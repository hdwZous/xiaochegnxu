"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.closeWebView=exports.postMsgUpdateV=exports.toAppPageFn=exports.abTest=exports.subscribeMsginfo=exports.getAddress=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,a=arguments[t];for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},_indexWeapp=(exports.getNewOpenId=getNewOpenId,exports.getDaoJiaLocation=getDaoJiaLocation,require("../../npm/@jd/djmp/common-t/js/http/index.weapp.js")),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/env/index.weapp.js"),address="local/getAddressN",getAddress=exports.getAddress=function(){return(0,_indexWeapp.request)({functionId:address,isNeedDealError:!0,body:0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}})},subscribeMsg="xapp/subscribeMsg",subscribeMsginfo=exports.subscribeMsginfo=function(){return(0,_indexWeapp.request)({functionId:subscribeMsg,isNeedDealError:!0,body:JSON.stringify(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})})},abTestFnKey="xapp/abTest",abTest=exports.abTest=function(){return(0,_indexWeapp.request)({functionId:abTestFnKey,isNeedDealError:!0,body:JSON.stringify(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})})};function getNewOpenId(){return new Promise(function(a,e){wx.getStorageSync("openId")?a(wx.getStorageSync("openId")):wx.login({success:function(e){if(e.code){var t=0;try{t=wx.getStorageSync("sKey")||0}catch(e){}(0,_indexWeapp.request)({method:"post",functionId:"xapp/wechat/getWxUserInfoAndLog",appVersion:"8.26.0",body:{xcxType:1,jsCode:t+","+e.code},isNeedDealError:!0,isNeedDealLogin:!0}).then(function(e){if(0==e.data.code){var e=e.data.result||{},t=e.openId,t=void 0===t?"":t,i=e.skey,i=void 0===i?"":i,e=e.unionid,e=void 0===e?"":e;if(t)try{wx.setStorageSync("openId",t),a(t)}catch(e){}if(i)try{wx.setStorageSync("sKey",i)}catch(e){}if(e)try{wx.setStorageSync("unionid",e)}catch(e){}try{wx.setStorageSync("JDHasUseLogin",!0)}catch(e){}}}).catch(function(e){})}},fail:function(e){}})})}function getDaoJiaLocation(i,a,e){(0,_indexWeapp.request)(_extends({functionId:"local/getAddressN",appVersion:"8.26.0",body:{longitude:i.longitude,latitude:i.latitude,coord_type:"1",needMatch:0}},e)).then(function(e){if(e&&e.data)if("0"==e.data.code&&e.data.result){var t=e.data.result.title,e=e.data.result,t=t||e.poi||e.title||e.address||e.district||e.addressName||"",t={longitude:e.longitude||"",latitude:e.latitude||"",cityId:e.cityId||e.areaCode||e.cityCode||"",cityName:e.city||cityName||"",countyName:e.district,districtCode:e.districtCode||"",poi:t,adcode:e.adcode};try{wx.setStorageSync("realTimeLocation",t)}catch(e){}a&&a(t,i)}else{try{wx.removeStorageSync("realTimeLocation")}catch(e){}a&&a(null)}else{try{wx.removeStorageSync("realTimeLocation")}catch(e){}a&&a(null)}}).catch(function(e){a&&a(null)})}var toAppPageFn=exports.toAppPageFn=function(){if(_indexWeapp2.isDaojiaApp&&0<=_isCompatible(String(_indexWeapp2.djAppVersion),String("8.6.0")))if(_indexWeapp2.isIOS)_indexWeapp2.supportDJSHWK?window.webkit.messageHandlers.MobileNavi.postMessage({to:"web",method:"toAppPage",params:JSON.stringify({url:url}),callBackName:null,callBackId:null}):toAppPage("toAppPage",JSON.stringify({url:url}));else{if(!_indexWeapp2.isAndroid)return Taro.navigateTo({url:handleUrlInH5(url)});window.djJava.toAppPage("web",JSON.stringify({url:url}),"")}},postMsgUpdateV=exports.postMsgUpdateV=function(){_indexWeapp2.isDaojiaApp&&0<=_isCompatible(String(_indexWeapp2.djAppVersion),String("8.6.0"))&&(_indexWeapp2.isIOS?_indexWeapp2.supportDJSHWK&&window.webkit.messageHandlers.MobileNavi.postMessage({method:"updateVPlusPage",callBackName:null,callBackId:null}):_indexWeapp2.isAndroid&&window.djJava.closeWebview&&window.djJava.updateVPlusPage())},closeWebView=exports.closeWebView=function(){_indexWeapp2.isDaojiaApp&&0<=_isCompatible(String(_indexWeapp2.djAppVersion),String("8.6.0"))&&(_indexWeapp2.isIOS?_indexWeapp2.supportDJSHWK&&window.webkit.messageHandlers.MobileNavi.postMessage({method:"closeWebview",callBackName:null,callBackId:null}):_indexWeapp2.isAndroid&&window.djJava.closeWebview&&window.djJava.closeWebview())};function _isCompatible(e,t){e=e.split("."),t=t.split(".");for(var i=Math.max(e.length,t.length);e.length<i;)e.push("0");for(;t.length<i;)t.push("0");for(var a=0;a<i;a++){var n=parseInt(e[a]),o=parseInt(t[a]);if(o<n)return 1;if(n<o)return-1}return 0}