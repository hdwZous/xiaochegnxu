import{isDaojiaApp,isJDReactNativeWebView,isJDApp,isDjXcxWebview,isInWeappH5,isXcxWebview}from"../env/index.h5";import{urlToName,paramsToObj}from"./utils";import{CXC_MAP}from"./map";import{ADDRESS_INFO}from"../../constants/index.h5";import{getStorageSync}from"../storage/index.h5";import{setDjmsg,isInWhiteList}from"../utils/utils";const{HOME,STORE,BACK,MYCOUPON,STORELIST,BARGAINDETAIL,SIGIN,PUNCH,FRIENDHELPLIST,BARGAINLIST,LOTTERY,GROUPBUYLIST,TASKLIST,BEANS,NEWSIGNIN,PHONECHARGE,ACTIVITYDETAIL,VIPMEMBER,JDWEB,WEB,MERCHANTMEMBER,ORCHARD,CASH,NEWUSER,PRODUCTDETAIL,SETTLEMENT,COUPONGOODSLIST}=require("./pageName.json"),navigateToAPP=(e,a)=>{let t={};var{storeId:o="",skuId:s="",orgCode:i="",needAnchorSku:r,addCart:c,needAddCar:I,userAction:u,saleType:T="",skuCount:l=1,preSaleSkuInfos:n="",settleShowType:m=""}=a;switch(e){case HOME:t={params:a,to:e};break;case STORE:t={params:{storeId:o,skuId:s,orgCode:i,cartType:0,needAnchorSku:r||!1,addCart:c||!1,needAddCar:I||!1,userAction:u||""},to:e};break;case STORELIST:var{limitId:d,jumpType:p}=a;t={params:{limitId:d,jumpType:p||"goodsList"},to:"storeList"};break;case COUPONGOODSLIST:t={params:{couponId:a.limitId,limitId:a.limitId,storeId:a.storeId,orgCode:a.orgCode,jumpType:"couponGoodsList",passThroughParam:a.passThroughParam,needAnchorSku:!1},to:"couponGoodsList"};break;case MYCOUPON:t={params:{},to:e};break;case BACK:t={params:{},to:"closeWeb"};break;case ACTIVITYDETAIL:d=a["activityId"];t={params:{activityId:d},to:e};break;case JDWEB:p=a["extraUrl"];t={params:{url:p},to:e};break;case WEB:d=a["extraUrlInDJ"];t={params:{url:d},to:e};break;case SETTLEMENT:t={params:{storeId:o,orgCode:i,skuId:s,saleType:T,skuCount:l,preSaleSkuInfos:JSON.parse(n),skuList:JSON.parse(n)},to:e};break;case PRODUCTDETAIL:t={params:{storeId:o,orgCode:i,skuId:s,settleShowType:m},to:e};break;default:t={params:{},to:"home"}}return"closeWeb"===t.to?"openapp.jddj://communication/closeWeb":"openApp.jddj://communication?body="+encodeURIComponent(JSON.stringify(t))},navigateToRn=(c,a)=>{let t={},o="";var{storeId:s,orgCode:i="",skuId:r,promotionType:I,activityId:u,hasGoods:T,needAddCart:l,storetypeId:m,promotionInfoId:E,jumpType:h,latitude:n="",longitude:d="",channel_name:e="",ret_type:g="",spuId:S="",saleType:C="",settleType:A="",skuCount:N=1,settleShowType:O=""}=a||{},e=e||"";let p=null;switch(c){case HOME:t={tab:"Home"},o=JSON.parse('{"pagename":"Main","args":'+JSON.stringify(t)+"}");break;case STORE:t={orgCode:i||"",storeId:s,skuId:r||"",promotionType:I||"",activityId:u||"",hasGoods:T||!1,needAddCart:l||!1,second:a.second||"",popup:a.popup||"",channel:a.channel||"",channelBusiness:a.channelBusiness||"",strategyCode:a.strategyCode||"",popupCoupon:a.popupCoupon||""},o='{"pagename":"StoreHome","args":'+JSON.stringify(t)+"}",p={h5hash:`storeHome/storeId:${s||""}/orgCode:`+(i||""),latitude:n||"",longitude:d||"",second:a.second||"",popup:a.popup||"",channel:a.channel||"",channelBusiness:a.channelBusiness||"",strategyCode:a.strategyCode||"",popupCoupon:a.popupCoupon||""};break;case MYCOUPON:o='{"pagename":"CouponsList","args":'+JSON.stringify(t)+"}";break;case STORELIST:t={storetypeId:m,promotionInfoId:E,jumpType:h||""},o='{"pagename":"StoreList","args":'+JSON.stringify(t)+"}";break;case COUPONGOODSLIST:let e="";a.passThroughParam&&(e=a.passThroughParam.code||""),t={limitId:a.limitId,couponPattern:a.couponPattern,jumpType:a.jumpType,passThroughParam:JSON.stringify({...a.passThroughParam,markState:3}),couponId:a.couponId,activityCode:e,storeId:a.storeId},o='{"pagename":"NewCouponBuy","args":'+JSON.stringify(t)+"}";break;case BACK:t={to:"closeWeb"},o="closeJDApp://webview?refresh=false";break;case ACTIVITYDETAIL:t={activityId:u,activityType:"cms",actFrom:"vplus"},o='{"pagename":"activityDetail","args":'+JSON.stringify(t)+"}";break;case SETTLEMENT:t={storeId:s,orgCode:i,skuId:r,settleType:A,saleType:C,skuCount:N},o='{"pagename":"Settlement","args":'+JSON.stringify(t)+"}";break;case PRODUCTDETAIL:t={storeId:s,orgCode:i,skuId:r,ret_type:g,spuId:S,settleShowType:O},o='{"pagename":"GoodsDetail","args":'+JSON.stringify(t)+"}";break;default:t={tab:"Home"},o=JSON.parse('{"pagename":"Main","args":'+JSON.stringify(t)+"}")}if("closeWeb"!==t.to)return p?'openapp.jdmobile://virtual?params={"category":"jump","des":"jdreactcommon","modulename":"JDReactDaoJia","appname":"JDReactDaoJia","ishidden":true,"latitude":"'+n+'","longitude":"'+d+'","channel_name":"'+e+'","param":{"entrance":'+JSON.stringify(o)+'},"h5params":'+JSON.stringify(p)+"}":'openapp.jdmobile://virtual?params={"category":"jump","des":"jdreactcommon","modulename":"JDReactDaoJia","appname":"JDReactDaoJia","ishidden":true,"latitude":"'+n+'","longitude":"'+d+'","channel_name":"'+e+'","param":{"entrance":'+JSON.stringify(o)+"}}";window.location.href=o},navigateToXcxWebview=(e,a={})=>{if(a.extraUrl)return a.extraUrl;if(a&&"object"==typeof a){if(!isDjXcxWebview())return a={...a,fromWq:!0},navigateToH5(e,a);a={...a,_is_djxcx_:1}}let t="";var o={[HOME]:"/html/index.html",[STORE]:"#storeHome",[MYCOUPON]:"#couponsList",[STORELIST]:"#storeList",[BARGAINDETAIL]:"/xcxh5/#/bargain/detail",[BARGAINLIST]:"/xcxh5/#/bargain/list",[LOTTERY]:"/xcxh5/#/lottery/list",[FRIENDHELPLIST]:"/taroh5/h5dist/#/pages/friendHelp/list/index",[GROUPBUYLIST]:"/taroh5/h5dist/#/pages/GroupBuy/List/index",[PUNCH]:"/taroh5/h5dist/#/pages/punch-t/home/index",[SIGIN]:"/activity/market/signIn/index.html",[TASKLIST]:"/taroh5/h5dist/#/pages/signIn-t/taskList/index",[BEANS]:"/taroh5/h5dist/#/pages/bean-t/index",[NEWSIGNIN]:"/taroh5/h5dist/#/pages/tabBar/signIn-t/index",[PHONECHARGE]:"/taroh5/h5dist/#/pages/phoneCharge-t/index",[VIPMEMBER]:"/pages/vpayMember-t/home/index",[ACTIVITYDETAIL]:"#activityPage",[MERCHANTMEMBER]:"/activity/memberCard/index.html",[ORCHARD]:"/taro2orchard/h5dist/#/pages/orchard-t/index",[CASH]:"/taro2cash/h5dist/index.html#/pages/cash-t/index"};switch(e){case HOME:if("{}"!=JSON.stringify(a)){let e="";for(var s in a)e+="&"+s+"="+a[s];e=e.slice(1),t=o[HOME]+"?"+e}else t=o[HOME];break;case STORE:t=`/html/index.html?_is_djxcx_=${a._is_djxcx_||""}&strategyCode=${a.strategyCode||""}&channelBusiness=${a.channelBusiness||""}&popupCoupon=${a.popupCoupon||""}&channel=${a.channel||""}&second=${a.second||""}&popup=${a.popup||""}&latitude=${a.latitude||""}&longitude=${a.longitude||""}${o[STORE]}/storeId:${a.storeId||""}/skuId:${a.skuId||""}/orgCode:${a.orgCode||""}/needAddCart:${a.needAddCart||!1}/addCart:`+(a.needAddCart||!1);break;case MYCOUPON:t="/html/index.html?_is_djxcx_="+(a._is_djxcx_||"")+o[MYCOUPON];break;case STORELIST:t=`/html/index.html?_is_djxcx_=${a._is_djxcx_||""}${o[STORELIST]}/storetypeId:/promotionInfoId:${a.limitId||""}/jumpType:`+(a.jumpType||"");break;case BACK:var{delta:i=1}=a;history.go(-i);break;case BARGAINDETAIL:i={storeId:a.storeId||"",activityId:a.activityId||"",skuId:a.unionCode||a.skuId||"",orgCode:a.orgCode||""};t=o[BARGAINDETAIL]+"/"+JSON.stringify(i);break;case BARGAINLIST:t=o[BARGAINLIST];break;case SIGIN:t=o[SIGIN];break;case PUNCH:t=a&&a.userAction?o[PUNCH]+"?userAction="+a.userAction:o[PUNCH];break;case FRIENDHELPLIST:t=a&&a.userAction?o[FRIENDHELPLIST]+"?userAction="+a.userAction:o[FRIENDHELPLIST];break;case LOTTERY:t=o[LOTTERY];break;case GROUPBUYLIST:t=o[GROUPBUYLIST];break;case TASKLIST:t=a&&a.userAction?o[TASKLIST]+"?userAction="+a.userAction:o[TASKLIST];break;case BEANS:t=o[BEANS];break;case NEWSIGNIN:t=o[NEWSIGNIN];break;case PHONECHARGE:t=o[PHONECHARGE];break;case VIPMEMBER:t=o[VIPMEMBER];break;case ACTIVITYDETAIL:t=`/html/index.html?_is_djxcx_=${a._is_djxcx_||""}${o[ACTIVITYDETAIL]}/actNativeId:`+a.activityId;break;case MERCHANTMEMBER:t=`${o[MERCHANTMEMBER]}?_is_djxcx_=${a._is_djxcx_||""}&orgCode=${a.orgCode}&storeId=${a.storeId}&source=${a.source}&identificationCode=`+a.identificationCode;break;case ORCHARD:t=o[ORCHARD];break;default:t=o[HOME]}return t?window.location.origin+t:window.location.origin+o[HOME]},navigateToH5=(r,n={})=>{if(n.extraUrl)return n.extraUrl;isXcxWebview&&n&&"object"==typeof n&&(n=isDjXcxWebview()?{...n,_is_djxcx_:1}:{...n,fromWq:!0});let d="";var p={[HOME]:"/html/index.html",[STORE]:"#storeHome",[MYCOUPON]:"#couponsList",[STORELIST]:"#storeList",[BARGAINDETAIL]:"/xcxh5/#/bargain/detail",[BARGAINLIST]:"/xcxh5/#/bargain/list",[LOTTERY]:"/xcxh5/#/lottery/list",[FRIENDHELPLIST]:"/taroh5/h5dist/#/pages/friendHelp/list/index",[GROUPBUYLIST]:"/taroh5/h5dist/#/pages/GroupBuy/List/index",[PUNCH]:"/taroh5/h5dist/#/pages/punch-t/home/index",[SIGIN]:"/activity/market/signIn/index.html",[TASKLIST]:"/taroh5/h5dist/#/pages/signIn-t/taskList/index",[BEANS]:"/taroh5/h5dist/#/pages/bean-t/index",[NEWSIGNIN]:"/taroh5/h5dist/#/pages/tabBar/signIn-t/index",[PHONECHARGE]:"/taroh5/h5dist/#/pages/phoneCharge-t/index",[VIPMEMBER]:"/pages/vpayMember-t/home/index",[ACTIVITYDETAIL]:"#activityPage",[MERCHANTMEMBER]:"/activity/memberCard/index.html",[ORCHARD]:"/taro2orchard/h5dist/#/pages/orchard-t/index",[CASH]:"/taro2cash/h5dist/index.html#/pages/cash-t/index",[NEWUSER]:"/taroh5/h5dist/#/pages/newUser-t/index",[PRODUCTDETAIL]:"/goodsDetails",[SETTLEMENT]:"/Settlement"};let c="";switch(r){case HOME:if("{}"!=JSON.stringify(n)){let e="";for(var I in n)e+="&"+I+"="+n[I];e=e.slice(1),d=p[HOME]+"?"+e}else d=p[HOME];break;case STORE:if(d=`/html/index.html?_is_djxcx_=${n._is_djxcx_||""}&strategyCode=${n.strategyCode||""}&channelBusiness=${n.channelBusiness||""}&popupCoupon=${n.popupCoupon||""}&channel=${n.channel||""}&second=${n.second||""}&popup=${n.popup||""}&latitude=${n.latitude||""}&longitude=${n.longitude||""}${p[STORE]}/storeId:${n.storeId||""}/skuId:${n.skuId||""}/orgCode:${n.orgCode||""}/needAddCart:${n.needAddCart||!1}/addCart:`+(n.needAddCart||!1),isInWhiteList(window.location.origin+d)){const c=setDjmsg({latitude:n.latitude||"",longitude:n.longitude||""});d=`/html/index.html?_is_djxcx_=${n._is_djxcx_||""}&strategyCode=${n.strategyCode||""}&channelBusiness=${n.channelBusiness||""}&popupCoupon=${n.popupCoupon||""}&channel=${n.channel||""}&second=${n.second||""}&popup=${n.popup||""}&djmsg=${c}${p[STORE]}/storeId:${n.storeId||""}/skuId:${n.skuId||""}/orgCode:${n.orgCode||""}/needAddCart:${n.needAddCart||!1}/addCart:`+(n.needAddCart||!1)}break;case MYCOUPON:d="/html/index.html?_is_djxcx_="+(n._is_djxcx_||"")+p[MYCOUPON];break;case STORELIST:d=`/html/index.html?_is_djxcx_=${n._is_djxcx_||""}${p[STORELIST]}/storetypeId:/promotionInfoId:${n.limitId||""}/jumpType:`+(n.jumpType||"");break;case COUPONGOODSLIST:let{limitId:e="",couponPattern:a="",jumpType:t="",passThroughParam:o="",couponId:s=""}=n,i="";o&&(i=o.code||"",o=encodeURIComponent(JSON.stringify({...o,markState:3}))),c=(()=>{var e=getStorageSync(ADDRESS_INFO),{latitude:e,longitude:a,cityId:t}=(e&&"string"==typeof e?JSON.parse(e):e)||{};return setDjmsg({lat:e,lng:a,city_id:t,latitude:e,longitude:a,cityId:t})})(),d=`/html/index/NewCouponBuy?limitId=${e}&jumpType=${t}&couponPattern=${a}&passThroughParam=${o}&couponId=${s||e}&activityCode=${i}&djmsg=`+c;break;case BACK:var{delta:u=1}=n;history.go(-u);break;case BARGAINDETAIL:u={storeId:n.storeId||"",activityId:n.activityId||"",skuId:n.unionCode||n.skuId||"",orgCode:n.orgCode||""};d=p[BARGAINDETAIL]+"/"+JSON.stringify(u);break;case BARGAINLIST:d=p[BARGAINLIST];break;case SIGIN:d=p[SIGIN];break;case PUNCH:d=n&&n.userAction?p[PUNCH]+"?userAction="+n.userAction:p[PUNCH];break;case FRIENDHELPLIST:d=n&&n.userAction?p[FRIENDHELPLIST]+"?userAction="+n.userAction:p[FRIENDHELPLIST];break;case LOTTERY:d=p[LOTTERY];break;case GROUPBUYLIST:d=p[GROUPBUYLIST];break;case TASKLIST:d=n&&n.userAction?p[TASKLIST]+"?userAction="+n.userAction:p[TASKLIST];break;case BEANS:d=p[BEANS];break;case NEWSIGNIN:d=p[NEWSIGNIN];break;case PHONECHARGE:d=p[PHONECHARGE];break;case VIPMEMBER:d=p[VIPMEMBER];break;case ACTIVITYDETAIL:d=`/html/index.html?_is_djxcx_=${n._is_djxcx_||""}${p[ACTIVITYDETAIL]}/actNativeId:`+n.activityId;break;case MERCHANTMEMBER:d=`${p[MERCHANTMEMBER]}?_is_djxcx_=${n._is_djxcx_||""}&orgCode=${n.orgCode}&storeId=${n.storeId}&source=${n.source}&identificationCode=`+n.identificationCode;break;case ORCHARD:d=p[ORCHARD];break;case NEWUSER:d=n&&n.channel?p[NEWUSER]+"?channel="+n.channel:p[NEWUSER];break;case PRODUCTDETAIL:d=`/html/index/goodsDetails?_is_djxcx_=${n._is_djxcx_||""}&channel=${n.channel||""}&orgCode=${n.orgCode||""}&storeId=${n.storeId||""}&skuId=${n.skuId||""}&spuId=${n.spuId||""}&settleShowType=`+(n.settleShowType||"");break;case SETTLEMENT:d=`/html/index/newSettlement?_is_djxcx_=${n._is_djxcx_||""}&channel=${n.channel||""}&orgCode=${n.orgCode||""}&storeId=${n.storeId||""}&skuId=${n.skuId||""}&settleType=${n.settleType||"0"}&saleType=${n.saleType||"5"}&skuCount=`+(n.skuCount||1);break;default:d=p[HOME]}return d?window.location.origin+d:window.location.origin+p[HOME]},jump=({to:e="home",type:a="",params:t={}}={})=>{let o="";(o=("h5"===a?navigateToH5:isDaojiaApp?navigateToAPP:isJDApp||isJDReactNativeWebView?navigateToRn:navigateToH5)(e,t))&&(window.location.href=o)},autoJump=({url:e="",nativePageUrl:a="",nativePageParam:t=""}={},o="")=>{var s;e&&urlToName(e)?(s=e&&e.split("?")[1]||"",jump({type:o,to:urlToName(e),params:paramsToObj(s)})):a&&CXC_MAP[a]?jump({type:o,to:CXC_MAP[a]||"home",params:paramsToObj(t)}):window.location.href=e};export{jump,autoJump};