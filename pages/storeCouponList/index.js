require("./runtime"),require("./vendors"),(wx["webpackJsonp/pages/storeCouponList/"]=wx["webpackJsonp/pages/storeCouponList/"]||[]).push([[2],{137:function(e,t,o){"use strict";o.r(t);var n=o(1),a=o(26),r=o(10),i=o(11),c=o(12),s=o(27),u=o(22),l=o(20),p=o(21),d=o(3),g=(o(102),o(4)),m=o(0),b=(o(16),o(7)),f=o.n(b),h=o(34),j=o.n(h),v=f.a.createContext({options:{},observer:null}),O=o(85),x=o.n(O),y=o(63),C=function(e){Object(l.a)(VisibleLogItem,e);var t=Object(p.a)(VisibleLogItem);function VisibleLogItem(){return Object(r.a)(this,VisibleLogItem),t.apply(this,arguments)}return Object(i.a)(VisibleLogItem,[{key:"componentDidMount",value:function componentDidMount(){var e,t=this;this.entry.onVisible=this.props.onVisible,this.entry.onHidden=this.props.onHidden,this.entry.visibleCallback=this.props.visibleCallback,null===(e=this.arr)||void 0===e||e.push((function(e){var o;(null===(o=t.entry)||void 0===o?void 0:o.uid)===e.id&&(null==e?void 0:e.intersectionRatio)>=(null===y.a||void 0===y.a?void 0:y.a.epMTADelayRatio)&&t.props.onVisible(e)}))}},{key:"componentWillUnmount",value:function componentWillUnmount(){}},{key:"render",value:function render(){var e=this,t=this.props,o=t.children,n=t.style,a=t.logSendData,r=void 0===a?{}:a,i=(t.addElClassName,t.innerStyle),c=t.onLayout,s=r.userAction,u=Array.isArray(s);return this.random=Math.random().toString().replace(".","")+"_"+Date.now(),Object(m.jsx)(v.Consumer,{children:function children(t){var a=t.options,r=t.userData,l=t.observer,p=t.arr;return e.options=a,e.userData=r,e.observer=l,e.arr=p,Object(m.jsx)(g.f,{ref:function ref(t){e.entry=t},className:x()("exposure"),"data-useraction":u?"":s,"data-useraction-list":u?JSON.stringify(s):"",style:i,children:Object(m.jsx)(g.f,{style:n,onLayout:c,children:o})})}})}}]),VisibleLogItem}(b.Component);Object(d.a)(C,"propTypes",{onVisible:j.a.func,onHidden:j.a.func,visibleCallback:j.a.func,style:j.a.oneOfType([j.a.array,j.a.object])}),Object(d.a)(C,"defaultProps",{onVisible:function onVisible(){},onHidden:function onHidden(){},visibleCallback:function visibleCallback(){},style:{}});var w=o(15),S=(o(29),o(42)),I=o.n(S),k=function Tip(e){var t=e.type,o=e.callBack,n=e.tipText,a=e.tipDesc,r=void 0===a?"":a,i=e.tipTitle,c=void 0===i?"":i,s=function getImage(e){return{nothing:{url:"https://storage.360buyimg.com/wximg/common/errorbar_icon_nothingV2.png",width:160,height:160,button:"重新加载"},graydog:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/graydog.png",width:160,height:160,button:"重新加载"},graydogNoBtn:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/graydog.png",width:160,height:160},addNewAddress:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/graydog.png",width:160,height:160,msg:"新建收货地址",button:"新建地址"},loadError:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/graydog.png",width:160,height:160,button:"重新加载"},noAddress:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/graydog.png",width:160,height:160,msg:"地址获取失败",button:"重新加载"},noCoupon:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/noCoupon.png",width:160,height:160},noSearch:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/noSearch.png",width:160,height:160},unlogin:{url:"https://static-o2o.360buyimg.com/activity/images/fe/emtip_unLogin.png",width:160,height:160,msg:"请您登录",button:"立即登录"},noShop:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/noShop.png",width:160,height:160},cartEmpty:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/cart_empty.png",width:160,height:160},shopDown:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/store_offline.png",width:160,height:160,button:"去首页逛逛",page:"Main",args:{tab:"Home"}},nowifi:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/nowifi.png",width:160,height:160,button:"重新加载"},network:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/nowifi.png",width:160,height:160,button:"重新加载"},poiAddress:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/noAddress.png",width:160,height:160,msg:"请手动输入地址"},noFeed:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/noCover.png",width:160,height:160,msg:"很抱歉，当前位置未开通服务"},hasNoActivity:{url:"https://storage.360buyimg.com/wximg/merchant/vipChannel/noSearch.png",width:160,height:160,msg:"这里没有活动，回首页逛逛吧[0001]",button:"返回首页"},hasNoCoupon:{url:"https://storage.360buyimg.com/flutter-mock/tip_noCoupon.196a080c.png",width:160,height:160,msg:"暂无可用优惠券"}}[e]||{}}(t),u=s.url,l=s.width,p=s.height;return u?Object(m.jsxs)(g.f,{className:I.a.tipcontainer,style:{minHeight:e.height},children:[Object(m.jsx)(g.a,{className:I.a.img,style:{width:l,height:p},src:u}),!!c&&Object(m.jsx)(g.e,{className:I.a.tipTitle,children:c}),!!r&&Object(m.jsx)(g.e,{className:I.a.tipDesc,children:r}),!!n&&Object(m.jsx)(g.f,{className:I.a.tipButton,onClick:o,children:n})]}):null},P=o(86),L=o.n(P),B=function Loading(e){return Object(m.jsx)(g.a,{className:L.a.loading,src:"https://storage.360buyimg.com/wximg/merchant/vipChannel/newLoading.gif"})},N=o(14),A=o.n(N),D=o(88),W=(o(95),o(24)),H=function requestAdpter(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={xcxVersion:"8.28.0",appVersion:"8.28.0"};return Object(D.a)(Object(n.a)(Object(n.a)({},e),t))},M=o(72),E=o.n(M),R=o(28);function safe_add(e,t){var o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}function md5_cmn(e,t,o,n,a,r){return safe_add(function bit_rol(e,t){return e<<t|e>>>32-t}(safe_add(safe_add(t,e),safe_add(n,r)),a),o)}function md5_ff(e,t,o,n,a,r,i){return md5_cmn(t&o|~t&n,e,t,a,r,i)}function md5_gg(e,t,o,n,a,r,i){return md5_cmn(t&n|o&~n,e,t,a,r,i)}function md5_hh(e,t,o,n,a,r,i){return md5_cmn(t^o^n,e,t,a,r,i)}function md5_ii(e,t,o,n,a,r,i){return md5_cmn(o^(t|~n),e,t,a,r,i)}function binl_md5(e,t){var o,n,a,r,i;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var c=1732584193,s=-271733879,u=-1732584194,l=271733878;for(o=0;o<e.length;o+=16)n=c,a=s,r=u,i=l,c=md5_ff(c,s,u,l,e[o],7,-680876936),l=md5_ff(l,c,s,u,e[o+1],12,-389564586),u=md5_ff(u,l,c,s,e[o+2],17,606105819),s=md5_ff(s,u,l,c,e[o+3],22,-1044525330),c=md5_ff(c,s,u,l,e[o+4],7,-176418897),l=md5_ff(l,c,s,u,e[o+5],12,1200080426),u=md5_ff(u,l,c,s,e[o+6],17,-1473231341),s=md5_ff(s,u,l,c,e[o+7],22,-45705983),c=md5_ff(c,s,u,l,e[o+8],7,1770035416),l=md5_ff(l,c,s,u,e[o+9],12,-1958414417),u=md5_ff(u,l,c,s,e[o+10],17,-42063),s=md5_ff(s,u,l,c,e[o+11],22,-1990404162),c=md5_ff(c,s,u,l,e[o+12],7,1804603682),l=md5_ff(l,c,s,u,e[o+13],12,-40341101),u=md5_ff(u,l,c,s,e[o+14],17,-1502002290),c=md5_gg(c,s=md5_ff(s,u,l,c,e[o+15],22,1236535329),u,l,e[o+1],5,-165796510),l=md5_gg(l,c,s,u,e[o+6],9,-1069501632),u=md5_gg(u,l,c,s,e[o+11],14,643717713),s=md5_gg(s,u,l,c,e[o],20,-373897302),c=md5_gg(c,s,u,l,e[o+5],5,-701558691),l=md5_gg(l,c,s,u,e[o+10],9,38016083),u=md5_gg(u,l,c,s,e[o+15],14,-660478335),s=md5_gg(s,u,l,c,e[o+4],20,-405537848),c=md5_gg(c,s,u,l,e[o+9],5,568446438),l=md5_gg(l,c,s,u,e[o+14],9,-1019803690),u=md5_gg(u,l,c,s,e[o+3],14,-187363961),s=md5_gg(s,u,l,c,e[o+8],20,1163531501),c=md5_gg(c,s,u,l,e[o+13],5,-1444681467),l=md5_gg(l,c,s,u,e[o+2],9,-51403784),u=md5_gg(u,l,c,s,e[o+7],14,1735328473),c=md5_hh(c,s=md5_gg(s,u,l,c,e[o+12],20,-1926607734),u,l,e[o+5],4,-378558),l=md5_hh(l,c,s,u,e[o+8],11,-2022574463),u=md5_hh(u,l,c,s,e[o+11],16,1839030562),s=md5_hh(s,u,l,c,e[o+14],23,-35309556),c=md5_hh(c,s,u,l,e[o+1],4,-1530992060),l=md5_hh(l,c,s,u,e[o+4],11,1272893353),u=md5_hh(u,l,c,s,e[o+7],16,-155497632),s=md5_hh(s,u,l,c,e[o+10],23,-1094730640),c=md5_hh(c,s,u,l,e[o+13],4,681279174),l=md5_hh(l,c,s,u,e[o],11,-358537222),u=md5_hh(u,l,c,s,e[o+3],16,-722521979),s=md5_hh(s,u,l,c,e[o+6],23,76029189),c=md5_hh(c,s,u,l,e[o+9],4,-640364487),l=md5_hh(l,c,s,u,e[o+12],11,-421815835),u=md5_hh(u,l,c,s,e[o+15],16,530742520),c=md5_ii(c,s=md5_hh(s,u,l,c,e[o+2],23,-995338651),u,l,e[o],6,-198630844),l=md5_ii(l,c,s,u,e[o+7],10,1126891415),u=md5_ii(u,l,c,s,e[o+14],15,-1416354905),s=md5_ii(s,u,l,c,e[o+5],21,-57434055),c=md5_ii(c,s,u,l,e[o+12],6,1700485571),l=md5_ii(l,c,s,u,e[o+3],10,-1894986606),u=md5_ii(u,l,c,s,e[o+10],15,-1051523),s=md5_ii(s,u,l,c,e[o+1],21,-2054922799),c=md5_ii(c,s,u,l,e[o+8],6,1873313359),l=md5_ii(l,c,s,u,e[o+15],10,-30611744),u=md5_ii(u,l,c,s,e[o+6],15,-1560198380),s=md5_ii(s,u,l,c,e[o+13],21,1309151649),c=md5_ii(c,s,u,l,e[o+4],6,-145523070),l=md5_ii(l,c,s,u,e[o+11],10,-1120210379),u=md5_ii(u,l,c,s,e[o+2],15,718787259),s=md5_ii(s,u,l,c,e[o+9],21,-343485551),c=safe_add(c,n),s=safe_add(s,a),u=safe_add(u,r),l=safe_add(l,i);return[c,s,u,l]}function binl2rstr(e){var t,o="";for(t=0;t<32*e.length;t+=8)o+=String.fromCharCode(e[t>>5]>>>t%32&255);return o}function rstr2binl(e){var t,o=[];for(o[(e.length>>2)-1]=void 0,t=0;t<o.length;t+=1)o[t]=0;for(t=0;t<8*e.length;t+=8)o[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return o}function rstr2hex(e){var t,o,n="";for(o=0;o<e.length;o+=1)t=e.charCodeAt(o),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function str2rstr_utf8(e){return unescape(encodeURIComponent(e))}function raw_md5(e){return function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),8*e.length))}(str2rstr_utf8(e))}function raw_hmac_md5(e,t){return function rstr_hmac_md5(e,t){var o,n,a=rstr2binl(e),r=[],i=[];for(r[15]=i[15]=void 0,a.length>16&&(a=binl_md5(a,8*e.length)),o=0;o<16;o+=1)r[o]=909522486^a[o],i[o]=1549556828^a[o];return n=binl_md5(r.concat(rstr2binl(t)),512+8*t.length),binl2rstr(binl_md5(i.concat(n),640))}(str2rstr_utf8(e),str2rstr_utf8(t))}var U=function md5(e,t,o){return t?o?raw_hmac_md5(t,e):function hex_hmac_md5(e,t){return rstr2hex(raw_hmac_md5(e,t))}(t,e):o?raw_md5(e):function hex_md5(e){return rstr2hex(raw_md5(e))}(e)},V=(new Date).getTime(),F=function generateId(){var e=(A.a.getStorageSync("login_info")||{}).deviceid_pdj_jd;return V+++e+Math.random().toString().substr(1)+"."+(new Date).getTime()};function pageIdFormation(e,t,o,n,a){var r="string"==typeof o?o:o===GOTO?"g":o===GOBACK?"b":"u";return U((e?e+"-":"")+(a?a+"-":"")+t+"-"+r+(n?"-"+n:""))}var G=function(){function PageStackClass(){var e=this;Object(r.a)(this,PageStackClass),this.pages=[],this.getReferPage=function(t){if(!e.pages.length)return{ref_page_name:"",ref_path:"",refPageSource:""};var o;if(e.pages.forEach((function(e,n){e.page_name==t&&(o=n-1)})),o<0)return{ref_page_name:"",ref_path:"",refPageSource:""};var n=e.pages[o]||{};return{ref_page_name:n.page_name||"",ref_path:n.cur_path||"",refPageSource:n.pageSource}}}return Object(i.a)(PageStackClass,null,[{key:"generate",value:function generate(){return PageStackClass.instance||(PageStackClass.instance=new PageStackClass),PageStackClass.instance}}]),PageStackClass}().generate(),q=["lat","lng","city_id","poi","lat_pos","lng_pos","pageId","ref_page","$taroTimestamp","city_name","transparentenable","ref_par","userAction"],J=function(e){Object(l.a)(Page,e);var t=Object(p.a)(Page);function Page(){var e;Object(r.a)(this,Page);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),Object(d.a)(Object(c.a)(e),"$instance",Object(N.getCurrentInstance)()),Object(d.a)(Object(c.a)(e),"firstMount",!0),Object(d.a)(Object(c.a)(e),"getPageName",(function(){return e.page_name})),Object(d.a)(Object(c.a)(e),"getPageSource",(function(){return e.pageSource})),Object(d.a)(Object(c.a)(e),"pageId",pageIdFormation(e.getPageName(),F(),"GOTO","","")),Object(d.a)(Object(c.a)(e),"getPageParams",(function(){return{pageId:e.pageId,page_name:e.getPageName(),pageSource:e.getPageSource(),request_par:Object.assign(e.isPageHome&&(A.a.getLaunchOptionsSync()||{}).query||{},(e.$instance.router||{}).params||{}),cur_path:(e.$instance.router||{}).path}})),Object(d.a)(Object(c.a)(e),"pageInfoValue",Object(n.a)(Object(n.a)({},e.getPageParams()),G.getReferPage(e.getPageName()))),e}return Object(i.a)(Page,[{key:"componentWillMount",value:function componentWillMount(){this.sendPvData("goto")}},{key:"componentDidShow",value:function componentDidShow(){this.firstMount||this.sendPvData("back")}},{key:"componentDidHide",value:function componentDidHide(){Object(W.e)(Object(n.a)({},this.pageInfoValue)),this.firstMount=!1}},{key:"sendPvData",value:function sendPvData(e){try{var t=this.getPageParams(),o=G.pages,a=G.getReferPage,r=t.page_name;if(o.length)o[o.length-1].page_name!==r&&o.push(t);else o.push(t);var i=a(r),c="";(c=(t.request_par||{}).ref_page)&&(i.ref_page_name=c),this.pageInfoValue.ref_page_name=i.ref_page_name||"",this.pageInfoValue.ref_path=i.ref_path,this.pageInfoValue.page_name=this.getPageName();var s=t.request_par,u=(s.lat,s.lng,s.city_id,s.poi,s.lat_pos,s.lng_pos,s.pageId,s.ref_page,s.$taroTimestamp,s.city_name,s.transparentenable,s.ref_par),l=s.userAction,p=Object(R.a)(s,q);if(u){var d="{}";try{"string"==typeof u?(d=decodeURIComponent(u),d=JSON.parse(d)):d=u}catch(e){d=JSON.parse("{}")}p.ref_par=d}else if(l)try{p.ref_par={userAction:decodeURIComponent(l)}}catch(e){p.ref_par={userAction:l}}t.request_par=p,"back"==e&&(t.request_par.ret_Type="back",p.ref_par={}),Object(W.d)(Object(n.a)(Object(n.a)({},t),i))}catch(e){}}}]),Page}(b.Component),$=f.a.createContext({pageId:""}),z=o(18),K=o(23),Z=o(31),X=(o(132),o(46)),Y=o.n(X),Q=Object(b.memo)((function(e){Object(b.useEffect)((function(){var t=e||{},o=t.cats,n=t.selectedIndex;c({index:n,item:o[n],firstReport:!0})}),[]);var t=e||{},o=t.cats,a=t.selectedIndex,r=t.style,i=Object(b.useContext)($),c=function cateItemClick(t){var o=t.index,r=t.item,c=t.e,s=t.firstReport;c&&c.preventDefault(),c&&c.stopPropagation();var u={userAction:null==r?void 0:r.userAction};if(r.selected&&s&&(u.state=0),Object(W.a)(Object(n.a)({create_time:new Date,click_id:"selectTab",click_par:u},i)),a!==o){var l=e.cateChange;l&&l(o)}};return Object(m.jsx)(g.f,{className:Y.a.cateListWrap,style:r,children:Object(m.jsx)(g.d,{className:Y.a.scrollViewWrap,style:{height:"45px"},scrollX:!0,scrollY:!1,enhanced:!0,showScrollbar:!1,scrollLeft:100,children:null==o?void 0:o.map((function(e,t){var o=a===t;return Object(m.jsx)(g.f,{id:"first"+t,onClick:function onClick(){return c({index:t,item:e})},className:Y.a.cateItemWrap,style:{backgroundColor:o?"rgba(71,179,79,0.1)":"#f8f8f8"},children:Object(m.jsx)(g.e,{className:Y.a.cateText,style:{color:o?"#47b34f":"#000",fontWeight:o?"600":"400"},children:e.title})},t)}))})})})),ee=o(19),te=o(47),oe=o.n(te),ne=o(5),ae=o(13),re=function transferColorToRgb(e,t,o){if("string"!=typeof e&&!(e instanceof String))return console.error("请输入16进制字符串形式的颜色值");if(6!==(e="#"===e.charAt(0)?e.substring(1):e).length&&3!==e.length)return e;3===e.length&&(e=e.replace(/(\w)(\w)(\w)/,"$1$1$2$2$3$3"));for(var n=e.match(/\w{2}/g),a=0;a<n.length;a++)n[a]=parseInt(n[a],16).toString();return null!=t&&t>=0&&t<=1?"rgba(".concat(n.join(),",").concat(t,")"):"array"==o?n:"rgb("+n.join()+")"},ie=o(30),ce=["usedj"],se=["usedj"],ue=function api_singleCouponTready(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return H({functionId:"coupon/singleCouponTready",body:JSON.stringify(e),method:"GET"})};function api_getBrandLayer(e,t){var o=e||{},n=(o.usedj,Object(R.a)(o,ce));return H({functionId:"pavilionWeb/member/layerInfo",body:n})}function api_getCounponNew(e){var t={functionId:"coupon/grabCoupon",body:{code:e.code,fromSource:e.fromSource,storeNo:e.storeNo,operType:e.operType,isFans:e.isFans,isFloor:e.isFloor||0,needCouponGo:e.needCouponGo,grabPlat:"1",platNewActivityFlag:e.platNewActivityFlag||"",orgCode:e.orgCode,source:e.source,channel:e.channel,couponPattern:e.couponPattern,eid:e.eid,sdkToken:e.sdkToken}};return H(t)}var le={None:0,NotStart:1,NotGrab:2,HaveGrab:3,HaveUsed:4,HaveEmpty:5,HaveEnd:6,HaveEmptyToday:7,UnExchange:8,Exchange:9},pe={help:3,vPlus:4,redPacket:5,inflatedCoupon:6},de={notLimit:0,limit:1},ge=o(45),_e=o(61),me=function UpdateCouponStatus(e){wx.setStorageSync("backSource","couponMore")},be={0:function _(e){var t=e.item,o=(e.props,e.couponItem),n=e.message;return t.showLayer||Object(N.showToast)({title:n||"优惠券已领取成功"}),{activityCode:t.activityCode,couponItem:o,action:"getCouponSuccess"}},AC3600:function AC3600(e){e.item,e.props,e.data,e.message},AC4400:function AC4400(e){e.props,e.extFieldMap,e.message},AC4401:function AC4401(e){e.item,e.props,e.data,e.extFieldMap,e.message},AC4402:function AC4402(e){e.item,e.props,e.data;var t=e.result,o=(e.extFieldMap,e.message);t.extFieldMap||Object(N.showToast)({title:o||"优惠券领取失败"})},cacheForAC1205:[],AC1205:function AC1205(e){var t=e.busiCode,o=e.couponItem,n=e.message,a=e.responseList,r=e.result;if(Object(N.showToast)({title:n||"优惠券领取失败"}),a)return be.cacheForAC1205.push({couponId:o.couponId,result:r}),{couponItem:o,busiCode:t,action:"getCouponSuccess"}}};function normalCouponGrap(e,t){var o=t.params,a=void 0===o?{}:o,r=(t.p,t.cannotGrab),i=(null!=this&&this.gotCoupon?this.state:t).item;if(r)return function normalCouponGrapWithCached(e){var t,o=null===(t=be.cacheForAC1205.find((function(t){return t.couponId===e.couponId})))||void 0===t?void 0:t.result;o&&o.responseList&&Object(N.showToast)(o.message||"优惠券领取失败")}(i);e&&(a=Object(n.a)(Object(n.a)({},a),e)),console.log(i,"getCoupongetCoupon");var c={code:a.code||i.activityCode,fromSource:a.fromSource||2,storeNo:a.storeNo,operType:a.operType||1,isFans:a.isFans||i.isFans,isFloor:a.isFloor||0,needCouponGo:a.needCouponGo||!0,grabPlat:"1",platNewActivityFlag:a.platNewActivityFlag||i.platNewActivityFlag||"",orgCode:a.orgCode,source:a.source,channel:a.channel,usedj:!0};return A.a.showLoading({title:""}),new Promise(function(){var e=Object(ae.a)(Object(ne.a)().mark((function _callee(e){var o,n,a,r,s,u,l,p,d,g,m,b,f;return Object(ne.a)().wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,Object(ie.b)(api_getCounponNew(c));case 2:if(o=h.sent,n=Object(w.a)(o,2),a=n[0],r=n[1],console.log("error,resp",a,r),A.a.hideLoading(),!a){h.next=11;break}return 201==a.code||202==a.code?(Object(N.showToast)({title:a.msg||"为了您的账号安全，请重新登录",icon:"none"}),Object(_e.a)()):(a.code,Object(N.showToast)({title:a&&a.msg||"优惠券领取失败"})),h.abrupt("return",e());case 11:if(s=r.result||{},u=s.busiCode,l=s.message,p=s.extFieldMap,d=void 0===p?{}:p,g=s.responseList,m=g&&g[0]||{},console.log("result",s),b=be[u]){h.next=21;break}return Object(N.showToast)({title:l||"优惠券领取失败"}),e(),h.abrupt("return");case 21:return h.next=23,b({item:i,props:t,data:c,result:s,busiCode:u,extFieldMap:d,couponItem:m,message:l,responseList:g});case 23:f=h.sent,e(f);case 25:case"end":return h.stop()}}),_callee)})));return function(t){return e.apply(this,arguments)}}())}var fe=function(){function CouponLogic(e){Object(r.a)(this,CouponLogic),this.props=e||{}}var e,t,o;return Object(i.a)(CouponLogic,[{key:"updatePropsItem",value:function updatePropsItem(e){e&&(this.props.item=e)}},{key:"useCoupon",value:(o=Object(ae.a)(Object(ne.a)().mark((function _callee(){var e,t,o,n,a,r,i,c,s,u,l=arguments;return Object(ne.a)().wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:if(e=l.length>0&&void 0!==l[0]?l[0]:{},t=e.alwaysGrab,o=e.toUse,this.props.item){p.next=3;break}return p.abrupt("return",[{message:"no data"}]);case 3:if((n=this.props.item.couponShowType)!==pe.help){p.next=7;break}p.next=15;break;case 7:if(n!==pe.inflatedCoupon){p.next=10;break}p.next=15;break;case 10:if(!(r=this.useCouponByMarkState({alwaysGrab:t,toUse:o,couponShowType:n})).handle){p.next=15;break}return p.next=14,Object(ie.b)(r.result);case 14:a=p.sent;case 15:return i=a||[],c=Object(w.a)(i,2),s=c[0],u=c[1],s||this.updatePropsItem(null==u?void 0:u.newItem),p.abrupt("return",a);case 18:case"end":return p.stop()}}),_callee,this)}))),function useCoupon(){return o.apply(this,arguments)})},{key:"useCouponByMarkState",value:function useCouponByMarkState(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.alwaysGrab,n=t.toUse,a=t.couponShowType,r=this.props.item,i=r.markState,c=r.addOnItemState,s={handle:!1,result:null};return n?this.toUse(s,{toUse:n}):i==le.HaveGrab&&void 0!==c&&1!=c?(s.handle=!0,s.result=new Promise((function(e){Object(N.showToast)({title:"暂不支持"}),e()}))):i==le.HaveGrab||i==le.Exchange?this.toUse(s):a===pe.redPacket&&i==le.UnExchange?(s.handle=!0,s.result=this.vipCheck()):i==le.NotGrab?(s.handle=!0,s.result=new Promise(function(){var t=Object(ae.a)(Object(ne.a)().mark((function _callee2(t,o){var n,a,i,c,s,u,l,p,d,g,m,b,f,h;return Object(ne.a)().wrap((function _callee2$(j){for(;;)switch(j.prev=j.next){case 0:if(a=(n=r||{}).memberFlag,i=n.brandId,c=n.accessType,console.log(a,i,c,"领券"),j.prev=2,2!=c){j.next=32;break}if(a){j.next=25;break}return j.next=7,Object(ie.b)(api_getBrandLayer({brandId:i,usedj:!0}));case 7:if(s=j.sent,u=Object(w.a)(s,2),l=u[0],p=u[1],!l){j.next=17;break}return j.t0=t,j.next=15,e.errorHandler(l);case 15:return j.t1=j.sent,j.abrupt("return",(0,j.t0)(j.t1));case 17:return d=p.result,j.t2=t,j.next=21,e.showBrandLayer(d,r);case 21:return j.t3=j.sent,j.abrupt("return",(0,j.t2)(j.t3));case 25:return j.t4=t,j.next=28,e.getBrandCoupon(r);case 28:return j.t5=j.sent,j.abrupt("return",(0,j.t4)(j.t5));case 30:j.next=45;break;case 32:return j.next=34,normalCouponGrap(null,e.props);case 34:if(j.t6=j.sent,j.t6){j.next=37;break}j.t6={};case 37:if(g=j.t6,m=g.couponItem,b=g.busiCode,f=g.action,console.log("{ couponItem, busiCode, action }",{couponItem:m,busiCode:b,action:f}),"getCouponSuccess"!==f){j.next=45;break}return h=e.getCouponSuccess(m,b),j.abrupt("return",t(h));case 45:t(),j.next=51;break;case 48:j.prev=48,j.t7=j.catch(2),o(j.t7);case 51:case"end":return j.stop()}}),_callee2,null,[[2,48]])})));return function(e,o){return t.apply(this,arguments)}}())):o&&normalCouponGrap({cannotGrab:!0},this.props),s}},{key:"toUse",value:function toUse(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.toUse,a=this.props,r=a.item,i=a.params,c=a.pageValue;e.handle=!0,e.result=new Promise(function(){var e=Object(ae.a)(Object(ne.a)().mark((function _callee3(e,o){var a,s,u,l,p,d;return Object(ne.a)().wrap((function _callee3$(g){for(;;)switch(g.prev=g.next){case 0:if(g.prev=0,!r.to||!r.params||n){g.next=4;break}return Object(ge.a)({to:r.to,params:Object.assign({},r.params,{ref_par:JSON.stringify({traceId:t.props.tracdId})}),extraParams:{ref_page:"applet",ref_par:JSON.stringify({traceId:t.props.tracdId,userAction:r.userAction,pageId:c.pageId}),pageSource:c.pageSource||c.page_name}}),g.abrupt("return",e());case 4:if(!(1===r.needToUse&&"mini_cart"!==i.channel||n)){g.next=23;break}return(a={couponGoSource:0,couponId:r.couponId,stationNo:i.storeNo||i.stationNo||i.storeId}).passThroughParam={markState:3,code:r.activityCode,couponId:r.couponId,storeId:a.stationNo,orgCode:i.orgCode,skuIds:null!=i&&i.skuId?JSON.stringify([null==i?void 0:i.skuId]):void 0,refPageSource:c.pageSource||c.page_name},t.props.needToUnion&&(a.passThroughParam.promotionSource="storePromotion"),a.usedj=!0,g.next=11,Object(ie.b)(ue(a));case 11:if(s=g.sent,u=Object(w.a)(s,2),l=u[0],p=u[1],!l){g.next=17;break}return g.abrupt("return",t.errorHandler(l));case 17:if(d=p.result||{},console.log("api_getCouponJumpParams",d),d.to&&d.params){g.next=21;break}return g.abrupt("return");case 21:Object(ge.a)({to:d.to,params:Object.assign({},d.params,{ref_par:JSON.stringify({traceId:t.props.traceId})}),extraParams:{ref_page:"applet",ref_par:JSON.stringify({traceId:t.props.tracdId,userAction:r.userAction,pageId:c.pageId}),pageSource:c.pageSource||c.page_name}}),e();case 23:g.next=28;break;case 25:g.prev=25,g.t0=g.catch(0),o(g.t0);case 28:case"end":return g.stop()}}),_callee3,null,[[0,25]])})));return function(t,o){return e.apply(this,arguments)}}())}},{key:"vipCheck",value:function vipCheck(){}},{key:"closeLayer",value:function closeLayer(e,t){e(t)}},{key:"showBrandLayer",value:function showBrandLayer(e,t){}},{key:"getBrandCoupon",value:(t=Object(ae.a)(Object(ne.a)().mark((function _callee4(e){var t,o,n,a,r,i,c,s,u,l;return Object(ne.a)().wrap((function _callee4$(p){for(;;)switch(p.prev=p.next){case 0:return o=(t=e||{}).couponId,n=t.brandId,p.next=3,Object(ie.b)((d=void 0,g=void 0,d={couponId:o,brandId:n}||{},g=Object(R.a)(d,se),H({functionId:"pavilionWeb/member/grapCoupon",body:g})));case 3:if(a=p.sent,r=Object(w.a)(a,2),i=r[0],c=r[1],!i){p.next=9;break}return p.abrupt("return",this.errorHandler(i));case 9:return s=c.result||{},u={title:s.bntWords,titleColor:s.bntWordsStyle,startColor:s.bntStyle,endColor:s.bntStyle,borderColor:s.borderColor,state:s.state},s.couponButton=u,l=this.getCouponSuccess(s),Object(N.showToast)({title:(null==s?void 0:s.msg)||"恭喜入会成功，券已发放"}),p.abrupt("return",l);case 15:case"end":return p.stop()}var d,g}),_callee4,this)}))),function getBrandCoupon(e){return t.apply(this,arguments)})},{key:"changeCoupon",value:(e=Object(ae.a)(Object(ne.a)().mark((function _callee5(e){return Object(ne.a)().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:e.sourcePackage,e.targetPackage,e.exchangeFlag;case 1:case"end":return t.stop()}}),_callee5)}))),function changeCoupon(t){return e.apply(this,arguments)})},{key:"getCouponSuccess",value:function getCouponSuccess(e,t){var o,a=this.props,r=a.params,i=void 0===r?{}:r,c=a.item;"AC1205"==t&&e&&Object.keys(e).length?e=function handleNoMoreCoupon(e,t){if(e&&t)return t.couponLeftIcon=Object(n.a)(Object(n.a)({},e.couponLeftIcon),t.couponLeftIcon),e.couponRightIcon||delete t.couponRightIcon,e.styles&&!t.styles&&(e.styles=null),t=Object(n.a)(Object(n.a)({},e),t),e.styles&&e.styles.couponLabelStyle&&e.styles.couponLabelStyle.length>0?t.couponSigns=e.styles.couponLabelStyle:t.couponSigns=[],t}(c,e):"mini_cart"==i.channel&&1==c.addOnItemState&&(e.couponButton={title:c.titleAfterGain||"去逛逛",titleColor:e.priceColor,borderColor:e.priceColor,state:1},e.to=c.to,e.params=c.params),this.gotCoupon=!0;var s={},u={};if(null!==(o=this.props.extra)&&void 0!==o&&o.isNewStyle){var l;delete e.couponBgColor,delete e.couponBgBorderColor,delete e.priceColor,delete e.couponLimitColor,delete e.couponTitleColor,delete e.couponExpireColor;var p=(null===(l=e)||void 0===l?void 0:l.styles)||{},d=p.couponButStyle,g=p.couponLabelStyle,m=p.leftTopIconList;u=Object.assign({},c.styles,d&&{couponButStyle:d},g&&{couponLabelStyle:g},m&&{leftTopIconList:m})}else{var b,f;s=Object.assign({},null===(b=c.styles)||void 0===b?void 0:b.couponBgStyle,null===(f=e.styles)||void 0===f?void 0:f.couponBgStyle),u=Object.assign({},c.styles,e.styles,Object.keys(s).length>0&&{couponBgStyle:s})}console.log("new couponItem",e),console.log("newStyle",u);var h=Object.assign({},c,e,{styles:u});return this.lastCoupon=h,this.getCouponHook({couponItem:h}),{newItem:h}}},{key:"getCouponHook",value:function getCouponHook(e){var t=e.couponItem;this.props.getCouponHook?this.props.getCouponHook({activityCode:t.activityCode,couponItem:t,couponType:t.couponType}):Object(N.showToast)({title:"getCouponHook"})}},{key:"useHelpCoupon",value:function useHelpCoupon(){}},{key:"openVip",value:function openVip(e,t){e&&t&&Object(ge.a)({to:e,params:t})}},{key:"errorHandler",value:function errorHandler(e){return new Promise((function(t,o){e||(e={}),"201"==e.code||"202"==e.code?(Object(_e.a)(),Object(K.c)("gotologincoupon","1")):(e.msg&&Toast(e.msg),o(e))}))}}]),CouponLogic}(),he=Object(b.memo)((function(e){var t=e.item,o=e.onButtonPress,n=e.CouponUI,a=e.extra,r=(t||{}).styles,i=r||{},c=i.couponBgStyle,s=i.couponButStyle,u=i.couponLabelStyle,l=i.couponContentStyle,p=i.couponLconStyle,d=i.leftTopIconList,g={onButtonPress:o,couponBgColor:"#fff",couponBgEndColor:"#fff",couponBgBorderColor:"rgba(255, 87, 87, .2)"};if(!n)return null;var b=Object.assign(null!=p&&p.couponLconStyle?{couponRightIcon:null==p?void 0:p.couponLconStyle}:{},c,l||{},p||{}),f=Object.assign(b,s&&{couponButton:s},u&&{couponTags:u},d&&{leftTopIconList:d}),h=!!r&&Object.keys(r).length>0&&f,j=Object.assign({},g,t,{couponTags:t.couponSigns},h);j.couponButton&&!j.couponButton.startColor&&(j.couponButton.startColor="transparent",j.couponButton.endColor="transparent");j.couponButton,j.markState,j.price,j.priceUnit,j.couponLimit,j.couponTitle,j.couponExpire;return 3===t.couponShowType&&"这张不可领",Object(m.jsx)(n,{params:j,extra:a,item:t})})),je=Object(b.memo)((function(e){var t=Object(n.a)(Object(n.a)({},e),{},{needToUnion:!0}),o=Object(b.useState)((function(){return new fe(t)})),a=Object(w.a)(o,2),r=a[0],i=a[1],c=Object(b.useState)(e.item),s=Object(w.a)(c,2),u=s[0],l=s[1],p=e.couponPress,d=e.params,g=e.extra,f=e.CouponUI,h=e.autoUseWhenLimited,j=e.pageValue,v=Object(b.useRef)(!0);Object(b.useEffect)((function(){v.current?v.current=!1:(i(new fe(t)),l(e.item))}),[null==g?void 0:g.couponId,e]);var O,x=d=d||{},y=x.storeNo,C=(x.orgCode,Object(b.useCallback)(Object(ae.a)(Object(ne.a)().mark((function _callee(){var e,t,o,a,i,c,s,p,d,g,m,b,f;return Object(ne.a)().wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:return a=u.activityCode,i=u.couponType,c=u.couponId,s=u.userAction,p=(null===(e=u.styles)||void 0===e||null===(t=e.couponButStyle)||void 0===t?void 0:t.title)||(null===(o=u.couponButton)||void 0===o?void 0:o.title),Object(W.a)(Object(n.a)({click_id:"click_coupon",click_par:{activityCode:a,couponType:i,actType:p,storeId:y,couponId:c,userAction:s}},j)),h.next=5,r.useCoupon();case 5:if(h.t0=h.sent,h.t0){h.next=8;break}h.t0=[];case 8:if(d=h.t0,g=Object(w.a)(d,2),m=g[0],b=g[1],!m){h.next=14;break}return h.abrupt("return",[m]);case 14:(f=(b||{}).newItem)&&l(f);case 16:case"end":return h.stop()}}),_callee)}))),[r,u,y])),S=Object(b.useCallback)(Object(ae.a)(Object(ne.a)().mark((function _callee2(){var e,t;return Object(ne.a)().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:if(u.markState===le.HaveGrab){o.next=13;break}return o.next=3,C();case 3:if(o.t1=t=o.sent,o.t0=null===o.t1,o.t0){o.next=7;break}o.t0=void 0===t;case 7:if(!o.t0){o.next=11;break}o.t2=void 0,o.next=12;break;case 11:o.t2=t[0];case 12:e=o.t2;case 13:e||r.useCoupon({alwaysGrab:!0,toUse:!1});case 14:case"end":return o.stop()}}),_callee2)}))),[r,C,u]);return O=u.limitedStandard===de.limit&&h?S:p||C,Object(m.jsx)(he,{CouponUI:f,item:u,onButtonPress:O,extra:Object(n.a)({notNeedTouch:d.isMember},g||{})})})),ve=o(35),Oe=o.n(ve),xe=function Amount(e){var t=e.price,o=e.priceUnit,n=e.priceStyle,a=e.amountStyle,r=void 0===a?{}:a,i=e.priceColor,c=void 0===i?"#333333":i,s=e.style,u=void 0===s?{}:s,l=e.isSmallScreen;if(null==t)return null;var p=0==o?t:parseInt(t),d=t.toString().replace(p,""),b=0==o?l?14:22:l?24:32;return Object(m.jsx)(g.f,{className:Oe.a.AmountWrap,style:u,children:Object(m.jsxs)(g.e,{className:Oe.a.textW,style:Object.assign({color:c},n),children:[1==o&&Object(m.jsx)(g.e,{className:Oe.a.priceSymb,style:{marginRight:2,color:c},children:"¥"}),Object(m.jsx)(g.e,{className:Oe.a.priceInt,style:{color:c,marginBottom:0==o?10:0,fontSize:b},children:p}),Object(m.jsx)(g.e,{className:Oe.a.priceFloat,style:Object.assign({color:c},r),children:d}),2==o&&Object(m.jsx)(g.e,{className:Oe.a.priceSymb,style:{color:c},children:"折"})]})})},ye=o(90),Ce=o.n(ye),we=function LimitRule(e){var t=e.couponLimit,o=e.couponLimitColor,n=void 0===o?"#333":o;e.style,e.numberOfLines;return Object(m.jsx)(g.e,{className:Ce.a.couponLimit,style:{color:n},children:t})},Se=o(91),Ie=o.n(Se),ke=function CouponTitle(e){var t=e.couponTitle,o=e.couponTitleColor,a=void 0===o?"#333":o,r=e.style;return Object(m.jsx)(g.f,{className:Ie.a.couponTitle,style:Object(n.a)({color:a},r),children:t})},Te=o(92),Pe=o.n(Te),Le=function AvilableDate(e){var t=e.couponExpire,o=void 0===t?"":t,a=e.couponExpireColor,r=void 0===a?"#666":a,i=e.style,c=void 0===i?{}:i,s=e.isWrap;return s=s||o&&o.indexOf("\r\n")>=0,Object(m.jsx)(g.e,{className:Pe.a.couponExpire,style:Object(n.a)({color:r,marginTop:s?0:4},c),children:o})},Be=o(73),Ne=o.n(Be),Ae=o(64),De=o.n(Ae),We=function EmptyTag(e){var t=e||{},o=t.fontStyle,a=void 0===o?{}:o,r=t.style,i=void 0===r?{}:r,c=t.tag,s=t.className,u=c||{},l=u.iconText,p=u.strokeColorCode,d=u.strokeNameColorCode,b=u.iconTextColorCode,f=u.borderOpacity,h=function changeColorCode(e){return"transparent"!=e&&e?-1!=e.indexOf("#")?e:"#".concat(e):"transparent"};return l?Object(m.jsx)(g.f,{className:"".concat(De.a.tagBox," ").concat(De.a.emptyTagStyle),style:Object(n.a)(Object(n.a)({},i),{},{borderColor:f?re(p,f):h(p)}),children:Object(m.jsx)(g.e,{style:Object(n.a)({color:h(d||b)},a),className:"".concat(De.a.tagText," ").concat(s),children:l})}):null},He=function CouponTags(e){var t=e.tags,o=e.style,n=e.tagStyle;return Object(m.jsx)(g.f,{className:Ne.a.labels,style:o,children:t.map((function(e,t){var o={iconText:null==e?void 0:e.title,strokeColorCode:null==e?void 0:e.borderColor,strokeNameColorCode:null==e?void 0:e.titleColor,borderOpacity:null==e?void 0:e.borderOpacity};return(null==e?void 0:e.title)&&Object(m.jsx)(We,{tag:o,className:Ne.a.label,style:n},"".concat(t))}))})},Me=o(74),Ee=o.n(Me),Re=function CouponBtn(e){var t=e||{},o=t.onButtonPress,a=void 0===o?function(){}:o,r=t.couponButton,i=t.style,c=r||{},s=c.title,u=c.titleColor,l=void 0===u?"#fff":u,p=c.startColor,d=void 0===p?"#fff":p,b=c.endColor,f=void 0===b?"#fff":b,h=c.borderColor;c.state;return Object(m.jsx)(g.f,{className:Ee.a.CouponBtnWrap,onClick:a,style:Object(n.a)({borderColor:h||"transparent",background:"linear-gradient(315deg,".concat(d," 0%,").concat(f," 100%)")},i),children:Object(m.jsx)(g.e,{className:Ee.a.couponBtnTit,style:{color:l||"#ffffff"},children:s})})},Ue=["colors","style","deg"],Ve=function LinearGradient(e){var t=e||{},o=t.colors,a=t.style,r=t.deg,i=void 0===r?"135deg":r,c=Object(R.a)(t,Ue);return Object(m.jsx)(g.f,Object(n.a)(Object(n.a)({},c),{},{style:Object(n.a)(Object(n.a)({},a),{},{background:"linear-gradient(".concat(i,", ").concat(o[0]," 0%,").concat(o[1]," 100%)")})}))},Fe=o(93),Ge=o.n(Fe),qe=function DashedVerticalLine(e){e.couponBgMDottedLine,e.width;var t=e.minHeight,o=e.style,a=1.5*t,r=Array(Math.ceil(a/3)).fill(1);return Object(m.jsx)(g.f,{style:Object(n.a)({overflow:"hidden",alignItems:"center",justifyContent:"center"},o),children:r.map((function(e,t){return Object(m.jsx)(g.f,{className:Ge.a.lineStyle},t)}))})},Je=o(48),$e=o.n(Je),ze=f.a.memo((function(e){var t,o=e.leftTopIconList,a=e.style,r=e.fontStyle,i=e.wrapperStyle,c=e.tagsOnPress,s=void 0===c?function(){}:c;if(!o||0===o.length)return null;var u=o.length;return Object(m.jsx)(g.f,{onClick:s,className:$e.a.leftTopTagWrap,style:Object(n.a)({},i),children:null==o||null===(t=o.map)||void 0===t?void 0:t.call(o,(function(e,t){var o=e||{},i=o.startColor,c=o.endColor,s=o.title,l=o.titleColor,p=o.icon;return Object(m.jsxs)(Ve,{colors:[i,c],start:{x:0,y:0},end:{x:1,y:1},style:Object(n.a)(Object(n.a)({},a),{},{position:"relative",zIndex:u-t,paddingRight:p?4:8,overflow:"hidden",borderTopLeftRadius:0!==t?0:8,marginLeft:0!==t?-8:0,paddingLeft:0!==t?12:8}),className:$e.a.flag,children:[Object(m.jsx)(g.e,{style:Object(n.a)({color:l},r),className:$e.a.tagText,children:s}),!!p&&Object(m.jsx)(g.a,{src:p,className:$e.a.icon})]},t)}))})}));var Ke=o(49),Ze=o.n(Ke),Xe=f.a.memo((function(e){var t,o,a=(e||{}).item,r=e.params,i=r.price,c=r.priceUnit,s=r.priceColor,u=r.couponLimit,l=r.couponLimitColor,p=r.couponButton,d=r.couponTitle,f=r.couponTitleColor,h=r.couponTags,j=r.couponExpire,v=r.couponExpireColor,O=r.couponRightIcon,x=r.onButtonPress,y=r.couponBgColor,w=r.couponBgMDottedLine,S=r.couponBgEndColor,I=r.leftTopIconList,k=void 0===I?[]:I,P=r.couponBgIShadowColor,L=r.couponBgIShadowOpacity;if(!e.params)return null;var B=Object(b.useContext)($)||{},N=z.c.windowWidth,A=!1;N&&N<=320&&(A=!0);var D=function getDefaultBorderStyle(e){var t,o,n=e.couponBgIShadowColor,a=e.couponBgIShadowOpacity;return n&&(t=re(n,a),o={width:0,height:-8}),n?{shadowRadius:1.5,shadowColor:t,shadowOffset:o}:{}}({couponBgIShadowColor:P,couponBgIShadowOpacity:L}),H=function getSuitableFontSize(e){var t=e.uiFontSize,o=e.containerWidth,n=e.containerHeight,a=e.textLength,r=t,i=Math.floor(Math.sqrt(o*(n-1)/a));return r=Math.min(r,i)}({uiFontSize:32,containerWidth:94,containerHeight:36,textLength:"".concat(i).length+1});return Object(m.jsx)(C,{onVisible:function onVisible(){Object(W.b)(Object(n.a)({trace_id:null==B?void 0:B.traceId,ep:null==a?void 0:a.userAction},B))},children:Object(m.jsxs)(Ve,{colors:[y,S],start:{x:0,y:0},end:{x:1,y:1},className:Ze.a.row,style:Object(n.a)(Object(n.a)({},D),null===(t=e.extra)||void 0===t?void 0:t.style),children:[Object(m.jsx)(ze,{leftTopIconList:k,tagsOnPress:null===(o=e.extra)||void 0===o?void 0:o.tagsOnPress}),Object(m.jsxs)(g.f,{className:Ze.a.left,children:[Object(m.jsx)(xe,{price:i,priceUnit:c,priceColor:s,amountStyle:{fontSize:H},isSmallScreen:A}),!!u&&Object(m.jsx)(we,{couponLimit:u,couponLimitColor:l})]}),Object(m.jsx)(g.f,{children:Object(m.jsx)(qe,{minHeight:15,style:{marginTop:19,marginBottom:19},couponBgMDottedLine:w})}),Object(m.jsxs)(g.f,{className:Ze.a.center,children:[Object(m.jsx)(g.f,{style:{width:"100%"},children:Object(m.jsx)(ke,{couponTitle:d,couponTitleColor:f,style:{marginRight:p&&p.title||!O?0:10}})}),h&&!!h.length&&Object(m.jsx)(He,{tags:h}),Object(m.jsx)(Le,{couponExpire:j,couponExpireColor:v||"#999999"})]}),!!p&&!!p.title&&Object(m.jsx)(g.f,{className:Ze.a.right,children:Object(m.jsx)(Re,{couponButton:p,onButtonPress:x,style:{marginTop:"6rpx"}})})]})})})),Ye=o(94),Qe=["forwardRef"],et=["forwardRef","getWrapperRef"],tt=Object(i.a)((function Store(){Object(r.a)(this,Store)})),ot=function VisibleLogScrollView(e,t,o){var a=function(a){Object(l.a)(T,a);var s=Object(p.a)(T);function T(e){var t;return Object(r.a)(this,T),t=s.call(this,e),Object(d.a)(Object(c.a)(t),"observer",void 0),Object(d.a)(Object(c.a)(t),"entries",void 0),Object(d.a)(Object(c.a)(t),"userData",void 0),Object(d.a)(Object(c.a)(t),"wrappedComponent",void 0),Object(d.a)(Object(c.a)(t),"callback",void 0),Object(d.a)(Object(c.a)(t),"disconnect",(function(){t.observer&&t.observer.disconnectObserver()})),e&&e.getScrollViewInstance&&e.getScrollViewInstance(Object(c.a)(t)),t.store=new tt,t.store.arr=[],t}return Object(i.a)(T,[{key:"componentDidMount",value:function componentDidMount(){var e,t,n,a=this;this.Exposure=new Ye.a(".exposure",this.$scope?this.$scope:o,(function(e){a.store.arr.forEach((function(t){t(e)}))})),setTimeout((function(){a.Exposure&&a.Exposure.initObserver&&a.Exposure.initObserver()}),1e3);var r=this.props;r.forwardRef,Object(R.a)(r,Qe),null===(e=this.props.epOptions)||void 0===e||e.root,null===(t=this.props.epOptions)||void 0===t||t.rootMargin,null===(n=this.props.epOptions)||void 0===n||n.threshold}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.disconnect()}},{key:"getWrappedInstance",value:function getWrappedInstance(){return this.wrappedComponent}},{key:"render",value:function render(){var o=this,a=this.props,r=a.forwardRef,i=a.getWrapperRef,c=Object(R.a)(a,et);return this.store.options=t,this.store.userData=this.userData,this.store.observer=this.observer,Object(m.jsx)(v.Provider,{value:this.store,children:Object(m.jsx)(e,Object(n.a)(Object(n.a)({},c),{},{ref:function ref(e){o.wrappedComponent=e,"function"==typeof r&&r(e),"function"==typeof i&&i(o)}}))})}}]),T}(b.Component);return f.a.forwardRef((function(e,t){return Object(m.jsx)(a,Object(n.a)(Object(n.a)({},e),{},{forwardRef:t}))}))},nt=function CouponList(e){var t=e.couponList,o=void 0===t?[]:t,n=e.requestPar,r=(e.topDistance,n||{}),i=r.storeId,c=r.orgCode,s=null==o?void 0:o.length,u=Object(b.useRef)(1),l=Object(b.useState)([]),p=Object(w.a)(l,2),d=p[0],f=p[1],h=Object(b.useState)(!1),j=Object(w.a)(h,2),v=j[0],O=j[1];Object(b.useEffect)((function(){return A.a.eventCenter.on("_useReachBottom",(function(){if(20*u.current<s){console.log("_useReachBottom"),O(!0);var e=o.slice(20*u.current,20*(u.current+1));f((function(t){return[].concat(Object(a.a)(t),Object(a.a)(e))})),u.current++}else O(!1)})),A.a.eventCenter.on("cateChange",(function(){A.a.pageScrollTo({scrollTop:0,duration:0})})),function(){A.a.eventCenter.off("_useReachBottom"),A.a.eventCenter.off("cateChange")}}),[o]),Object(b.useEffect)((function(){u.current=1,O(!1),f(null==o?void 0:o.slice(0,20))}),[o]);var x=ot(g.d,"",void 0),y=Object(b.useCallback)((function(){}),[]),C=Object(b.useContext)($)||{};return Object(m.jsx)(g.f,{className:oe.a.couponListWrap,children:Object(m.jsxs)(x,{className:[oe.a.scrollViewWrap,"scroll-view"].join(" "),scrollY:!0,enhanced:!0,showScrollbar:!1,children:[null==d?void 0:d.map((function(t,o){return Object(m.jsx)(je,{params:{storeNo:i,orgCode:c,source:"homestore",channel:"station_home_page",grabChannel:"station_index_page"},item:t,CouponUI:Xe,getCouponHook:function getCouponHook(t){return function getCouponHook(t){var o=t.activityCode,n=t.couponItem;"object"===Object(ee.a)(n)&&null!==n&&(n.storeId=i),n&&(null==me||me()),null==e||e.getCouponHook({activityCode:o,couponItem:n})}({activityCode:t.activityCode,couponItem:t.couponItem})},extra:{couponLimitLines:2,isNewStyle:!0},loginHook:y,pageValue:C},o+t.activityCode+"")})),Object(m.jsx)(g.f,{className:oe.a.bottomTipBox,children:Object(m.jsx)(g.e,{className:oe.a.bottomTipText,children:v||20*u.current<s?"加载中...":"已经到底了"})})]})})},at=function isJDLogin(){var e=(jd.getUUIdSync&&jd.getUUIdSync()||{}).deviceUUId||Object(ie.a)();return new Promise((function(t,o){var n=Object(K.b)("login_info")||{deviceid_pdj_jd:e};if(console.log("获取缓存现有的",n),console.log("isJDApp",z.b),z.b||"devtools"===z.c.brand){var a=Object(K.b)("address_info")||{},r={method:"GET",functionId:"login/jdMini",body:{fromPath:"djwchat_coupon",latitude:a.latitude,refPar:"",longitude:a.longitude}};n.pt_key?H(r).then((function(e){if(e&&e.result){var a=e.result||{},r=Object.assign(n,a);Object(K.c)("login_info",r),console.log("京东里设置数据222",r),t(!0)}else o(!1)})).catch((function(e){console.log("err",JSON.stringify(e)),o(!1)})):jd.requestWebCookie({needpin:1,success:function success(e){if(e){var a=e.pt_pin,i=void 0===a?"":a,c=e.ticket,s=void 0===c?"":c,u={pt_pin:encodeURI(i),pt_key:s},l=Object.assign(n,u);Object(K.c)("login_info",l),H(r).then((function(e){if(e&&e.result){var a=e.result||{},r=Object.assign(n,a);Object(K.c)("login_info",r),console.log("京东里设置数据111",r),t(!0)}else o(!1)})).catch((function(e){console.log("err",JSON.stringify(e)),o(!1)}))}else console.log("get pin fail:1 "),o(!1)},fail:function fail(e){console.log("get pin fail:2 ",e),o(!1)}})}else z.a&&(n.PDJ_H5_PIN&&n[Z.e]?t(!0):jd.requestWebCookie({needpin:1,success:function success(e){if(e){var a=e.pt_pin,r=void 0===a?"":a,i=e.ticket,c=void 0===i?"":i;console.log("到家pin success==2",e);var s={};s="string"==typeof c&&c?JSON.parse(c):c;var u={pt_pin:encodeURI(r),ticket:c};u[Z.d]=(s||{}).o2o_app_mobile_sid,u[Z.c]=(s||{}).o2o_app_mobile_pin,u[Z.e]=(s||{}).tgt,console.error("strogeLogin","data","=============="),console.error(n,u);var l=Object.assign(n,u);Object(K.c)("login_info",l),console.error("到家 setStorage成功，===",l),t(!0)}else o(!1)},fail:function fail(e){o(!1)}}))}))},rt=function withHomePage(e){return function(t){Object(l.a)(_class2,t);var o=Object(p.a)(_class2);function _class2(){var e;Object(r.a)(this,_class2);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=o.call.apply(o,[this].concat(n)),Object(d.a)(Object(c.a)(e),"state",{isLoading:!1}),Object(d.a)(Object(c.a)(e),"mainPage",null),Object(d.a)(Object(c.a)(e),"$instance",A.a.getCurrentInstance()),Object(d.a)(Object(c.a)(e),"firstMount",!0),e}return Object(i.a)(_class2,[{key:"componentWillMount",value:function componentWillMount(){var e=this;z.b||z.a||"devtools"===z.c.brand?at().then((function(){e.setState({isLoading:!0})})).catch((function(){e.setState({isLoading:!0})})):this.setState({isLoading:!0})}},{key:"componentDidMount",value:function componentDidMount(){}},{key:"componentDidShow",value:function componentDidShow(){var e=this;this.firstMount||(z.b||z.a||"devtools"===z.c.brand?at().then((function(){e.mainPage&&e.mainPage.componentDidShow&&e.mainPage.componentDidShow()})).catch((function(){e.mainPage&&e.mainPage.componentDidShow&&e.mainPage.componentDidShow()})):this.mainPage&&this.mainPage.componentDidShow&&this.mainPage.componentDidShow())}},{key:"componentDidHide",value:function componentDidHide(){this.firstMount=!1,this.mainPage&&this.mainPage.componentDidHide&&this.mainPage.componentDidHide()}},{key:"onLoad",value:function onLoad(){this.mainPage&&this.mainPage.onLoad&&this.mainPage.onLoad()}},{key:"onUnload",value:function onUnload(){this.mainPage&&this.mainPage.onUnload&&this.mainPage.onUnload()}},{key:"onReachBottom",value:function onReachBottom(){this.mainPage&&this.mainPage.onReachBottom&&this.mainPage.onReachBottom()}},{key:"onPageScroll",value:function onPageScroll(){this.mainPag&&this.mainPage.onPageScroll&&this.mainPage.onPageScroll()}},{key:"render",value:function render(){var t=this;return this.state.isLoading?Object(m.jsx)(e,Object(n.a)(Object(n.a)({},this.props),{},{ref:function ref(e){return t.mainPage=e}})):Object(m.jsx)(B,{})}}]),_class2}(f.a.Component)},it=(o(50),function(e){Object(l.a)(Index,e);var t=Object(p.a)(Index);function Index(e){var o;return Object(r.a)(this,Index),o=t.call(this,e),Object(d.a)(Object(c.a)(o),"pageSource",""),Object(d.a)(Object(c.a)(o),"page_name",""),Object(d.a)(Object(c.a)(o),"isPageHome",!0),Object(d.a)(Object(c.a)(o),"traceId",""),Object(d.a)(Object(c.a)(o),"request_par",""),Object(d.a)(Object(c.a)(o),"statusBarH",0),Object(d.a)(Object(c.a)(o),"toBar",0),Object(d.a)(Object(c.a)(o),"_pageInfo",{}),Object(d.a)(Object(c.a)(o),"getPageData",(function(){var e=o.request_par||{},t=e.storeId,n=e.orgCode,a=e.floorCode,r=void 0===a?"":a,i=e.moreCouponAb,c=(o.getPageParams()||{}).request_par;(function api_getCateAndCoupon(e){return H({functionId:"coupon/stationMoreCouponInfo",body:e})})({stationNo:t,orgCode:n,grabPlat:z.b?"1":"2",floorCode:r,moreCouponAb:i,pageSource:"storeAllCoupons",ref_par:c}).then((function(e){var t,n=e.result;o.traceId=e.traceId;var a=0;(a=null==n||null===(t=n.findIndex)||void 0===t?void 0:t.call(n,(function(e){return e.floorCode==r&&(e.selected=!0,!0)})))<=0&&(a=0,n&&n[0]&&(n[0].selected=!0)),0===(null==n?void 0:n.length)?o.setState({loading:!1,errorInfo:{name:"hasNoCoupon",msg:"暂无可用优惠券"}}):o.setState({loading:!1,errorInfo:null,cats:n||[],selectedIndex:a})})).catch((function(e){console.log(e);var t=e.msg||"网络开小差，请稍后再试哦~";o.setState({loading:!1,errorInfo:{name:"nowifi",msg:t}})}))})),Object(d.a)(Object(c.a)(o),"cateChange",(function(e){console.log("index",e),A.a.eventCenter.trigger("cateChange"),o.setState({selectedIndex:e})})),Object(d.a)(Object(c.a)(o),"getCouponHook",(function(e){var t=e.activityCode,n=e.couponItem,r=o.state.cats;Object(a.a)(r).forEach((function(e){e.coupons.forEach((function(o,a){o.activityCode===t&&(e.coupons[a]=n,e.coupons[a].userAction=o.userAction)}))}))})),o.state={loading:!0,errorInfo:null,cats:[],selectedIndex:0,isShowPop:!1},o.pageSource="storeAllCoupons",o.page_name="StoreCouponPage",o.isPageHome=!0,o.traceId="",o.request_par={},o.statusBarH=0,o.toBar=0,o}return Object(i.a)(Index,[{key:"componentWillMount",value:function componentWillMount(){var e=this.getPageParams();this._pageInfo=e||{},this.request_par=e.request_par,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.taroGlobalData||{},o={},n={},a="",r=(wx.getEnterOptionsSync()||{}).query||{},i=(wx.getEnterOptionsSync()||{}).scene||"";n={wechat_version:z.c.version,app_version:"8.28.0",app_ver:"8.28.0",openId:""},o={dj_par_key:r.dj_par_key,business:r.business,sourcefrom:"index",scene:i,wxScene:i,wetchat_type:"jdTaro"};var c=function dynamicFunc(){var e=Object(K.b)(Z.a)||{},o=Object(K.b)(Z.f)||{},n={lat_pos:o.latitude||"",lng_pos:o.longitude||"",city_name_pos:o.cityName||"",lat_select:e.latitude||"",lng_select:e.longitude||"",poi_select:e.poi||"",city_name_select:e.cityName||"",city_id_select:e.cityId||e.areaCode||""},r="",i="",c=Object(K.b)(Z.b)||{};r=c.PDJ_H5_PIN||"",i=c.o2o_m_h5_sid||"";var s=t.channel;return a||(console.log("network==",a),A.a.getNetworkType({success:function success(e){a=e.networkType},fail:function fail(){console.log("network失败")}})),Object.assign(n,{user_id:r,session_id:i,channel_name:s,network:a})};console.log("埋点初始化==="),Object(W.c)(n,c,o)}({taroGlobalData:e.request_par}),Object(s.a)(Object(u.a)(Index.prototype),"componentWillMount",this).call(this)}},{key:"componentDidMount",value:function componentDidMount(){try{var e=A.a.getSystemInfoSync();e.statusBarHeight&&(this.statusBarH=e.statusBarHeight),"ios"==e.platform?this.toBar=42:"android"==e.platform?this.toBar=46:this.toBar=42}catch(e){}this.getPageData()}},{key:"componentDidShow",value:function componentDidShow(){try{var e=Object(K.b)("gotologincoupon");this.firstMount||"1"!==e||(this.getPageData(),Object(K.c)("gotologincoupon","0"))}catch(e){}Object(s.a)(Object(u.a)(Index.prototype),"componentDidShow",this).call(this)}},{key:"componentDidHide",value:function componentDidHide(){Object(s.a)(Object(u.a)(Index.prototype),"componentDidHide",this).call(this)}},{key:"onReachBottom",value:function onReachBottom(){A.a.eventCenter.trigger("_useReachBottom")}},{key:"render",value:function render(){var e=this.state,t=e.loading,o=e.errorInfo,a=e.cats,r=void 0===a?[]:a,i=e.selectedIndex,c=Object(n.a)(Object(n.a)({},this.pageInfoValue),this._pageInfo);return c.traceId=this.traceId,Object(m.jsx)($.Provider,{value:c,children:Object(m.jsxs)(g.f,{className:E.a.content,children:[!1,t?Object(m.jsx)(B,{}):o?Object(m.jsx)(k,{type:o.name,tipDesc:o.msg}):Object(m.jsxs)(g.f,{className:E.a.realContent,style:{marginTop:0},children:[!!r&&r.length>=2&&Object(m.jsx)(Q,{style:{top:0},cateChange:this.cateChange,cats:r,selectedIndex:i}),Object(m.jsx)(nt,{getCouponHook:this.getCouponHook,requestPar:this.request_par,couponList:r&&r[i]&&r[i].coupons})]})]})})}}]),Index}(J));t.default=rt(it)},16:function(e,t,o){e.exports={container:"index-module__container___2lNI1",coupon:"index-module__coupon___aCYv4",left_icon:"index-module__left_icon___2JgKX",circleIcon:"index-module__circleIcon___1Fycg",circleIconImage:"index-module__circleIconImage___3kzPT",amount_box:"index-module__amount_box___K0nPA",amount:"index-module__amount___2MsFc",unit:"index-module__unit___i9ZSH",limit:"index-module__limit___34icU",coupon_detail:"index-module__coupon_detail___32-WP",coupon_title:"index-module__coupon_title___2spLt",coupon_type:"index-module__coupon_type___pKm5c",sumTag:"index-module__sumTag___3Nt1W",coupon_date:"index-module__coupon_date___1ExOv",right_icon:"index-module__right_icon___385Vq",to_use:"index-module__to_use___dxonP",couponDetail:"index-module__couponDetail___3nNtM",line:"index-module__line___2LCGz",detailTitle:"index-module__detailTitle___P9gLm",text:"index-module__text___qBiHB",detailList:"index-module__detailList___1j7bE",tapArea:"index-module__tapArea___24TfG",icon_arrow:"index-module__icon_arrow___3SsMr",icon_arrow_up:"index-module__icon_arrow_up___OqSZW"}},29:function(e,t,o){e.exports={bg:"index-module__bg___vuVex",content:"index-module__content___8-LTS",title:"index-module__title___vLdGx",input_box:"index-module__input_box___3ZSEP",input_class:"index-module__input_class___3jvng",btn_box:"index-module__btn_box___2__5y",confirm_btn:"index-module__confirm_btn___2I8q7",cancel_btn:"index-module__cancel_btn___2Fo-o"}},30:function(e,t,o){"use strict";(function(e){function p2Arry(e){return e.then((function(e){return[null,e]})).catch((function(e){return[e]}))}o.d(t,"b",(function(){return p2Arry})),o.d(t,"a",(function(){return n}));var n=function genDeviceId(){for(var e=[],t="0123456789abcdefghijklmnopqrstuv",o=0;o<36;o++)e[o]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}}).call(this,o(6).document)},35:function(e,t,o){e.exports={AmountWrap:"index-module__AmountWrap___2gF93",priceSymb:"index-module__priceSymb___Tjmmh",priceInt:"index-module__priceInt___1sIXJ",priceFloat:"index-module__priceFloat___3jWM7",textW:"index-module__textW___30gWL"}},42:function(e,t,o){e.exports={tipcontainer:"index-module__tipcontainer___2ADbc",img:"index-module__img___1GIbW",tipButton:"index-module__tipButton___14tpa",tipTitle:"index-module__tipTitle___nIgAo",tipDesc:"index-module__tipDesc___3k4i-"}},46:function(e,t,o){e.exports={cateListWrap:"index-module__cateListWrap___3v_Zf",cateItemWrap:"index-module__cateItemWrap___2_Mik",cateText:"index-module__cateText___2-wNJ"}},47:function(e,t,o){e.exports={couponListWrap:"index-module__couponListWrap___2RmKZ",scrollViewWrap:"index-module__scrollViewWrap___pKylq",bottomTipBox:"index-module__bottomTipBox___WvtoU",bottomTipText:"index-module__bottomTipText___2BXyf"}},48:function(e,t,o){e.exports={icon:"index-module__icon___1DPwA",flag:"index-module__flag___KSfo8",tagText:"index-module__tagText___18YAC",leftTopTagWrap:"index-module__leftTopTagWrap___t0wkS"}},49:function(e,t,o){e.exports={row:"index-module__row___1j4Cp",left:"index-module__left___BacBS",rightWrap:"index-module__rightWrap___374OW",center:"index-module__center___1L-eg",right:"index-module__right___25Crt"}},50:function(e,t,o){e.exports={ch_top:"index-module__ch_top___3NOrD",tobar:"index-module__tobar___1RhOH",back:"index-module__back___M_57p",left_custom_class:"index-module__left_custom_class___1r5KW",title:"index-module__title___3MOZ3"}},64:function(e,t,o){e.exports={tagBox:"index-module__tagBox___1D7Jj",emptyTagStyle:"index-module__emptyTagStyle___10byz",tagText:"index-module__tagText___EDK_5"}},72:function(e,t,o){e.exports={content:"index-module__content___3CrZk"}},73:function(e,t,o){e.exports={labels:"index-module__labels___30tV0",label:"index-module__label___26Av8"}},74:function(e,t,o){e.exports={CouponBtnWrap:"index-module__CouponBtnWrap___3SGBP",couponBtnTit:"index-module__couponBtnTit___2hX0e"}},86:function(e,t,o){e.exports={loading:"index-module__loading___2hJGS"}},90:function(e,t,o){e.exports={couponLimit:"index-module__couponLimit___3po47"}},91:function(e,t,o){e.exports={couponTitle:"index-module__couponTitle___1bPnW"}},92:function(e,t,o){e.exports={couponExpire:"index-module__couponExpire___3PfpE"}},93:function(e,t,o){e.exports={lineStyle:"index-module__lineStyle___7mV8M"}},96:function(e,t,o){"use strict";o.r(t);o(97);var n=o(2),a=o(6),r=o(82),i=o(7),c=o(83);a.container.get(a.SERVICE_IDENTIFIER.Hooks).initNativeApiImpls=[n.e.initNativeApi];var s={pages:["pages/index/index"],subPackages:[{root:"pages/myCoupons/",pages:["index","subPages/description/index","subPages/disabledCoupon/index"],independent:!0},{root:"pages/storeCouponList/",pages:["index"],independent:!0},{root:"pages/myAttention/",pages:["index"],independent:!0}],permission:{"scope.userLocation":{desc:"你的位置信息将用获取最近的门店信息"}},plugins:{loginPlugin:{version:"1.5.1",provider:"wxefe655223916819e"},"live-player-plugin":{version:"1.3.5",provider:"wx2b03c6e691cd7370"}},window:{backgroundTextStyle:"light",navigationBarBackgroundColor:"#fff",navigationBarTitleText:"WeChat",navigationBarTextStyle:"black"}};a.window.__taroAppConfig=s;class App extends i.Component{render(){return this.props.children}}Object(r.a)(App,i,c.a,s);var u=o(137).default;Page(Object(a.createPageConfig)(u,"pages/storeCouponList/index",{},{navigationBarTitleText:"店铺优惠券",navigationStyle:"default",onReachBottomDistance:50,renderer:"webview"}||{}))}},[[96,0,3]]]);