"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(o):void 0:null!==(i=Object.getPrototypeOf(t))?e(i,n,o):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp2=require("../../../npm/@jd/djmp/common-t/js/location/index.weapp.js"),_indexWeapp3=require("../../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp4=require("../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp5=require("../../../npm/@jd/djmp/common-t/js/utils/index.weapp.js"),_indexWeapp6=require("../../../npm/@jd/djmp/common-t/js/cookie/index.weapp.js"),_indexWeapp7=require("../../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_indexWeapp8=require("../../../npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp9=require("../../../npm/@jd/djmp/common-t/constants/index.weapp.js"),_farm=require("../api/farm.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}_temp2=_class=function(){function a(){var e,t;_classCallCheck(this,a);for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(o)))).$$hasLoopRef=!0,t.$usedState=["anonymousState__temp","anonymousState__temp2","loopArray3","$compid__107","$compid__108","$compid__109","$compid__110","$compid__111","$compid__112","$compid__113","$compid__114","$compid__115","$compid__116","$compid__117","$compid__118","style","signList","listScroll","listLast","loading","showDefault","showChickenDefaultType","sourceData","signinBgImg","scrollIntoView","remainTime","notifySwitch","gifImg","chickenFly","signinImg","showOriginEgg","midImg","showGetEggBtn","flagText","exchangeButtonImg","repairButtonImg","lotteryButtonImg","lotteryDetailResponse","addressInfo","eDay","eHour","eMinute","eSecond","textAreaShow","lDay","lHour","lMinute","lSecond","exchangeCardFlag","transition","showLotteryInvitePop","lotteryData","showMyExchangeCard","showAddressConfirm","showEggResult","showEndPop","showEggRules","curCity","result","defaultType","defaultTips","defaultBtnTxt","isTyping","waitToType","typingRate","couponInfoResponse","couponStatus","couponType","eTimer","lTimer","IDay","IHour","IMinute","ISecond","ITimer","isHideGuide"],t.config={navigationBarTitleText:"每日领蛋"},t.anonymousFunc0Map={},t.customComponents=["Guide","Default","MyExchangeCardPop","DifPlacePop","ExchangeCardPop","EggResultPop","RulesPop","EndPop","AddressConfirmPop","ExchangeCouponPop","LotteryPop","LotteryInvitePop"],_possibleConstructorReturn(t,e)}return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.biFlag=!0,this.shareFlag=!0,this.userAction="",this.state={loading:!0,exchangeCardFlag:0,sourceData:{},scrollIntoView:"",showGetEggBtn:!1,chickenFly:"",notifySwitch:0,showOriginEgg:!0,transition:"",showLotteryInvitePop:!1,lotteryData:{},showMyExchangeCard:!1,showAddressConfirm:!1,showEggResult:!1,showEndPop:!1,showEggRules:!1,addressInfo:"",showChickenDefaultType:2,curCity:1,result:"",showDefault:!1,defaultType:0,defaultTips:"",defaultBtnTxt:"",textAreaShow:"",isTyping:!1,waitToType:[],typingRate:10,couponInfoResponse:"",couponStatus:"",couponType:0,eDay:"00",eHour:"00",eMinute:"00",eSecond:"00",eTimer:null,lDay:"00",lHour:"00",lMinute:"00",lSecond:"00",lTimer:null,IDay:"00",IHour:"00",IMinute:"00",ISecond:"00",ITimer:null,isHideGuide:!1},this.$$refs=[{type:"dom",id:"eOibl",refName:"scroll",fn:null}]}},{key:"_createData",value:function(){var o=this,j=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},arguments[2]),e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__107"),n=(0,_index.genCompid)(e+"$compid__108"),i=(0,_index.genCompid)(e+"$compid__109"),a=(0,_index.genCompid)(e+"$compid__110"),s=(0,_index.genCompid)(e+"$compid__111"),c=(0,_index.genCompid)(e+"$compid__112"),u=(0,_index.genCompid)(e+"$compid__113"),r=(0,_index.genCompid)(e+"$compid__114"),l=(0,_index.genCompid)(e+"$compid__115"),p=(0,_index.genCompid)(e+"$compid__116"),M=(0,_index.genCompid)(e+"$compid__117"),e=(0,_index.genCompid)(e+"$compid__118"),A=this.$scope,$=void 0,d=this.__state,H=d.exchangeCardFlag,B=(d.sourceData,d.scrollIntoView,d.showGetEggBtn,d.chickenFly,d.notifySwitch,d.showOriginEgg,d.transition),G=d.showLotteryInvitePop,O=d.lotteryData,U=d.showMyExchangeCard,q=d.showAddressConfirm,N=d.showEggResult,J=d.showEndPop,K=d.showEggRules,h=d.addressInfo,y=d.showChickenDefaultType,V=d.curCity,g=d.showDefault,Y=d.defaultType,z=d.defaultTips,Q=d.defaultBtnTxt,m=(d.textAreaShow,d.exchangeCardInfo),m=void 0===m?{}:m,X=d.couponInfoResponse,Z=d.couponStatus,ee=d.couponType,te=(d.eDay,d.eHour,d.eMinute,d.eSecond,d.lDay),ne=d.lHour,oe=d.lMinute,ie=d.lSecond,ae=d.IDay,se=d.IHour,ce=d.IMinute,ue=d.ISecond,d=(d.loading,d.isHideGuide),f=this.__state.result,_=f.remainTime,_=void 0===_?0:_,v=f.breakToastText,v=void 0===v?"":v,x=f.cityToastText,x=void 0===x?"":x,C=f.signList,C=void 0===C?[]:C,k=f.bgImg,k=void 0===k?"":k,I=f.exchangeButtonImg,I=void 0===I?"":I,w=f.repairButtonImg,w=void 0===w?"":w,T=f.repairCard,T=void 0===T?0:T,F=f.lotteryButtonImg,F=void 0===F?"":F,S=f.tipsImg,S=void 0===S?"":S,D=f.ruleDesc,D=void 0===D?"":D,E=f.gifImg,E=void 0===E?"":E,P=f.midImg,P=void 0===P?"":P,R=f.signinImg,R=void 0===R?"":R,L=f.lotteryDetailResponse,L=void 0===L?{}:L,W=f.flagText,W=void 0===W?"":W,f=f.signinBgImg,f=void 0===f?"":f,re=C.slice(0,C.length-1),b=C[C.length-1],k=(0<C.length&&($=re.map(function(e,t){e={$original:(0,_index.internal_get_original)(e)};var n="pIFfK"+t;o.anonymousFunc0Map[n]=function(){return o.onClickEggToExchangeCard(e.$original)},A&&j&&(0,_index.getElementById)(A,"#YdJln"+t);return{_$indexKey:n,$original:e.$original}})),b&&(this.anonymousFunc1=function(){return o.onClickEggToExchangeCard(b)}),{backgroundImage:'url("'+k+'")',backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"100% auto"}),k=(this.anonymousFunc2=function(){return o.onClickResourceImg()},this.anonymousFunc3=function(){return o.onClickGetLocation()},(0,_index.internal_inline_style)(k)),B=(this.anonymousFunc4=function(){return o.onClickHeadExchangeCoupon()},this.anonymousFunc5=function(e){return o.onClickSwitch(e)},this.anonymousFunc6=function(e){return o.onClickChickenReportFormId(e)},(0,_index.internal_inline_style)(B));return this.anonymousFunc7=function(){return o.onClickGetEgg()},this.anonymousFunc8=function(){return o.onClickMyRecordBall()},this.anonymousFunc9=function(){return o.onClickMyExchangeCardBall()},this.anonymousFunc10=function(e){return o.onClickLotteryBall(e)},this.anonymousFunc11=function(){return o.onClickRules()},this.anonymousFunc12=function(){return o.onClickMyExchangeCard()},this.anonymousFunc13=function(){return o.onClickClosePlacePop()},this.anonymousFunc14=function(){return o.onCloseExchangeCard()},this.anonymousFunc15=function(){return o.onUseExchangeCard()},this.anonymousFunc16=function(){return o.onClickInviteFriend()},this.anonymousFunc17=function(){return o.onCloseEggResultPop()},this.anonymousFunc18=function(){return o.onClickRulesBg()},this.anonymousFunc19=function(){return o.onCloseEndPop()},this.anonymousFunc20=function(){return o.onClickGoToHome()},this.anonymousFunc21=function(){return o.onCloseAddressConfirmPop()},this.anonymousFunc22=function(){return o.onClickAddressConfirm()},this.anonymousFunc23=function(){return o.onClickGoToHome()},this.anonymousFunc24=function(){return o.onClickCloseCouponPop()},this.anonymousFunc25=function(){return o.onClickGoToUse()},this.anonymousFunc26=function(){return o.doExchangeCoupon(1)},this.anonymousFunc27=function(){return o.onClickGoToHome()},this.anonymousFunc28=function(){return o.onClickCloseLotteryPop()},this.anonymousFunc29=function(){return o.onClickLotteryInviteFriend()},this.anonymousFunc30=function(){return o.onClickCloseLotteryInvitePop()},_index.propsManager.set({isShow:d},t),g&&_index.propsManager.set({defaultType:Y,defaultTips:z,defaultBtnTxt:Q,defaultTop:"40px",onDefaultEvent:this.onDefaultEvent.bind(this)},n),g||1===y||2===y||_index.propsManager.set({num:T,showMyExchangeCard:U,onClickMyExchangeCard:this.anonymousFunc12},i),g||1===y||2===y||_index.propsManager.set({onClickClosePlacePop:this.anonymousFunc13,curCity:V,addressInfo:h,cityToastText:x},a),g||1===y||2===y||_index.propsManager.set({data:m,exchangeCardFlag:H,countDown:0<ae?ae+"天"+se+":"+ce+":"+ue:se+":"+ce+":"+ue,onCloseExchangeCard:this.anonymousFunc14,onUseExchangeCard:this.anonymousFunc15,onClickInviteFriend:this.anonymousFunc16},s),g||1===y||2===y||_index.propsManager.set({showEggResult:N,tipsImg:S,onCloseEggResultPop:this.anonymousFunc17},c),g||1===y||2===y||_index.propsManager.set({nodes:D,showEggRules:K,onClickRulesBg:this.anonymousFunc18},u),g||1===y||2===y||_index.propsManager.set({showEndPop:J,breakToastText:v,addressInfo:h,onCloseEndPop:this.anonymousFunc19},r),g||1===y||2===y||_index.propsManager.set({showAddressConfirm:q,addressInfo:h,onClickGoToHome:this.anonymousFunc20,onCloseAddressConfirmPop:this.anonymousFunc21,onClickAddressConfirm:this.anonymousFunc22},l),g||1===y||2===y||_index.propsManager.set({couponInfo:X,status:Z,type:ee,addressInfo:h,onClickGoToHome:this.anonymousFunc23,onClickCloseCouponPop:this.anonymousFunc24,onClickGoToUse:this.anonymousFunc25,onClickGetLowerCoupon:this.anonymousFunc26},p),g||1===y||2===y||_index.propsManager.set({data:O,onClickGoToHome:this.anonymousFunc27,onClickCloseLotteryPop:this.anonymousFunc28},M),g||1===y||2===y||_index.propsManager.set({onClickLotteryInviteFriend:this.anonymousFunc29,onClickCloseLotteryInvitePop:this.anonymousFunc30,showLotteryInvitePop:G,data:L,countDown:0<te?te+"天"+ne+":"+oe+":"+ie:ne+":"+oe+":"+ie},e),Object.assign(this.__state,{anonymousState__temp:k,anonymousState__temp2:B,loopArray3:$,$compid__107:t,$compid__108:n,$compid__109:i,$compid__110:a,$compid__111:s,$compid__112:c,$compid__113:u,$compid__114:r,$compid__115:l,$compid__116:p,$compid__117:M,$compid__118:e,style:_indexModuleScssMap2.default,signList:C,listScroll:re,listLast:b,signinBgImg:f,remainTime:_,gifImg:E,signinImg:R,midImg:P,flagText:W,exchangeButtonImg:I,repairButtonImg:w,lotteryButtonImg:F,lotteryDetailResponse:L}),this.__state}},{key:"onShareAppMessage",value:function(e){var t="";try{var n=wx.getStorageSync("login_info");n&&n.PDJ_H5_PIN&&(t=n.PDJ_H5_PIN)}catch(e){}var n=this.state.result,o=n.shareUrl,i=n.shareText,n=n.activityId,i=(void 0===i?"":i)||"惊喜！快来参与每日领蛋吧！",o=void 0===o?"":o,a="/pages/home/home?type=43&business=149";return"button"===e.from&&(i=(e=e.target.dataset.params).shareText,o=e.shareUrl,a=a+"&senderUserPin="+(t||"")+"&senderActivityId="+(void 0===n?"":n)+"&senderLotteryId="+(e.lotteryId||"")+"&senderShareId="+Date.now()),{title:i,path:a,imageUrl:o}}},{key:"componentDidShow",value:function(){var e=this;(0,_indexWeapp3.isLogin)().then(function(){e.handleLocation()}).catch(function(){e.handleLocation()})}},{key:"componentDidMount",value:function(){var e=this,t=this.$router.params;t.userAction&&(this.userAction=decodeURIComponent(t.userAction)),setTimeout(function(){e.setState({loading:!1})},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.eTimer),clearInterval(this.state.lTimer),clearInterval(this.state.ITimer)}},{key:"handleLocation",value:function(){var c=this;(0,_indexWeapp2.getLocation)().then(function(t){t.cityId=t.cityId||t.areaCode||t.cityCode||0,t.cityName=t.city||t.cityName||"",t.poi=t.poi||t.title||t.address||t.district||t.addressName||"",c.setState({addressInfo:t||{},showChickenDefaultType:0});var e=c.$router.params,n=e.scene||"",o="",i="",a="",s="";n?(n=decodeURIComponent(n)||"",(0,_farm.getCircleParams)({scene:n}).then(function(e){var e=e.result;e&&(e=JSON.parse(e),o=e.senderUserPin||"",i=e.senderActivityId||"",a=e.senderLotteryId||"",s=e.senderShareId||"",c.handleCurrentPageData({addressInfo:t,senderUserPin:o,senderActivityId:i,senderLotteryId:a,senderShareId:s}))}).catch(function(){})):(o=e.senderUserPin||"",i=e.senderActivityId||"",a=e.senderLotteryId||"",s=e.senderShareId||"",c.handleCurrentPageData({addressInfo:t,senderUserPin:o,senderActivityId:i,senderLotteryId:a,senderShareId:s}))}).catch(function(e){c.setState({showChickenDefaultType:2}),(0,_indexWeapp.showToast)({title:"有地址才能领取哦~"}),(0,_indexWeapp3.isLogin)().then(function(){(0,_indexWeapp4.pvReport)({create_time:new Date,page_par:{status:"无定位",isLogin:!0,userAction:c.userAction}})}).catch(function(){(0,_indexWeapp4.pvReport)({create_time:new Date,page_par:{status:"无定位",isLogin:!1,userAction:c.userAction}})})})}},{key:"handleCurrentPageData",value:function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.addressInfo,n=e.senderUserPin,o=e.senderActivityId,a=e.senderLotteryId,e=e.senderShareId;(0,_farm.getCurrentPageData)({cityId:(void 0===t?{}:t).cityId,senderUserPin:void 0===n?"":n,senderActivityId:void 0===o?"":o,senderLotteryId:void 0===a?"":a,senderShareId:void 0===e?"":e}).then(function(e){var t,n,o=e.result;i.setState({loading:!1}),o?(i.setState({result:o,curCity:o.curCity,notifySwitch:o.notifySwitch||0,showChickenDefaultType:0,showDefault:!1}),t=i,0<(n=o.signDays+1-6)&&setTimeout(function(){t.setState({scrollIntoView:"egg"+n})},500),1===o.curCity&&(0<n?setTimeout(function(){t.handleDelEgg(o)},1e3):t.handleDelEgg(o)),e=o.tipsList&&o.tipsList[0]||"",i._chickenSay(e),o.remainTime&&0<o.remainTime&&(clearInterval(i.state.eTimer),i._showEggCountDown(o.remainTime)),o.lotteryDetailResponse&&0<o.lotteryDetailResponse.remainTime&&(clearInterval(i.state.lTimer),i._showLotteryCountDown(o.lotteryDetailResponse.remainTime)),o.tipsResponse&&0<o.tipsResponse.remainTime&&(clearInterval(i.state.ITimer),i._showExchangeCardCountDown(o.tipsResponse.remainTime)),i.biFlag&&((0,_indexWeapp3.isLogin)().then(function(){(0,_indexWeapp4.pvReport)({create_time:new Date,page_par:{status:"正常",isLogin:!0,userAction:i.userAction}})}).catch(function(){(0,_indexWeapp4.pvReport)({create_time:new Date,page_par:{status:"正常",isLogin:!1,userAction:i.userAction}})}),i.biFlag=!1)):(i.setState({showChickenDefaultType:1}),i.handleGetPageResource(),i.biFlag&&((0,_indexWeapp3.isLogin)().then(function(){(0,_indexWeapp4.pvReport)({create_time:new Date,page_par:{status:"城市未开启或者无活动",isLogin:!0,userAction:i.userAction}})}).catch(function(){(0,_indexWeapp4.pvReport)({create_time:new Date,page_par:{status:"城市未开启或者无活动",isLogin:!1,userAction:i.userAction}})}),i.biFlag=!1))}).catch(function(e){i.setState({showDefault:!0,defaultType:3,defaultTips:e.msg||"服务异常！"}),i.biFlag&&((0,_indexWeapp3.isLogin)().then(function(){(0,_indexWeapp4.pvReport)({create_time:new Date,page_par:{status:"异常",isLogin:!0,userAction:i.userAction}})}).catch(function(){(0,_indexWeapp4.pvReport)({create_time:new Date,page_par:{status:"异常",isLogin:!1,userAction:i.userAction}})}),i.biFlag=!1)})}},{key:"onClickClosePlacePop",value:function(){this.setState({curCity:1}),this.handleDelEgg(this.state.result)}},{key:"handleDelEgg",value:function(t){var n=this;if(1===t.breakStatus)this.setState({showEndPop:!0});else if(0===t.breakStatus){var e=this.state.addressInfo;if(1===t.status){var o="",i="";try{var a=wx.getStorageSync(_indexWeapp9.LOGIN_INFO),o=a.nickname||"",i=a.avatar||""}catch(e){}(0,_farm.getCurDayEgg)({cityId:e.cityId||"",activityId:t.activityId||"",nickName:o,nickHeadUrl:i,senderUserPin:t.senderUserPin||"",senderActivityId:t.senderActivityId||"",senderLotteryId:t.senderLotteryId||"",senderShareId:t.senderShareId||""}).then(function(e){"0"==e.code?n._playChickenAnimation(t,function(){n.setState({showEggResult:!0,showGetEggBtn:!1})}):("201"!=e.code&&"201"!=e.code&&(0,_indexWeapp.showToast)({title:e.msg||"领取失败"}),n.setState({showGetEggBtn:!0}))}).catch(function(e){(0,_indexWeapp.showToast)({title:e.msg||"领取失败"}),n.setState({showGetEggBtn:!0})})}else 2===t.status&&(this.setState({showGetEggBtn:!1}),this.refillCard(t))}}},{key:"onCloseEndPop",value:function(){this.setState({showEndPop:!1}),this.refreshPage()}},{key:"refreshPage",value:function(){this.handleCurrentPageData({addressInfo:this.state.addressInfo,senderActivityId:this.state.result&&this.state.result.activityId||""})}},{key:"refillCard",value:function(e){var t=this.state.exchangeCardFlag;e&&e.tipsResponse&&this.setState({exchangeCardInfo:e.tipsResponse,exchangeCardFlag:++t})}},{key:"onCloseExchangeCard",value:function(){this.setState({exchangeCardInfo:{}})}},{key:"onClickInviteFriend",value:function(){var o=this;(0,_indexWeapp3.isLogin)().then(function(){var e=(0,_indexWeapp6.getCookie)(_indexWeapp9.PDJ_H5_JDPIN_KEY),t=o.state.exchangeCardInfo||{},n=o.state.result;o._openShare({bgImgUrl:t.friendUrl,params:{senderUserPin:e||"",senderActivityId:n.activityId||""},shareImg:t.shareUrl,shareText:t.shareText,type:43,path:"pages/home/home"})}).catch(function(){o._goToLogin()})}},{key:"onClickEggToExchangeCard",value:function(e){1===e.status&&this.setState({exchangeCardInfo:e.tipsResponse||{},exchangeCardFlag:1})}},{key:"onUseExchangeCard",value:function(){var t=this,e=this.state.result,e=e&&e.activityId||"";(0,_farm.useExchangeCard)({activityId:e||""}).then(function(e){"0"==e.code?(t.onCloseExchangeCard(),(0,_indexWeapp.showToast)({title:e.msg||"补领成功"}),t.refreshPage()):"201"!=e.code&&"202"!=e.code||t._goToLogin()}).catch(function(e){(0,_indexWeapp.showToast)({title:e.msg||"使用补领卡失败！"})})}},{key:"onClickHeadExchangeCoupon",value:function(){var t=this;(0,_indexWeapp3.isLogin)().then(function(){var e=t.state.result||{};1===e.buttonId?(t.setState({showAddressConfirm:!0}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickToExchange",click_par:{status:"可兑换"}})):2===e.buttonId&&(e=e.leftDays,(0,_indexWeapp.showToast)({title:e?"再来"+e+"天即可兑换~":"请补领后再来兑换~"}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickToExchange",click_par:{status:"不可兑换"}}))}).catch(function(){t._goToLogin()})}},{key:"onClickAddressConfirm",value:function(){this.doExchangeCoupon(0)}},{key:"onCloseAddressConfirmPop",value:function(){this.setState({showAddressConfirm:!1})}},{key:"doExchangeCoupon",value:function(n){var o=this,e=this.state.addressInfo||{},t=this.state.result&&this.state.result.activityId||"";(0,_farm.doExchangeCoupon)({longitude:e.longitude,latitude:e.latitude,cityId:e.cityId||"",activityId:t,status:n||0}).then(function(e){var t=e.result;"0"==e.code&&t?1!=t.couponInfoResponse.couponType&&t.couponInfoResponse.couponType&&1===t.status?(0,_indexWeapp.showToast)({title:"活动太火爆，请稍后"}):o.setState({couponInfoResponse:t.couponInfoResponse||"",couponStatus:t.status,showAddressConfirm:!1,couponType:n}):"201"==e.code||"202"==e.code?o._goToLogin():(0,_indexWeapp.showToast)({title:e.msg||"兑换失败！"})}).catch(function(e){(0,_indexWeapp.showToast)({title:e.msg||"兑换失败！"})})}},{key:"onClickCloseCouponPop",value:function(){this.setState({couponType:""}),this.refreshPage()}},{key:"onClickGoToUse",value:function(){var e=this.state.couponType,t=this.state.couponInfoResponse,n=t.couponId,n=void 0===n?"":n,o=t.upcs,o=void 0===o?"":o,t=t.couponType,t=void 0===t?"":t;t&&1!=t?this.onClickGoToHome():0===e?(0,_indexWeapp.navigateTo)("/pages/farm-t/storelist/index?couponId="+n+"&upcs="+o):1===e&&this.onClickGoToHome()}},{key:"handleGetPageResource",value:function(){var n=this;(0,_farm.getPageResource)({}).then(function(e){var t=e.result;"0"==e.code&&t&&0<t.length&&t.forEach(function(e){1===e.resourceNicheIndex&&(e=e.resourcesList[0],n.setState({sourceData:e}))})}).catch(function(e){})}},{key:"onClickMyRecordBall",value:function(){var t=this;(0,_indexWeapp3.isLogin)().then(function(){var e=t.state.result&&t.state.result.activityId||"";(0,_indexWeapp.navigateTo)("/pages/farm-t/record/index?activityId="+e)}).catch(function(){t._goToLogin()}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickMyCollection"})}},{key:"onClickMyExchangeCardBall",value:function(){var e=this;(0,_indexWeapp3.isLogin)().then(function(){e.setState({showMyExchangeCard:!0})}).catch(function(){e._goToLogin()}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickSupplementCard"})}},{key:"onClickMyExchangeCard",value:function(){this.setState({showMyExchangeCard:!1})}},{key:"onClickLotteryBall",value:function(e){var i=this;(0,_indexWeapp3.isLogin)().then(function(){var e=i.state.result,t=e&&e.lotteryDetailResponse||{},n=t.status,o=t.lotteryId||"";0===n?((0,_indexWeapp.showToast)({title:t.toastText||"彩蛋还没准备好，倒计时结束后再来吧~"}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickEasterEgg",click_par:{status:"不可领取"}})):1===n?((0,_farm.doDraw)({activityId:e.activityId||"",lotteryId:o}).then(function(e){"0"==e.code&&e.result?i.setState({lotteryData:e.result}):(0,_indexWeapp.showToast)({title:e.msg||"抽奖失败！"})}).catch(function(e){(0,_indexWeapp.showToast)({title:e.msg||"抽奖失败！"})}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickEasterEgg",click_par:{status:"可领取"}})):2===n?(i.setState({showLotteryInvitePop:!0}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickEasterEgg",click_par:{status:"冷却中可分享"}})):3===n&&((0,_indexWeapp.showToast)({title:t.toastText||"今日邀请次数已用光，倒计时结束后再来吧~"}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickEasterEgg",click_par:{status:"冷却中不可分享"}}))}).catch(function(){i._goToLogin()})}},{key:"onClickCloseLotteryPop",value:function(){this.setState({lotteryData:""}),this.handleLocation()}},{key:"onClickCloseLotteryInvitePop",value:function(){this.setState({showLotteryInvitePop:!1})}},{key:"onClickLotteryInviteFriend",value:function(){var o=this;(0,_indexWeapp3.isLogin)().then(function(){var e=(0,_indexWeapp6.getCookie)(_indexWeapp9.PDJ_H5_JDPIN_KEY),t=o.state.result,n=t.lotteryDetailResponse||{};o._openShare({bgImgUrl:n.friendUrl||"",params:{senderUserPin:e||"",senderActivityId:t.activityId||"",senderLotteryId:t.lotteryDetailResponse&&t.lotteryDetailResponse.lotteryId||"",senderShareId:"20190705"},shareImg:n.shareUrl,shareText:n.shareText,type:43,path:"pages/home/home"})}).catch(function(){o._goToLogin()})}},{key:"onClickRules",value:function(){this.setState({showEggRules:!0})}},{key:"onClickRulesBg",value:function(){this.setState({showEggRules:!1})}},{key:"onClickGetLocation",value:function(){_index2.default.openSetting().then(function(e){}).catch(function(e){})}},{key:"onClickGetEgg",value:function(){var e=this;(0,_indexWeapp3.isLogin)().then(function(){e.handleDelEgg(e.state.result)}).catch(function(){e._goToLogin()}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickFreeCollect"})}},{key:"onClickGoToHome",value:function(){(0,_indexWeapp7.jump)({to:"home"})}},{key:"onCloseEggResultPop",value:function(){try{this.setState({showEggResult:!1,transition:{display:"none"},showOriginEgg:!0}),this.refreshPage(),(0,_indexWeapp8.getStorageSync)("isHideGuide")||(this.setState({isHideGuide:!0}),(0,_indexWeapp8.setStorageSync)("isHideGuide",!0))}catch(e){}}},{key:"onDefaultEvent",value:function(){var e=this.state.defaultType;3===e?this.handleLocation():4===e&&this._goToLogin()}},{key:"onClickSwitch",value:function(e){var n=this;(0,_indexWeapp3.isLogin)().then(function(){var t=n.state.notifySwitch?0:1;(0,_farm.requestSubscribeNotify)({activityId:n.state.result&&n.state.result.activityId||"",status:t}).then(function(e){"0"==e.code?n.setState({notifySwitch:t}):(0,_indexWeapp.showToast)({title:e.msg||"请稍后再试！"})}).catch(function(e){(0,_indexWeapp.showToast)({title:e.msg||"请稍后再试！"})}),wx.vibrateShort({success:function(){},fail:function(){},complete:function(){}})}).catch(function(){n._goToLogin()})}},{key:"onClickChickenReportFormId",value:function(e){var t,n,o,i=this;wx.vibrateShort({success:function(){},fail:function(){}}),this.state.isTyping||(this.setState({chickenFly:"https://storage.360buyimg.com/wximg/farm/chicken2.gif?t="+Date.now()}),setTimeout(function(){i.setState({chickenFly:""})},1400),n=(t=this.state.result&&this.state.result.tipsList||[]).length,o=Math.floor(Math.random()*n),0<n&&this._chickenSay(t[o])),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickChicken"})}},{key:"onClickResourceImg",value:function(){var e=this.state.sourceData.url;-1<e.indexOf("friendHelp")?(0,_indexWeapp7.jump)({type:"",to:"friendHelpList"}):-1<e.indexOf("bargain/list")?(0,_indexWeapp7.jump)({type:"",to:"bargainList"}):-1<e.indexOf("bargain/detail")?(0,_indexWeapp7.jump)({type:"",to:"bargainDetail"}):-1<e.indexOf("signIn")?(0,_indexWeapp7.jump)({type:"h5",to:"sigin"}):-1<e.indexOf("punch-t")?(0,_indexWeapp7.jump)({type:"",to:"punch"}):-1<e.indexOf("lottery")?(0,_indexWeapp7.jump)({type:"",to:"lottery"}):-1<e.indexOf("GroupBuy")?(0,_indexWeapp7.jump)({type:"",to:"groupBuyList"}):(0,_indexWeapp.showToast)({title:"暂不支持，请稍后再试！"})}},{key:"_chickenSay",value:function(e){var t=this,n=(this.setState({textAreaShow:""}),e.split(""));0<n.length&&(setTimeout(function(){return t._typing(n,n[0],0)},this.state.typingRate),this.setState({waitToType:[]}))}},{key:"_throttle",value:function(e){var t=this;this.shareFlag&&(this.shareFlag=!1,e.apply(this,arguments),setTimeout(function(){t.shareFlag=!0},1e3))}},{key:"_openShare",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.bgImgUrl,e.path,e.params,e.type,e.shareText,e.shareImg}},{key:"_goToLogin",value:function(){(0,_indexWeapp3.goToLogin)({localTargetUrl:"/pages/farm-t/home/index"})}},{key:"_playChickenAnimation",value:function(e,o){var i=this,t=_index2.default.createSelectorQuery();setTimeout(function(){t.selectAll("#egg,#egg"+e.signDays).boundingClientRect(function(e){var t=e[1].left+e[1].width/2,n=e[1].top+e[1].height/2,t=e[0].left+e[0].width/2-t,e=e[0].top+e[0].height/2-n;i.setState({showOriginEgg:!1,transition:{transform:"translate("+t+"px, "+e+"px) scale(0.74,0.7)"}}),setTimeout(function(){o()},1e3)}).exec()},1001)}},{key:"_showEggCountDown",value:function(e){var t=this;(0,_indexWeapp5.countDown)(e,function(e){e.end?(t.refreshPage(),clearInterval(t.state.eTimer),t.setState({eDay:"00",eHour:"00",eMinute:"00",eSecond:"00",eTimer:null})):t.setState({eDay:e.day,eHour:e.hour,eMinute:e.minute,eSecond:e.second,eTimer:e.timer})})}},{key:"_showLotteryCountDown",value:function(e){var t=this;(0,_indexWeapp5.countDown)(e,function(e){e.end?(t.refreshPage(),clearInterval(t.state.lTimer),t.setState({lDay:"00",lHour:"00",lMinute:"00",lSecond:"00",lTimer:null})):t.setState({lDay:e.day,lHour:e.hour,lMinute:e.minute,lSecond:e.second,lTimer:e.timer})})}},{key:"_showExchangeCardCountDown",value:function(e){var t=this;(0,_indexWeapp5.countDown)(e,function(e){e.end?(t.refreshPage(),clearInterval(t.state.ITimer),t.setState({IDay:"00",IHour:"00",IMinute:"00",ISecond:"00",ITimer:null})):t.setState({IDay:e.day,IHour:e.hour,IMinute:e.minute,ISecond:e.second,ITimer:e.timer})})}},{key:"_typing",value:function(e,t,n){var o=this;n<e.length?(t=this.state.textAreaShow+t,this.setState({textAreaShow:t,isTyping:!0},function(){setTimeout(function(){return o._typing(e,e[n+1],n+1)},o.state.typingRate)},this)):n>=e.length&&this.setState({isTyping:!1},function(){var e,t=o.state.waitToType;0<t.length&&(e=t.shift(),setTimeout(function(){return o._typing(e,e[0],0)},o.state.typingRate),o.setState({waitToType:t}))},this)}},{key:"anonymousFunc0",value:function(e,t){return this.anonymousFunc0Map[e]&&this.anonymousFunc0Map[e](t)}},{key:"anonymousFunc1",value:function(e){}},{key:"anonymousFunc2",value:function(e){}},{key:"anonymousFunc3",value:function(e){}},{key:"anonymousFunc4",value:function(e){}},{key:"anonymousFunc5",value:function(e){}},{key:"anonymousFunc6",value:function(e){}},{key:"anonymousFunc7",value:function(e){}},{key:"anonymousFunc8",value:function(e){}},{key:"anonymousFunc9",value:function(e){}},{key:"anonymousFunc10",value:function(e){}},{key:"anonymousFunc11",value:function(e){}},{key:"anonymousFunc12",value:function(e){}},{key:"anonymousFunc13",value:function(e){}},{key:"anonymousFunc14",value:function(e){}},{key:"anonymousFunc15",value:function(e){}},{key:"anonymousFunc16",value:function(e){}},{key:"anonymousFunc17",value:function(e){}},{key:"anonymousFunc18",value:function(e){}},{key:"anonymousFunc19",value:function(e){}},{key:"anonymousFunc20",value:function(e){}},{key:"anonymousFunc21",value:function(e){}},{key:"anonymousFunc22",value:function(e){}},{key:"anonymousFunc23",value:function(e){}},{key:"anonymousFunc24",value:function(e){}},{key:"anonymousFunc25",value:function(e){}},{key:"anonymousFunc26",value:function(e){}},{key:"anonymousFunc27",value:function(e){}},{key:"anonymousFunc28",value:function(e){}},{key:"anonymousFunc29",value:function(e){}},{key:"anonymousFunc30",value:function(e){}}]),a}(),_class.$$events=["anonymousFunc0","anonymousFunc1","anonymousFunc2","anonymousFunc3","anonymousFunc4","anonymousFunc5","anonymousFunc6","anonymousFunc7","anonymousFunc8","anonymousFunc9","anonymousFunc10","anonymousFunc11"],_class.options={addGlobalClass:!0},_class.$$componentPath="pages/farm-t/home/index";var Farm=_temp2;exports.default=Farm,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Farm,!0));