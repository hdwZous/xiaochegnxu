<!-- 新地址模块（支持门店自提） -->
<wxs module="tool" src="../../util/tools.wxs"></wxs>
<view class="distributionInfo">

  <block wx:if="{{(!deliverType.data && dispatchMold == '1') || (deliverType.data && !deliverTypeABStyle )}}">
      <!-- 仅配送/配送+自提 但样式为老样式 地址在头部上方-->
    <include src="./addressTemplate.wxml"></include>
  </block>
  <view class="time_line_box" wx:if="{{!deliverType.data && dispatchMold == '1'}}">
    <!-- <view class="time_line"></view> -->
  </view>
  <!-- 切换tab -->
  <view wx:if="{{deliverType.data}}" class="lift_head flex-row {{receiptAddress.data && deliverType.data.defaultType == '1'?'address_left_checked':'address_right_checked'}}">
    <view class="lift_item flex-auto {{deliverType.data.defaultType == item.type ? 'lift_active' : ''}}" wx:for="{{deliverType.data.deliverTypeItemList}}" wx:key="type" data-type="{{item.type}}" bindtap="clickAddressTab" aria-checked="true" aria-label="{{(deliverType.data.defaultType == item.type?'已选中':'未选中')+item.descText}}">
      {{item.descText}}
    </view>
  </view>
  <block wx:if="{{deliverTypeABStyle == 1 && deliverType.data.defaultType == '1'}}">
    <include src="./addressTemplate.wxml"></include>
  </block>

  <view class="map_wrap {{deliverTypeABStyle == 1 && dispatchMold == '2' ? 'new_style' : ''}} {{ !deliverType.data && dispatchMold == '2' ? 'just_zt' : ''}} ">
    <!-- !deliverType.data && dispatchMold == '2' 代表仅自提-->
    <!-- 自提 -->
    <block wx:if="{{selfAddress.data && dispatchMold == '2'}}">
      <block wx:if="{{!deliverTypeABStyle}}">
        <view class="lift_address {{!deliverType.data ? 'has_radius' : ''}} d-flex flex-row align-items-start" aria-role="text" aria-label="{{'商家地址' + selfAddress.data.address + '商家名称' + selfAddress.data.storeName}}">
          <view class="address_tag">商家</view>
          <view class="selfAddress_name ellipsis2">{{selfAddress.data.address}} {{selfAddress.data.storeName}}</view>
        </view>
        <view class="time_line_box">
          <view class="time_line"></view>
        </view>
      </block>
      <block wx:if="{{deliverTypeABStyle == 1}}">
        <view class="lift_address new_style d-flex flex-row {{dispatchMold == '2' && !deliverType.data ? 'self_radius' : ''}}">
          <view class="self_left" aria-role="text" aria-label="{{selfAddress.data.storeName + selfAddress.data.address}}">
            <view class="self_store_name">{{selfAddress.data.storeName}}</view>
            <view class="self_address ellipsis2">{{selfAddress.data.address}}</view>
          </view>
          <view class="self_right_empty"></view>
          <view catchtap='toMap' class="self_right d-flex flex-column align-items-center" aria-role="button" aria-label="{{selfAddress.data.distanceExplain + '点击跳转去地图页'}}">
            <view class="self_distance d-flex flex-row align-items-center justify-content-center" wx:if="{{selfAddress.data.distanceExplain}}">
              <text class="distance_txt ellipsis">{{selfAddress.data.distanceExplain}}</text>
              <view class="distance_arrow dj_icon ts_next" style="margin-left:0;margin-top:2rpx;color: #999"></view>
            </view>
            <view class="self_store_icon_wrap">
              <image class="self_store_icon" src="{{selfAddress.data.storeIcon}}" />
            </view>
          </view>
        </view>
      </block>
    </block>

    <!-- 家政服务时间模块 -->
    <block wx:if="{{serviceDateTime}}">
      <view class="settlement-delivery-container newStyle">
        <view class="d-flex flex-row align-items-center settlement-delivery-box" bindtap="serviceTimeClick" data-types="{{serviceDateTime.data.timeSelectedArrowClickEvent}}">
          <text class="distribution-other">{{serviceDateTime.title}}</text>
          <text class="delivery-time ellipsis">
            <block wx:for="{{serviceDateTime.data.checkText.textList}}">
              <text style="color:{{item.fontColor}};font-size:{{item.fontSize*2}}rpx;font-weight:{{item.fontWeight==1?'bold':item.fontWeight==2?'lighter':'normal'}};">{{item.text}}</text>
            </block>
          </text>
          <view class="delivery-arrow-right dj_icon ts_next " wx:if="{{serviceDateTime.data.timeSelectedArrowFlag}}" />
        </view>
      </view>
    </block>
    <!-- 配送时间模块 -->
    <block wx:else>
      <view class="settlement-delivery-container {{deliverTypeABStyle == 1 ? 'newStyle' : ''}}" wx:if="{{receiptAddress.data}}">
        <block wx:if="{{deliverTypeABStyle == 1 && dispatchMold == '2'}}">
          <view class="new_delivery_wrap {{!deliverTime.data.promiseStyle ? 'd-flex flex-row align-items-center' : ''}}">
            <block wx:if="{{!deliverTime.data.promiseStyle}}">
              <view class="new_deliver_left">
                <view class="ndl_text ndl_font ndl_font_family">自提时间</view>
                <view class="ndl_times d-flex flex-row align-items-center" bindtap="onDeliverTimeClick" aria-role="button" aria-label="{{selectedDeliveryTime}}">
                  <text class="ndl_times_txt ndl_font ndl_font_family_bold ellipsis">{{selectedDeliveryTime}}</text>
                  <view class="ndl-arrow-right dj_icon ts_next " wx:if="{{deliverTime.data.promiseDateRespItems.length}}" />
                </view>
              </view>
              <view class="new_deliver_line"></view>
            </block>
            <view class="new_deliver_right {{deliverTime.data.promiseStyle == 1 ? 'no-padding d-flex flex-row align-items-center' : ''}}">
              <view class="ndl_font ndl_font_family ndr_text" aria-role="text" aria-label="手机号">手机号</view>
              <view class="ndr_phone_wrap d-flex flex-row align-items-center">
                <input 
                  class="ndl_font ndl_font_family_bold ndr_phone" 
                  placeholder="请输入手机号" 
                  placeholder-class="ndr_plac" 
                  maxlength="11" 
                  type="text" 
                  value="{{self_phone}}"
                  bindblur="phoneBlur"
                  aria-role="button"
                  aria-label="{{(self_phone?self_phone : '目前为空') + '点击重新输入'}}"
                />
                <image class="ndr_bj" src="https://storage.360buyimg.com/wximg/storewin/settle_bj.png" />
              </view>
            </view>
            <!-- 虚拟商品样式 -->
            <view class="new_promise_style" wx:if="{{deliverTime.data.promiseStyle == 1}}" aria-role="text" aria-label="{{deliverTime.data.nonPushTimeText + deliverTime.data.offPeakTip.tipTwo}}">
              <text wx:if="{{deliverTime.data.nonPushTimeText}}">{{deliverTime.data.nonPushTimeText}}</text>
              <text wx:if="{{deliverTime.data.offPeakTip.tipOne}}">{{deliverTime.data.offPeakTip.tipOne}}</text>
              <text wx:if="{{deliverTime.data.offPeakTip.tipTwo}}">{{deliverTime.data.offPeakTip.tipTwo}}</text>
            </view>
          </view>
        </block>
        <block wx:else>
          <block wx:if="{{deliverTime.data.promiseStyle == 1}}">
            <!-- 虚拟商品样式 -->
            <view class="new_promise_style" aria-role="text" aria-label="{{deliverTime.data.nonPushTimeText + deliverTime.data.offPeakTip.tipTwo}}">
              <text wx:if="{{deliverTime.data.nonPushTimeText}}">{{deliverTime.data.nonPushTimeText}}</text>
              <text wx:if="{{deliverTime.data.offPeakTip.tipOne}}">{{deliverTime.data.offPeakTip.tipOne}}</text>
              <text wx:if="{{deliverTime.data.offPeakTip.tipTwo}}">{{deliverTime.data.offPeakTip.tipTwo}}</text>
            </view>
          </block>
          <block wx:else>
            <view class="d-flex flex-row align-items-center settlement-delivery-box" bindtap="onDeliverTimeClick" aria-role="button" aria-label="{{deliverTime.title+(deliverTime.data.microLabel.title||'')+selectedDeliveryTime}}">
              <text class="distribution-other">{{deliverTime.title}}</text>
              <!-- 微常准标 -->
              <view class="microLabel" wx:if="{{deliverTime.data.microLabel}}" style="color: {{deliverTime.data.microLabel.titleColor}};border-color: {{deliverTime.data.microLabel.borderColor}}">
                {{deliverTime.data.microLabel.title}}
                <view class="shin-border"></view>
              </view>
              <text class="delivery-time ellipsis">{{selectedDeliveryTime || ''}}</text>
              <view class="delivery-arrow-right dj_icon ts_next " wx:if="{{deliverTime.data.promiseDateRespItems.length}}" />
            </view>
            <view class="promiseText" wx:if="{{deliverTime.data.promiseSkuText}}" aria-role="text" aria-label="{{deliverTime.data.promiseSkuText}}">
              {{deliverTime.data.promiseSkuText}}
              <image wx:if="{{deliverTime.data.promiseSkuTip}}" bindtap="showTip" class="settlement-delivery-fee-icon" style="vertical-align: -4rpx;" src="https://storage.360buyimg.com/wximg/settlement/tip.png" />
            </view>
            <view class="offPeakTip" wx:if="{{deliverTime.data.offPeakTip}}" aria-role="text" aria-label="{{deliverTime.data.offPeakTip.tipTwo}}">
              <text wx:if="{{deliverTime.data.offPeakTip.tipOne}}" style="color: {{deliverTime.data.offPeakTip.colorOne}}">{{deliverTime.data.offPeakTip.tipOne}}</text>
              <text wx:if="{{deliverTime.data.offPeakTip.tipTwo}}" style="color: {{deliverTime.data.offPeakTip.colorTwo}}">{{deliverTime.data.offPeakTip.tipTwo}}</text>
            </view>
          </block>
        </block>
      </view>
    </block>
  </view>
  <tip-dialog show="{{tipShow}}" showBtn="{{true}}" title="{{deliverTime.data.promiseSkuTitle}}" desc="{{deliverTime.data.promiseSkuTip}}" bindtipClose="tipClose" ></tip-dialog>
</view>