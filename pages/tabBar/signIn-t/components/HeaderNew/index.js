"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(o):void 0:null!==(i=Object.getPrototypeOf(t))?e(i,n,o):void 0},_index=require("../../../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp2=require("../../../../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp3=require("../../../../../npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp4=require("../../../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp5=require("../../../../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_goToByCouponWeapp=require("../../../../../npm/@jd/djmp/common-t/js/utils/goToByCoupon.weapp.js"),_indexWeapp6=require("../../../../../npm/@jd/djmp/common-t/js/env/index.weapp.js"),_signIn=require("../../../../../common-mp/api/signIn.js"),_beansExchange=require("../../../../../common-mp/api/beansExchange.js"),_bean=require("../../../../../common-mp/api/bean.js"),_utils=require("../../../../../common-mp/components/TaskListForSignNew/js/utils.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var getChannel=function(){return""},isWeappAndH5InWebView=!0,isWeapp=!0,REPORT={keyName:{afterSigninPopup:"afterSigninPopup",clickAfterSigninPopup:"clickAfterSigninPopup",newUserPopup:"newUserPopup",clickNewUserPopup:"clickNewUserPopup",oldUserPopup:"oldUserPopup",clickOldUserPopup:"clickOldUserPopup"},initReportFns:function(){var t=this;Object.keys(this.keyName).forEach(function(e){t[e]=function(){(0,_indexWeapp4.clickReport)({click_id:t.keyName[e]})}})},showYHYYpopupFn:function(){(0,_indexWeapp4.clickReport)({click_id:"showYHYYpopup"})},clickToUseYHYYCouponFn:function(){(0,_indexWeapp4.clickReport)({click_id:"clickToUseYHYYCoupon"})},clickCloseYHYYpopupFn:function(){(0,_indexWeapp4.clickReport)({click_id:"clickCloseYHYYpopup"})},clickToExchangeList:function(e){var t=e.showName,e=e.couponType;(0,_indexWeapp4.clickReport)({click_id:"clickToExchangeList",click_par:{text:t,type:{1:"优惠券",2:"通用红包",3:"话费券",4:"唯一券码"}[e]}})},h5CouponGroupPopup:function(e){e=["newUser","oldUser"][e]||"";(0,_indexWeapp4.clickReport)({click_id:"h5CouponGroupPopup",click_par:{userType:e}})},clickH5CouponGroupPopup:function(e){e=["newUser","oldUser"][e]||"";(0,_indexWeapp4.clickReport)({click_id:"clickH5CouponGroupPopup",click_par:{userType:e}})},h5VipExpiredPopup:function(){(0,_indexWeapp4.clickReport)({click_id:"h5VipExpiredPopup"})},clickh5VipExpiredPopup:function(){(0,_indexWeapp4.clickReport)({click_id:"clickh5VipExpiredPopup"})},signReport:function(e){var t=Number(e)%7+1;e=Number(e)+1,(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"ClickSighIn",click_par:{status:"已签到",alreadySignInDays:e,alreadySignInDaysIn7Period:t}})},shareBeanClickReport:function(){(0,_indexWeapp4.clickReport)({click_id:"clickGuaFenXianDouButton"})},showRedeemCoupon:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.couponResponse,e=e.beanNums,t=(void 0===t?{}:t).couponCode;(0,_indexWeapp4.clickReport)({click_id:"showRedeemCoupon",click_par:{couponId:t,beansCount:e}})},clickRedeem:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.couponResponse,e=e.beanNums,t=(void 0===t?{}:t).couponCode;(0,_indexWeapp4.clickReport)({click_id:"clickRedeem",click_par:{couponId:t,beansCount:e}})},clickCloseCoupon:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.couponResponse,e=e.beanNums,t=(void 0===t?{}:t).couponCode;(0,_indexWeapp4.clickReport)({click_id:"clickCloseCoupon",click_par:{couponId:t,beansCount:e}})},showGetBeans:function(e){(0,_indexWeapp4.clickReport)({click_id:"showGetBeans",click_par:{beansCount:e}})},clickGetBeans:function(e){(0,_indexWeapp4.clickReport)({click_id:"clickGetBeans",click_par:{beansCount:e}})},clickCloseGetBeans:function(e){(0,_indexWeapp4.clickReport)({click_id:"clickCloseGetBeans",click_par:{beansCount:e}})},showLayer:function(e){(0,_indexWeapp4.clickReport)({click_id:"showLayer",click_par:{type:"orderQuest",questid:e}})},clickButton:function(e){(0,_indexWeapp4.clickReport)({click_id:"clickButton",click_par:{type:"orderQuest",questid:e}})},clickOff:function(e){(0,_indexWeapp4.clickReport)({click_id:"clickOff",click_par:{type:"orderQuest",questid:e}})}},linkLayerTypeForClick=(REPORT.initReportFns(),0),initFlag=!0,HeaderNew=(_temp2=_class=function(){function a(){var e,t;_classCallCheck(this,a);for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(o)))).$usedState=["anonymousState__temp18","anonymousState__temp19","$compid__233","$compid__234","$compid__235","style","unDoneMoneyCount","maxBenefit","anonymousState__temp10","anonymousState__temp11","isDaojiaApp","djAppVersion","pagePushSwitch","sevenDaysReward","orderInfo","beansIconAnimation","beansNumAnimation","showToExchangeType","toExchangeButtonAbTest","anonymousState__temp12","userInfo","couponLayer","anonymousState__temp13","linkLayer","anonymousState__temp14","strCoupLayer","anonymousState__temp15","couponpacksLayer","anonymousState__temp16","vipPlusLayer","anonymousState__temp17","showSysPushSwUp","signRewardLayer","totleBeanNum","v31BeansShow","v31CouponShow","orderGetBeansLayer","transition","showRule","sevenDayImg","isSignInStart","urlGroupId","attendClockActivityHis","hasSignNew","hasSignInDay","openBox","linkLayerImgUrl","redPackageAnimation","showOnHomePage","showName","showAction","userAction","areaCode","strCouponInfoList","couponpacksLists","ifNewUser","groupSucc","carveUpCount","couponInfoList","tomorrowReward","signPoint","afterSignResponse","signInInfo","ifCic","refreshSignStatus","hasSign","openBeansSharePop","latitude","longitude","newBenefitLists","secondKillLists","resources","refreshPushSwitchStatus","isOpenPushStatus","setIsClickPagePushSwitch","v33BuyOneTaskInfo","callToBottomList","pushSwitch","v34abflag","address"],t.config={navigationBarTitleText:""},t.customComponents=["SubscribeMessage","OpenSysPushPop","SignRewardPop"],_possibleConstructorReturn(t,e)}return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){var t=this;_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.state={transition:{opacity:"0"},showRule:!1,totleBeanNum:0,sevenDayImg:!1,isSignInStart:!1,urlGroupId:"",attendClockActivityHis:!1,hasSignNew:!1,hasSignInDay:9999,openBox:!0,couponLayer:!1,linkLayer:!1,linkLayerImgUrl:"",beansNumAnimation:"",redPackageAnimation:"",showOnHomePage:!1,showToExchangeType:!1,showName:"",showAction:!1,userAction:"",beansIconAnimation:"",areaCode:"",strCoupLayer:!1,strCouponInfoList:[],couponpacksLayer:!1,vipPlusLayer:!1,couponpacksLists:[],ifNewUser:-1,groupSucc:!1,carveUpCount:"",showSysPushSwUp:!1,pagePushSwitch:!1,signRewardLayer:!1,couponInfoList:[],tomorrowReward:{},signPoint:0,afterSignResponse:{},maxBenefit:{},v31CouponShow:!1,v31BeansShow:!1,orderGetBeansLayer:!1,orderInfo:{}},this.$$refs=[{type:"component",id:"hfFac",refName:"",fn:function(e){return t.childSubscribe=e}}]}},{key:"hideStrCoupLayer",value:function(){this.setState({strCoupLayer:!1}),this.checkOrderTask(),REPORT.clickCloseYHYYpopupFn()}},{key:"goToCouponPage",value:function(e){var t=this.state.address,n=t.longitude,o=t.latitude,t=t.cityId||t.areaCode||t.cityCode||"",i={};i.couponId=e.couponId||e.couponCode||e.couponResponse.couponCode,i.longitude=n,i.latitude=o,i.cityId=t,(0,_goToByCouponWeapp.goToByCouponId)(i)}},{key:"clickStrCoupBtn",value:function(e){REPORT.clickToUseYHYYCouponFn();var t=e.ifFull;this.checkAbToMyExchangePage(e,t,"coupon")}},{key:"hideLinkLayer",value:function(){this.setState({linkLayer:!1}),linkLayerTypeForClick=0}},{key:"linkLayerClick",value:function(){var e=this.state,t=e.linkLayerType,e=e.linkLayerUrl;1==linkLayerTypeForClick&&REPORT.clickAfterSigninPopup(),2==linkLayerTypeForClick&&REPORT.clickNewUserPopup(),1==t&&e?(0,_indexWeapp5.autoJump)({url:e}):(0,_indexWeapp5.jump)({to:"home"})}},{key:"closeCouponLayer",value:function(){this.setState({couponLayer:!1})}},{key:"goUseCoupon",value:function(e){REPORT.clickOldUserPopup(),e?(0,_indexWeapp5.autoJump)({url:e}):(0,_indexWeapp5.jump)({to:"home"})}},{key:"afterSign",value:function(e,t){var n=this,e=e.result.strategyCouponResponse,e=(void 0===e?{}:e).couponInfoList,e=void 0===e?[]:e;0<e.length?(n.setState({strCoupLayer:!0,strCouponInfoList:e}),REPORT.showYHYYpopupFn()):this.checkOrderTask()}},{key:"signHeaderInfo",value:function(){this.props.signInInfo()}},{key:"beansFlyAnimate",value:function(e,t){var i=this,n=this.props.sevenDaysReward.alreadySignInDays,o=void 0===n?0:n,a=_index2.default.createSelectorQuery(),a=_index2.default.createSelectorQuery().in(this.$scope);setTimeout(function(){a.selectAll("#animateEle"+o%7+",#beans").boundingClientRect(function(e){var t,n,o;e&&e[0]&&e[1]&&(t=e[1].left+e[1].width/2,n=e[1].top+e[1].height/2,o=e[0].left+e[0].width/2,e=e[0].top+e[0].height/2,i.setState({transition:{opacity:"1",transform:"translate("+(o-t)+"px, "+(e-n)+"px)"}})),i.beanIconAnimation()}).exec()},100),setTimeout(function(){setTimeout(function(){i.setState({transition:{opacity:"0"}}),i.startSignAnimationNew(),i.signInFinnish(e,t)},1200)},100)}},{key:"sign",value:function(){var o=this,i=0<arguments.length&&void 0!==arguments[0]&&arguments[0];(0,_indexWeapp2.isLogin)().then(function(){if(o.setState({isSignInStart:!0}),o.state.isSignInStart)return!1;var e=o.state.address,t=o.props.ifCic,e={channel:getChannel(),cityId:e.cityId||e.areaCode||e.cityCode||"",longitude:e.longitude,latitude:e.latitude,wholeVersion:1,ifCic:t};(0,_signIn.userSigninFun)(e).then(function(e){var t,n;0!=e.code&&"0"!=e.code||((0,_indexWeapp.showToast)({title:"签到成功",icon:"none",duration:1e3}),o.sleep(1e3),t=(0,_indexWeapp3.getStorageSync)("signButton_flag"),(n=(n=new Date).getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate())!=t&&((0,_indexWeapp3.setStorageSync)("signButton_flag",n),o.childSubscribe.initSubscribeMessage(["sUa5bwdXb322H3gZYAUF2CLKhDqgCfEE8ClYdMr69AU"],[4])),o.setState({hasSignNew:!0}),o.beansFlyAnimate(i,e),(n=void 0===(t=o.state.userInfo)?{}:t).hasSign=!0,o.props.refreshSignStatus(!0),o.setState({userInfo:n}),o.getCarveUpInfo(),e=o.state.sevenDaysReward.alreadySignInDays,REPORT.signReport(void 0===e?1:e),o.props&&o.props.hasSign&&o.props.hasSign())}).catch(function(){(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"ClickSighIn",click_par:{status:"未签到"}})})}).catch(function(){(0,_indexWeapp2.goToLogin)()})}},{key:"sleep",value:function(e){for(var t=new Date,n=t.getTime()+e;;)if((t=new Date).getTime()>n)return}},{key:"showBeanShareLayer",value:function(){var e=this.state.urlGroupId,t=this;(0,_indexWeapp3.getStorageSync)("teachPopHasShow")||"true"==(0,_indexWeapp3.getStorageSync)("teachPopHasShow")?e?setTimeout(function(){t.signHeaderInfo()},200):(setTimeout(function(){t.openBeansShare(),t.signHeaderInfo()},200),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"ClickDivideBean",click_par:{from:"SighIn"}})):((0,_indexWeapp3.setStorageSync)("teachPopHasShow",!0),this.state.attendClockActivityHis?setTimeout(function(){t.props.showPopTeach(),t.signHeaderInfo()},200):setTimeout(function(){t.openBeansShare(),t.signHeaderInfo()},200))}},{key:"signInFinnish",value:function(e,t){var n=this.state.sevenDaysReward,o=n.items,o=void 0===o?[]:o,n=n.alreadySignInDays,n=void 0===n?1:n;o&&0<o.length&&((o=t&&t.result&&t.result.points||o[n%7-1]&&o[n%7-1].points)&&this.beanAnimate(o)),e||this.openSignRewardPop(t)}},{key:"openBeansShare",value:function(){this.props.openBeansSharePop(),REPORT.shareBeanClickReport()}},{key:"beanIconAnimation",value:function(){var e=this;this.setState({beansIconAnimation:"shakeAnimation"}),setTimeout(function(){e.setState({beansIconAnimation:""})},1200)}},{key:"beanAnimate",value:function(e){var t=this,n=this.state.totleBeanNum,o=0;setInterval(function(){++o<=e?t.setState({totleBeanNum:++n}):clearInterval()},45)}},{key:"startSignAnimationNew",value:function(){var e=this,t=(t=e.state.sevenDaysReward,(n=(void 0===(n=(t=void 0===t?{}:t).items)?[]:n)[t.alreadySignInDays%7])&&(n.hasSign=!0),t.alreadySignInDays++,e.setState({changeItem:n}),this.props),e=t.latitude,n=t.longitude;e&&n&&this.setCuponShow(!0)}},{key:"toRecordPage",value:function(){}},{key:"toMyExchange",value:function(){(0,_indexWeapp2.isLogin)().then(function(){(0,_utils.jumpExchange)(),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"ClickExchange",click_par:{}})}).catch(function(){(0,_indexWeapp2.goToLogin)()})}},{key:"showRule",value:function(){this.setState({showRule:!0}),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"ClickRule",click_par:{}})}},{key:"closeRule",value:function(){this.setState({showRule:!1})}},{key:"getPosition",value:function(){var e=_index2.default.createSelectorQuery(),e=_index2.default.createSelectorQuery().in(this.$scope);setTimeout(function(){e.selectAll("#animateEle6,#beans").boundingClientRect(function(e){}).exec()},500)}},{key:"handleClickCoup",value:function(){var e,t,n=this;(t=n.state.areaCode)&&_index2.default.createSelectorQuery().select("#"+({new_user:"newbenefit",time_limit:"secondKill"}[t]||"secondKill")).boundingClientRect(function(e){e=e.top;_index2.default.pageScrollTo({scrollTop:e}).then(function(){})}).exec(),(0,_signIn.clickCouponButtonFn)({}).then(function(e){var t;0==e.code&&(t=(e=n.props).latitude,e=e.longitude,t&&e&&n.setCuponShow(!0))}).catch(function(e){}),this.props.toExchangeButtonAbTest?(0,_indexWeapp4.clickReport)({click_id:"clickToExchangev2.9",click_par:{text:"去兑换"}}):(e=(t=this.state).showName,t=t.couponType,REPORT.clickToExchangeList({showName:e,couponType:t}))}},{key:"setCuponShow",value:function(u){var l=this,e=this.props,t=e.toExchangeButtonAbTest,n=e.newBenefitLists,d=void 0===n?{}:n,n=e.secondKillLists,h=void 0===n?{}:n;t?(e=d.items&&0<d.items.length||h.items&&0<h.items.length,n="",n=d.items&&0<d.items.length?"new_user":"time_limit",this.setState({showToExchangeType:e,areaCode:n})):(0,_signIn.ifClickedCouponButtonFn)({}).then(function(e){var t,e=e.result,e=void 0===e?{}:e,n=e.userAction,e=e.ifClickedCoupon,o=!1,i=void 0,a=!1,s=void 0;if(d.items&&0<d.items.length){var i="new_user",r=d.items.find(function(e){return 1==e.status});if(!r)return}else{i="time_limit";var r=h.items.find(function(e){return 1==e.status});if(!r)return;r=r.items,s=r.find(function(e){return 0==e.isShow})}r=s.beanNums,t=s.showName,n&&((p=JSON.parse(n)).buttonText=t,n=JSON.stringify(p));var p=s.couponResponse&&s.couponResponse.couponType,c=!!l.props.userInfo&&l.props.userInfo.hasSign;c&&!e?r<=l.state.totleBeanNum&&(o=!0):o=!1,l.setState({showOnHomePage:a=s?!0:a,showName:t,areaCode:i,couponType:p,showAction:o,userAction:n}),(u?o:o&&c)?l.setState({redPackageAnimation:"shakeMove"}):l.setState({redPackageAnimation:""})}).catch(function(e){})}},{key:"_createLinkLayerData",value:function(e){var t=this;return function(){var e=t.state.linkLayerImgUrl;return{style:_indexModuleScssMap2.default,linkLayerImgUrl:void 0===e?"":e}}}},{key:"_createCouponLayerData",value:function(e){var a=this;return function(){var e=a.state.displacementFlowConfigReponse,e=void 0===e?{}:e,t=e.oldAmount,n=e.oldTitle,o=e.oldThreshold,i=e.oldAvailableDate,e=e.redirectH5Address;return{style:_indexModuleScssMap2.default,redirectH5Address:e,oldAmount:t,oldTitle:n,oldThreshold:o,oldAvailableDate:i}}}},{key:"_createItemNotSignCouponData",value:function(e){return function(e){var t=e.couponPrice,n=e.rewardType,o=e.notifyText,e=e.couponType;return{style:_indexModuleScssMap2.default,notifyText:o,couponPrice:t,phone:3==n,weekCard:2==n,redPack:1==n,reduceCoupon:0==n&&2==e,couponType:0==n&&2!=e}}}},{key:"_createItemNotSignData",value:function(a){var s=this;return function(n,e){var o=s.state.transition,i=s.props.sevenDaysReward?s.props.sevenDaysReward.alreadySignInDays:1,t=s._createItemNotSignCouponData(a+"GJaNhwRlRK")(n);return{loopArray53:n.day===i+1?[0,1,2,3,4,5,6,7].map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp3:n.day===i+1?(0,_index.internal_inline_style)(o):null,$original:e.$original}}):[],style:_indexModuleScssMap2.default,anonymousState__temp:t,alreadySignInDays:i,index:e,item:n}}}},{key:"_createItemSignData",value:function(e){return function(e,t){t=6==t?"has_sign_last":0==t?"has_sign_first":"has_sign";return{style:_indexModuleScssMap2.default,hasSignClassName:t,item:e}}}},{key:"_createSignGridsData",value:function(o){var i=this;return function(){var e=i.props.sevenDaysReward,n=void 0===e?{}:e,e=n&&n.items&&0<n.items.length?n.items.map(function(e,t){return{$loopState__temp5:(e={$original:(0,_index.internal_get_original)(e)}).$original.hasSign?i._createItemSignData(o+"IzdWSFRQkb"+t)(e.$original,t):null,$loopState__temp7:i._createItemNotSignData(o+"wWUXOMEyxD"+t)(e.$original,t),$loopState__temp9:n&&n.items&&0<n.items.length?t+"sign_wrap":null,$original:e.$original}}):[];return{sevenDaysReward:n,loopArray54:e,style:_indexModuleScssMap2.default}}}},{key:"_createCouponButtonData",value:function(e){var i=this;return function(){var e=i.state,t=e.showOnHomePage,n=e.showName,o=e.redPackageAnimation,e=e.userAction,n=n&&n.substr(0,6);return{showOnHomePage:t,style:_indexModuleScssMap2.default,redPackageAnimation:o,userAction:e,showName:n}}}},{key:"_createStrategyCouponLayerData",value:function(e){var t=this;return function(){var e=t.state.strCouponInfoList,e=void 0===e?[]:e;return{loopArray55:e.map(function(e,t){var n=(e={$original:(0,_index.internal_get_original)(e)}).$original;return{minOrderAmount:n.minOrderAmount,quota:n.quota,couponShowName:n.couponShowName,expireShow:n.expireShow,$original:e.$original}}),style:_indexModuleScssMap2.default,strCouponInfoList:e}}}},{key:"closeCouponLayer",value:function(){this.setState({couponpacksLayer:!1})}},{key:"clickCouponpacksBtn",value:function(e){var t=this.state.ifNewUser;REPORT.clickH5CouponGroupPopup(t),this.goToCouponPage(e)}},{key:"_createCouponpacksLayerData",value:function(e){var t=this;return function(){var e=t.state.couponpacksLists,e=void 0===e?[]:e;return{loopArray56:e.map(function(e,t){var n=(e={$original:(0,_index.internal_get_original)(e)}).$original;return{quota:n.quota,couponShowName:n.couponShowName,minOrderAmount:n.minOrderAmount,$original:e.$original}}),style:_indexModuleScssMap2.default,couponpacksLists:e}}}},{key:"closeVipLayer",value:function(){this.setState({vipPlusLayer:!1})}},{key:"vipLayerLink",value:function(){var e=this.state.vipData.vipLink;REPORT.clickh5VipExpiredPopup(),(0,_indexWeapp.navigateTo)(e)}},{key:"_createVipPlusLayerData",value:function(e){var n=this;return function(){var e=n.state.vipData,e=void 0===e?{}:e,t=e.redPacketMoney,e=e.leftVipRedEnvelope;return{style:_indexModuleScssMap2.default,redPacketMoney:void 0===t?0:t,leftVipRedEnvelope:void 0===e?0:e}}}},{key:"getCarveUpInfo",value:function(){var n=this;(0,_bean.getCarveUp)({groupId:"",type:1}).then(function(e){var t;0==e.code&&(t=(e=void 0===(e=e.result)?{}:e).groupStatus,e=e.carveUpCount,n.setState({groupSucc:2==t,carveUpCount:e}))}).catch(function(){})}},{key:"_createSignBtnData",value:function(e){var s=this;return function(){var e=s.props,t=e.sevenDaysReward,t=void 0===t?{}:t,e=e.resources,e=void 0===e?{}:e,e=e.resourcesList&&e.resourcesList.some&&e.resourcesList.some(function(e){return e.url&&-1<e.url.indexOf("sign-bean-guafen")}),n=s.state,o=n.userInfo,o=void 0===o?{}:o,i=n.hasSignNew,a=n.groupSucc,n=n.carveUpCount,o=!!o&&o.hasSign;return{groupSucc:void 0!==a&&a,shareFlag:e,style:_indexModuleScssMap2.default,carveUpCount:n,sevenDaysReward:t,hasSign:o,hasSignNew:void 0!==i&&i}}}},{key:"refreshPushSwitchStatus",value:function(e){this.props.refreshPushSwitchStatus(e)}},{key:"openSysPushSwitch",value:function(){var e=this.state.pagePushSwitch,t=this.props.isOpenPushStatus;(0,_indexWeapp4.clickReport)({click_id:"clickPushSwitchOnMainPanel",click_par:{action:e?"turnOff":"turnOn",systemPushStatus:1==t?"on":"off"}}),e?this.props.refreshPushSwitchStatus(0):1==t?this.props.refreshPushSwitchStatus(1):((0,_indexWeapp4.clickReport)({click_id:"appPushSettingPopup"}),this.handleSysPushPop(!0))}},{key:"setIsClickPagePushSwitch",value:function(e){this.props.setIsClickPagePushSwitch(e)}},{key:"handleSysPushPop",value:function(e){this.setState({showSysPushSwUp:e})}},{key:"closeSignRewardLayer",value:function(){this.setState({signRewardLayer:!1})}},{key:"handleSignRewardLayer",value:function(e){this.setState({signRewardLayer:e}),e||(e=this.state.afterSignResponse)&&this.afterSignRewardPopOtherPop(e)}},{key:"afterSignRewardPopOtherPop",value:function(e){this.afterSign(e,this.showBeanShareLayer.bind(this))}},{key:"openSignRewardPop",value:function(e){var t=e.result,n=t.couponList,t=t.points,o=(this.setState({afterSignResponse:e}),this.state.sevenDaysReward),i=void 0===o?{}:o,a={};if(i&&0<i.items.length)for(var s=0;s<i.items.length;s++)if(!i.items[s].hasSign){a=i.items[s];break}if(a&&-1!=a.rewardType&&null!=a.rewardType||n&&0<n.length){a.tomorrowCouponTitle=i.tomorrowCouponTitle,a.tomorrowCouponPrice=i.tomorrowCouponPrice,this.setState({signRewardLayer:!0,couponInfoList:n,tomorrowReward:a,signPoint:t});var r=[];if(n&&0<n.length)for(var p=0;p<n.length;p++)r.push({type:n[p].rewardType,code:n[p].couponId||n[p].couponCode});o={};a&&-1!=a.rewardType&&null!=a.rewardType&&(o={type:a.rewardType}),(0,_indexWeapp4.clickReport)({click_id:"checkinSucceedPopup",click_par:{todayReward:r,tomorrowReward:o}})}else this.afterSignRewardPopOtherPop(e)}},{key:"signRewardGotoCouponGo",value:function(e){this.goToCouponPage(e)}},{key:"checkOrderTask",value:function(){this.judgeTaskGuideOrGetBeanLayer()}},{key:"judgeTaskGuideOrGetBeanLayer",value:function(){this.setState({v31BeansShow:!0});var e=this.props.unDoneMoneyCount;REPORT.showGetBeans(e)}},{key:"goTaskListPage",value:function(){var e=this.props.unDoneMoneyCount;REPORT.clickGetBeans(e),_indexWeapp6.isDaojiaApp&&_indexWeapp6.isAndroid&&0<=(0,_utils.isCompatible)(String(_indexWeapp6.djAppVersion),String("8.6.0"))?(e=window.location.origin+"/taroh5/h5dist/#/pages/signIn-t/taskList/index?showhand=1",(0,_indexWeapp5.jump)({type:"",to:"web",params:{extraUrlInDJ:e}})):(0,_indexWeapp.navigateTo)("/pages/signIn-t/taskList/index?showhand=1"),this.setState({v31BeansShow:!1})}},{key:"v31BeansClose",value:function(){this.setState({v31BeansShow:!1});var e=this.props.unDoneMoneyCount;REPORT.clickCloseGetBeans(e)}},{key:"checkAbToMyExchangePage",value:function(e){this.judgeFullCoupon(e,!1,"")}},{key:"judgeFullCoupon",value:function(e){var t,n,o,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";i?(n=(i=this.props.v33BuyOneTaskInfo).awardValue,o=i.taskType,i=i.status,(t=e).awardValue=n,t.taskType=o,t.status=i,this.props&&this.props.callToBottomList&&this.props.callToBottomList(a,t)):this.goToCouponPage(e),this.setState({v31CouponShow:!1,strCoupLayer:!1})}},{key:"v31CouponExchange",value:function(){var o=this,i=this.state.maxBenefit,e={},e=(e.activityId=i.activityId||"",e.prizeId=i.prizeId||"",e.type=i.type||"",e.configId=""|i.activityId,0==e.type&&(e.skuId=i.skuResponse.skuId||"",e.storeId=i.skuResponse.storeId||"",e.orgCode=i.skuResponse.orgCode||""),{configId:e.activityId||"",activityId:e.activityId||"",skuId:e.skuId||"",storeId:e.storeId||"",orgCode:e.orgCode||"",type:{0:"new",1:"limit"}[i.activityType]||"new",prizeId:e.prizeId||""});(0,_beansExchange.exchangeProduct)(e).then(function(e){var t,n;0==e.code?(t=(void 0===(t=i.couponResponse)?{}:t).ifFull,n=void 0!==t&&t,(0,_indexWeapp.showToast)({title:"兑换成功"}),setTimeout(function(){o.checkAbToMyExchangePage(i,n,"coupon")},500)):(0,_indexWeapp.showToast)({title:e.msg})}).catch(function(e){(0,_indexWeapp.showToast)({title:e.msg||"网络错误，请稍后重试！"})}),REPORT.clickRedeem(i)}},{key:"v31CouponClose",value:function(){this.setState({v31CouponShow:!1}),this.checkOrderTask();var e=this.state.maxBenefit;REPORT.clickCloseCoupon(e)}},{key:"v33GoToOrder",value:function(){this.setState({orderGetBeansLayer:!1});var e=this.state.orderInfo.taskId;REPORT.clickButton(e),this.props&&this.props.callToBottomList&&this.props.callToBottomList()}},{key:"v33Close",value:function(){this.setState({orderGetBeansLayer:!1});var e=this.state.orderInfo.taskId;REPORT.clickOff(e),this.judgeTaskGuideOrGetBeanLayer()}},{key:"callToBottomList",value:function(){this.props&&this.props.callToBottomList&&this.props.callToBottomList()}},{key:"componentWillReceiveProps",value:function(e){var t=this;if(9999===this.state.hasSignInDay||this.state.hasSignInDay!==e.userInfo.alreadySignInDays){if(e.sevenDaysReward&&e.sevenDaysReward.items)for(var n=0;n<6;n++)e.sevenDaysReward.items[n].checkIn=!1;this.setState({totleBeanNum:e.userInfo.points,userInfo:e.userInfo,sevenDaysReward:e.sevenDaysReward,urlGroupId:e.urlGroupId,hasSignInDay:e.userInfo.alreadySignInDays,attendClockActivityHis:e.attendClockActivityHis})}var o,i;i=e.userInfo.points,!t.state.totleBeanNum&&i&&100<=i&&t.setState({beansNumAnimation:"moveUp"}),i=e.address,t.setState({address:i});initFlag&&(i=t.props,o=i.newBenefitLists,i=i.secondKillLists,o&&i&&(t.setCuponShow(),initFlag=!1)),_indexWeapp6.isDaojiaApp&&"7.4.5"<=_indexWeapp6.djAppVersion&&(o=e.isOpenPushStatus,1==(i=e.pushSwitch)&&0==o?(this.props.refreshPushSwitchStatus(0),this.setState({pagePushSwitch:!1})):1==i&&1==o?this.setState({pagePushSwitch:!0}):this.setState({pagePushSwitch:!1}))}},{key:"componentWillMount",value:function(){this.getCarveUpInfo()}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__233"),n=(0,_index.genCompid)(e+"$compid__234"),o=(0,_index.genCompid)(e+"$compid__235"),i=this.__props,a=i.sevenDaysReward,a=void 0===a?{}:a,s=i.userInfo,s=void 0===s?{}:s,r=i.toExchangeButtonAbTest,p=i.isOpenPushStatus,i=i.pushSwitch,c=this.__state,u=c.totleBeanNum,u=void 0===u?0:u,l=c.couponLayer,l=void 0!==l&&l,d=c.linkLayer,d=void 0!==d&&d,h=(c.beansNumAnimation,c.beansIconAnimation,c.strCoupLayer),y=c.couponpacksLayer,g=c.vipPlusLayer,f=(c.showToExchangeType,c.showSysPushSwUp),_=(c.pagePushSwitch,c.signRewardLayer),m=c.couponInfoList,k=c.tomorrowReward,S=c.signPoint,v=c.maxBenefit,c=(c.v31CouponShow,c.v31BeansShow,c.orderGetBeansLayer,c.orderInfo,this.__props.unDoneMoneyCount),v=v.showName&&v.showName.split("元")[0],w=this._createSignGridsData(e+"HmdDDMKdni")(),C=this._createSignBtnData(e+"eSoZScPvYV")(),P=r?null:this._createCouponButtonData(e+"cEWoDIpszN")(),l=l?this._createCouponLayerData(e+"uydwFbVcEn")():null,d=d?this._createLinkLayerData(e+"kfuPDUJgyg")():null,h=h?this._createStrategyCouponLayerData(e+"IoLHRHpThf")():null,y=y?this._createCouponpacksLayerData(e+"vkXtyyiNow")():null,g=g?this._createVipPlusLayerData(e+"dsLbaOIYMd")():null,e=(.001*u).toFixed(2);return _index.propsManager.set({subscribeMessageImageUrl:"https://storage.360buyimg.com/wximg/common/subscribeImageSign.png"},t),f&&_index.propsManager.set({setIsClickPagePushSwitch:this.setIsClickPagePushSwitch.bind(this),closeSysPushPopLayer:this.handleSysPushPop.bind(this)},n),_&&_index.propsManager.set({v34abflag:this.__props.v34abflag,address:this.__state.address,couponList:m,tomorrowReward:k,signPoint:S,isOpenPushStatus:p,pushSwitch:i,refreshPushSwitchStatus:this.refreshPushSwitchStatus.bind(this),signRewardGotoCouponGo:this.signRewardGotoCouponGo.bind(this),closeSignRewardLayer:this.handleSignRewardLayer.bind(this),handleSysPushPop:this.handleSysPushPop.bind(this),callToBottomList:this.callToBottomList.bind(this),closeSignRewardLayerOnly:this.closeSignRewardLayer.bind(this)},o),Object.assign(this.__state,{anonymousState__temp18:v,anonymousState__temp19:e,$compid__233:t,$compid__234:n,$compid__235:o,style:_indexModuleScssMap2.default,unDoneMoneyCount:c,anonymousState__temp10:w,anonymousState__temp11:C,isDaojiaApp:_indexWeapp6.isDaojiaApp,djAppVersion:_indexWeapp6.djAppVersion,sevenDaysReward:a,toExchangeButtonAbTest:r,anonymousState__temp12:P,userInfo:s,anonymousState__temp13:l,anonymousState__temp14:d,anonymousState__temp15:h,anonymousState__temp16:y,anonymousState__temp17:g}),this.__state}}]),a}(),_class.$$events=["hideLinkLayer","linkLayerClick","closeCouponLayer","goUseCoupon","handleClickCoup","clickStrCoupBtn","hideStrCoupLayer","clickCouponpacksBtn","closeCouponLayer","vipLayerLink","closeVipLayer","openBeansShare","sign","goTaskListPage","v31BeansClose","v31CouponExchange","v31CouponClose","openSysPushSwitch","v33GoToOrder","v33Close","toRecordPage","handleClickCoup","showRule","closeRule"],_class.multipleSlots=!0,_class.$$componentPath="pages/tabBar/signIn-t/components/HeaderNew/index",_temp2);exports.default=HeaderNew,Component(require("../../../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(HeaderNew));