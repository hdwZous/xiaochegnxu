"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.countDown=exports.getDeviceId=exports.isEmptyObj=exports.getTaroPlatEnv=void 0,exports.updateAb=updateAb,exports.testSpeed=testSpeed,exports.genSignKeyV1=genSignKeyV1;var _indexWeapp=require("../storage/index.weapp.js"),_indexWeapp2=require("../getApp/index.weapp.js"),_indexWeapp3=_interopRequireDefault(_indexWeapp2);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var app=(0,_indexWeapp3.default)(),getTaroPlatEnv=exports.getTaroPlatEnv=function(){return"weapp"},isEmptyObj=exports.isEmptyObj=function(e){for(var t in e)return!1;return!0},getDeviceId=exports.getDeviceId=function(){var e=app._independent_.uuId;if(!(e=e||wx.getStorageSync("uuId"))){for(var t=[],n="0123456789abcdef",r=0;r<36;r++)t[r]=n.substr(Math.floor(16*Math.random()),1);t[14]="4",t[19]=n.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",e=t.join(""),(0,_indexWeapp.setStorageSync)("uuId",e)}return e},countDown=exports.countDown=function(e,t){var n=void 0;countDownTime(e/=1e3,n,t),e--,n=setInterval(function(){countDownTime(e,n,t),e--},1e3)};function countDownTime(e,t,n){var r=0,o=0,a=0,i=0;0<e&&(r=Math.floor(e/86400),o=Math.floor(e/3600)-24*r,a=Math.floor(e/60)-24*r*60-60*o,i=Math.floor(e)-24*r*60*60-60*o*60-60*a),o<=9&&(o="0"+o),a<=9&&(a="0"+a),i<=9&&(i="0"+i),0<e?n({day:r,hour:o,minute:a,second:i,timer:t,end:!1}):(clearInterval(t),n({hour:"00",minute:"00",second:"00",timer:t,end:!0}))}function updateAb(e){try{var n,r,o=app._independent_.testtag||[];e instanceof Array?e.forEach(function(n){var r=!0;n.startTime=Date.now(),o.forEach(function(e,t){e.experimentName===n.experimentName&&(o.splice(t,1,n),r=!1)}),r&&o.push(n)}):e&&e.experimentName&&(r=!0,(n=e||{}).startTime=Date.now(),o.forEach(function(e,t){e.experimentName===n.experimentName&&(o.splice(t,1,n),r=!1)}),r&&o.push(n)),app._independent_.testtag=o}catch(e){}}function testSpeed(o,a,i,p,c){return new Promise(function(e,t){var n=(0,_indexWeapp3.default)(),r=i-a;n.reportPerformance(p,r);r=Date.now()-o-r;n.reportPerformance(c,r),e(!0)})}function genSignKeyV1(e){var t=Object.assign({},e),e=t.signNeedBody;delete t.functionId,delete t.signNeedBody;var n={};if(e)try{var r=t.body;delete t.body,r=(r=getStringValue(JSON.parse(r))).substring(0,r.lastIndexOf("&")),n=Object.assign({},t,{body:r})}catch(e){n=t}else n=t;var o={};Object.keys(n).sort().forEach(function(e){"functionId"!=e&&(o[e]=n[e])});e=Object.values(o).filter(function(e){if(""!=e)return e}),r=require("../../../../crypto-js/hmac-sha256.js"),t=require("../../../../crypto-js/enc-hex.js"),e=r(e.join("&"),"6b040931c5661s04108af19t2a8e6fdb9");return t.stringify(e)}function getStringValue(t){var e,n="",r={};for(e in Object.keys(t).sort().forEach(function(e){r[e]=t[e]}),r){var o=r[e];"[object Object]"===Object.prototype.toString.call(o)?n+=getStringValue("[object Object]"===Object.prototype.toString.call(o)?o:JSON.parse(o)):"[object Array]"===Object.prototype.toString.call(o)?o.map(function(e,t){"[object Object]"===Object.prototype.toString.call(e)?n+=getStringValue("[object Object]"===Object.prototype.toString.call(e)?e:JSON.parse(e)):""!==e&&null!=e&&(n+=e+"&")}):""!==o&&null!=o&&(n+=o+"&")}return n}