"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function n(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,o,t){return o&&n(e.prototype,o),t&&n(e,t),e}}(),_get=function e(o,t,n){null===o&&(o=Function.prototype);var i=Object.getOwnPropertyDescriptor(o,t);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(n):void 0:null!==(i=Object.getPrototypeOf(o))?e(i,t,n):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_indexWeapp3=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp4=require("../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_offLine=require("./api/offLine.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,o){if(e)return!o||"object"!=typeof o&&"function"!=typeof o?e:o;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}var isWeapp=!0,OPTIONS={},REPORT={pv:function(e){var o=OPTIONS,t=o.orgCode,n=o.storeId,i=o.businessId,o=o.promoteId;(0,_indexWeapp3.pvReport)({page_par:{login:e,orgCode:t,storeId:n,businessId:i,promoteId:o}})},clickLogin:function(){var e=OPTIONS,o=e.orgCode,t=e.storeId,n=e.businessId,e=e.promoteId;(0,_indexWeapp3.clickReport)({click_id:"clickLogin",click_par:{orgCode:o,storeId:t,businessId:n,promoteId:e}})},succeedToPickBag:function(){var e=OPTIONS,o=e.orgCode,t=e.storeId,n=e.businessId,e=e.promoteId;(0,_indexWeapp3.clickReport)({click_id:"succeedToPickBag",click_par:{orgCode:o,storeId:t,businessId:n,promoteId:e}})},failToPickBag:function(){var e=OPTIONS,o=e.orgCode,t=e.storeId,n=e.businessId,e=e.promoteId;(0,_indexWeapp3.clickReport)({click_id:"failToPickBag",click_par:{orgCode:o,storeId:t,businessId:n,promoteId:e}})},couponTypeToName:function(e){return{1:"优惠券",2:"通用红包",3:"话费券",4:"唯一券码"}[e]||"话费券"},succeedToSendCoupon:function(e){var o=e.couponCode,e=e.couponType,t=OPTIONS,n=t.orgCode,i=t.storeId,r=t.businessId,t=t.promoteId,e=this.couponTypeToName(e);(0,_indexWeapp3.clickReport)({click_id:"succeedToSendCoupon",click_par:{orgCode:n,storeId:i,businessId:r,promoteId:t,couponType:e,couponCode:o}})},failToSendCoupon:function(e){var o=e.couponCode,e=e.couponType,t=OPTIONS,n=t.orgCode,i=t.storeId,r=t.businessId,t=t.promoteId,e=this.couponTypeToName(e);(0,_indexWeapp3.clickReport)({click_id:"failToSendCoupon",click_par:{orgCode:n,storeId:i,businessId:r,promoteId:t,couponType:e,couponCode:o}})},clickCheckCoupon:function(){(0,_indexWeapp3.clickReport)({click_id:"clickCheckCoupon"})},clickToStore:function(){var e=OPTIONS,o=e.orgCode,t=e.storeId,n=e.businessId,e=e.promoteId;(0,_indexWeapp3.clickReport)({click_id:"clickToStore",click_par:{orgCode:o,storeId:t,businessId:n,promoteId:e}})}},Index=(_temp2=_class=function(){function r(){var e,o;_classCallCheck(this,r);for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=o=_possibleConstructorReturn(this,(o=r.__proto__||Object.getPrototypeOf(r)).call.apply(o,[this].concat(n)))).$usedState=["style","timesStr","couponTitle","receiveBagsFlag","receiveCouponFlag","showFlag","isLoginStatus","data","timer"],o.config={navigationBarTitleText:"领礼品",navigationBarBackgroundColor:"#fff",navigationBarTextStyle:"black"},o.customComponents=[],_possibleConstructorReturn(o,e)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(e){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,e),this.state={isLoginStatus:!1,data:{},timesStr:"00分00秒",timer:null,showFlag:!1},this.$$refs=[]}},{key:"setShowFlagOn",value:function(){this.setState({showFlag:!0})}},{key:"getParams",value:function(){var e=this.$router.params,e=(e.orgCode,e.storeId,e.businessId);e&&isWeapp&&(e=e,(0,_index.getApp)().globalData.qrcode.business=e||""),OPTIONS=this.$router.params,this.getLoginStatus()}},{key:"getLoginStatus",value:function(){var o=this;(0,_indexWeapp.isLogin)().then(function(e){o.setState({isLoginStatus:!0}),REPORT.pv(!0),o.getData()}).catch(function(e){o.setShowFlagOn(),REPORT.pv(!1)})}},{key:"getData",value:function(){var r=this,e=OPTIONS,o=e.orgCode,o={storeId:e.storeId,orgCode:o,businessId:e.businessId,promoteId:e.promoteId};(0,_offLine.presentBagsFn)(o).then(function(e){var o,t,n,i=e.code,e=e.result;0==i&&(i=e,r.setState({data:i}),e=void 0===(e=i.couponInfo)?{}:e,o=i.remainSeconds,t=i.receiveBagsFlag,i=i.receiveCouponFlag,n=e.couponCode,e=e.couponType,o&&r.showCountDown(o),1==t?REPORT.succeedToPickBag():REPORT.failToPickBag(),1==i?REPORT.succeedToSendCoupon({couponCode:n,couponType:e}):REPORT.failToSendCoupon({couponCode:n,couponType:e})),r.setShowFlagOn()}).catch(function(e){r.setShowFlagOn()})}},{key:"showCountDown",value:function(o){var t=this;function n(e){var o=Math.floor(e/60);return(o=1==(o+="").length?"0"+o:o)+"分"+(e=1==(e=e%60+"").length?"0"+e:e)+"秒"}var e=n(o);this.setState({timesStr:e}),this.timer=setInterval(function(){var e;o<=0?(clearInterval(t.timer),(0,_indexWeapp4.showToast)({title:"领取资格已过期"}),e=Object.assign({},t.state.data,{receiveBagsFlag:0}),t.setState({data:e})):(e=n(--o),t.setState({timesStr:e}))},1e3)}},{key:"goLogin",value:function(){REPORT.clickLogin(),(0,_indexWeapp.goToLogin)()}},{key:"goStore",value:function(){var e=OPTIONS,o=e.storeId,o=void 0===o?"":o,e=e.orgCode,e=void 0===e?"":e;REPORT.clickToStore(),(0,_indexWeapp2.jump)({to:"store",params:{storeId:o,skuId:"",orgCode:e,needAnchorSku:!0,addCart:!0,needAddCar:!0,needAddCart:1,isAddCart:!0}})}},{key:"goCoupon",value:function(){REPORT.clickCheckCoupon(),(0,_indexWeapp2.jump)({to:"myCoupon"})}},{key:"hideShareAsync",value:function(){setTimeout(function(){wx.hideShareMenu({menus:["shareAppMessage","shareTimeline"]})},300)}},{key:"componentDidShow",value:function(){this.hideShareAsync(),this.getParams()}},{key:"componentDidHide",value:function(){clearInterval(this.timer)}},{key:"componentDidMount",value:function(){this.hideShareAsync()}},{key:"onShareAppMessage",value:function(e){}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};this.$prefix;var e=this.__state,o=(e.receiveStatus,e.couponFlag,e.isLoginStatus,e.data),e=(e.timesStr,e.showFlag,o.receiveBagsFlag),t=(o.remainSeconds,o.couponInfo),t=void 0===t?{}:t,o=o.receiveCouponFlag,n=(t.couponCode,t.couponTitle);t.couponType;return Object.assign(this.__state,{style:_indexModuleScssMap2.default,couponTitle:n,receiveBagsFlag:e,receiveCouponFlag:o}),this.__state}}]),r}(),_class.$$events=["goLogin","goStore","goCoupon"],_class.multipleSlots=!0,_class.$$componentPath="pages/offLineActive-t/index",_temp2);exports.default=Index,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Index,!0));