"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s,n=arguments[e];for(s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},_createClass=function(){function n(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,s){return e&&n(t.prototype,e),s&&n(t,s),t}}(),_get=function t(e,s,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,s);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(n):void 0:null!==(o=Object.getPrototypeOf(e))?t(o,s,n):void 0},_index=require("../../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp2=require("../../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_hackOrder=require("../../api/hackOrder.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var i=t.apply(this,arguments);return new Promise(function(a,r){return function e(t,s){try{var n=i[t](s),o=n.value}catch(t){return void r(t)}if(!n.done)return Promise.resolve(o).then(function(t){e("next",t)},function(t){e("throw",t)});a(o)}("next")})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var modelId="K10002",Task=(_temp2=_class=function(){function a(){var t,e;_classCallCheck(this,a);for(var s=arguments.length,n=Array(s),o=0;o<s;o++)n[o]=arguments[o];return(t=e=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(n)))).$usedState=["showNew","anonymousState__temp","anonymousState__temp2","refresh","taskList","showExtraReceive","extraSucessNum","taskPriorityId","extraInfo","isHelping","showExtraTask","showQrcode","showLottery","remainDrawsTimes","refreshTask","shareBackType","cutStatus","clickTab","cutOrderId","taskEvent","expireTime","extraEvent","shareBackStatus","qrCodeEvent","remainSharedDrawsTimes"],e.anonymousFunc3Map={},e.anonymousFunc7Map={},e.customComponents=[],_possibleConstructorReturn(e,t)}var e;return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(t){_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,t),this.state={refresh:!1,taskList:[],showExtraReceive:!1,extraSucessNum:0,taskPriorityId:null,extraInfo:{}},this.data={moreKnifeTask:{},cardTask:{},timeTask:{}},this.$$refs=[]}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var t=this.$prefix,e=this.__props.showNew,s=e?this._createNewData(t+"xeGGPMTZeY")():null,t=this._createOldData(t+"ABONmJVIyD")();return Object.assign(this.__state,{showNew:e,anonymousState__temp:s,anonymousState__temp2:t}),this.__state}},{key:"_createNewData",value:function(t){var u=this;return function(){var t=u.state,e=t.taskList,e=void 0===e?[]:e,s=t.showExtraReceive,t=t.extraInfo,t=void 0===t?{}:t,n=u.props,o=n.isHelping,a=n.showExtraTask,r=n.showQrcode,i=n.showLottery,n=n.remainDrawsTimes;return u.anonymousFunc0=function(){return u.clickExtraTaskEntry()},u.anonymousFunc1=function(){return u.clickPrizeDraw()},u.anonymousFunc2=function(){return u.clickQrcode()},{loopArray81:e.map(function(e,t){e={$original:(0,_index.internal_get_original)(e)};t="WBjhc"+t;return u.anonymousFunc3Map[t]=function(t){return u.clickTaskEntry(t,e.$original)},{_$indexKey:t,$original:e.$original}}),showExtraTask:a,extraInfo:t,style:_indexModuleScssMap2.default,showExtraReceive:s,isHelping:o,showLottery:i,remainDrawsTimes:n,showQrcode:r,taskList:e}}}},{key:"_createOldData",value:function(t){var p=this;return function(){var t=p.state,e=t.taskList,e=void 0===e?[]:e,s=t.taskData,s=void 0===s?"":s,n=t.showExtraReceive,t=t.extraInfo,t=void 0===t?{}:t,o=p.props,a=o.isHelping,r=o.showExtraTask,i=o.showQrcode,u=o.showLottery,o=o.remainDrawsTimes;return p.anonymousFunc4=function(){return p.clickExtraTaskEntry()},p.anonymousFunc5=function(){return p.clickPrizeDraw()},p.anonymousFunc6=function(){return p.clickQrcode()},{loopArray82:e.map(function(e,t){e={$original:(0,_index.internal_get_original)(e)};t="RZftc"+t;return p.anonymousFunc7Map[t]=function(t){return p.clickTaskEntry(t,e.$original)},{_$indexKey2:t,$original:e.$original}}),taskData:s,style:_indexModuleScssMap2.default,showExtraTask:r,extraInfo:t,showExtraReceive:n,isHelping:a,showLottery:u,remainDrawsTimes:o,showQrcode:i,taskList:e}}}},{key:"componentDidMount",value:function(){this.handleTask()}},{key:"componentDidUpdate",value:function(){var t=this;this.state.refresh!==this.props.refreshTask&&this.setState({refresh:this.props.refreshTask},function(){t.handleTask("update")})}},{key:"handleTask",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var s,n,o,a,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.props,s=a.shareBackType,n=a.cutStatus,o=a.showExtraTask,a=a.clickTab,t.next=3,this.getTaskList();case 3:if(o)return t.next=6,this.getExtraTask();t.next=6;break;case 6:return t.next=8,this.taskEntryReport();case 8:this.props.isHelping&&(null!=s?this.handleBackTaskPop():2===n&&"update"!=e||a||this.getTaskPriorityInfo().then(function(t){r.handleTaskPop(t)}).catch(function(t){}));case 11:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"getTaskList",value:function(n){var o=this,t=this.props.cutOrderId,a=n?{cpOrderInfoId:t,type:n}:{cpOrderInfoId:t};return new Promise(function(e,s){(0,_hackOrder.getTask)(a).then(function(t){n?e(t.result||[]):o.setState({taskList:t.result||[]},function(){e(t.result||[])})}).catch(function(t){s(t)})})}},{key:"clickTaskEntry",value:function(t,e){var s=this,n=this.props.isHelping,o=e;n?(this.clickReportFn("clicktask",{taskid:e.taskType}),this.getTaskList(e.taskType).then(function(t){var t={targetInviteNum:(o=0==t.code&&t.result&&t.result.length&&1==t.result[0].taskType?t.result[0]:o).targetInviteNum,invitedNum:o.invitedNum,helpCutAmountStr:o.helpCutAmountStr||0,hour:o.hour||0,helpCardUsed:o.helpCardUsed||!1,times:o.times||0,hourCountdownMillis:o.hourCountdownMillis||0},e={};if(0==o.taskType){if(0==o.status)return s.props.taskEvent(_extends({},e={taskType:0,show:!0,showType:1},t)),void s.clickReportFn("showtask1ing");if(1==o.status)return s.props.taskEvent(_extends({},e={taskType:0,show:!0,showType:2},t)),void s.clickReportFn("showtask1done");if(2==o.status)return s.props.taskEvent(_extends({},e={taskType:0,show:!0,showType:4},t)),void s.clickReportFn("shownotask")}if(1==o.taskType){if(1==o.status)return void s.props.taskEvent(_extends({},e={taskType:1,show:!0,showType:1},t));if(0==o.status)return e={taskType:1,show:!0,showType:3},s.clickReportFn("showtask2ing"),void s.props.taskEvent(_extends({},e,t))}2==o.taskType&&(0==o.status?(s.props.taskEvent(_extends({},e={taskType:2,show:!0,showType:1},t)),s.clickReportFn("showtask3ing")):1==o.status?(s.props.taskEvent(_extends({},e={taskType:2,show:!0,showType:2},t)),s.clickReportFn("showtask3done")):2==o.status&&(s.props.taskEvent(_extends({},e={taskType:2,show:!0,showType:4},t)),s.clickReportFn("shownotask")))}).catch(function(t){})):(0,_indexWeapp2.showToast)({title:"该任务不可参与",icon:"none",duration:2e3})}},{key:"getExtraTask",value:function(){var r=this,t=this.props.expireTime;return new Promise(function(a,e){(0,_hackOrder.getTaskListInfo)({modelId:modelId,plateCode:(0,_hackOrder.getPlateCode)(),finishTimestamp:t}).then(function(t){var e,s,n=t.result,o=void 0===n?{}:n;0==t.code&&o&&(n=o.taskInfoList||[],e=!1,n[s=0]&&n[0].subList&&n[0].subList.forEach(function(t){2==t.taskStatus&&(e=!0),3==t.taskStatus&&(s+=1)}),r.setState({showExtraReceive:e,extraSucessNum:s,extraInfo:n[0]},function(){a(o)}),r.props.extraEvent(n[0]))}).catch(function(t){e(t)})})}},{key:"clickExtraTaskEntry",value:function(){var n=this,t=this.props.isHelping;this.clickReportFn("clicktask",{taskid:3}),t?this.getExtraTask().then(function(t){var e=n.state.extraInfo||{},s=[];n.props.taskEvent({taskType:3,show:!0,extraInfo:e}),e.subList&&e.subList.forEach(function(t,e){s.push({taskNode:e+1,nodeStatus:t.taskStatus})}),n.clickReportFn("showExtraTask",{task:s})}):(0,_indexWeapp2.showToast)({title:"该任务不可参与",icon:"none",duration:2e3})}},{key:"getTaskPriorityInfo",value:function(){var t=this;return new Promise(function(e,s){(0,_hackOrder.getTaskPriority)({cpOrderInfoId:t.props.cutOrderId,plateCode:(0,_hackOrder.getPlateCode)()}).then(function(t){e(t.result.taskPriorityId)}).catch(function(t){s(t)})})}},{key:"handleTaskPop",value:function(t){var e=this.props.isHelping;if(t&&e){var e=this.data,s=e.moreKnifeTask,n=void 0===s?{}:s,s=e.timeTask,o=void 0===s?{}:s,s=e.cardTask,a=void 0===s?{}:s,r={taskType:null,show:!0,showType:null};switch(t){case 1:if(n.show){if(0==n.status)return u={targetInviteNum:n.targetInviteNum,invitedNum:n.invitedNum},this.props.taskEvent(_extends({},r={taskType:0,show:!0,showType:1},u)),void this.clickReportFn("showtask1ing");if(1==n.status)return r={taskType:0,show:!0,showType:2,targetInviteNum:n.targetInviteNum,invitedNum:n.invitedNum,helpCutAmountStr:n.helpCutAmountStr},this.props.taskEvent(r),void this.clickReportFn("showtask1done")}break;case 2:if(o.show){if(0==o.status)return u={helpCutAmountStr:o.helpCutAmountStr||0,hour:o.hour||0,hourCountdownMillis:o.hourCountdownMillis||0},r={taskType:1,show:!0,showType:3},this.clickReportFn("showtask2ing"),void this.props.taskEvent(_extends({},r,u));if(1==o.status)return r={taskType:1,show:!0,showType:1,hour:o.hour,helpCutAmountStr:o.helpCutAmountStr},this.props.taskEvent(r),void this.clickReportFn("showtask2done")}break;case 3:if(a.show){if(0==a.status)return this.props.taskEvent(r={taskType:2,show:!0,showType:1}),void this.clickReportFn("showtask3ing");if(1==a.status)return r={taskType:2,show:!0,showType:2,helpCutAmountStr:a.helpCutAmountStr,times:a.times},this.props.taskEvent(r),void this.clickReportFn("showtask3done")}break;case 4:var i,u=this.props.showExtraTask,p=this.state.extraInfo,p=void 0===p?{}:p;u&&p.modelId&&(this.props.taskEvent({taskType:3,show:!0,extraInfo:p||{}}),i=[],p.subList&&p.subList.forEach(function(t,e){i.push({taskNode:e+1,nodeStatus:t.taskStatus})}),this.clickReportFn("showExtraTask",{task:i}));break;case 5:this.props.taskEvent({taskType:4,show:!0});break;case 6:this.props.taskEvent({taskType:5,show:!0}),this.clickReportFn("shownotask")}}}},{key:"taskEntryReport",value:function(){var e=this,t=this.state.taskList||[],s=this.state.extraInfo||{},n=this.props,o=n.showQrcode,n=n.showLottery,a="";t.forEach(function(t){switch(t.taskType){case 0:(e.data.moreKnifeTask=t).show&&(a+="0");break;case 1:(e.data.timeTask=t).show&&(a+="1");break;case 2:(e.data.cardTask=t).show&&(a+="2")}}),s.taskId&&(a+="3"),o&&(a+="4"),n&&(a+="5"),this.setState({taskData:a}),this.clickReportFn("showTask",{taskId:a})}},{key:"handleBackTaskPop",value:function(){var t=this.data,e=t.moreKnifeTask,e=void 0===e?{}:e,s=t.timeTask,s=void 0===s?{}:s,t=t.cardTask,t=void 0===t?{}:t,n=this.props,o=n.isHelping,a=n.shareBackType,n=n.shareBackStatus;if(o){o={taskType:null,show:!0,showType:null};if(e.show&&0==a){if(2==e.status&&0==n)return o={taskType:0,show:!0,showType:3,targetInviteNum:e.targetInviteNum,invitedNum:e.invitedNum,helpCutAmountStr:e.helpCutAmountStr},this.props.taskEvent(o),void this.clickReportFn("showtask1use");if(0==e.status)return o={taskType:0,show:!0,showType:1,targetInviteNum:e.targetInviteNum,invitedNum:e.invitedNum,helpCutAmountStr:e.helpCutAmountStr},this.props.taskEvent(o),void this.clickReportFn("showtask1ing");if(1==e.status)return o={taskType:0,show:!0,showType:2,targetInviteNum:e.targetInviteNum,invitedNum:e.invitedNum,helpCutAmountStr:e.helpCutAmountStr},this.props.taskEvent(o),void this.clickReportFn("showtask1done");if(2==e.status)return o={taskType:0,show:!0,showType:4,targetInviteNum:e.targetInviteNum,invitedNum:e.invitedNum,helpCutAmountStr:e.helpCutAmountStr},this.props.taskEvent(o),void this.clickReportFn("shownotask")}if(1==a){if(1==n)return o={taskType:1,show:!0,showType:2,hour:s.hour,helpCutAmountStr:s.helpCutAmountStr,hourCountdownMillis:s.hourCountdownMillis||0},this.props.taskEvent(o),void this.clickReportFn("showtask2use");if(1==s.status)return o={taskType:1,show:!0,showType:1,hour:s.hour,helpCutAmountStr:s.helpCutAmountStr,hourCountdownMillis:s.hourCountdownMillis||0},this.props.taskEvent(o),void this.clickReportFn("showtask2use");if(0==s.status)return o={taskType:1,show:!0,showType:3,hour:s.hour,helpCutAmountStr:s.helpCutAmountStr,hourCountdownMillis:s.hourCountdownMillis||0},this.props.taskEvent(o),void this.clickReportFn("showtask2ing")}if(t.show&&2==a){if(2==n){if(1==t.status)return o={taskType:2,show:!0,showType:2,helpCutAmountStr:t.helpCutAmountStr,times:t.times},this.props.taskEvent(o),void this.clickReportFn("showtask3done");if(2==t.status)return o={taskType:2,show:!0,showType:3,helpCutAmountStr:t.helpCutAmountStr,times:t.times},this.props.taskEvent(o),void this.clickReportFn("showtask3use")}if(0==taskEle.status)return o={taskType:2,show:!0,showType:1,helpCutAmountStr:t.helpCutAmountStr,times:t.times},this.props.taskEvent(o),void this.clickReportFn("showtask3ing")}3==a&&this.clickExtraTaskEntry(),4==a&&(this.props.taskEvent(o={taskType:4,show:!0}),this.clickReportFn("shownotask"))}}},{key:"clickQrcode",value:function(){var t=this.props.isHelping;this.clickReportFn("clicktask",{taskid:4}),t?this.props.qrCodeEvent():(0,_indexWeapp2.showToast)({title:"该任务不可参与",icon:"none",duration:2e3})}},{key:"clickPrizeDraw",value:function(){this.clickReportFn("clicktask",{taskid:5});var t=this.props,e=t.remainDrawsTimes,s=t.remainSharedDrawsTimes;t.isHelping?e||s?this.props.onShowPrizeDraw():this.props.taskEvent({taskType:5,show:!0}):(0,_indexWeapp2.showToast)({title:"该任务不可参与",icon:"none",duration:2e3})}},{key:"clickReportFn",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};(0,_indexWeapp.clickReport)({create_time:new Date,click_id:t,click_par:e})}},{key:"anonymousFunc0",value:function(t){}},{key:"anonymousFunc1",value:function(t){}},{key:"anonymousFunc2",value:function(t){}},{key:"anonymousFunc3",value:function(t,e){return this.anonymousFunc3Map[t]&&this.anonymousFunc3Map[t](e)}},{key:"anonymousFunc4",value:function(t){}},{key:"anonymousFunc5",value:function(t){}},{key:"anonymousFunc6",value:function(t){}},{key:"anonymousFunc7",value:function(t,e){return this.anonymousFunc7Map[t]&&this.anonymousFunc7Map[t](e)}}]),a}(),_class.$$events=["anonymousFunc0","anonymousFunc1","anonymousFunc2","anonymousFunc3","anonymousFunc4","anonymousFunc5","anonymousFunc6","anonymousFunc7"],_class.options={addGlobalClass:!0},_class.multipleSlots=!0,_class.$$componentPath="pages/hackOrder-t/components/task/index",_temp2);exports.default=Task,Component(require("../../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Task));