"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);return void 0!==a?"value"in a?a.value:void 0!==(a=a.get)?a.call(o):void 0:null!==(a=Object.getPrototypeOf(t))?e(a,n,o):void 0},_index=require("../../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_animate=require("../../api/animate.js"),_animate2=_interopRequireDefault(_animate),_hackOrder=require("../../api/hackOrder.js"),_indexWeapp2=require("../../../../npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp3=require("../../../../npm/@jd/djmp/common-t/constants/index.weapp.js"),_indexWeapp4=require("../../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var helpCutAmountStr="",modelId="K10002",TaskPop=(_temp2=_class=function(){function s(){var e,t;_classCallCheck(this,s);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=t=_possibleConstructorReturn(this,(e=s.__proto__||Object.getPrototypeOf(s)).call.apply(e,[this].concat(o)))).$usedState=["style","taskPopData","anonymousState__temp","anonymousState__temp2","anonymousState__temp3","anonymousState__temp4","anonymousState__temp5","showCloseIcon","isShowRuleDia","extraInfo","showAdd","percentNew","cutAmountNew","minute","second","millisecond","timer","refreshTaskPopFlag","endTimeStr","extraPercent","extraBtnAnimate","subList","targetAmount","cutAmount","refreshTaskPop","percent","endTime","cutOrderId"],t.showRuleDia=function(){t.setState({isShowRuleDia:!0})},t.anonymousFunc14Map={},t.anonymousFunc15Map={},t.customComponents=[],_possibleConstructorReturn(t,e)}return _inherits(s,_index.Component),_createClass(s,[{key:"_constructor",value:function(e){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,e),this.state={showAdd:!0,percentNew:"0%",cutAmountNew:0,minute:"00",second:"00",millisecond:"00",timer:null,refreshTaskPopFlag:!1,endTimeStr:"00:00:00.0",extraPercent:"0%",extraBtnAnimate:!0,isShowRuleDia:!1,subList:[{}]},this.$$refs=[]}},{key:"_createData",value:function(){var t=this,e=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix),n=(this.__state.isShowRuleDia,this.__props.taskPopData),n=void 0===n?{}:n,o=(n||{}).extraInfo,o=void 0===o?{}:o,a=this.getCloseStatus(),s=0==n.taskType?this._createTaskRedPacketData(e+"BhDZIEwifX")():null,i=1==n.taskType?this._createTimeData(e+"RIeoZeHYUH")():null,u=2==n.taskType?this._createNCardData(e+"xoyXrOKeWr")():null,r=3==n.taskType?this._createExtraData(e+"gUzufdHpbH")():null,e=this._createProgressData(e+"DVOlMfCtTU")("clickProgress");return this.anonymousFunc0=function(e){return t.onClosePop(e)},this.anonymousFunc1=function(e){return t.onClickPop(e)},this.anonymousFunc2=function(e){return t.onClosePop(e)},this.anonymousFunc3=function(e){return t.onCloseRuleDia(e)},Object.assign(this.__state,{style:_indexModuleScssMap2.default,taskPopData:n,anonymousState__temp:s,anonymousState__temp2:i,anonymousState__temp3:u,anonymousState__temp4:r,anonymousState__temp5:e,showCloseIcon:a,extraInfo:o}),this.__state}},{key:"_createTaskRedPacketData",value:function(o){var a=this;return function(){var e=a.props.taskPopData,e=void 0===e?{}:e,t=3==e.showType?a._createMoneyData(o+"igNuTsZoXK")("redPacket"):null,n=4==e.showType?a._createProgressData(o+"cQffpgGVbA")("clicktask1Process"):null;return a.anonymousFunc4=function(e){return a.onClickShare(e,"friend","clicktask1ing")},a.anonymousFunc5=function(e){return a.getPacket(e,0)},{taskPopData:e,style:_indexModuleScssMap2.default,anonymousState__temp6:t,anonymousState__temp7:n}}}},{key:"_createNCardData",value:function(o){var a=this;return function(){var e=a.props.taskPopData,e=void 0===e?{}:e,t=3==e.showType?a._createMoneyData(o+"bkrmkmIUMX")():null,n=4==e.showType?a._createProgressData(o+"fDBQxbELbV")("clicktask3Process"):null;return a.anonymousFunc6=function(e){return a.onClickShare(e,"friend","clicktask3ing")},a.anonymousFunc7=function(e){return a.onClickShare(e,"friend","clicktask3done")},{taskPopData:e,anonymousState__temp8:t,anonymousState__temp9:n,style:_indexModuleScssMap2.default}}}},{key:"_createTimeData",value:function(i){var u=this;return function(){var e=u.props.taskPopData,e=void 0===e?{}:e,t=u.state,n=t.minute,o=t.second,t=t.millisecond,a=u._createMoneyData(i+"ZXKvqKLfxt")("renderTime"),s=2!=e.showType?(0,_index.internal_inline_style)({backgroundSize:"100% 100%"}):null;return u.anonymousFunc8=function(e){return u.onClickShare(e,"friend","clicktask2done")},u.anonymousFunc9=function(e){return u.onClickShare(e,"friend","clicktask2ing")},{anonymousState__temp11:s,taskPopData:e,style:_indexModuleScssMap2.default,anonymousState__temp10:a,minute:n,second:o,millisecond:t}}}},{key:"_createMoneyData",value:function(e){var o=this;return function(t){var e=o.state.cutAmountNew,n=(0,_index.internal_inline_style)({backgroundSize:"100% 100%"});return o.anonymousFunc10=function(e){return o.onClickShare(e,"friend","renderTime"==t?"clicktask2use":"redPacket"==t?"clicktask1use":"clicktask3use")},{anonymousState__temp12:n,style:_indexModuleScssMap2.default,type:t,helpCutAmountStr:helpCutAmountStr,cutAmountNew:e}}}},{key:"_createProgressData",value:function(e){var s=this;return function(t){var e=s.props,n=e.targetAmount,e=e.cutAmount,o=s.state.percentNew,a=(0,_index.internal_inline_style)({backgroundSize:"100% 100%"}),o=(0,_index.internal_inline_style)({width:o});return s.anonymousFunc11=function(e){return s.onClickShare(e,"friend","clicknotask",t)},{anonymousState__temp13:a,anonymousState__temp14:o,style:_indexModuleScssMap2.default,cutAmount:e,targetAmount:n}}}},{key:"_createExtraData",value:function(e){var l=this;return function(){var e=l.state,t=e.endTimeStr,n=e.subList,o=void 0===n?[{}]:n,n=e.totalNum,a=e.processGoing,e=e.finishNum,s=(0,_index.internal_inline_style)({backgroundSize:"100% 100%"}),i=(l.anonymousFunc12=function(){return l.showRuleDia()},1==o[0].taskStatus||2==o[0].taskStatus?Number(o[0].maxPrize)/1e3:null),u=3==o[0].taskStatus?Number(o[0].prizeValue)/1e3:null,r=(l.anonymousFunc13=function(e){return l.getExtraReward(e,o[0])},0!=e&&0<e?(0,_index.internal_inline_style)({width:a}):null),c=0!=e&&0<e?(0,_index.internal_inline_style)({width:a}):null,a=0!=e&&0<e?(0,_index.internal_inline_style)({width:a}):null;return l.anonymousFunc16=function(e){return l.onClickShare(e,"friend","clickExtraTask")},{anonymousState__temp15:s,anonymousState__temp16:i,anonymousState__temp17:u,anonymousState__temp18:r,anonymousState__temp23:c,anonymousState__temp28:a,loopArray83:o&&2==o.length?o.map(function(t,e){t={$original:(0,_index.internal_get_original)(t)};var n="uCdOC"+e;return l.anonymousFunc14Map[n]=function(e){return l.getExtraReward(e,t.$original)},{_$indexKey:n,$loopState__temp20:1==t.$original.taskStatus||2==t.$original.taskStatus?Number(o[e].maxPrize)/1e3:null,$loopState__temp22:3==t.$original.taskStatus?Number(o[e].prizeValue)/1e3:null,$original:t.$original}}):[],loopArray84:o&&3==o.length?o.map(function(t,e){t={$original:(0,_index.internal_get_original)(t)};var n="HmEBK"+e;return l.anonymousFunc15Map[n]=function(e){return l.getExtraReward(e,t.$original)},{_$indexKey2:n,$loopState__temp25:1==t.$original.taskStatus||2==t.$original.taskStatus?Number(o[e].maxPrize)/1e3:null,$loopState__temp27:3==t.$original.taskStatus?Number(o[e].prizeValue)/1e3:null,$original:t.$original}}):[],style:_indexModuleScssMap2.default,subList:o,finishNum:e,endTimeStr:t,totalNum:n}}}},{key:"componentDidMount",value:function(){this.setState({refreshTaskPopFlag:this.props.refreshTaskPop}),this.initData()}},{key:"componentDidUpdate",value:function(){this.props.refreshTaskPop!==this.state.refreshTaskPopFlag&&(this.initData(),this.setState({refreshTaskPopFlag:this.props.refreshTaskPop}))}},{key:"onCloseRuleDia",value:function(){this.setState({isShowRuleDia:!1})}},{key:"initData",value:function(){var e=this,t=this.props,n=t.percent,o=t.cutAmount,a=t.taskPopData,t=(t.endTime,"0%"),t="100%"==n?"98%":n,n=(this.setState({percentNew:t}),(helpCutAmountStr=2==a.taskType?a.helpCutAmountStr||"":helpCutAmountStr).split("元")[0]),t=Number(o)-Number(n),s=new _animate2.default({target:Number(o)||0,speed:1e3,from:t,refreshTime:100,decimals:2,onUpdate:function(){e.setState({cutAmountNew:s.tempValue})},onComplete:function(){}});a.hourCountdownMillis&&this.showCountDown(a.hourCountdownMillis),this.extraPercent()}},{key:"extraPercent",value:function(){var e,t=(this.props.taskPopData||{}).extraInfo,t=void 0===t?{}:t,n=t.subList,o=void 0===n?[]:n,n=t.finishNum,a=t.totalNum,s=t.status,i=t.awardValue,u=t.maxPrize;o&&0==o.length&&((e={}).node=a,e.taskStatus=s,e.prizeValue=i||"",e.maxPrize=u,o.push(e)),o&&0<o.length&&o.map(function(e,t){var n=e.maxPrize%10,n=(e.maxPrize=e.maxPrize-n,e.prizeValue%10);e.prizeValue=e.prizeValue-n});for(var r=0;r<o.length;r++)if(o[r].taskStatus<2){a=o[r].node;break}s=void 0,i=void(s=(100*(s=1<(s=o&&0<o.length?n/o[o.length-1].node:s)?1:s)).toFixed()+"%");o&&1==o.length?i=s:o&&2==o.length?i=0==n?"0%":n<o[0].node?"25%":n==o[0].node?"48%":n>o[0].node&&n<o[1].node?"75%":"100%":o&&3==o.length&&(i=0==n?"0%":n<o[0].node?"17%":n==o[0].node?"32%":n>o[0].node&&n<o[1].node?"51%":n==o[1].node?"68%":n>o[1].node&&n<o[2].node?"85%":"100%"),this.setState({processGoing:i,subList:o,totalNum:a,finishNum:n}),t.secondsLeft&&this.showEndTimeCountDown(1e3*Number(t.secondsLeft))}},{key:"onClosePop",value:function(e){this.props.onPopEvent(e,"hideTaskPop")}},{key:"onClickPop",value:function(){}},{key:"onPopEvent",value:function(e){this.props.onPopEvent(e,"taskPop")}},{key:"onClickShare",value:function(e,t,n,o){var a,s=null,i=null,u=[];"clicktask1ing"!=n&&"clicktask1use"!=n&&"clicktask1Process"!=n||(s=0),"clicktask2done"!=n&&"clicktask2use"!=n&&"clicktask2ing"!=n||(s=1,"clicktask2done"==n&&(i=1),clearInterval(this.state.timer),this.useTaskReward(1)),"clicktask3ing"!=n&&"clicktask3done"!=n&&"clicktask3use"!=n&&"clicktask3Process"!=n||(s=2,"clicktask3ing"!=n&&"clicktask3done"!=n||(this.useTaskReward(2),i=2)),"clickExtraTask"==n&&(s=3,(a=void 0===(a=(this.props.taskPopData||{}).extraInfo)?{}:a).subList&&a.subList.forEach(function(e,t){u.push({taskNode:t+1,nodeStatus:e.taskStatus})})),"clickProgress"==o&&(s=4),(0,_indexWeapp.clickReport)({create_time:new Date,click_id:n,click_par:{task:u}}),this.props.onClickShare(e,t,{shareBackType:s,shareBackStatus:i})}},{key:"getCloseStatus",value:function(){var e=this.props,t=e.taskPopData,t=void 0===t?{}:t,e=(e.cutAmount,!0);return 0!=t.taskType||1!=t.showType&&2!=t.showType||(e=!1),e=2!=t.taskType||1!=t.showType&&2!=t.showType?e:!1}},{key:"getPacket",value:function(t,e){var n=this;(0,_indexWeapp.clickReport)({create_time:new Date,click_id:"clicktask1done"}),this.useTaskReward(e).then(function(e){n.props.onPopEvent(t,"getPacket")}).catch(function(e){})}},{key:"useTaskReward",value:function(e){var t=this.props.cutOrderId,o=void 0===t?"":t,a=(0,_indexWeapp2.getStorageSync)(_indexWeapp3.LOGIN_INFO)||{};return new Promise(function(t,n){(0,_hackOrder.useReward)({cpOrderInfoId:o,taskType:e,nickname:a.nickname||"",nickHeadUrl:a.avatar||""}).then(function(e){helpCutAmountStr=e.result&&e.result.helpCutAmountStr||"",t(e)}).catch(function(e){n(e)})})}},{key:"showCountDown",value:function(e){var t=this;clearInterval(this.state.timer),this.millisecondCountDown(e,function(e){e.end?(t.setState({minute:"00",second:"00",timer:null}),clearInterval(t.state.timer),t.props.onPopEvent("","refreshTask")):t.setState({minute:e.minute,second:e.second,timer:e.timer,millisecond:e.millisecond})})}},{key:"showEndTimeCountDown",value:function(e){var t=this;clearInterval(this.state.endTimeTimer),this.millisecondCountDown(e,function(e){e.end?(t.setState({endTimeStr:"00:00:00.0",endTimeTimer:null}),clearInterval(t.state.endTimeTimer),t.props.onPopEvent("","refreshTask")):t.setState({endTimeTimer:e.timer,endTimeStr:e.hour+":"+e.minute+":"+e.second+"."+e.millisecond})})}},{key:"millisecondCountDown",value:function(a,s){var i=setInterval(function(){var e=0,t=0,n=0,o=0;0<a&&(e=Math.floor(a/1e3/60/60),t=Math.floor(a/1e3/60%60),n=Math.floor(a/1e3%60),o=Math.floor(a%1e3/100)),e<=9&&(e="0"+e),t<=9&&(t="0"+t),n<=9&&(n="0"+n),s(0<a?{hour:e,minute:t,second:n,millisecond:o,timer:i,end:!1}:{hour:"00",minute:"00",second:"00",millisecond:"00",timer:i,end:!0}),a-=100},100)}},{key:"getExtraReward",value:function(e,t){var n=this,o=(this.props.taskPopData||{}).extraInfo;(0,_hackOrder.sendTaskPrizeInfo)({modelId:modelId,taskId:(void 0===o?{}:o).taskId,subNode:t.node,plateCode:(0,_hackOrder.getPlateCode)()}).then(function(e){0==e.code?n.props.onPopEvent("","getExtraReward"):(0,_indexWeapp4.showToast)({title:e.msg||"奖励领取失败",icon:"none",duration:2e3})}).catch(function(e){(0,_indexWeapp4.showToast)({title:e.msg||"奖励领取失败",icon:"none",duration:2e3})})}},{key:"anonymousFunc0",value:function(e){}},{key:"anonymousFunc1",value:function(e){}},{key:"anonymousFunc2",value:function(e){}},{key:"anonymousFunc3",value:function(e){}},{key:"anonymousFunc4",value:function(e){}},{key:"anonymousFunc5",value:function(e){}},{key:"anonymousFunc6",value:function(e){}},{key:"anonymousFunc7",value:function(e){}},{key:"anonymousFunc8",value:function(e){}},{key:"anonymousFunc9",value:function(e){}},{key:"anonymousFunc10",value:function(e){}},{key:"anonymousFunc11",value:function(e){}},{key:"anonymousFunc12",value:function(e){}},{key:"anonymousFunc13",value:function(e){}},{key:"anonymousFunc14",value:function(e,t){return this.anonymousFunc14Map[e]&&this.anonymousFunc14Map[e](t)}},{key:"anonymousFunc15",value:function(e,t){return this.anonymousFunc15Map[e]&&this.anonymousFunc15Map[e](t)}},{key:"anonymousFunc16",value:function(e){}}]),s}(),_class.$$events=["anonymousFunc0","anonymousFunc1","anonymousFunc2","anonymousFunc3","anonymousFunc4","anonymousFunc5","anonymousFunc6","anonymousFunc7","anonymousFunc8","anonymousFunc9","anonymousFunc10","anonymousFunc11","anonymousFunc12","anonymousFunc13","anonymousFunc14","anonymousFunc15","anonymousFunc16"],_class.options={addGlobalClass:!0},_class.multipleSlots=!0,_class.$$componentPath="pages/hackOrder-t/components/taskPop/index",_temp2);exports.default=TaskPop,Component(require("../../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(TaskPop));