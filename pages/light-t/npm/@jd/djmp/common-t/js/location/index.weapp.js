"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getLocation=void 0;var _indexWeapp=require("../../constants/index.weapp.js"),_indexWeapp2=require("../bi/index.weapp.js"),_indexWeapp3=require("../storage/index.weapp.js"),_indexWeapp4=require("../http/index.weapp.js"),transferLocation=function(e){return new Promise(function(n,o){(0,_indexWeapp4.request)({functionId:"local/getAddressN",body:{longitude:e.longitude||"",latitude:e.latitude||"",coord_type:"1",needMatch:0}}).then(function(e){if("0"==e.code&&e.result){var t=e.result.title,i=e.result,t=t||i.address,i={longitude:i.longitude,latitude:i.latitude,cityId:i.areaCode,cityName:i.city,countyName:i.district,poi:t,adcode:i.adcode};try{(0,_indexWeapp3.setStorageSync)("realTimeLocation",i)}catch(e){}(0,_indexWeapp3.setStorageSync)(_indexWeapp.ADDRESS_INFO,i),n(i)}else o(e)}).catch(function(e){o(e)})})},getLocation=exports.getLocation=function(n){return new Promise(function(t,i){if(n&&n.latitude&&n.longitude)return transferLocation({latitude:n.latitude,longitude:n.longitude});var e=(0,_indexWeapp3.getStorageSync)("address_info");e.latitude&&e.longitude&&e.cityId?t(e):((0,_indexWeapp2.clickReport)({create_time:new Date,click_id:"showlocation",click_par:{}}),wx.getLocation({type:"wgs84",success:function(e){transferLocation({latitude:e.latitude,longitude:e.longitude}).then(function(e){t(e)}).catch(function(){i()})},fail:function(e){i(e)}}))})};