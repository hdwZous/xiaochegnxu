"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function n(o,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}return function(o,e,t){return e&&n(o.prototype,e),t&&n(o,t),o}}(),_get=function o(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0!==i){if("value"in i)return i.value;i=i.get;return void 0!==i?i.call(n):void 0}i=Object.getPrototypeOf(e);if(null!==i)return o(i,t,n)},_indexWeapp=require("../../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp2=require("../../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_index=require("../../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_vpayMember=require("../../api/vpayMember.js"),_couponModuleScssMap=require("./coupon.module.scss.map.js"),_couponModuleScssMap2=_interopRequireDefault(_couponModuleScssMap);function _interopRequireDefault(o){return o&&o.__esModule?o:{default:o}}function _classCallCheck(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?o:e}function _inherits(o,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):o.__proto__=e)}_temp2=_class=function(){function r(){var o,n;_classCallCheck(this,r);for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(o=n=_possibleConstructorReturn(this,(o=r.__proto__||Object.getPrototypeOf(r)).call.apply(o,[this].concat(t)))).$usedState=["anonymousState__temp","anonymousState__temp2","$compid__298","$compid__299","$compid__300","$compid__301","$compid__302","$compid__303","$compid__304","couponModuleInfo","style","couponLeftIcon","couponRightIcon","couponCircleIcon","couponLimit","couponTags","couponButton","state","isPop","isUpdate","shareInfoMsg","showShare2WxDialog","showShare2MomentsDialog","savePicDialogReportData","shareMsg","momentsShareImgSrc","getShareInfo","leftIconPress","onPress"],n.config={navigationBarTitleText:"V+会员",navigationStyle:"custom",usingComponents:{share_wx_dialog:"../../../../components/share2WxDialog/index","share-to-moments-dialog":"../../../../components/singlePicWithSave/index"}},n.onButtonPress=function(){var o=n.state.isPop,e=n.state.couponModuleInfo,e={activityCode:e.activityCode,helpCouponGo:e.helpCouponGo};o&&(n.setState({isPop:!1,isUpdate:!1}),n.HelpCoupon(e)),(0,_indexWeapp.clickReport)({create_time:new Date,click_id:"clickCouponAllocateCoupon",click_par:{isPaid:1}})},n.HelpCoupon=function(o){var e,o=o||{},t=o.helpCouponGo,t=void 0===t?{}:t,o=o.activityCode;t.to&&"couponShare"==t.to?(0,_vpayMember.api_helpCoupon)({activityCode:void 0===o?"":o}).then(function(o){var e;"0"==o.code&&(e=(o=o.result||{}).chart,o=o.couponModuleInfo,n.setState({couponModuleInfo:o,isPop:!0}),_index2.default.eventCenter.trigger("updateCouponStatus",{isUpdate:!0}),e={title:e.miniProgram.title,desc:e.miniProgram.desc,shareUrl:e.miniProgram.miniProgram,imgUrl:e.miniProgram.imageUrl,appId:e.miniProgram.appId,mpImgUrl:e.miniProgram.shareUrl,path:e.miniProgram.miniProgram,pyqImg:e.miniProgram.imageUrl||"",callback:"",clickcallback:"",timeline_title:"",channel:"Wxfriends,QRCode",qrparam:{top_pic:"",mid_pic:"",slogan:"",qr_title:"",qr_content:"",qr_direct:e.miniProgram.imageUrl}},n.setState({shareMsg:e}),(o||{}).helpCouponGo,n.props.getShareInfo(e),n.setState({showShare2WxDialog:!0}))}).catch(function(o){_index2.default.showToast({title:o.msg,icon:"none",duration:1500}),"-2"==o.code&&(_index2.default.eventCenter.trigger("updateCouponStatus",{isUpdate:!0}),o=(o&&o.result||{}).couponModuleInfo,n.setState({couponModuleInfo:o,isPop:!0}))}):t.to&&t.params&&(_index2.default.eventCenter.trigger("updateCouponStatus",{isUpdate:!1}),n.setState({isPop:!0,isUpdate:!1}),t=(o=t||{}).to,e="",(o=o.params).url&&(e=o.url.split("#")[1],t?(0,_indexWeapp2.navigateTo)(e):_index2.default.showToast({icon:"none",title:"附近没有门店耶~换个地方再试试",duration:2e3})))},n.setShareInfo=function(){},n.customComponents=["DJTag","Amount","LimitRule","CouponTitle","Tags","CouponExpire","CouponBtn"],_possibleConstructorReturn(n,o)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(o){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,o);o=((this.props||{}).item||{}).couponModuleInfo;this.state={couponModuleInfo:o,isPop:!0,isUpdate:!1,shareInfoMsg:{},showShare2WxDialog:!1,showShare2MomentsDialog:!1,savePicDialogReportData:{},shareMsg:{}},this.$$refs=[]}},{key:"componentDidMount",value:function(){}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var o=this.$prefix,c=(0,_index.genCompid)(o+"$compid__298"),u=(0,_index.genCompid)(o+"$compid__299"),l=(0,_index.genCompid)(o+"$compid__300"),_=(0,_index.genCompid)(o+"$compid__301"),d=(0,_index.genCompid)(o+"$compid__302"),m=(0,_index.genCompid)(o+"$compid__303"),o=(0,_index.genCompid)(o+"$compid__304"),e=this.__state,t=e.couponModuleInfo,e=e.shareInfo,n=(t&&t.price,t||{}),g=n.price,h=n.priceUnit,f=n.priceColor,i=n.couponLimit,C=n.couponLimitColor,r=n.couponLeftIcon,r=void 0===r?{}:r,p=n.couponRightIcon,p=void 0===p?"":p,a=n.couponButton,a=void 0===a?{}:a,y=n.couponTitle,v=n.couponTitleColor,s=n.couponTags,x=n.couponExpire,M=n.couponExpireColor,P=n.couponCircleIcon,n=n.helpActivityStatus,S=a.state,I=(this.anonymousFunc0=1==r.type?this.__props.leftIconPress:null,r&&r.title&&t&&t.price?{startColorCode:r.startColor,endColorCode:r.endColor,iconText:r.title}:null),b=t&&t.price?(0,_index.internal_inline_style)({borderColor:"rgba(255, 87, 87, .2)"}):null;return this.anonymousFunc1=1==S?this.onButtonPress.bind(this):null,t&&t.price&&r&&r.title&&_index.propsManager.set({tags:I},c),t&&t.price&&_index.propsManager.set({price:g,priceUnit:h,priceColor:f},u),t&&t.price&&i&&_index.propsManager.set({couponLimit:i,couponLimitColor:C},l),t&&t.price&&_index.propsManager.set({couponTitle:y,couponTitleColor:v},_),t&&t.price&&s&&s.length&&_index.propsManager.set({tags:s},d),t&&t.price&&_index.propsManager.set({couponExpire:x,couponExpireColor:M},m),t&&t.price&&a&&a.title&&_index.propsManager.set({helpActivityStatus:n,couponButton:a,onClick:this.anonymousFunc1,shareInfo:e},o),Object.assign(this.__state,{anonymousState__temp:I,anonymousState__temp2:b,$compid__298:c,$compid__299:u,$compid__300:l,$compid__301:_,$compid__302:d,$compid__303:m,$compid__304:o,style:_couponModuleScssMap2.default,couponLeftIcon:r,couponRightIcon:p,couponCircleIcon:P,couponLimit:i,couponTags:s,couponButton:a,state:S}),this.__state}},{key:"share2Moments",value:function(){this.setState({showShare2WxDialog:!1,showShare2MomentsDialog:!0})}},{key:"funPrivateJgNHR",value:function(){return this.props.onPress.apply(void 0,Array.prototype.slice.call(arguments,1))}},{key:"anonymousFunc0",value:function(o){}},{key:"anonymousFunc1",value:function(o){}}]),r}(),_class.$$events=["funPrivateJgNHR","anonymousFunc0"],_class.$$componentPath="pages/vpayMember-t/components/coupon/index";var CouponUI=_temp2;exports.default=CouponUI,Component(require("../../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(CouponUI));