"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_get=function e(t,o,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,o);return void 0!==r?"value"in r?r.value:void 0!==(r=r.get)?r.call(n):void 0:null!==(r=Object.getPrototypeOf(t))?e(r,o,n):void 0},_indexWeapp=require("../../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_vpayMember=require("../../api/vpayMember.js"),_indexWeapp2=require("../../../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_index=require("../../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp3=require("../../../../npm/@jd/djmp/common-t/js/cookie/index.weapp.js"),_envelopesComponentModuleScssMap=require("./envelopesComponent.module.scss.map.js"),_envelopesComponentModuleScssMap2=_interopRequireDefault(_envelopesComponentModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}_temp2=_class=function(){function i(){var e,t;_classCallCheck(this,i);for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t=_possibleConstructorReturn(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(n)))).$usedState=["anonymousState__temp3","item","loopArray158","loopArray159","loopArray160","$compid__306","style","storeLogo","monthSale","ext","distance","predictedTime","freightWords","freightDescForLine","storeCouponTags","takeState","showPoup","storeName","storeScore","consumeCode","exchangePop","exchangeData","refreshPage","userCardType","cityId"],t.config={navigationBarTitleText:"V+会员"},t.customComponents=["PoupEnvelopes"],_possibleConstructorReturn(t,e)}return _inherits(i,_index.Component),_createClass(i,[{key:"_constructor",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_constructor",this).call(this,e),this.state={consumeCode:"",showPoup:!1,exchangePop:!1,exchangeData:{}},this.$$refs=[]}},{key:"_createData",value:function(){var o=this,e=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix),e=(0,_index.genCompid)(e+"$compid__306"),t=this.__props||{},n=t.item,r=t.longitude,i=t.latitude,t=t.cityId,a=n||{},s=a.storeName,p=a.storeLogo,c=a.storeScore,c=void 0===c?5:c,l=a.monthSale,l=void 0===l?0:l,u=a.predictedTime,d=a.freightWords,_=a.freightDescForLine,g=a.distance,h=a.storeCouponTags,a=a.ext,a=void 0===a?"":a,m=n.bestExchangeCouponInfo.takeState,f=this.__state,C=f.showPoup,v=f.consumeCode,f=f.exchangeData,y=n.carrierTag?(0,_index.internal_inline_style)({borderColor:n.carrierTag.strokeColorCode,color:n.carrierTag.iconTextColorCode}):null,x=(this.anonymousFunc0=(2==m?this.exchangeEvent:this.jumpStore).bind(this,n),n&&n.allStartNum?n.allStartNum.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp2:n&&n.allStartNum?"key"+t:null,$original:e.$original}}):[]),k=h&&h.length?h.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp5:t<3&&h&&h.length?(0,_index.internal_inline_style)({borderColor:e.$original.outLineColor,backgroundColor:e.$original.backgroundColor,color:e.$original.frontColor}):null,$original:e.$original}}):[],b=n.tags&&n.tags.length?n.tags.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp7:0==t?(0,_index.internal_inline_style)({background:"linear-gradient(135deg,"+e.$original.startColorCode+" 0%,"+e.$original.endColorCode+" 100%)"}):null,$loopState__temp9:0==t?o.filterTxt(e.$original.labelDesc,"###",","):null,$original:e.$original}}):[];return C&&_index.propsManager.set({exchangeData:f,item:n,longitude:r,latitude:i,cityId:t,consumeCode:v,closeExchangePop:this.closeExchangePop.bind(this),refreshPage:this.refreshPage.bind(this)},e),Object.assign(this.__state,{anonymousState__temp3:y,item:n,loopArray158:x,loopArray159:k,loopArray160:b,$compid__306:e,style:_envelopesComponentModuleScssMap2.default,storeLogo:p,monthSale:l,ext:a,distance:g,predictedTime:u,freightWords:d,freightDescForLine:_,storeCouponTags:h,takeState:m,storeName:s,storeScore:c}),this.__state}},{key:"filterTxt",value:function(e,t,o){return e&&0<e.length?e.split(t).join(o):e}},{key:"closeExchangePop",value:function(){this.setState({showPoup:!1})}},{key:"refreshPage",value:function(){this.props.refreshPage()}},{key:"exchangeEvent",value:function(e,t){var o=(e||{}).storeId;t.preventDefault(),t.stopPropagation(),2==e.bestExchangeCouponInfo.takeState?this.convertCouponCheck(e.bestExchangeCouponInfo,o):this.jumpStore(e),(0,_indexWeapp.clickReport)({create_time:new Date,click_id:"clickbigredpacket",click_par:{storeId:o,statusId:1==this.props.userCardType?"week":"month",activityCode:e.bestExchangeCouponInfo.activityCode||"",takeState:1==e.bestExchangeCouponInfo.takeState?"去门店":"兑换"}})}},{key:"jumpStore",value:function(e){var e=e||{},t=e.orgCode,o=e.storeId,n=e.skuId,e=e.tab,e=void 0===e?1:e;(0,_indexWeapp2.jump)({to:"store",params:{storeId:o||"",skuId:n||"",orgCode:t||"",needAnchorSku:!0,addCart:!0,isAddCart:!0,needAddCar:!0}});(0,_indexWeapp.clickReport)({click_id:"click_store",click_par:{storeid:o||"",tab:{1:"vip_keyonghongbao",2:"vip_jintieduihuan",3:"vip_daifafang"}[e]}})}},{key:"convertCouponCheck",value:function(e,t){var a=this,o=this.props.cityId;(0,_vpayMember.api_convertCouponCheck)({cityId:o,pin:(0,_indexWeapp3.getCookie)("PDJ_H5_PIN")||(0,_indexWeapp3.getCookie)("pin")||(0,_indexWeapp3.getCookie)("PDJ_H5_JDPIN"),activityCode:e.activityCode,serviceVersion:2,consumeCode:"",grabChannel:"vip_index_page",platform:"H5",requestor:"vplus",storeId:t}).then(function(e){var t,o,n,r,i;"0"==e.code&&e.result.vip&&(t=(i=e&&e.result).sourcePackage,o=i.targetPackage,n=i.title,r=i.subTitle,i=i.storeLogo,a.setState({showPoup:!0,exchangeData:{title:n,subTitle:r,sourcePackage:t,targetPackage:o,storeLogo:i},consumeCode:t.activityCode}),(0,_indexWeapp.clickReport)({create_time:new Date,click_id:"exchangeCouponWindowVender",click_par:{isPaid:1,result:e}}))}).catch(function(e){_index2.default.showToast({title:e.msg||"网络开小差，请稍后重试",icon:"none",duration:1500})}),(0,_indexWeapp.clickReport)({create_time:new Date,click_id:"clickCouponVender",click_par:{isPaid:1,item:e}})}},{key:"anonymousFunc0",value:function(e){}}]),i}(),_class.$$events=["jumpStore","anonymousFunc0"],_class.$$componentPath="pages/vpayMember-t/components/envelopesComponentNew/index";var EnvelopesComponent=_temp2;exports.default=EnvelopesComponent,Component(require("../../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(EnvelopesComponent));