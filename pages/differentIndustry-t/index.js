"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,n=arguments[t];for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_get=function e(t,o,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,o);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(n):void 0:null!==(i=Object.getPrototypeOf(t))?e(i,o,n):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/env/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap),_indexWeapp3=require("../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_indexWeapp4=require("../../npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp5=require("../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_differentIndustry=require("./api/differentIndustry.js"),_indexWeapp6=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp7=require("../../npm/@jd/djmp/common-t/js/location/index.weapp.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var isWeapp=!0,isInWeappH5=!1,scopeData={throttleFlag:!0,isShowDownButtonPvFlag:!0},DifferentIndustry=(_temp2=_class=function(){function a(){var e,t;_classCallCheck(this,a);for(var o=arguments.length,n=Array(o),i=0;i<o;i++)n[i]=arguments[i];return(e=t=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(n)))).$usedState=["$compid__174","showDefault","anonymousState__temp","phone","isShowPop","defineSelf","data","showResultTxt","defaultType","defaultTips","sendNewUserCoupon","isNewUser","toastConfigLogo","toastJumpLink","couponBaseInfo","cityId","lng","lat","firstOrder","buttionId","couponBaseInfoList","takeCouponRecordList","isShowDownButton"],t.config={navigationBarTitleText:"到家会员免费送"},t.getPaySource=function(){return(_indexWeapp2.isWeixin?"isWeixin":_indexWeapp2.isDaojiaApp&&"isDaojiaApp")||_indexWeapp2.isJDReactNativeWebView&&"isJDReactNativeWebView"||"isMiniProgram"},t.customComponents=["Default","VipPopCard"],_possibleConstructorReturn(t,e)}return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.state={phone:"",isShowPop:!1,defineSelf:!0,data:{},showResultTxt:!1,showDefault:!0,defaultType:0,defaultTips:"",sendNewUserCoupon:!1,isNewUser:!1,toastConfigLogo:"",toastJumpLink:"",couponBaseInfo:{},cityId:"",lng:"",lat:"",firstOrder:"",buttionId:"",couponBaseInfoList:[],takeCouponRecordList:[],isShowDownButton:!1},this.$$refs=[]}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__174"),o=this.__state,n=o.showDefault,i=o.defaultType,o=o.defaultTips,e=this._createMainData(e+"cficwYEVci")();return n&&_index.propsManager.set({defaultType:i,defaultTips:o},t),Object.assign(this.__state,{$compid__174:t,anonymousState__temp:e}),this.__state}},{key:"_createMainData",value:function(m){var w=this;return function(){var e=(0,_index.genCompid)(m+"$compid__175"),t=w.$router.params.channel,o=w.state,n=o.isShowPop,i=o.bannelLogo,a=o.vipLogo,p=o.title,s=o.buttionId,r=o.phone,c=o.isNewUser,u=o.toastConfigLogo,l=o.toastJumpLink,d=o.couponBaseInfo,h=o.couponBaseInfoList,h=void 0===h?[]:h,f=o.takeCouponRecordList,f=void 0===f?[]:f,o=o.isShowDownButton,_=0<h.length?h.map(function(e,t){return 1!=(e={$original:(0,_index.internal_get_original)(e)}).$original.takeType&&e.$original.takeType,{$original:e.$original}}):[],g=0<f.length?f.map(function(e,t){return 1!=(e={$original:(0,_index.internal_get_original)(e)}).$original.takeType&&e.$original.takeType,{$original:e.$original}}):[];return _index.propsManager.set({isShowPop:n,onClosePopUp:w.onClosePopUp.bind(w),toastConfigLogo:u,toastJumpLink:l,couponBaseInfo:d,couponBaseInfoList:h,channel:t,showVipPop:c,download:w.download.bind(w)},e),{loopArray29:_,loopArray30:g,$compid__175:e,style:_indexModuleScssMap2.default,bannelLogo:i,buttionId:s,couponBaseInfoList:h,title:p,isShowDownButton:o,phone:r,takeCouponRecordList:f,vipLogo:a}}}},{key:"componentDidShow",value:function(){isInWeappH5=(0,_indexWeapp2.getH5InWeappFlag)(),wx.hideShareMenu({menus:["shareAppMessage","shareTimeline"]}),(0,_index.getApp)().globalData.qrcode.business=this.$router.params.business||211,(0,_index.getApp)().globalData.qrcode.channel=this.$router.params.channel,this.fetchData()}},{key:"download",value:function(e){var t=this.$router.params,o=t.channel;t.openapp;"isDownBtn"==e&&(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickdownloadbutton",click_par:{channel:o}})}},{key:"goHome",value:function(e){var t=this.$router.params.channel;(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickgojddaojia",click_par:{channel:t,statusId:e}}),isInWeappH5?(0,_indexWeapp3.jump)({to:"home",type:"h5",params:{}}):(0,_indexWeapp3.jump)({to:"home",params:{}})}},{key:"getCouponFn",value:function(){var e=this,t=this.state,o=t.buttionId,t=t.showResultTxt,n=this.$router.params.channel;1!=o||t?this.goHome(1):((0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickcooperatepage",click_par:{channel:n}}),this._throttle(function(){e.getCoupon(!0)}))}},{key:"getCoupon",value:function(u){var l=this,o=this.state.vpId,d=this.$router.params.channel,n=((0,_indexWeapp5.showLoading)(),{isWeixin:96,isDaojiaApp:95,isJDReactNativeWebView:108,isJDApp:114,isMiniProgram:107,isDJBrowser:-1}),i=this.getPaySource();this.judageIsLogin().then(function(){var e,t={channel:d,vpId:o,cityId:-1,redPacketPaySource:n[i]};"yili"==d&&(e=((0,_index.getApp)().globalData||{}).redeemCode||"",t=_extends({redeemCode:e},t)),l.getPositionController().then(function(e){t.cityId=e&&e.cityId||e&&e.areaCode||-1,t=_extends({lng:e&&e.longitude||"",lat:e&&e.latitude||""},t),(0,_differentIndustry.freeTakeFn)(t).then(function(e){var t,o,n,i,a,p,s,r,c;(0,_indexWeapp5.hideLoading)(),405==e.code||406==e.code?(u&&l.clickRp("clickCooerateInfo",{channel:d,info:e.msg}),(0,_indexWeapp5.showToast)({title:e.msg}),c="",e.result&&(c=e.result.phone),l.setState({title:e.msg,buttionId:0,phone:c||"",isShowDownButton:1==e.result.isShowDownButton})):0==e.code?(t=(c=e.result).title,o=c.buttionId,n=c.isNewUser,i=c.toastConfigLogo,a=c.toastJumpLink,p=c.phone,s=c.couponBaseInfo,r=c.couponBaseInfoList,c=c.isShowDownButton,l.setState({title:t,phone:p,buttionId:o,showResultTxt:!0,isShowPop:!0,isNewUser:1==n,toastConfigLogo:i,toastJumpLink:a,couponBaseInfo:s,couponBaseInfoList:r||[],isShowDownButton:1==c},function(){l.state.isShowPop&&(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickCooeratePop",click_par:{channel:d,type:s&&s.amount?2:1}})})):201==e.code||202==e.code?(u&&l.clickRp("clickCooerateInfo",{channel:d,info:e.msg}),l._goToLogin()):(e.result&&e.result.title&&l.setState({title:e.result.title,buttionId:0,isShowDownButton:1==e.result.isShowDownButton}),u&&l.clickRp("clickCooerateInfo",{channel:d,info:e.msg}),(0,_indexWeapp5.showToast)({title:e.msg})),scopeData.isShowDownButtonPvFlag&&1==e.result.isShowDownButton&&(scopeData.isShowDownButtonPvFlag=!1,_indexWeapp6.clickReport)({create_time:new Date,click_id:"showdownloadbutton",click_par:{channel:d}})}).catch(function(e){u&&l.clickRp("clickCooerateInfo",{channel:d,info:e.msg}),(0,_indexWeapp5.showToast)({title:e.msg||"网络异常"}),(0,_indexWeapp5.hideLoading)()})})}).catch(function(e){(0,_indexWeapp5.showToast)({title:"请登录"}),l._goToLogin()})}},{key:"clickRp",value:function(e,t){(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:e,click_par:t})}},{key:"onClosePopUp",value:function(){this.setState({isShowPop:!1})}},{key:"_throttle",value:function(e,t){scopeData.throttleFlag&&(scopeData.throttleFlag=!1,e.apply(this,arguments),setTimeout(function(){scopeData.throttleFlag=!0},t||1e3))}},{key:"fetchData",value:function(){var u=this,l=this.$router.params.channel,e=this.state;e.cityId,e.lng,e.lat;(0,_indexWeapp5.showLoading)(),(0,_differentIndustry.getData)({channel:l}).then(function(e){if((0,_indexWeapp5.hideLoading)(),0==e.code){var e=e.result,t=e.bannelLogo,o=e.vipLogo,n=e.title,i=e.buttionId,a=e.vpId,p=e.sendNewUserCoupon,s=e.firstOrder,r=e.takeCouponRecordList,r=void 0===r?[]:r,c=e.phone,e=e.isShowDownButton;try{u.getPositionController().then(function(e){u.pvReportFn(i,n)})}catch(e){u.pvReportFn("")}scopeData.isShowDownButtonPvFlag&&1==e&&(scopeData.isShowDownButtonPvFlag=!1,_indexWeapp6.clickReport)({create_time:new Date,click_id:"showdownloadbutton",click_par:{channel:l}}),u.setState({bannelLogo:t,vipLogo:o,title:n,buttionId:i,vpId:a,phone:c||"",showDefault:!1,sendNewUserCoupon:p,firstOrder:1==s,takeCouponRecordList:r||[],isShowDownButton:1==e},function(){u.judageIsLogin().then(function(e){u.getCouponAuto()}).catch(function(e){(0,_indexWeapp4.setStorageSync)("pageFrom","")})})}else u.setState({showDefault:!0,defaultType:2,defaultTips:"抱歉活动不存在"}),u.pvReportFn("","活动不存在")}).catch(function(e){(0,_indexWeapp5.hideLoading)(),u.setState({showDefault:!0,defaultType:2,defaultTips:"抱歉活动不存在"}),u.pvReportFn("","活动不存在")})}},{key:"pvReportFn",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=this.$router.params.channel;(0,_indexWeapp6.pvReport)({create_time:new Date,page_par:{channel:o,info:1==e?"免费领取":t||"不能领取"}})}},{key:"judageIsLogin",value:function(){return new Promise(function(e,t){(0,_indexWeapp.isLogin)().then(function(){e()}).catch(function(){isInWeappH5||_indexWeapp2.isJDReactNativeWebView||_indexWeapp2.isJDApp||_indexWeapp2.isJDFinanceApp||_indexWeapp2.isJxApp||_indexWeapp2.isJiSuApp?(0,_indexWeapp.isLoginInWeappH5)().then(function(){e()}).catch(function(){t()}):t()})})}},{key:"getCouponAuto",value:function(){var e=this.$router.params.channel;(0,_indexWeapp4.getStorageSync)("pageFrom")=="differentIndustry"+e&&this.getCoupon(!1),(0,_indexWeapp4.setStorageSync)("pageFrom","")}},{key:"_goToLogin",value:function(){var e=this.$router.params.channel,t=this.state.sendNewUserCoupon;(0,_indexWeapp4.setStorageSync)("pageFrom","differentIndustry"+e),(0,_indexWeapp.goToLogin)({channel:1==t?"vipcooperation_"+e:"",localTargetUrl:"/pages/differentIndustry-t/index?channel="+e})}},{key:"getPositionController",value:function(){var o=this,n=this.$router.params.channel,e=this.state,i=e.cityId,a=e.lng,p=e.lat,s=e.firstOrder;return new Promise(function(t,e){i&&a&&p?t({cityId:i,longitude:a,latitude:p}):"jdjr"!=n||s?_indexWeapp2.isJDApp?(0,_indexWeapp7.getLocation)().then(function(e){(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"spclAddrSuccess"}),o.setState({cityId:e.cityId||e.areaCode||"",lng:e.longitude||"",lat:e.latitude||""}),t(e)}).catch(function(e){t()}):t():window.confirm("为了更好地为您提供服务，京东到家想使用您当前的位置")&&_indexWeapp2.isJDFinanceApp?(0,_indexWeapp7.getLocation)().then(function(e){(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"spclAddrSuccess"}),o.setState({cityId:e.cityId||e.areaCode||"",lng:e.longitude||"",lat:e.latitude||""}),t(e)}).catch(function(e){t()}):t()})}},{key:"onShareAppMessage",value:function(){return{title:"京东到家",path:"/pages/home/home",imageUrl:"https://storage.360buyimg.com/wximg/common/logo.jpg"}}},{key:"onShareTimeline",value:function(){return{title:"京东到家",path:"/pages/home/home",imageUrl:"https://storage.360buyimg.com/wximg/common/logo.jpg"}}}]),a}(),_class.$$events=["getCouponFn","download","goHome"],_class.multipleSlots=!0,_class.$$componentPath="pages/differentIndustry-t/index",_temp2);exports.default=DifferentIndustry,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(DifferentIndustry,!0));