"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,n=arguments[t];for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_get=function e(t,o,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,o);return void 0!==s?"value"in s?s.value:void 0!==(s=s.get)?s.call(n):void 0:null!==(s=Object.getPrototypeOf(t))?e(s,o,n):void 0},_index=require("../../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp2=require("../../../../npm/@jd/djmp/common-t/js/epBi/index.weapp.js"),_indexWeapp3=_interopRequireDefault(_indexWeapp2),_indexWeapp4=require("../../../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_index3=require("../../api/index.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}_temp2=_class=function(){function r(){var e,t;_classCallCheck(this,r);for(var o=arguments.length,n=Array(o),s=0;s<o;s++)n[s]=arguments[s];return(e=t=_possibleConstructorReturn(this,(t=r.__proto__||Object.getPrototypeOf(r)).call.apply(t,[this].concat(n)))).$usedState=["loopArray141","$compid__293","commonSalesList","style","totalCount","pageSize","pageNum","title","subTitle","cornerMark","productList","commonSalesInfo","saleShowType"],t.jumpTo=function(t,e){var o={},n=(1==t.userJdIdentity&&(o.saleType=7),(0,_indexWeapp.clickReport)({create_time:new Date,click_id:"clickSku",click_par:{skuId:t.skuId,storeId:t.storeId,userAction:t.userAction}}),t.productJumpTyp),s=t.buttonJumpType,r=t.storeId,r=void 0===r?"":r,i=t.orgCode,i=void 0===i?"":i,a=t.skuId,u=void 0===a?"":a,a=t.spuId,p=void 0===a?"":a,a="goods"===e?void 0===n?1:n:void 0===s?1:s,e={1:"store",2:"Settlement",3:"productDetail"},l=_extends({skuId:t.skuId,storeId:t.storeId,orgCode:t.orgCode,spuId:t.spuId,userAction:t.userAction},o);1==a?(0,_indexWeapp4.jump)({to:e[a],params:_extends({},l,{needAnchorSku:!0,addCart:!0,needAddCar:!0,needAddCart:1,isAddCart:!0})}):2==a?(0,_index3.validSettle)({skuList:[{id:u,spuId:p,num:1}],storeId:r,orgCode:i,fromSource:5,verifyResource:1,pageSource:"newPerson"}).then(function(e){var t=[{skuCount:1,skuId:Number(u),spuId:Number(p)}];(0,_indexWeapp4.jump)({to:"Settlement",params:_extends({saleType:5},l,{settleType:"0",preSaleSkuInfos:JSON.stringify(t),skuCount:1})})}).catch(function(e){(0,_indexWeapp4.jump)({to:"productDetail",params:_extends({},t,l,{settleShowType:1})})}):3==a&&(0,_indexWeapp4.jump)({to:e[a],params:_extends({},t,l,{settleShowType:1})})},t.customComponents=["ModuleTitle","SkuYhsExp"],_possibleConstructorReturn(t,e)}return _inherits(r,_index.Component),_createClass(r,[{key:"_constructor",value:function(e){_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_constructor",this).call(this,e),this.state={pageNum:1,pageSize:12,title:"",subTitle:"",cornerMark:"",totalCount:0,commonSalesList:[],productList:[]},this.Exposure=null,this.userAction={},this.$$refs=[]}},{key:"componentDidMount",value:function(){this.initPage(this.props),this.Exposure=new _indexWeapp3.default(".content >>> .exposure",this.$scope)}},{key:"componentWillReceiveProps",value:function(e){JSON.stringify(this.props.commonSalesInfo)!=JSON.stringify(e.commonSalesInfo)&&(this.Exposure&&(this.Exposure=null),this.initPage(e),this.Exposure=new _indexWeapp3.default(".content >>> .exposure",this.$scope))}},{key:"componentWillUnmount",value:function(){this.Exposure=null}},{key:"initPage",value:function(e){var t=this.state.pageNum,e=e.commonSalesInfo;1==t&&this.setState({title:e.title||"",cornerMark:e.cornerMark||"",totalCount:e.normalProductList&&e.normalProductList.length,productList:e.normalProductList,commonSalesList:e.normalProductList&&e.normalProductList.slice(0,12)})}},{key:"_toExposure",value:function(){var e=this;this.state.productList.length&&setTimeout(function(){e.Exposure&&e.Exposure.initObserver&&e.Exposure.initObserver()},2e3)}},{key:"_moreHandle",value:function(){var e=this,t=this.state,o=t.commonSalesList,n=t.totalCount,s=t.pageNum,r=t.pageSize,i=t.productList;o.length>=n||n<=s*r||this.setState({pageNum:s+1,pageSize:r},function(){e.setState({commonSalesList:i.slice(0,12*e.state.pageNum)}),e._toExposure()})}},{key:"_createData",value:function(){var o=this,n=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix),e=(0,_index.genCompid)(n+"$compid__293"),t=this.__state,s=t.title,r=(t.totalCount,t.commonSalesList),i=t.subTitle,t=(t.pageNum,t.pageSize,t.cornerMark),a=(this.anonymousFunc0=function(){o._moreHandle()},r&&0<r.length?r.map(function(e,t){e={$original:(0,_index.internal_get_original)(e)};t=(0,_index.genCompid)(n+"QFwMXqapms"+t);return r&&0<r.length&&_index.propsManager.set({item:e.$original,onPress:o.jumpTo},t),{$compid__292:t,$original:e.$original}}):[]);return r&&0<r.length&&_index.propsManager.set({saleShowType:this.__props.saleShowType,title:s,subTitle:i,cornerMark:t},e),Object.assign(this.__state,{loopArray141:a,$compid__293:e,style:_indexModuleScssMap2.default}),this.__state}},{key:"anonymousFunc0",value:function(e){}}]),r}(),_class.$$events=["anonymousFunc0"],_class.$$componentPath="pages/newPersonB-t/components/commonSales/index";var CommonSales=_temp2;exports.default=CommonSales,Component(require("../../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(CommonSales));