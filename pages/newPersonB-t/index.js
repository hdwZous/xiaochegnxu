"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},_createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);return void 0!==a?"value"in a?a.value:void 0!==(a=a.get)?a.call(o):void 0:null!==(a=Object.getPrototypeOf(t))?e(a,n,o):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/env/index.weapp.js"),_indexWeapp3=require("../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_indexWeapp4=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp5=require("../../npm/@jd/djmp/common-t/js/epBi/index.weapp.js"),_indexWeapp6=_interopRequireDefault(_indexWeapp5),_indexWeapp7=require("../../npm/@jd/djmp/common-t/js/location/index.weapp.js"),_index3=require("./api/index.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,i){return function t(e,n){try{var o=s[e](n),a=o.value}catch(e){return void i(e)}if(!o.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var isInWeappH5=(0,_indexWeapp2.getH5InWeappFlag)(),isH5=!1,isWeapp=!0,location={},Index=(_temp2=_class=function(){function a(){var e,p,l=this;_classCallCheck(this,a);for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=p=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(n)))).$usedState=["anonymousState__temp16","anonymousState__temp17","$compid__219","style","defaultPageFlag","isWeapp","anonymousState__temp4","anonymousState__temp5","anonymousState__temp6","isShowOldUserPage","anonymousState__temp7","vipInfo","anonymousState__temp8","newUserProductFloorInfo","anonymousState__temp9","productShowType","anonymousState__temp10","anonymousState__temp11","hasInflateCoupon","anonymousState__temp12","headerInfo","anonymousState__temp13","anonymousState__temp14","popupInfo","anonymousState__temp15","userSource","isDialog","dialogList","userIdentity","couponFloorInfo","inflateFloorInfo","requestflag","pageInfo","couponsInfo","currentPage","isLogin","position","shopList","flagShop","showFlag","statusBarH","toBar","isAssistCouponDialogShow","isCommonSales","commonSalesInfo","whiteBarProductFloorInfo","productFloorTypes"],p.config={navigationBarTitleText:"新人专区",navigationBarBackgroundColor:"#fff",navigationBarTextStyle:"black",onReachBottomDistance:160,navigationStyle:"custom"},p._weappIsDialog=function(){var e=p.state.showFlag;e?((0,_indexWeapp4.clickReport)({click_id:"click_open",click_par:{userAction:p.retainUserAction,type:"retain"}}),p.setState({isDialog:e})):p.childCustomNavBg&&p.childCustomNavBg.goback&&"function"==typeof p.childCustomNavBg.goback&&p.childCustomNavBg.goback()},p._callNativeClose=function(){(0,_indexWeapp4.clickReport)({click_id:"clickLayer",click_par:{userAction:p.retainUserAction,btnName:"leave",type:"retain"}}),_indexWeapp2.isDaojiaApp&&0<=p._isCompatible(String(_indexWeapp2.djAppVersion),String("8.6.0"))?_indexWeapp2.isIOS?_indexWeapp2.supportDJSHWK&&window.webkit.messageHandlers.MobileNavi.postMessage({method:"closeWebview",callBackName:null,callBackId:null}):_indexWeapp2.isAndroid&&window.djJava.closeWebview&&window.djJava.closeWebview():p._childSubscribeHandle([],null,103,function(){p.childCustomNavBg&&p.childCustomNavBg.goback&&"function"==typeof p.childCustomNavBg.goback&&p.childCustomNavBg.goback()})},p._childSubscribeHandle=function(i,s,u,c){var t;i=i&&0<i.length?i:["tVl3oywjEtM5mNz-179LZNPRgkA9a3tKvRkszASHgjs","aUUy2JkJeivLJJCEPOMuMyN4ew4pS1_Qn9Ln_YOeeYM","fchAp-FzoMeL7H-ENM6JyboyPHI5mMhuG9XqsCvqK5I"],(0,_index3.getAbTest)({experimentName:"wechat_submit"}).then((t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,o,a=t.code,r=t.result;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("0"==a&&r&&"submit_a"==r.strategyName)return e.next=4,p.judgeAllowBtn(i);e.next=10;break;case 4:return n=e.sent,e.next=7,p.needShowSub(n);case 7:e.sent?(o=p._childSubscribeCb.bind(p,i,u),p.childSubscribe.initSubscribeMessage(i,s,c,o)):c&&c(),(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"showLayer",click_par:{type:n?"hideSubscribe":"subscribe",templateId:i.join(),channelId:u}});case 10:case"end":return e.stop()}},e,l)})),function(e){return t.apply(this,arguments)})).catch(function(e){c&&c()})},p._initiativeCloseLog=function(){(0,_indexWeapp4.clickReport)({click_id:"clickLayer",click_par:{userAction:p.retainUserAction,btnName:"close",type:"retain"}}),p.setState({showFlag:!1,isDialog:!1})},p.productType=function(){var e=p.state,t=e.commonSalesInfo,e=e.whiteBarProductFloorInfo,n=void 0,o=void 0;return t&&!e&&(n=1,o=t),!t&&e&&(n=2,o=e),t&&e&&(n=3,o={commonSalesInfo:t,whiteBarProductFloorInfo:e}),{productShowType:n,productInfo:o}},p.customComponents=["Bitmap","Products","CommonSales","TabCommonSales","OldShops","Coupons","PayInfoRoll","Shops","Dialog","Custom","AssistCouponDialog","Default","SubscribeMessage"],_possibleConstructorReturn(p,e)}var t,n,e,o,r,i,s,u,c,p;return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){var t=this,e=(_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.Exposure=null,this.userAction={},this.retainUserAction={},this.goToLoginParams={localTargetUrl:"/pages/newPersonB-t/index"},this.hotsList=0,this.state={userSource:0,isDialog:!1,dialogList:[],userIdentity:null,headerInfo:{},couponFloorInfo:null,inflateFloorInfo:null,newUserProductFloorInfo:{},requestflag:!1,popupInfo:null,pageInfo:{},couponsInfo:null,currentPage:1,isLogin:null,position:null,shopList:[],flagShop:!0,showFlag:null,statusBarH:20,toBar:44,isAssistCouponDialogShow:!1,isCommonSales:!1,commonSalesInfo:null,hasInflateCoupon:!1,whiteBarProductFloorInfo:null,productFloorTypes:null},this.$router.params.appVersion);this.appVersion=e||"",this.$$refs=[{type:"component",id:"mJkYC",refName:"oldShops",fn:null},{type:"component",id:"EtWmi",refName:"shops",fn:null},{type:"component",id:"ApeBp",refName:"",fn:function(e){return t.childCustomNavBg=e}},{type:"component",id:"MPEXJ",refName:"",fn:function(e){return t.childSubscribe=e}}]}},{key:"componentWillMount",value:(p=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.Exposure=new _indexWeapp6.default(".content >>> .exposure",this.$scope),t=!1,e.prev=2,e.next=5,this._judageIsLogin();case 5:t=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),t=!1;case 11:t||(0,_indexWeapp.goToLogin)(this.goToLoginParams),n=this,_index2.default.getSystemInfo({success:function(e){n.setState({statusBarH:e.statusBarHeight}),"ios"!=e.platform&&"android"==e.platform?n.setState({toBar:48}):n.setState({toBar:44})}}),(0,_index.getApp)().globalData.pageStack.push("newPersonB");case 16:case"end":return e.stop()}},e,this,[[2,8]])})),function(){return p.apply(this,arguments)})},{key:"componentDidShow",value:(c=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.$router.params).userAction&&(this.userAction=decodeURIComponent(t.userAction)),n=!1,e.prev=3,e.next=6,this._judageIsLogin();case 6:n=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),n=!1;case 12:this.setState({isLogin:n,params:t}),this._initPage(),t.business&&((0,_index.getApp)().globalData.qrcode.business=t.business||null,(0,_index.getApp)().globalData.qrcode.roomid=t.roomId||null),(0,_indexWeapp4.pvReport)({create_time:new Date,page_name:"newPersonB",page_par:{roomId:t.roomId||null,business:t.business||null,orderIndex:t.stage||null,ref_par:{userAction:this.userAction}}});case 16:case"end":return e.stop()}},e,this,[[3,9]])})),function(){return c.apply(this,arguments)})},{key:"onReachBottom",value:function(){var e=this,t=this.state,n=t.currentPage,o=t.pageInfo;this.setState({currentPage:n+1},function(){o.store&&e.child._fetchShopData(),o.isShowStore&&e.childOldShops.fetchData()})}},{key:"_createBannerData",value:function(e){var t=this;return function(){var e=t.state.headerInfo.vipInfo;return t.anonymousFunc0=function(){return t._toVipLink(e.to)},{style:_indexModuleScssMap2.default,vipInfo:e}}}},{key:"_createBitmapData",value:function(l){var d=this;return function(){var e=(0,_index.genCompid)(l+"$compid__208"),t=d.state,n=t.headerInfo,o=t.couponFloorInfo,a=t.inflateFloorInfo,r=t.position,i=t.pageInfo,s=t.userIdentity,u=t.statusBarH,c=t.toBar,p=t.hasInflateCoupon,t=t.userSource,u=(0,_index.internal_inline_style)({marginTop:2*(u+c)+"rpx"});return d.anonymousFunc1=function(e){return d.bitmap=e},_index.propsManager.set({userSource:t,headerInfo:n,userIdentity:s,hasInflateCoupon:p,couponFloorInfo:o,inflateFloorInfo:a,onRef:d.anonymousFunc1,position:r,pageInfo:i,toStore:d._toStore,traceId:d.traceId,appVersion:d.appVersion},e),{anonymousState__temp2:u,$compid__208:e}}}},{key:"_createProductsData",value:function(a){var r=this;return function(){var e=(0,_index.genCompid)(a+"$compid__209"),t=r.$router.params.channel,n=r.state,o=n.position,n=n.newUserProductFloorInfo;return o&&_index.propsManager.set({position:o,channel:t,newUserProductFloorInfo:n,traceId:r.traceId,appVersion:r.appVersion},e),{$compid__209:e,style:_indexModuleScssMap2.default,position:o}}}},{key:"_createCommonSalesData",value:function(o){var a=this;return function(e){var t=(0,_index.genCompid)(o+"$compid__210"),n=a.state.position;return _index.propsManager.set({position:n,commonSalesInfo:e,toStore:a._toStore},t),{$compid__210:t}}}},{key:"_createTabCommonSalesData",value:function(a){var r=this;return function(e){var t=(0,_index.genCompid)(a+"$compid__211"),n=r.state,o=n.position,n=n.productFloorTypes;return _index.propsManager.set({productInfo:e,position:o,productFloorTypes:n||[],toStore:r._toStore},t),{$compid__211:t}}}},{key:"_createNearbyStoresData",value:function(o){var a=this;return function(){var e=(0,_index.genCompid)(o+"$compid__212"),t=a.state,n=t.position,t=t.currentPage;return a.anonymousFunc2=function(e){return a.childOldShops=e},_index.propsManager.set({position:n,toStore:a._toStore,currentPage:t,onRef:a.anonymousFunc2,fromSource:"newPerson"},e),{$compid__212:e}}}},{key:"_createCouponData",value:function(u){var c=this;return function(){var e=(0,_index.genCompid)(u+"$compid__213"),t=c.state,n=t.position,o=t.isLogin,a=t.pageInfo,r=t.couponsInfo,i=t.isCommonSales,s=t.newUserProductFloorInfo,t=t.commonSalesInfo;return _index.propsManager.set({position:n,isLogin:o,pageInfo:a,couponsInfo:r,isCommonSales:i,newUserProductFloorInfo:s,commonSalesInfo:t},e),{$compid__213:e}}}},{key:"_createOldUsersData",value:function(e){var t=this;return function(){return t.anonymousFunc3=function(){(0,_indexWeapp3.jump)({to:"home"})},{style:_indexModuleScssMap2.default}}}},{key:"_createPayInfoRollData",value:function(a){var r=this;return function(){var e=(0,_index.genCompid)(a+"$compid__214"),t=r.state,n=t.pageInfo,o=t.headerInfo,t=2*(t.statusBarH+t.toBar)+"rpx";return _index.propsManager.set({pageInfo:n,payInfo:o.recentlyPayInfo,top:t},e),{anonymousState__temp3:t,$compid__214:e}}}},{key:"_createShopsData",value:function(r){var i=this;return function(){var e=(0,_index.genCompid)(r+"$compid__215"),t=i.state,n=t.position,o=t.currentPage,a=t.shopList,t=t.flagShop;return i.anonymousFunc4=function(e){return i.child=e},_index.propsManager.set({position:n,toStore:i._toStore,shopList:a,flagShop:t,currentPage:o,onRef:i.anonymousFunc4},e),{$compid__215:e}}}},{key:"_createDialogData",value:function(i){var s=this;return function(){var e=(0,_index.genCompid)(i+"$compid__216"),t=s.state,n=t.isLogin,o=t.isDialog,a=t.dialogList,r=t.statusBarH,t=t.toBar;return _index.propsManager.set({isDialog:o,dialogList:void 0===a?[]:a,callNativeClose:s._callNativeClose,initiativeCloseLog:s._initiativeCloseLog,isLogin:n,statusBarH:r,toBar:t,onToStore:s._toStore,retainUserAction:s.retainUserAction},e),{$compid__216:e}}}},{key:"_createCustomData",value:function(o){var a=this;return function(){var e=(0,_index.genCompid)(o+"$compid__217"),t=a.state,n=t.statusBarH,t=t.toBar;return _index.propsManager.set({statusBarH:n,toBar:t,weappIsDialog:a._weappIsDialog},e),{$compid__217:e}}}},{key:"_createAssistCouponDialogData",value:function(a){var r=this;return function(){var e=(0,_index.genCompid)(a+"$compid__218"),t=r.state,n=(t.pageInfo,t.isAssistCouponDialogShow),o=t.isLogin,t=t.popupInfo;return r.anonymousFunc5=function(){return r._closeAssistCouponDialog()},_index.propsManager.set({isAssistCouponDialogShow:n,popupInfo:t,onCloseEv:r.anonymousFunc5,isLogin:o},e),{$compid__218:e}}}},{key:"_closeAssistCouponDialog",value:function(){this.setState({isAssistCouponDialogShow:!1});var e=this.$router.params.source;this._childSubscribeHandle([],null,"hyzl"===e?106:102)}},{key:"_assistCouponSubscribeClickReport",value:function(e){e&&(e=this.$router.params.source,(0,_indexWeapp4.clickReport)({click_id:"clickLayer",click_par:{type:"subscribe",templateId:"tVl3oywjEtM5mNz-179LZNPRgkA9a3tKvRkszASHgjs,aUUy2JkJeivLJJCEPOMuMyN4ew4pS1_Qn9Ln_YOeeYM,fchAp-FzoMeL7H-ENM6JyboyPHI5mMhuG9XqsCvqK5I",channelId:"hyzl"===e?106:102,btnName:"accept"}}))}},{key:"_showAssistCouponDialog",value:function(){(0,_indexWeapp4.clickReport)({click_id:"showLayer",click_par:{type:"helpCoupon"}}),this.setState({isAssistCouponDialogShow:!0})}},{key:"_getPageInfo",value:(u=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,o,a,r,i,s,u,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.position,i=this.$router.params,n=i.source,o=i.popupText,a=i.channelId,u=i.platCode,r=i.channel,i=i.clipboardCommand,s={},u&&"ios"==u&&(s.idfa=r),u&&"android"==u&&(s.deviceChannelCode=r),i&&(s.command=i),u=_extends({cityId:t.cityId,lngPos:t.longitude,latPos:t.latitude,source:n,popupText:decodeURIComponent(o),channelId:a||"",appVersion:this.appVersion},s),(0,_index3.gainNewUserland)(u).then(function(e){var t=e.code,n=e.result,e=e.traceId;"0"==t&&(c.traceId=e,c.setState({userSource:n.userSource||0,userIdentity:n.userIdentity,commonSalesInfo:n.productFloorInfo,whiteBarProductFloorInfo:n.whiteBarProductFloorInfo,headerInfo:n.headFloorInfo,couponFloorInfo:n.couponFloorInfo,inflateFloorInfo:n.inflateFloorInfo,newUserProductFloorInfo:n.newUserProductFloorInfo,popupInfo:n.popupInfo,hasInflateCoupon:n.inflateFloorInfo&&n.inflateFloorInfo.currentChannelId&&n.inflateFloorInfo.channelList&&0<n.inflateFloorInfo.channelList.length,requestflag:!0,productFloorTypes:n.productFloorTypes},function(){n.popupInfo&&c._showAssistCouponDialog()}))}).catch(function(){c.setState({couponFloorInfo:null,requestflag:!0})});case 8:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"_getHeaderInfo",value:(s=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.position){e.next=3;break}return e.abrupt("return");case 3:return n={city_id:t.cityId,lng_pos:t.longitude,lat_pos:t.latitude},e.next=6,(0,_index3.getHeaderInfo)(n).then(function(e){var t=e.code,e=e.result;"0"==t&&o.setState({headerInfo:e},function(){var e=o.state.pageInfo;e.coupon,e.product,e.store})});case 6:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"_getPayRecords",value:(i=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(0,_index3.getPayRecords)().then(function(e){var t=e.code,e=e.result;"0"==t&&n.setState({payInfo:e})});case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:"_getCouponsInfo",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.position,t={city_id:t.cityId,lng_pos:t.longitude,lat_pos:t.latitude},(0,_index3.getCouponsInfo)(t).then(function(e){var t=e.code,e=e.result;"0"==t&&n.setState({couponsInfo:e})});case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"_newUserRetain",value:(o=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,o,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.position,n=this.$router.params.channel,n=void 0===n?null:n,t){e.next=4;break}return e.abrupt("return");case 4:o={city_id:t.cityId,lng_pos:t.longitude,lat_pos:t.latitude},n&&(o.channel=n),(0,_index3.newUserRetain)(o).then(function(e){e.result.showFlag&&a._djAppShowFlag(),a.retainUserAction=e.result.userAction||{},a.setState({showFlag:e.result.showFlag,dialogList:e.result.products})});case 7:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"_getCommonSales",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.position,t={cityId:t.cityId,longitude:t.longitude,latitude:t.latitude},(0,_index3.getCommonSalesInfo)(t).then(function(e){var t=e.code,e=e.result;"0"==t&&e&&e.productList&&0<e.productList.length&&n.setState({isCommonSales:!0,commonSalesInfo:e})});case 3:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"judgeAllowBtn",value:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(o){try{wx.getSetting({withSubscriptions:!0,success:function(e){var t,n,e=e.subscriptionsSetting;0==e.mainSwitch&&o(null),1==e.mainSwitch&&(t=e.itemSettings||null)&&(n=!0,a.forEach(function(e){null==t[e]&&(n=!1)}),n&&o(!0)),o(!1)}})}catch(e){}}));case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"needShowSub",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,o,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0;try{wx.getStorageSync("subscribeCount"),a=new Date,r=""+a.getFullYear()+(a.getMonth()+1)+a.getDate(),(o=wx.getStorageSync("subscribeCount")||{}).days&&o.days==r&&(n=o.count)}catch(e){}if(n<2&&null!=t&&this.state.isLogin)return e.abrupt("return",!0);e.next=6;break;case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_isShowPayRecords",value:function(e){return!!(e.coupon||e.product||e.store)&&(this._getPayRecords(),!0)}},{key:"_toVipLink",value:function(e){var e=e.split("#")[1],t=this.state.headerInfo.vipInfo;(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickMember",click_par:{userAction:t.userAction,url:t.url}}),_index2.default.navigateTo({url:e})}},{key:"_executeBitmapFun",value:function(){var e=this.state.headerInfo,t=e.nowTime,e=e.todayLastTime;this.bitmap&&!this.bitmap.timer&&this.bitmap._countFun((void 0===e?0:e)-(void 0===t?0:t))}},{key:"_judageIsLogin",value:function(){return new Promise(function(e,t){(0,_indexWeapp.isLogin)().then(function(){e(!0)}).catch(function(){isInWeappH5||_indexWeapp2.isJDReactNativeWebView||_indexWeapp2.isJDApp||_indexWeapp2.isJDFinanceApp||_indexWeapp2.isJxApp||_indexWeapp2.isJiSuApp?(0,_indexWeapp.isLoginInWeappH5)().then(function(){e(!0)}).catch(function(){t(!1)}):t(!1)})})}},{key:"_toExposure",value:function(){var e=this;this.state.headerInfo.vipInfo&&setTimeout(function(){e.Exposure&&e.Exposure.initObserver&&e.Exposure.initObserver({otherParams:{traceId:e.traceId,app_version:e.appVersion}})},1e3)}},{key:"_childSubscribeCb",value:function(e,t,n){var o=!1,a=[];if(e.forEach(function(e){"accept"==n[e]&&(o=!0,a.push(e))}),o){try{var r=wx.getStorageSync("subscribeCount")||{},i=new Date,s=""+i.getFullYear()+(i.getMonth()+1)+i.getDate();r.days&&r.days==s?r.count+=1:(r.days=s,r.count=1),wx.setStorageSync("subscribeCount",r)}catch(e){}(0,_indexWeapp4.clickReport)({create_time:new Date,click_id:"clickLayer",click_par:{type:"subscribe",templateId:a.join(),channelId:t,btnName:"accept"}})}}},{key:"_djAppShowFlag",value:function(){_indexWeapp2.isDaojiaApp&&0<=this._isCompatible(String(_indexWeapp2.djAppVersion),String("8.6.0"))&&(this._callEnableIntercept(),this._closeWebCall())}},{key:"_callEnableIntercept",value:function(){_indexWeapp2.isDaojiaApp&&0<=this._isCompatible(String(_indexWeapp2.djAppVersion),String("8.6.0"))&&(_indexWeapp2.isIOS?_indexWeapp2.supportDJSHWK&&window.webkit.messageHandlers.MobileNavi.postMessage({method:"enableIntercept",params:1,callBackName:null,callBackId:null}):_indexWeapp2.isAndroid&&window.djJava.enableIntercept&&window.djJava.enableIntercept(1))}},{key:"_closeWebCall",value:function(){var t=this;window.djWebviewBack=function(){var e=t.state.showFlag;return!!e&&((0,_indexWeapp4.clickReport)({click_id:"click_open",click_par:{userAction:t.retainUserAction,type:"retain"}}),t.setState({isDialog:e}),!0)}}},{key:"_isCompatible",value:function(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var o=0;o<n;o++){var a=parseInt(e[o]),r=parseInt(t[o]);if(r<a)return 1;if(a<r)return-1}return 0}},{key:"_toStore",value:function(e){e={userAction:e.userAction,storeId:e.storeId||"",skuId:e.skuId||"",orgCode:e.orgCode||"",longitude:location.longitude||116.51064,latitude:location.latitude||39.79553,needAnchorSku:!0,addCart:!0,needAddCar:!0,needAddCart:1,isAddCart:!0};(0,_indexWeapp3.jump)({to:"store",params:e})}},{key:"_initPage",value:function(){var t=this;this._getCurLocation().then(function(e){t.setState({position:e},function(){t._getPageInfo(),t._newUserRetain()})})}},{key:"_getCurLocation",value:function(){return new Promise(function(t,e){(0,_indexWeapp7.getLocation)().then(function(e){t(location=e)}).catch(function(){e()})})}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__219"),n=this.__state,o=n.isLogin,a=n.requestflag,r=n.headerInfo,i=n.couponFloorInfo,s=n.newUserProductFloorInfo,u=n.pageInfo,c=(n.position,n.isCommonSales,n.commonSalesInfo,n.popupInfo),p=n.hasInflateCoupon,l=n.userSource,n=(n.whiteBarProductFloorInfo,u.coupon,u.product,u.store,u.isShowStore,u.isShowOldUserPage),u=r.vipInfo,i=(u&&this._toExposure(),!i),d=this.productType(),_=d.productShowType,d=d.productInfo,f=!i&&isWeapp?this._createCustomData(e+"TomipJjhMY")():null,m=i?null:this._createBitmapData(e+"oddGlygnsa")(),h=i?null:this._createCouponData(e+"AIoteBztDi")(),g=n?this._createOldUsersData(e+"aTlPmJdtxr")():null,y=u&&!n?this._createBannerData(e+"OELzOkoAMZ")():null,s=!i&&s?this._createProductsData(e+"JZOKTzZEEH")():null,v=i||1!=_&&2!=_?null:this._createCommonSalesData(e+"QLOGrrMLMc")(d),d=i||3!=_?null:this._createTabCommonSalesData(e+"PvoydLEkxT")(d),p=i||p?null:this._createNearbyStoresData(e+"QsfqVtlSms")(),r=!i&&r.recentlyPayInfo&&r.recentlyPayInfo.length?this._createPayInfoRollData(e+"FkGqXzAvCD")():null,S=i?null:this._createDialogData(e+"QkbkLOcTYE")(),c=!i&&c?this._createAssistCouponDialogData(e+"MwhrrcrjPu")():null,e=(0,_index.internal_inline_style)({display:null!==o&&a?"":"none"}),o=(0,_index.internal_inline_style)({display:!i&&u?"":"none"});return i&&_index.propsManager.set({userSource:l},t),Object.assign(this.__state,{anonymousState__temp16:e,anonymousState__temp17:o,$compid__219:t,style:_indexModuleScssMap2.default,defaultPageFlag:i,isWeapp:isWeapp,anonymousState__temp4:f,anonymousState__temp5:m,anonymousState__temp6:h,isShowOldUserPage:n,anonymousState__temp7:g,vipInfo:u,anonymousState__temp8:y,anonymousState__temp9:s,productShowType:_,anonymousState__temp10:v,anonymousState__temp11:d,anonymousState__temp12:p,anonymousState__temp13:r,anonymousState__temp14:S,anonymousState__temp15:c}),this.__state}},{key:"anonymousFunc0",value:function(e){}},{key:"anonymousFunc1",value:function(e){}},{key:"anonymousFunc2",value:function(e){}},{key:"anonymousFunc3",value:function(e){}},{key:"anonymousFunc4",value:function(e){}},{key:"anonymousFunc5",value:function(e){}}]),a}(),_class.$$events=["anonymousFunc0","anonymousFunc3"],_class.multipleSlots=!0,_class.$$componentPath="pages/newPersonB-t/index",_temp2);exports.default=Index,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Index,!0));