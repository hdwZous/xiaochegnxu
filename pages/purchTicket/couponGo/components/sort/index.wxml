<wxs src="../../../../../common/util/tools.wxs" module="tools" />
<view class='sort-filter' aria-role='region' aria-label='排序'>
  <view class='sort-wrapper marL24'>
    <view
      class="log-sort sort-item marR48 {{(item.value == curValue || (item.value == 2 && curValue == 3)) ? 'selected' : ''}}"
      wx:for="{{sortList}}"
      wx:key="index"
      wx:for-item="item"
      id="{{index}}"
      data-store-id="{{storeId}}"
      data-coupon-id="{{couponId}}"
      data-order-type="{{priceType ? 'asc' : 'desc'}}"
      data-sort-type="{{item.value}}"
      data-sort-text="{{item.text}}"
      bindtap="clickSort"
      aria-role='button'
      aria-label="{{(item.value == curValue || (item.value == 2 && curValue == 3)) ? '已选定' : ''}}{{item.title}}{{curValue == 2 && priceType ? '升序' :  curValue == 3 && !priceType ? '降序' : ''}}">
        {{item.title}}
        <block wx:if="{{item.value == '2' ||  item.value == '3'}}">
          <view class="price-triangle">
            <view 
              class='triangle-up' 
              style="border-bottom-color: {{curValue == 2 && priceType ? '#00CF37' : '#999'}}">
            </view>
            <view 
              class='triangle-down'
              style="border-top-color: {{curValue == 3 && !priceType ? '#00CF37' : '#999'}}">
            </view>
          </view>
        </block>
    </view>
  </view>
  <view wx:if="{{filterFloor && filterFloor.length > 0}}" 
        class="log-filter sort-item marR24  {{filterCount ? 'selected' : ''}}" 
        bindtap="clickFilter"
        aria-role='button'
        aria-haspopup="true"
        aria-label="筛选.{{filterCount ? '以选' +  filterCount + '个' : ''}}"
        data-store-id="{{storeId}}"
        data-coupon-id="{{couponId}}">
      筛选
      <image aria-hidden="true" wx:if="{{!filterCount}}" src="https://s.360buyimg.com/wximg/searchAbout/filter.png" />
      <view aria-hidden="true" wx:else class='filter-selected-count'>{{filterCount}}</view>
  </view>
</view>

<view class="content-wrapper"  wx:if="{{sortModal}}">
  <scroll-view scroll-y
              scroll-with-animation 
              scroll-into-view="{{'_' + currentIndex}}"
              catchtouchmove="catchtouchmove" 
              class='filter-wrapper' 
              style="padding-bottom: {{isIpx ? 150 : 100}}rpx; margin-top: {{(capsule.top || 0) + (capsule.height || 0)}}px"  
              wx:if="{{filterFloor.length > 0}}">
    <view class="filter-floor"
      wx:for="{{filterFloor}}"
      wx:for-item="item"
      wx:key="index"
      id="{{'_' + index}}"
      wx:if="{{(item.itemList &&  item.itemList.length >= 1) || item.bizType == 'price' }}"
    >
      <view
        class='fitler-name filter-category'
        data-index="{{index}}" 
        bindtap="switch"
      >
        <view style="display: flex; align-items: flex-end;"
              aria-label="按{{item.filterName}}筛选"
              aria-role='text'>
          <view>
            {{item.filterName}}
          </view>
          <view aria-hidden="true" wx:if="{{item.bizType != 'price'}}" class="filter-type">
            {{item.filterFloorText}}
          </view>
        </view>
        <view class="filter-right"
              aria-label="{{item.selectNames && item.selectNames.length ? '已选择' : ''}}{{tools.arrToStr(item.selectNames)}}{{(item.itemList && item.itemList.length > 12 || index > 2) ? item.showAll ? '.点击收起全部' +  item.filterName : '.点击展开全部' + item.filterName : ''}}"
              aria-role='button'>
          <view aria-hidden="true" class='selected-filter'>{{tools.arrToStr(item.selectNames)}}</view>
          <view aria-hidden="true" class="arrow-area" wx:if="{{item.itemList.length > 12 || index > 2}}">
            <view class="arrow_icon {{item.showAll ? 'arrow_icon_up' : ''}}"></view>
          </view>
        </view>
      </view>
      <view 
        wx:if="{{item.bizType == 'price'}}"
        class="filter-price-wrapper"
      >
        <input
          class="price-item log-filter-item"
          type="number"
          value="{{minValItem.itemValue}}"
          data-item='{{item.itemList[0]}}'
          data-type="min"
          placeholder='最低价'
          placeholder-style="font-size: 24rpx"
          bindinput="priceChange"
          aria-role='input'
          aria-placeholder="最低价"
          aria-label="{{minValItem.itemValue || ''}}"
          data-store-id="{{storeId}}"
          data-coupon-id="{{couponId}}"
          data-user-action="{{item.itemList[0].userAction}}"
          bindtap="clickPriceFloor"
        />
        <view class="price-icon" aria-hidden="true">-</view>
        <input
          class="price-item log-filter-item"
          type="number"
          value="{{maxValItem.itemValue}}"
          data-item='{{item.itemList[1]}}'
          data-type="max"
          placeholder='最高价'
          placeholder-style="font-size: 24rpx"
          bindinput="priceChange"
          aria-role='input'
          aria-placeholder="最高价"
          aria-label="{{maxValItem.itemValue || ''}}"
          data-store-id="{{storeId}}"
          data-coupon-id="{{couponId}}"
          data-user-action="{{item.itemList[1].userAction}}"
          bindtap="clickPriceFloor"
        />
      </view>
      <view class='filter-items' wx:else>
        <view wx:for="{{item.itemList}}" 
              wx:for-item="subItem" 
              wx:for-index="subIndex"
              wx:key="subIndex"
              class="log-filter-item filter-item {{subItem.status ? 'filter-select' : ''}}" 
              hidden="{{subIndex >= item.firstScreenCount && !item.showAll}}" 
              data-item="{{subItem}}"
              data-index="{{index}}"
              data-sub-index="{{subIndex}}"
              data-user-action="{{subItem.userAction}}"
              data-father-filter-name="{{item.filterName}}"
              data-multi="{{item.multi}}"
              bindtap="clickFilterFloor"
              aria-role='button'
              aria-label="{{subItem.status ? '当前已选中' : ''}}{{subItem.itemName}}"
              data-store-id="{{storeId}}"
              data-coupon-id="{{couponId}}">
          {{subItem.itemName}}
        </view>
      </view>
    </view>
  </scroll-view>
  <view wx:else class="no-filter" catchtouchmove="catchtouchmove">没有更多筛选条件了</view>

  <view class='btns' style="bottom: {{isIpx ? '50rpx' : '0'}}">
    <view class="log-reset reset {{(cateList.length || otherfilterList.length) ? 'reset-yes' : 'reset-no'}}" 
          data-store-id="{{storeId}}"
          data-coupon-id="{{couponId}}"
          data-element="filter"
         bindtap="reset"
         aria-role='button'
         aria-label="重置.点击将清空已添加的筛选项">
      重置
    </view>
    <view class="log-confirm check check-yes"
          data-store-id="{{storeId}}"
          data-coupon-id="{{couponId}}"
          data-filter-list="{{totalFilterList}}"
          data-element="filter"
          bindtap="confirm"
          aria-role='button'
         aria-label="查看.点击按照已选筛选项过滤商品">查看</view>
  </view>
  <view wx:if="{{isIpx}}" class='ipx'></view>
</view>

<view class='mask' wx:if="{{sortModal}}" catchtouchmove="catchtouchmove" catchtap="hideFilter" aria-role='button' aria-label='关闭弹层'></view>