"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function n(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}}(),_get=function e(t,s,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,s);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(n):void 0:null!==(i=Object.getPrototypeOf(t))?e(i,s,n):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp2=require("../../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_signIn=require("../../../common-mp/api/signIn.js"),_common=require("../../../common-mp/api/common.js"),_indexWeapp3=require("../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp4=require("../../../npm/@jd/djmp/common-t/js/utils/index.weapp.js"),_indexWeapp5=require("../../../npm/@jd/djmp/common-t/js/epBi/index.weapp.js"),_indexWeapp6=_interopRequireDefault(_indexWeapp5),_indexWeapp7=require("../../../npm/@jd/djmp/common-t/js/env/index.weapp.js"),_utils=require("../../../common-mp/components/TaskListForSignNew/js/utils.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap),_indexWeapp8=require("../../../npm/@jd/djmp/common-t/js/storage/index.weapp.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var isWeapp=!0,HOT_FIX_REPORT={report:function(e,t){},hasOpenPushSettingHandle:function(e){this.report("taskList_hasOpenPushSettingHandle",e)}},TaskListPage=(_temp2=_class=function(){function a(){var e,t;_classCallCheck(this,a);for(var s=arguments.length,n=Array(s),i=0;i<s;i++)n[i]=arguments[i];return(e=t=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(n)))).$usedState=["loopArray7","$compid__124","$compid__125","style","loading","testFlag","forYouIsEmpty","taskListIsEmpty","goodsList","anonymousState__temp","defaultType","defaultTips","defaultBtnTxt","isOpenPushStatus","showPopAminate","superOrderTaskInfo"],t.config={navigationBarBackgroundColor:"#fff",navigationBarTextStyle:"black",navigationBarTitleText:"赚鲜豆"},t.customComponents=["SuperOrderTaskPop","TaskInfo","Default","TaskListNew"],_possibleConstructorReturn(t,e)}return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){var t=this;_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.Exposure=null,this.userAction="",this.state={defaultType:2,defaultTips:"",defaultBtnTxt:"",goodsList:[],forYouIsEmpty:!1,taskListIsEmpty:!1,loading:!0,isOpenPushStatus:0,showPopAminate:!1,superOrderTaskInfo:{},testFlag:!1},this.isFlag=!1,this.$$refs=[{type:"component",id:"KHdzg",refName:"",fn:function(e){return t.childPop=e}},{type:"component",id:"DQxQr",refName:"",fn:function(e){return t.childTaskInfo=e}},{type:"component",id:"YcjFL",refName:"",fn:function(e){return t.childTaskList=e}}]}},{key:"hasOpenPushSettingHandle",value:function(){try{(0,_indexWeapp4.hasOpenPushSetting2)(this.handle.bind(this))}catch(e){HOT_FIX_REPORT.hasOpenPushSettingHandle(e)}}},{key:"handle",value:function(e){var t=this,s=(this.setState({isOpenPushStatus:e}),setInterval(function(){t.childTaskList&&(t.childTaskList.getTaskListData(),t.childTaskList.checkTimeB(),clearInterval(s))},100))}},{key:"setTimeRefresh",value:function(){var e=this,t=setInterval(function(){(0,_utils.getTaskBrowseTime)()?e.setState({needRefreshSecond:e.state.needRefreshSecond++}):clearInterval(t)},1e3)}},{key:"taskListRef",value:function(){var e=this,t=setInterval(function(){e.childTaskList&&(e.childTaskList.getTaskListData(),clearInterval(t))},100)}},{key:"onClosePopUp",value:function(){this.setState({showPopAminate:!1})}},{key:"handleSuperOrderPop",value:function(){this.setState({showPopAminate:!0})}},{key:"bestForYou",value:function(e){var n=this;(0,_signIn.chooseForYou)({longtitude:e.longitude||"",latitude:e.latitude||""}).then(function(e){var t,s;0==e.code&&(t=!0,0<e.result.length&&(t=!1),s=[],s=12<e.result.length?e.result.slice(0,12):e.result,n.setState({goodsList:s,forYouIsEmpty:t}),setTimeout(function(){n.setState({loading:!1})},500))}).catch(function(e){(0,_indexWeapp.showToast)({title:"网络繁忙，请稍后再试！"})})}},{key:"bestForYouEvent",value:function(e){var t=e.params.skuId;(0,_indexWeapp2.jump)({to:e.to,params:{storeId:e.params.storeId||"",skuId:e.params.skuId||"",orgCode:e.params.orgCode||"",needAnchorSku:!0,addCart:!0,isAddCart:!0,needAddCar:!0}}),(0,_indexWeapp3.clickReport)({create_time:new Date,click_id:"ClickChoiceForYou",click_par:{skuId:t}})}},{key:"onShareAppMessage",value:function(e){var t=e.from,s=e.beansource,n=void 0,i=void 0,a=void 0;return"button"===t&&(n=(t=e.target.dataset.params).shareText,i=t.shareUrl,a=t.path),s&&"task"==s&&(0<a.indexOf("?")?a+="&beansource=task":a+="?beansource=task"),{title:n||"鲜豆当钱花",imageUrl:i||"https://img30.360buyimg.com/mobilecms/jfs/t1/65465/34/7772/289742/5d5ba9a2Ededf3e31/d9c6737e7ed4df17.png",path:a||"/pages/tabBar/signIn-t/index"}}},{key:"handleTaskListDataLoaded",value:function(e,t,s,n,i){var a=this;this.setState({taskListIsEmpty:e,superOrderTaskInfo:i}),setTimeout(function(){a.setState({loading:!1})},500)}},{key:"abTest",value:function(){var t=this;(0,_common.abTest)({experimentName:"QuestAffectSigninReward",routingValue:""}).then(function(e){e=e.result,e=(void 0===e?{}:e).strategyName;"ON"!=e&&"OFF"==e||(t.setState({testFlag:!0}),t.setOverflowAttr("hidden"))}).catch(function(e){})}},{key:"updateTaskInfo",value:function(){this.childTaskInfo.getData(!0)}},{key:"setOverflowAttr",value:function(e){}},{key:"callToBottomList",value:function(){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e&&506===e.taskType&&(0,_indexWeapp8.setStorageSync)("v33BuyOneTaskInfo",JSON.stringify(e)),(0,_utils.callNativeClose)()}},{key:"componentDidMount",value:function(){this.Exposure=new _indexWeapp6.default(".content >>> .exposure",this.$scope),this.abTest()}},{key:"componentWillUnmount",value:function(){this.setOverflowAttr("visible")}},{key:"componentDidShow",value:function(){var e,t=this,s=(this.setState({taskListIsEmpty:!1}),_indexWeapp7.isDaojiaApp&&"7.4.5"<=_indexWeapp7.djAppVersion?this.hasOpenPushSettingHandle():e=setInterval(function(){t.childTaskList&&(t.childTaskList.getTaskListData(),t.childTaskList.checkTimeB(),clearInterval(e))},300),setTimeout(function(){t.Exposure&&t.Exposure.initObserver&&t.Exposure.initObserver()},2e3),this.$router.params);s.userAction&&(this.userAction=decodeURIComponent(s.userAction)),s.isBreath&&this.setState({listItemButtonBreath:s.isBreath}),(0,_indexWeapp3.pvReport)({create_time:new Date,page_par:{userAction:this.userAction}})}},{key:"componentDidHide",value:function(){this.setState({taskListIsEmpty:!0}),this.Exposure&&this.Exposure.disconnectObserver&&this.Exposure.disconnectObserver()}},{key:"_createCouponData",value:function(n){var i=this;return function(e){var t=(0,_index.genCompid)(n+"$compid__123"),s=i.state.showPopAminate;return e&&_index.propsManager.set({showPopAminate:s,onClosePopUp:i.onClosePopUp.bind(i),callToBottomList:i.callToBottomList.bind(i),taskInfo:e,taskListRef:i.taskListRef.bind(i),from:1},t),{$compid__123:t,taskInfo:e}}}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__124"),s=(0,_index.genCompid)(e+"$compid__125"),n=this.__state,i=n.goodsList,a=void 0===i?[]:i,i=n.defaultType,o=n.defaultTips,r=n.defaultBtnTxt,p=n.forYouIsEmpty,u=n.taskListIsEmpty,l=(n.loading,n.isOpenPushStatus),d=n.superOrderTaskInfo,c=n.listItemButtonBreath,n=(n.testFlag,this._createCouponData(e+"eHcFzRfjkp")(d)),e=a&&0<a.length?a.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp3:a&&0<a.length?t+"ForYou":null,$original:e.$original}}):[];return p&&u&&_index.propsManager.set({defaultType:i,defaultTips:o,defaultBtnTxt:r,defaultTop:"40px"},t),p&&u||_index.propsManager.set({handleTaskListDataLoaded:this.handleTaskListDataLoaded.bind(this),handleSuperOrderPop:this.handleSuperOrderPop.bind(this),isOpenPushStatus:l,listItemButtonBreath:c,setTimeRefresh:this.setTimeRefresh.bind(this),updateTaskInfo:this.updateTaskInfo.bind(this),callToBottomList:this.callToBottomList.bind(this)},s),Object.assign(this.__state,{loopArray7:e,$compid__124:t,$compid__125:s,style:_indexModuleScssMap2.default,anonymousState__temp:n}),this.__state}}]),a}(),_class.$$events=["bestForYouEvent"],_class.multipleSlots=!0,_class.$$componentPath="pages/signIn-t/taskList/index",_temp2);exports.default=TaskListPage,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(TaskListPage,!0));