"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),_get=function e(t,n,a){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(a):void 0:null!==(i=Object.getPrototypeOf(t))?e(i,n,a):void 0},_index=require("../../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_bean=require("../../../../common-mp/api/bean.js"),_utils=require("../../../../common-mp/components/TaskListForSignNew/js/utils.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap),_indexWeapp=require("../../../../npm/@jd/djmp/common-t/js/env/index.weapp.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var SIGNIN_MODELID="M10001",isWeapp=!0,GOT_DATA={status:!1,getStatus:function(){return this.status},hasGotData:function(){this.status=!0},resetStatus:function(){var e=this;setTimeout(function(){e.status=!1},1e3)}},TaskInfo=(_temp2=_class=function(){function o(){var e,t;_classCallCheck(this,o);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t=_possibleConstructorReturn(this,(t=o.__proto__||Object.getPrototypeOf(o)).call.apply(t,[this].concat(a)))).$usedState=["anonymousState__temp","loopArray98","style","subList","active0","active1","active2","active3","active4","finishedTasks","nextDayUnReceivedAward","styleObj","finishNum","nextDayUnReceivedAwardValue","__fn_apply"],t.customComponents=[],_possibleConstructorReturn(t,e)}return _inherits(o,_index.Component),_createClass(o,[{key:"_constructor",value:function(e){_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_constructor",this).call(this,e),this.state={finishedTasks:0,nextDayUnReceivedAward:0,styleObj:{width:"8%"},active0:"",active1:"",active2:"",active3:"",active4:"",finishNum:0,nextDayUnReceivedAwardValue:0,subList:[]},this.$$refs=[]}},{key:"animate",value:function(){function t(e){var t=e.totleBeanNum,n=e.cb,a=e.gapBySelf,i=e.finisnCb,o=e.numPlus,s=0,r=setInterval(function(){o?(s+=o)<=t-o?n&&n():(clearInterval(r),i&&i()):++s<=t?n&&n():(clearInterval(r),i&&i())},a)}var n,a,p=this,e=this.state,f=e.finishNum,i=e.nextDayUnReceivedAwardValue,d=e.subList,o=0,s=0;t({totleBeanNum:f,cb:function(){p.setState({finishedTasks:++o})},gapBySelf:100,finisnCb:function(){var e=70<i?Math.ceil(i/30):1;t({totleBeanNum:i,cb:function(){s+=e,p.setState({nextDayUnReceivedAward:s+e})},gapBySelf:20,numPlus:e,finisnCb:function(){p.setState({nextDayUnReceivedAward:i})}})}}),setTimeout(function(){var n,a,i,o,s,e,t,r,u,c,l;d&&(Math.max.apply(Math,d.map(function(e){return e.node})),n=d.length,i=a=0,s=!(o=-1),d.forEach(function(e,t){f>e.node?(i=Math.min(n-1,t+1),o=a=t):f==e.node&&(o=t,s=!0)}),e=d[a].node,t=d[i].node,r=92/(n-1),r=s?12+r*o:12+r*(o+(f-e)/(t-e)),u=Math.min(100,Math.floor(r)),c=8,l=setInterval(function(){++c<=u?p.setState({styleObj:{width:c+"%"}}):clearInterval(l)},10))},500);n=0,a=setInterval(function(){var e;d&&(n<d.length&&f>=d[n].node?(e="active"+n,setTimeout(function(){p.setState(_defineProperty({},e,"active"))},333),n++):clearInterval(a))},333)}},{key:"getData",value:function(e){function t(){(0,_bean.taskListInfo)({modelId:SIGNIN_MODELID,plateCode:(0,_utils.getPlateCode)()}).then(function(e){var t,n,e=e.result.taskInfoList.find(function(e){return 311==e.taskType});e&&(t=e.finishNum,n=e.nextDayUnReceivedAwardValue,e=e.subList,a.setState({finishNum:t,nextDayUnReceivedAwardValue:n,subList:e},a.animate.bind(a)))}).catch(function(e){})}var a=this;e?t():GOT_DATA.getStatus()||(GOT_DATA.hasGotData(),GOT_DATA.resetStatus(),t())}},{key:"componentDidHide",value:function(){this.setState({finishedTasks:0,nextDayUnReceivedAward:0,finishNum:0,nextDayUnReceivedAwardValue:0,subList:[],active0:"",active1:"",active2:"",active3:"",active4:""})}},{key:"componentDidShow",value:function(){this.getData()}},{key:"componentDidMount",value:function(){this.getData()}},{key:"componentWillReceiveProps",value:function(e){_indexWeapp.isJDApp&&this.getData()}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};this.$prefix;var e=this.__state,t=(e.finishedTasks,e.styleObj),s=(e.nextDayUnReceivedAward,e.active0,e.active1,e.active2,e.active3,e.active4,e.subList),e=(0,_index.internal_inline_style)(t),t=s?s.map(function(e,t){var n=(e={$original:(0,_index.internal_get_original)(e)}).$original,a=n.node,n=n.prizeValue,i=s.length,t=10+80*t/(i-1),o={left:t+"%"};return{node:a,prizeValue:n,len:i,left:t,positionStyle:o,$loopState__temp3:s?(0,_index.internal_inline_style)(o):null,$original:e.$original}}):[];return Object.assign(this.__state,{anonymousState__temp:e,loopArray98:t,style:_indexModuleScssMap2.default}),this.__state}}]),o}(),_class.$$events=[],_class.$$componentPath="pages/signIn-t/components/TaskInfo/index",_temp2);exports.default=TaskInfo,Component(require("../../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(TaskInfo));