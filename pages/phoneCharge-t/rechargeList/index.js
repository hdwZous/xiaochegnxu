"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_get=function e(t,a,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,a);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(n):void 0:null!==(o=Object.getPrototypeOf(t))?e(o,a,n):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp2=require("../../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp3=require("../../../npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp4=require("../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap),_phoneCharge=require("../api/phoneCharge.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var scopeData={CHINA_MOBILE:"https://storage.360buyimg.com/wximg/phone-charge/CHINA_MOBILE.png",CHINA_UNICOM:"https://storage.360buyimg.com/wximg/phone-charge/CHINA_UNICOM.jpg",CHINA_TELECOM:"https://storage.360buyimg.com/wximg/phone-charge/CHINA_TELECOM.png",31e3:"status_wait",9e4:"status_end",20020:"status_refund",20021:"status_end",20040:"status_end",oldList:[],loadSwitch:!0,pageNo:1},rechargeList=(_temp2=_class=function(){function i(){var e,t;_classCallCheck(this,i);for(var a=arguments.length,n=Array(a),o=0;o<a;o++)n[o]=arguments[o];return(e=t=_possibleConstructorReturn(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(n)))).$usedState=["loopArray15","loopArray16","isLoading","anonymousState__temp","orderList","style","anonymousState__temp4","lastPage","noData","pageSize"],t.config={navigationBarTitleText:"充值记录"},t.customComponents=[],_possibleConstructorReturn(t,e)}return _inherits(i,_index.Component),_createClass(i,[{key:"_constructor",value:function(e){_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_constructor",this).call(this,e),this.state={noData:!1,pageSize:10,orderList:[],lastPage:!1,isLoading:!0},this.$$refs=[]}},{key:"_createData",value:function(){var a=this,n=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix),e=this.__state,t=e.orderList,o=void 0===t?[]:t,t=e.isLoading,e=(e.lastPage,t?this._createLoadingData(n+"AVdUmTmpwT")():null),i=this._createNullData(n+"vxdaKzjzuD")(),t=t?[]:o.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},e={$original:(0,_index.internal_get_original)(e.$original)},{$loopState__temp3:o.length?a._createListData(n+"TNWRnEmRiV"+t+t)(e.$original):null,$loopState__temp6:o.length?"listItem"+t:null,$original:e.$original}}),r=o.length?o.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},e={$original:(0,_index.internal_get_original)(e.$original)},{$loopState__temp3:o.length?a._createListData(n+"TNWRnEmRiV"+t+t)(e.$original):null,$loopState__temp6:o.length?"listItem"+t:null,$original:e.$original}}):[];return Object.assign(this.__state,{loopArray15:t,loopArray16:r,anonymousState__temp:e,style:_indexModuleScssMap2.default,anonymousState__temp4:i}),this.__state}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidShow",value:function(e){(0,_indexWeapp3.getStorageSync)("phoneFromPage");(0,_indexWeapp4.pvReport)({create_time:new Date})}},{key:"componentDidMount",value:function(){var e=this;scopeData.oldList=[],scopeData.loadSwitch=!0,scopeData.pageNo=1,(0,_indexWeapp2.isLogin)().then(function(){e.fetchData()}).catch(function(e){(0,_indexWeapp2.goToLogin)({localTargetUrl:"/pages/phoneCharge-t/rechargeList/index"})})}},{key:"componentDidUpdate",value:function(){}},{key:"_createLoadingData",value:function(e){return function(){return{style:_indexModuleScssMap2.default}}}},{key:"_createNullData",value:function(e){var t=this;return function(){var e=t.state.noData;return{style:_indexModuleScssMap2.default,noData:e}}}},{key:"_createListData",value:function(e){return function(a){return{loopArray17:a.length?a.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp8:a.length?"list"+t:null,$original:e.$original}}):[],style:_indexModuleScssMap2.default,list:a,scopeData:scopeData}}}},{key:"initDate",value:function(e){var e=new Date(e),t=e.getMonth()+1,a=e.getDate(),n=e.getHours(),e=e.getMinutes();return(t=t<10?"0"+t:t)+"-"+(a=a<10?"0"+a:a)+" "+(n=n<10?"0"+n:n)+":"+(e=e<10?"0"+e:e)}},{key:"onPageScroll",value:function(){var e=this.state.lastPage,t=scopeData.pageNo,a=scopeData.loadSwitch;!e&&a&&(scopeData.pageNo=t+1,this.fetchData())}},{key:"goDetail",value:function(e){(0,_indexWeapp.navigateTo)("/pages/phoneCharge-t/rechargeDetail/index?orderId="+e)}},{key:"goToIndex",value:function(){(0,_indexWeapp.navigateTo)("/pages/phoneCharge-t/index")}},{key:"initListData",value:function(e){var t,a=this,n=(scopeData.oldList=scopeData.oldList.concat(e),[]),o={};for(t in scopeData.oldList.forEach(function(e){e.orderDate=a.initDate(e.orderTime),e.month=Number(e.month),e.year=new Date(e.orderTime).getFullYear(),e.month<10&&(e.month="0"+e.month);var t=""+e.year+e.month;o[t]?o[t].push(e):o[t]=[e]}),o)n.unshift(o[t]);this.setState({orderList:n},function(){a.setState({isLoading:!1})})}},{key:"fetchData",value:function(){var t=this,e=((0,_indexWeapp.showLoading)(),this.state.pageSize),a=scopeData.pageNo;(scopeData.loadSwitch=!1,_phoneCharge.rechargeOrderList)({pageNo:a,pageSize:e}).then(function(e){scopeData.loadSwitch=!0,(0,_indexWeapp.hideLoading)(),10==e.result.length?t.initListData(e.result):0==e.result.length&&1==a?t.setState({noData:!0,isLoading:!1}):e.result.length<10&&(t.initListData(e.result),t.setState({lastPage:!0}))}).catch(function(e){scopeData.loadSwitch=!0,(0,_indexWeapp.hideLoading)(),t.setState({isLoading:!1}),(0,_indexWeapp.showToast)({title:e})})}}]),i}(),_class.$$events=["onPageScroll","goToIndex","goDetail"],_class.multipleSlots=!0,_class.$$componentPath="pages/phoneCharge-t/rechargeList/index",_temp2);exports.default=rechargeList,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(rechargeList,!0));