"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o,n=arguments[t];for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),_get=function e(t,o,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,o);return void 0!==a?"value"in a?a.value:void 0!==(a=a.get)?a.call(n):void 0:null!==(a=Object.getPrototypeOf(t))?e(a,o,n):void 0},_index2=require("../../npm/@tarojs/taro-weapp/index.js"),_index3=_interopRequireDefault(_index2),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/openPay/index.weapp.js"),_indexWeapp3=require("../../npm/@jd/djmp/common-t/js/env/index.weapp.js"),_indexWeapp4=require("../../npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp5=require("../../npm/@jd/djmp/common-t/constants/index.weapp.js"),_indexWeapp6=require("../../npm/@jd/djmp/common-t/js/utils/index.weapp.js"),_indexWeapp7=require("../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_phoneCharge=require("./api/phoneCharge.js"),_indexWeapp8=require("../../npm/@jd/djmp/common-t/js/location/index.weapp.js"),_indexWeapp9=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var scopeData={canSubmit:!0,hidePhoneNum:"",throttleFlag:!0,blurCheckFlag:!0,env:"",payType:""},testData={code:"0",msg:"成功",result:[{couponId:1,selection:1,couponType:2,couponCode:"1584375820084HQLjF9793449184-1010629200#1658451138",couponTitle:"妮维雅满388减88",couponTypeDesc:"满减券",availableStatus:!0,state:1,couponDesc:"满388元可用",availableDate:"2020.03.17 00:23-2020.03.18 23:59",couponAmount:"88",amountUnit:"元",payAmount:"55"},{couponId:1,selection:1,couponType:2,couponCode:"1584375820084HQLjF9793449184-1010629200#1658451138",couponTitle:"妮维雅满388减88",couponTypeDesc:"满减券",availableStatus:!0,state:1,couponDesc:"满388元可用",availableDate:"2020.03.17 00:23-2020.03.18 23:59",couponAmount:"88",amountUnit:"元",payAmount:"55"},{couponId:"dafc02ce7158ed1f1b8538bb472227eb",couponAmount:"4.00",couponTitle:"满90减4",selection:3,availableStatus:!1,couponType:1,couponDesc:"满90元可用",couponTypeDesc:"满减券",availableDate:"2020-04-10 14:23:19-2020-04-13 23:59:59",unusableReason:"商品金额不够券门槛"},{couponId:"dafc02ce7158ed1f1b8538bb472227eb",couponAmount:"4.00",couponTitle:"满90减4",selection:3,availableStatus:!1,couponType:1,couponDesc:"满90元可用",couponTypeDesc:"满减券",availableDate:"2020-04-10 14:23:19-2020-04-13 23:59:59",unusableReason:"商品金额不够券门槛"}],success:!0},PhoneCharge=(_temp2=_class=function(){function i(){var e,t;_classCallCheck(this,i);for(var o=arguments.length,n=Array(o),a=0;a<o;a++)n[a]=arguments[a];return(e=t=_possibleConstructorReturn(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(n)))).$usedState=["$compid__130","showPopAminate","style","showWarningFlag","warningTxt","anonymousState__temp","focusFlag","maxlength","phoneNum","errorTips","operator","showClearFlag","anonymousState__temp2","anonymousState__temp3","isRightNum","goodsList","choosed","showInstructionsPop","historyList","showHistoryFlag","anonymousState__temp4","couponInfo","anonymousState__temp5","allHistoryPhoneNum","content","defaultProduct","address","refreshFlag","isNetError","couponId","isRefresh"],t.config={navigationBarTitleText:"手机充值"},t.customComponents=["Pop","PopUp","Coupon"],_possibleConstructorReturn(t,e)}return _inherits(i,_index2.Component),_createClass(i,[{key:"_constructor",value:function(e){var t=this;_get(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"_constructor",this).call(this,e),this.state={phoneNum:"",operator:"",errorTips:"",choosed:{chooseIndex:"",rechargeMoney:0,selectSkuId:""},allHistoryPhoneNum:[],historyList:[],showHistoryFlag:!1,focusFlag:!1,goodsList:[],content:"",defaultProduct:[10,20,30,50,100,200,300,500],showInstructionsPop:!1,address:{},showClearFlag:!1,showWarningFlag:!1,warningTxt:"",refreshFlag:!1,isRightNum:!1,isNetError:!1,maxlength:11,showPopAminate:!1,couponInfo:[],couponId:"",isRefresh:!0},this.$$refs=[{type:"component",id:"nchMd",refName:"",fn:function(e){return t.childPop=e}}]}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.$prefix,t=(0,_index2.genCompid)(e+"$compid__130"),o=this.__state,n=(o.phoneNum,o.errorTips,o.isLogin,o.choosed,o.operator,o.historyList),a=(o.goodsList,o.focusFlag,o.showInstructionsPop),i=o.content,s=(o.showClearFlag,o.showHistoryFlag),r=o.showWarningFlag,c=o.warningTxt,o=(o.refreshFlag,o.isRightNum,o.maxlength,o.showPopAminate,o.couponInfo),r=r&&c?this._createWarningData(e+"YpqNDcvHGU")():null,c=this._createChargeViewData(e+"jeAYVSwBEi")(),p=this._createCouponViewData(e+"eHKjwMVcLN")(),n=n.length&&s?this._createHistoryData(e+"zYDDXrbIzZ")():null,s=0<o.length?this._createCouponData(e+"DPFdEHXeJV")():null;return a&&_index2.propsManager.set({content:i,onPopEvent:this.clsoeInstructions.bind(this)},t),Object.assign(this.__state,{$compid__130:t,style:_indexModuleScssMap2.default,anonymousState__temp:r,anonymousState__temp2:c,anonymousState__temp3:p,anonymousState__temp4:n,anonymousState__temp5:s}),this.__state}},{key:"getTaskListInfo",value:function(){}},{key:"onClosePopUp",value:function(){this.setState({showPopAminate:!1})}},{key:"onShareAppMessage",value:function(e){}},{key:"componentDidMount",value:function(){this.getDeviceInfo()}},{key:"componentDidShow",value:function(){this.initChargeData()}},{key:"initChargeData",value:function(){var i=this;(0,_indexWeapp7.showLoading)(),this.setState({couponId:""}),(0,_indexWeapp.isLogin)().then(function(){i.pvReportFn({islogin:1}),(0,_phoneCharge.rechargeIndex)().then(function(e){var t,o,n,a;(0,_indexWeapp7.hideLoading)(),0==e.code?(n=i.state.phoneNum,t=void 0===(t=(o=e.result).records)?"":t,o=void 0===(o=o.rechargeDesc)?"":o,a="",n?(n=i.trim(n),a=i.addSpace(n),i.fetchData(n)):t&&t.length&&(a=i.addSpace(t[0].phone),i.fetchData(t[0].phone)),i.setState({maxlength:a?13:11,allHistoryPhoneNum:t,content:o,phoneNum:a,operator:t.length&&t[0].city})):201==e.code||202==e.code?((0,_indexWeapp7.showToast)({title:e.msg||"请登录"}),i._goToLogin()):(0,_indexWeapp7.showToast)({title:e.msg||"网络异常"})}).catch(function(e){(0,_indexWeapp7.hideLoading)(),(0,_indexWeapp7.showToast)({title:e.msg||"网络异常"})})}).catch(function(e){(0,_indexWeapp7.hideLoading)(),i.pvReportFn({islogin:0}),i._goToLogin()})}},{key:"pvReportFn",value:function(e){(0,_indexWeapp9.pvReport)({create_time:new Date,page_par:e})}},{key:"clickReportFn",value:function(e,t){(0,_indexWeapp9.clickReport)({create_time:new Date,click_id:e,click_par:t})}},{key:"trim",value:function(e){return e.replace(/\s*/g,"")}},{key:"addSpace",value:function(e){var o;return e&&e.length?(e=e.toString().split(""),o="",e.forEach(function(e,t){o=3==t||7==t?o+" "+e:o+e}),o):""}},{key:"rechargeOrderFn",value:function(){var t,o=this,e=this.state,n=e.isRightNum,a=e.choosed,i=e.phoneNum;scopeData.canSubmit&&n&&(scopeData.canSubmit=!1,t=a.selectSkuId,e=a.rechargeMoney,i=this.trim(i),this.clickReportFn("clickOrder",{OrderAmount:e}),t&&/^[1]([3-9])[0-9]{9}$/.test(i)?(0,_indexWeapp.isLogin)().then(function(){(0,_indexWeapp8.getLocation)().then(function(e){e.cityId=e.cityId||e.areaCode||e.cityCode||0,e.cityName=e.city||e.cityName||"",(0,_indexWeapp4.setStorageSync)("address_info",e),o.setState({address:e||{}},function(){o.submitOrder(i,t)})}).catch(function(){(0,_indexWeapp7.showToast)({title:"获取地理位置有误"})})}).catch(function(){o._goToLogin()}):((0,_indexWeapp7.showToast)({title:t?"请输入正确手机号":"请选择金额"}),scopeData.canSubmit=!0))}},{key:"submitOrder",value:function(e,t){var o=scopeData,n=o.env,o=o.payType,a=(0,_indexWeapp4.getStorageSync)(_indexWeapp5.LOGIN_INFO)||{},i=this.state,s=i.address,i=(i.choosed,{rechargeMobile:e,skuId:t,payChannel:n,fromSource:o,latitude:s.latitude,longitude:s.longitude,cityId:s.cityId});""!=this.state.couponId&&(i.couponId=this.state.couponId),"WECHAT"==n?i=_extends({},i,{openId:a.openId}):_indexWeapp3.isJDApp&&_indexWeapp3.isJDReactNativeWebView&&(e=(0,_indexWeapp6.getQueryString)("reactnative"),i=_extends({},i,{urlParams:"reactnative="+e})),(0,_indexWeapp7.showLoading)(),(0,_phoneCharge.rechargeOrder)(i).then(function(t){var e;(0,_indexWeapp7.hideLoading)(),scopeData.canSubmit=!0,0==t.code?(e={},e="WECHAT"==n?{appid:t.result.wechatPayDTO.appId||"",timestamp:t.result.wechatPayDTO.timestamp||"",noncestr:t.result.wechatPayDTO.nonceStr||"",prepayid:t.result.wechatPayDTO.prepayId||"",signType:t.result.wechatPayDTO.signType||"",sign:t.result.wechatPayDTO.sign||""}:{url:t.result.paymentUrl},(0,_indexWeapp2.openPay)(e).then(function(e){(0,_indexWeapp7.navigateTo)("/pages/phoneCharge-t/payResult/index?orderId="+t.result.orderId)}).catch(function(){(0,_indexWeapp7.navigateTo)("/pages/phoneCharge-t/rechargeDetail/index?orderId="+t.result.orderId)})):101!=t.code&&102==t.code?(0,_indexWeapp7.navigateTo)("/pages/phoneCharge-t/rechargeDetail/index?orderId="+t.result.orderId):(0,_indexWeapp7.showToast)({title:t.msg})}).catch(function(e){(0,_indexWeapp7.hideLoading)(),scopeData.canSubmit=!0,(0,_indexWeapp7.showToast)({title:e.msg||"提单失败"})})}},{key:"goChargeList",value:function(){var t=this;this.clickReportFn("clickOrderList",{}),(0,_indexWeapp.isLogin)().then(function(){(0,_indexWeapp7.navigateTo)("rechargeList/index")}).catch(function(e){t._goToLogin()})}},{key:"getHistoryList",value:function(t){t=this.trim(t);var e=this.state.allHistoryPhoneNum,o=t.length,n=[];0==o?n=e:o<11&&e.forEach(function(e){(e.phone+"").substr(0,o)==t&&n.push(e)}),this.setState({historyList:n,showHistoryFlag:n.length})}},{key:"showInstructions",value:function(){this.clickReportFn("clickTips",{}),this.setState({showInstructionsPop:!0})}},{key:"clsoeInstructions",value:function(){this.setState({showInstructionsPop:!1})}},{key:"onBlurFn",value:function(e){var t=this,o=this.state.phoneNum,n=this.trim(o),a=this.addSpace(n),o=o&&o.length,a={maxlength:13,phoneNum:a},n=/^[1]([3-9])[0-9]{9}$/.test(n),a=_extends({},a,n&&0!=o?{isRightNum:!0}:{goodsList:[],selectSkuId:"",chooseIndex:"",errorTips:0<o?"请输入正确的手机号":"",operator:"",choosed:{chooseIndex:"",rechargeMoney:""},isRightNum:!1});this.setState(a),setTimeout(function(){t.setState({showClearFlag:!1})},100)}},{key:"onFoucsFn",value:function(){var e=this.state.phoneNum,e=this.trim(e);this.setState({maxlength:11,phoneNum:e,showClearFlag:0<e.length}),this.getHistoryList(e)}},{key:"getInputVal",value:function(e){var t=this,o=(e.preventDefault(),this.trim(e.detail.value)),n={showWarningFlag:!1,warningTxt:"",errorTips:"",refreshFlag:!1,showClearFlag:0<o.length};e.detail.keyCode?11<o.length&&8!=e.detail.keyCode?(n=_extends({},n,{focusFlag:!1}),o=o.substr(0,11)):8==e.detail.keyCode&&(n=_extends({},n,{operator:""})):11<o.length&&"deleteContentBackward"!=e.inputType?(n=_extends({},n,{focusFlag:!1}),o=o.substr(0,11)):"deleteContentBackward"==e.inputType&&(n=_extends({},n,{operator:""})),n=_extends({},n,{phoneNum:o}),this.setState(n,function(){11==o.length&&t.fetchData(o)}),this.getHistoryList(o)}},{key:"_throttle",value:function(e,t){scopeData.throttleFlag&&(scopeData.throttleFlag=!1,e.apply(this,arguments),setTimeout(function(){scopeData.throttleFlag=!0},t||1e3))}},{key:"getDeviceInfo",value:function(){var e=0,t="weapp"===(t="weapp")?(e=1,"WECHAT"):_indexWeapp3.isJDApp?_indexWeapp3.isJDReactNativeWebView?(e=2,"JD_RN"):(e=4,"JD_H5"):_indexWeapp3.isDaojiaApp?(e=0,"APP"):(e=3,(0,_indexWeapp3.getH5InWeappFlag)()?"IN_WEAPP_H5":"H5");scopeData=_extends({},scopeData,{payType:e,env:t})}},{key:"fetchData",value:function(t){var o=this,e=scopeData.payType;this.state.choosed;/^[1]([3-9])[0-9]{9}$/.test(t)&&(t=this.trim(t),(0,_indexWeapp7.showLoading)(),(0,_indexWeapp.isLogin)().then(function(){(0,_phoneCharge.rechargeProductInfo)({rechargeMobile:t,fromSource:e}).then(function(e){(0,_indexWeapp7.hideLoading)(),o.handleData(e,t)}).catch(function(e){o.clickReportFn("clickPhoneChange",{PhoneNum:t,Tips:e}),(0,_indexWeapp7.hideLoading)(),(0,_indexWeapp7.showToast)({title:e.msg||"获取商品失败"})})}).catch(function(){(0,_indexWeapp7.hideLoading)(),o._goToLogin()}))}},{key:"handleData",value:function(e,t){var o=this,n=this.state.choosed;if(0==e.code){this.clickReportFn("clickPhoneChange",{PhoneNum:t,Tips:e.result.operator+e.result.city});var t=e.result,a=t.productInfo,a=void 0===a?[]:a,i=t.city,t=t.couponInfo,s=void 0===t?[]:t,t="CHINA_MOBILE"==e.result.operator?i+"移动":"CHINA_UNICOM"==e.result.operator?i+"联通":i+"电信";if(0<a.length){var r="",c=!1;if(s&&0<s.length)for(var p=0;p<s.length;p++){var u=s[p];if(1==u.selection){r=u.payAmount,c=!0,this.setState({couponId:u.couponId});break}}c?this.setState({focusFlag:!1,historyList:[],errorTips:"",operator:t,goodsList:a,showWarningFlag:!1,warningTxt:"",refreshFlag:!1,isRightNum:!0,couponInfo:s,isRefresh:!1}):this.setState({focusFlag:!1,historyList:[],errorTips:"",operator:t,goodsList:a,showWarningFlag:!1,warningTxt:"",refreshFlag:!1,isRightNum:!0,couponInfo:s,isRefresh:!1,couponId:""}),a.length&&a.forEach(function(e,t){e.defaultSelect&&o.setState({choosed:_extends({},n,{chooseIndex:t,selectSkuId:e.skuId,rechargeMoney:r||e.realPrice})})})}else this.setState({focusFlag:!1,historyList:[],errorTips:"",operator:t,goodsList:[],showWarningFlag:!0,isRightNum:!1,warningTxt:"因运营商维护，暂时无法充值",refreshFlag:!1,couponInfo:[],couponId:""})}else-1==e.code||"000001"===e.code?this.setState({focusFlag:!1,historyList:[],operator:"",goodsList:[],isRightNum:!1,errorTips:e.msg,choosed:{rechargeMoney:""},couponInfo:[],couponId:""}):this.setState({focusFlag:!1,historyList:[],errorTips:"",operator:"",goodsList:[],showWarningFlag:!0,isNetError:!0,warningTxt:e.msg||"网络异常",refreshFlag:!0,isRightNum:!1,choosed:{rechargeMoney:""},couponInfo:[],couponId:""})}},{key:"refreshFn",value:function(){var e=this.state.phoneNum,e=this.trim(e);this.fetchData(e)}},{key:"chooseCharge",value:function(e,t,o){var n=this;this.clickReportFn("clickAmountChange",{Amount:t.productName}),this.setState({couponId:""}),(0,_indexWeapp.isLogin)().then(function(){n.fetchCouponData(t,e)}).catch(function(){n._goToLogin()})}},{key:"clearInputNum",value:function(){this.setState({phoneNum:"",errorTips:"",warningTxt:"",showWarningFlag:!1,operator:"",goodsList:[],historyList:[],choosed:{chooseIndex:"",rechargeMoney:""},isRightNum:!1,focusFlag:!0})}},{key:"_goToLogin",value:function(){(0,_indexWeapp.goToLogin)({localTargetUrl:"/pages/phoneCharge-t/index"})}},{key:"deleteHistory",value:function(n,e){var t=this,o=this.state,a=o.allHistoryPhoneNum;o.historyList;this.setState({showHistoryFlag:!1}),"all"==n?this.clickReportFn("clickCleanHistory",{}):this.clickReportFn("clickCleanPhone",{CleanPhoneNum:n}),e.stopPropagation(),_index3.default.showModal({showCancel:!0,content:"all"==n?"确定要删除全部手机号吗？":"确定删除该手机号吗",success:function(e){var o;e.confirm&&("all"==n?((0,_indexWeapp7.showLoading)(),(0,_phoneCharge.rechargeDelRecord)().then(function(e){(0,_indexWeapp7.hideLoading)(),(0,_indexWeapp7.showToast)({title:"删除成功"}),t.clearInputNum(),t.setState({focusFlag:!1,allHistoryPhoneNum:[]})})):(o=0,a.forEach(function(e,t){e.phone==n.phone&&(o=t)}),a.splice(o,1),(0,_indexWeapp7.showLoading)(),(0,_phoneCharge.rechargeDelRecord)({mobile:n.phone}).then(function(e){(0,_indexWeapp7.hideLoading)(),(0,_indexWeapp7.showToast)({title:"删除成功"}),t.setState({allHistoryPhoneNum:a}),(0,_indexWeapp7.hideLoading)()}).catch(function(e){(0,_indexWeapp7.showToast)({title:e.msg||"删除手机号失败"})})))}})}},{key:"closeHistory",value:function(e){e.stopPropagation(),this.setState({focusFlag:!1,historyList:[]})}},{key:"chooseNumber",value:function(e,t){var o=this,t=(t.stopPropagation(),this.addSpace(e.phone)),n=e.city;this.clickReportFn("clickPhoneHistory",{PhoneHistoryNum:e.phone}),this.setState({errorTips:"",maxlength:13,historyList:[],phoneNum:t,operator:n},function(){o.fetchData(e.phone)})}},{key:"_createCouponData",value:function(i){var s=this;return function(){var e=(0,_index2.genCompid)(i+"$compid__131"),t=(0,_index2.genCompid)(i+"$compid__132"),o=s.state,n=o.showPopAminate,a=o.couponInfo,a=void 0===a?[]:a,o=o.isRefresh;return a&&0<a.length&&_index2.propsManager.set({showPopAminate:n,onClosePopUp:s.onClosePopUp.bind(s),title:"优惠券"},e),a&&0<a.length&&_index2.propsManager.set({data:a,isRefresh:o,onClickNoCoupon:s.onClickNoCoupon.bind(s),onClickSelected:s.onClickSelected.bind(s)},t),{$compid__131:e,$compid__132:t,couponInfo:a}}}},{key:"onClickNoCoupon",value:function(e){var t=this.state,o=t.couponInfo,n=void 0===o?[]:o,o=t.goodsList,t=t.choosed;if(e)for(var a=0;a<n.length;a++)1==n[a].selection&&(n[a].selection=2);this.setState({couponInfo:n,isRefresh:!1,couponId:"",choosed:_extends({},t,{chooseIndex:t.chooseIndex,selectSkuId:t.selectSkuId,rechargeMoney:o[t.chooseIndex].realPrice})})}},{key:"onClickSelected",value:function(e,t){for(var o=this.state,n=o.couponInfo,a=void 0===n?[]:n,n=o.choosed,i=0;i<a.length;i++)1==a[i].selection&&(a[i].selection=2);a[e].selection=1,this.clickReportFn("clickCouponList",{CouponAmount_before:n.rechargeMoney,CouponAmount_after:a[e].payAmount}),this.setState({couponInfo:a,isRefresh:!1,couponId:a[e].couponId,choosed:_extends({},n,{chooseIndex:n.chooseIndex,selectSkuId:n.selectSkuId,rechargeMoney:a[e].payAmount})})}},{key:"_createWarningData",value:function(e){var o=this;return function(){var e=o.state,t=e.warningTxt,e=e.isNetError;return{style:_indexModuleScssMap2.default,isNetError:e,warningTxt:t}}}},{key:"fetchCouponData",value:function(s,r){var c=this,e=scopeData.env,p=this.state.choosed;(0,_indexWeapp7.showLoading)(),(0,_phoneCharge.rechargeCounponInfo)({skuId:s.skuId,payChannel:e}).then(function(e){if(0==e.code){var t=e.result,o="",n=!1;if(t&&0<t.length)for(var a=0;a<t.length;a++){var i=t[a];if(1==i.selection){o=i.payAmount,n=!0,c.setState({couponId:i.couponId});break}}n?c.setState({isLogin:!0,isRefresh:!0,couponInfo:t,choosed:_extends({},p,{chooseIndex:r,selectSkuId:s.skuId,rechargeMoney:o||s.realPrice})}):c.setState({isLogin:!0,isRefresh:!0,couponInfo:t,couponId:"",choosed:_extends({},p,{chooseIndex:r,selectSkuId:s.skuId,rechargeMoney:o||s.realPrice})})}else c.setState({isLogin:!0,couponInfo:[],couponId:"",isRefresh:!0,choosed:_extends({},p,{chooseIndex:r,selectSkuId:s.skuId,rechargeMoney:s.realPrice})});(0,_indexWeapp7.hideLoading)()}).catch(function(e){(0,_indexWeapp7.hideLoading)(),c.setState({isLogin:!0,couponInfo:[],couponId:"",isRefresh:!0,choosed:_extends({},p,{chooseIndex:r,selectSkuId:s.skuId,rechargeMoney:s.realPrice})})})}},{key:"_createHistoryData",value:function(e){var o=this;return function(){var e=o.state.historyList;return{loopArray11:e.map(function(e,t){return e={$original:(0,_index2.internal_get_original)(e)},{$loopState__temp7:"history"+t,$loopState__temp9:o.addSpace(e.$original.phone),$original:e.$original}}),style:_indexModuleScssMap2.default,historyList:e}}}},{key:"_createCouponViewData",value:function(t){var o=this;return function(){var e=o._createCouponTextViewData(t+"KBfxvcBkMb")();return{style:_indexModuleScssMap2.default,anonymousState__temp10:e}}}},{key:"_createCouponTextViewData",value:function(e){var n=this;return function(){var e=n.state,t=e.couponInfo,t=void 0===t?[]:t,e=e.goodsList,o=n.getChooseCouponNum();return{anonymousState__temp11:n.getSelectedCouponAmount(),anonymousState__temp16:-1==n.getChooseCouponIndex(),goodsList:e,couponInfo:t,style:_indexModuleScssMap2.default,selectNum:o}}}},{key:"getChooseCouponIndex",value:function(){for(var e=this.state.couponInfo,t=-1,o=0;o<e.length;o++)if(1==e[o].selection){t=o;break}return t}},{key:"getChooseCouponNum",value:function(){for(var e=this.state.couponInfo,t=0,o=0;o<e.length;o++)e[o].availableStatus&&t++;return t}},{key:"getSelectedCouponAmount",value:function(){var e=this.state.couponInfo,t=0;if(e&&0<e.length)for(var o=0;o<e.length;o++){var n=e[o];if(1==n.selection){t=n.couponAmount;break}}return t}},{key:"clickCoupon",value:function(){var e=this.state,t=e.goodsList,o=e.choosed,n=e.phoneNum,e=e.couponInfo,o=o.selectSkuId,n=this.trim(n);o&&/^[1]([3-9])[0-9]{9}$/.test(n)&&(this.clickReportFn("clickCoupon",{}),0<t.length&&e&&0<e.length&&this.setState({isRefresh:!1,showPopAminate:!0}))}},{key:"clickDefault",value:function(){}},{key:"_createChargeViewData",value:function(e){var n=this;return function(){var e=n.state,t=e.choosed,o=e.goodsList,e=e.defaultProduct,t=t.chooseIndex;return{loopArray12:o.length?o.map(function(e,t){return e={$original:(0,_index2.internal_get_original)(e)},{$loopState__temp13:o.length?"money"+t:null,$original:e.$original}}):[],loopArray13:e.map(function(e,t){return{$loopState__temp15:"defaultM"+t,$original:(e={$original:(0,_index2.internal_get_original)(e)}).$original}}),style:_indexModuleScssMap2.default,chooseIndex:t,goodsList:o,defaultProduct:e}}}},{key:"handleLocation",value:function(){var t=this;(0,_indexWeapp8.getLocation)().then(function(e){e.cityId=e.cityId||e.areaCode||e.cityCode||0,e.cityName=e.city||e.cityName||"",(0,_indexWeapp4.setStorageSync)("address_info",e),t.setState({address:e||{}})}).catch(function(e){(0,_indexWeapp7.showToast)({title:"有地址才能参加哦~"})})}}]),i}(),_class.$$events=["getInputVal","onBlurFn","onFoucsFn","clearInputNum","rechargeOrderFn","showInstructions","goChargeList","refreshFn","closeHistory","chooseNumber","deleteHistory","clickCoupon","chooseCharge","clickDefault"],_class.multipleSlots=!0,_class.$$componentPath="pages/phoneCharge-t/index",_temp2);exports.default=PhoneCharge,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(PhoneCharge,!0));