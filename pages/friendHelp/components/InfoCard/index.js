"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(o):void 0:null!==(i=Object.getPrototypeOf(t))?e(i,n,o):void 0},_index=require("../../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_indexWeapp2=require("../../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp3=require("../../../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp4=require("../../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_goToByCouponWeapp=require("../../../../npm/@jd/djmp/common-t/js/utils/goToByCoupon.weapp.js"),_indexWeapp5=require("../../../../npm/@jd/djmp/common-t/js/location/index.weapp.js"),_friendHelp=require("../../api/friendHelp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}_temp2=_class=function(){function a(){var e,t;_classCallCheck(this,a);for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(o)))).$usedState=["anonymousState__temp","data","style","logoImg","flagImgUrl","freindList","day","hour","minute","second","millisecond","timer","toggle","heightAuto","refresh"],t.customComponents=[],_possibleConstructorReturn(t,e)}return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.state={day:"00",hour:"00",minute:"00",second:"00",millisecond:"00",timer:null,toggle:!0,heightAuto:!0,refresh:!0},this.loadMoreFriends=this.loadMoreFriends.bind(this),this.toUse=this.toUse.bind(this),this.$$refs=[]}},{key:"_createData",value:function(){var t=this,e=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix,this.__props.data),e=void 0===e?{}:e,n="",o=(e.brandLogo?n=e.brandLogo:e.sugStoreInfoVO&&e.sugStoreInfoVO.logo&&(n=e.sugStoreInfoVO.logo),e.friendHelpUserVOList&&0<e.friendHelpUserVOList.length?e.friendHelpUserVOList:[]),i="",a=(3==e.helpStatus?i="https://storage.360buyimg.com/wximg/friendhelp/newFlagFalse.png":4==e.status?i="https://storage.360buyimg.com/wximg/friendhelp/newFlagNone.png":2==e.helpStatus&&1==e.leader&&(i="https://storage.360buyimg.com/wximg/friendhelp/newFlagSuccess.png"),1==e.leader?Number(e.takeCount)+Number(e.alreadyTakeCount)||0:null);return this.anonymousFunc0=function(e){return t.clickCoupon(e)},this.anonymousFunc1=function(){return t.onClickBtn()},Object.assign(this.__state,{anonymousState__temp:a,data:e,style:_indexModuleScssMap2.default,logoImg:n,flagImgUrl:i,freindList:o}),this.__state}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.timer)}},{key:"componentDidMount",value:function(){var e=this.props.data;this.state.refresh&&e&&e.groupRemainTime&&(this.initCountDown(),this.setState({refresh:!1}))}},{key:"clickCoupon",value:function(){var e=this.props.data||{};1==e.helpStatus?this.onClickShare():2==e.helpStatus&&1==e.leader&&this.toUse(e)}},{key:"onClickBtn",value:function(){var e=this.props.data,t=this.getPageType(e);switch(e.buttonId){case 2:this.toUse(e);break;case 3:this.goHome(),this.clickDataReport("to_home",{type:t});break;case 4:this.goToFriendHelpList(),this.clickDataReport("ClickLaunchNew",{type:2});break;case 5:this.helpJudge(),this.clickDataReport("ClickHelpFriend",{activityId:e.activityId,groupId:e.groupId});break;case 6:this.getFreeCoupon(e),this.clickDataReport("clickFreego",{is_layer:0,group_id:e.groupId,activityId:e.activityId});break;case 7:this.onClickShare();break;case 8:this.clickDataReport("clickFreego",{origin:e.leader,is_layer:0}),this.goToFriendHelpList();break;case 9:this.props.onHelpFriend("helpSelf")}}},{key:"getFreeCoupon",value:function(e){e.helperSendEnable?this.launchFriend(e):this.goToFriendHelpList()}},{key:"launchFriend",value:function(n){var o=this;(0,_indexWeapp4.showLoading)(),(0,_friendHelp.LaunchOrJoinFriendHelp)({activityId:n.activityId}).then(function(e){(0,_indexWeapp4.hideLoading)();var t=e.result,t=void 0===t?{}:t;"0"==e.code&&t.groupId?(e=n.activityId||"",t=t.groupId||"",(0,_indexWeapp4.navigateTo)("/pages/friendHelp/launch/index?from=list&activityId="+e+"&groupId="+t)):o.goToFriendHelpList()}).catch(function(e){(0,_indexWeapp4.hideLoading)(),o.goToFriendHelpList()})}},{key:"helpJudge",value:function(e){var t=this;(0,_indexWeapp3.isLogin)().then(function(){t.props.onHelpFriend()}).catch(function(){var e=t.$router.params,e="/pages/friendHelp/launch/index?from="+e.from+"&activityId="+e.activityId+"&groupId="+e.groupId;(0,_indexWeapp3.goToLogin)(e)})}},{key:"goHome",value:function(){(0,_indexWeapp.jump)({to:"home"})}},{key:"onGoBack",value:function(){(0,_indexWeapp.jump)({to:"back"})}},{key:"goToFriendHelpList",value:function(){"list"===this.$router.params.from?(0,_indexWeapp4.navigateBack)():(0,_indexWeapp4.navigateTo)("/pages/friendHelp/list/index")}},{key:"onGoToMyCouponList",value:function(){(0,_indexWeapp.jump)({to:"myCoupon"})}},{key:"loadMoreFriends",value:function(){this.setState({toggle:!this.state.toggle})}},{key:"toUse",value:function(t){(0,_indexWeapp2.clickReport)({click_id:"ClickRedPacket",click_par:{origin:1}});var n=t.couponGo||{};(0,_indexWeapp5.getLocation)().then(function(e){(0,_goToByCouponWeapp.goToByCouponId)({couponId:n.couponId||t.couponId||"",longitude:e.longitude,latitude:e.latitude,cityId:e.cityId,defaultJump_:"home"})}).catch(function(e){})}},{key:"initCountDown",value:function(){var e=this.props.data;void 0!==e.groupId?e.groupRemainTime&&0<e.groupRemainTime&&this.showCountDown(e.groupRemainTime):e.remainTimeByEnd&&0<e.remainTimeByEnd&&this.showCountDown(e.remainTimeByEnd)}},{key:"millisecondCountDown",value:function(i,a){var r=setInterval(function(){var e=0,t=0,n=0,o=0;0<i&&(e=Math.floor(i/1e3/60/60),t=Math.floor(i/1e3/60%60),n=Math.floor(i/1e3%60),o=Math.floor(i%1e3/100)),e<=9&&(e="0"+e),t<=9&&(t="0"+t),n<=9&&(n="0"+n),a(0<i?{hour:e,minute:t,second:n,millisecond:o,timer:r,end:!1}:{hour:"00",minute:"00",second:"00",millisecond:"00",timer:r,end:!0}),i-=100},100)}},{key:"showCountDown",value:function(e){var t=this;this.millisecondCountDown(e,function(e){e.end?(t.setState({hour:"00",minute:"00",second:"00",millisecond:e.millisecond,timer:null}),clearInterval(t.state.timer),t.props.onRefreshPage()):t.setState({hour:e.hour,minute:e.minute,second:e.second,millisecond:e.millisecond,timer:e.timer})})}},{key:"getPageType",value:function(e){var t,n;return e?(t=null,7==e.buttonId||8==e.buttonId?t="参与成功":2==e.helpStatus?t="助力成功":3==e.helpStatus?t="助力失败":3==e.status?t="活动已结束":4==e.status?t="券已抢光":1===e.failCause?t="参团失败1":2===e.failCause||3===e.failCause?t="参团失败2":(n=0,e.friendHelpUserVOList.map(function(e){e.nickName&&n++}),n==e.totalMemberNum&&(t="助力人数已满")),t):""}},{key:"onClickShare",value:function(){var e=this.props.data||{};this.props.onOpenShare&&1==e.leader&&this.props.onOpenShare(),(0,_indexWeapp2.clickReport)({create_time:new Date,click_id:"ClickInviteFriend",click_par:{is_layer:0}})}},{key:"goToFriendHelpList",value:function(){"list"===(this.$router.params.from||"")?(0,_indexWeapp4.navigateBack)():(0,_indexWeapp4.navigateTo)("/pages/friendHelp/list/index")}},{key:"clickDataReport",value:function(e,t){(0,_indexWeapp2.clickReport)({create_time:new Date,click_id:e,click_par:t})}},{key:"anonymousFunc0",value:function(e){}},{key:"anonymousFunc1",value:function(e){}}]),a}(),_class.$$events=["anonymousFunc0","onClickShare","anonymousFunc1","loadMoreFriends"],_class.options={addGlobalClass:!0},_class.$$componentPath="pages/friendHelp/components/InfoCard/index";var InfoCard=_temp2;exports.default=InfoCard,Component(require("../../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(InfoCard));