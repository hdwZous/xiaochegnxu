"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}(),_get=function e(t,i,o){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);return void 0!==a?"value"in a?a.value:void 0!==(a=a.get)?a.call(o):void 0:null!==(a=Object.getPrototypeOf(t))?e(a,i,o):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_utilsWeapp=require("../common/utils.weapp.js"),_friendHelp=require("../api/friendHelp.js"),_indexWeapp2=require("../../../npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp3=require("../../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_indexWeapp4=require("../../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp5=require("../../../npm/@jd/djmp/common-t/constants/index.weapp.js"),_indexWeapp6=require("../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp7=require("../../../npm/@jd/djmp/common-t/js/wxcode/index.weapp.js"),_indexWeapp8=require("../../../npm/@jd/djmp/common-t/js/location/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var startTime=Date.now(),isReportPerformance=!1,timerout=void 0,secTopPos=0,secList3Pos=0,screenHeight=0,currentScrollPos=0,addressInfo={},Detail=(_temp2=_class=function(){function a(){var e,n;_classCallCheck(this,a);for(var t=arguments.length,i=Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=n=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(i)))).$usedState=["anonymousState__temp","$compid__27","$compid__28","$compid__29","$compid__30","$compid__31","$compid__32","$compid__33","$compid__34","$compid__35","$compid__36","$compid__37","showDefault","userIsLogin","helperUserFeature","style","locationError","isGroupLeader","isActiveOldUserLaunch","isGroupValid","result","silenceOldUserHelpIsSuccess","mpSourceData","activeOldUserHelpIsSuccess","hotProducts","listArr","isShowOldUserDialog","showSelfHelpPop","logoImg","defaultType","defaultTips","defaultBtnTxt","pageParams","from","showRulePop","userRightsResps","remainCouponUseTime","showNewPersonLayer","showSeckill","showHelpCouponDia","refreshList","helperJoinMsg","currentPage"],n.config={navigationBarTitleText:"京东到家",navigationBarBackgroundColor:"#fff",navigationBarTextStyle:"black",usingComponents:{"location-default":"/components-b/locationDefault/index","back-to-app":"/components/backToApp/index"}},n.jumpLogin=function(t){(0,_indexWeapp.showLoading)(),(0,_indexWeapp4.isLogin)().then(function(){var e=(0,_indexWeapp2.getStorageSync)("address_info");e.latitude&&e.longitude&&e.cityId?(0,_indexWeapp7.getWxCode)().then(function(e){n.autoJoin(!0,t,e)}).catch(function(){}):n.handleLocation(t),n.setState({userIsLogin:!0}),(0,_indexWeapp.hideLoading)()}).catch(function(e){n.setState({userIsLogin:!1}),n.getFriendHelpDetailInfo(!0,t),(0,_indexWeapp.hideLoading)()})},n.autoJoin=function(o,e,t){(0,_indexWeapp.showLoading)();var a=e.activityId||"",s=e.groupId||"",e=(0,_indexWeapp2.getStorageSync)(_indexWeapp5.LOGIN_INFO)||{},i=(0,_indexWeapp2.getStorageSync)("wxGroupId")||"",i=s+","+(e.openId||"")+","+i+","+(t||"");(0,_friendHelp.autoJoinHelp)({activityId:a||"",groupId:s||"",nickName:e.nickname||"",nickHeadUrl:e.avatar||"",openId:e.openId||"",wcUnionId:e.unionid_pdj_jd_new||"",formId:"",encodeData:(0,_utilsWeapp.encrypt)(i)||""}).then(function(e){var t,i=e.result,e=!0,e=(1==i.helperUserFeature||2==i.helperUserFeature||3==i.helperUserFeature)&&i.isGroupValid;n.setState({isGroupValid:e}),0==e?n.getFriendHelpDetailInfo(o,{activityId:a,groupId:s}):(n.setState({isGroupLeader:i.isGroupLeader||"",helperUserFeature:i.helperUserFeature||"",helperJoinMsg:i.helperJoinMsg,helperSendActivityId:i.helperSendActivityId,helperSendGroupId:i.helperSendGroupId,to:i.to,params:i.params}),1==i.helperUserFeature&&(0,_indexWeapp.redirectTo)(i.params.url),"0"==i.helperJoinCode&&2==i.helperUserFeature&&n.setState({activeOldUserHelpIsSuccess:!0}),"0"!=i.helperJoinCode&&2==i.helperUserFeature&&n.setState({activeOldUserHelpIsSuccess:!1}),"0"==i.helperJoinCode&&3==i.helperUserFeature&&n.setState({silenceOldUserHelpIsSuccess:!0}),"0"!=i.helperJoinCode&&3==i.helperUserFeature&&n.setState({activeOldUserHelpIsSuccess:!1}),t=!(e={}),2==i.helperUserFeature&&(i.helperSendActivityId||i.helperSendGroupId?(e={activityId:i.helperSendActivityId,groupId:i.helperSendGroupId},n.getFriendHelpDetailInfo(o,e,i.helperUserFeature),n.setState({isActiveOldUserLaunch:!0}),t=!0):(n.setState({isActiveOldUserLaunch:!1}),t=!1,"0"!=i.helperJoinCode&&setTimeout(function(){(0,_indexWeapp.showToast)({title:i.helperJoinMsg})},2e3),n.getFriendHelpDetailInfo(o,e={activityId:a,groupId:s},i.helperUserFeature)),1==t&&n.getFriendHelpList(1)),1!=i.isGroupLeader&&3!=i.helperUserFeature||n.getFriendHelpDetailInfo(o,e={activityId:a,groupId:s},i.helperUserFeature),1!=i.isGroupLeader&&(2==i.helperUserFeature&&1==t&&n.setState({isShowOldUserDialog:!0}),2!=i.helperUserFeature||0!=t)||n.setState({isShowOldUserDialog:!1})),(0,_indexWeapp.hideLoading)()}).catch(function(e){})},n.goToHome=function(){(0,_indexWeapp3.jump)({to:"home"})},n.toLogin=function(){var e=n.$router.params,t=e.activityId,e=e.groupId;(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickHelp",click_par:{}}),(0,_indexWeapp4.goToLogin)({localTargetUrl:"/pages/friendHelp/detail/index?activityId="+t+"&groupId="+e})},n.closeHelpCouponDia=function(){n.setState({showHelpCouponDia:!1})},n.closeOldUserDialog=function(){n.setState({isShowOldUserDialog:!1})},n.customComponents=["Default","Marquee","SilentOldUserCoupon","MpSource","InfoCard","NewUser","NearbyShop","Title","ListAll","OldUserDialog","Pop","SubscribeMessage"],_possibleConstructorReturn(n,e)}return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){var t=this;_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.data={storeIds:[],orgCodes:[]},this.state={locationError:"",showDefault:!0,defaultType:0,defaultTips:"",defaultBtnTxt:"",pageParams:{},from:"",showRulePop:!1,result:{},userRightsResps:[],remainCouponUseTime:0,showSelfHelpPop:!1,showNewPersonLayer:!1,mpSourceData:{},hotProducts:[],showSeckill:!1,showHelpCouponDia:!0,isGroupValid:"",userIsLogin:"",listArr:[],refreshList:!0,isGroupLeader:"",isShowOldUserDialog:"",isActiveOldUserLaunch:"",helperUserFeature:"",activeOldUserHelpIsSuccess:"",silenceOldUserHelpIsSuccess:"",helperJoinMsg:"",currentPage:1},this.$$refs=[{type:"component",id:"rqbDm",refName:"",fn:function(e){return t.childSubscribe=e}}]}},{key:"_createData",value:function(){var t=this,e=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix),i=(0,_index.genCompid)(e+"$compid__27"),o=(0,_index.genCompid)(e+"$compid__28"),a=(0,_index.genCompid)(e+"$compid__29"),s=(0,_index.genCompid)(e+"$compid__30"),n=(0,_index.genCompid)(e+"$compid__31"),r=(0,_index.genCompid)(e+"$compid__32"),p=(0,_index.genCompid)(e+"$compid__33"),c=(0,_index.genCompid)(e+"$compid__34"),d=(0,_index.genCompid)(e+"$compid__35"),l=(0,_index.genCompid)(e+"$compid__36"),e=(0,_index.genCompid)(e+"$compid__37"),u=this.__state,h=u.result,g=u.showDefault,_=u.defaultBtnTxt,f=u.showRulePop,m=(u.showSelfHelpPop,u.defaultType),y=u.defaultTips,S=u.locationError,I=u.mpSourceData,v=u.userRightsResps,v=void 0===v?[]:v,x=(u.remainCouponUseTime,u.secIsTop,u.hotProducts),x=void 0===x?[]:x,k=(u.showSeckill,u.showHelpCouponDia,u.userIsLogin),b=u.listArr,w=(u.refreshList,u.helperUserFeature),C=u.isShowOldUserDialog,T=u.activeOldUserHelpIsSuccess,D=u.silenceOldUserHelpIsSuccess,W=u.helperJoinMsg,L=u.isActiveOldUserLaunch,P=u.isGroupLeader,H=u.isGroupValid,u=(u.currentPage,this.data),u=(u.storeIds,u.orgCodes,""),U=(h.brandLogo?u=h.brandLogo:h.sugStoreInfoVO&&h.sugStoreInfoVO.logo&&(u=h.sugStoreInfoVO.logo),this.anonymousFunc0=function(e){return t.toMyHelpList(e)},b&&0<b.length&&k?!this.__state.refreshList:null);return g&&!S&&_index.propsManager.set({defaultType:m,defaultTips:y,defaultBtnTxt:_,onDefaultEvent:this.onDefaultEvent.bind(this)},i),!g&&k&&(1==P||1==L||3==w||0==H)&&h.wonList&&0<h.wonList.length&&_index.propsManager.set({data:h.wonList},o),!g&&k&&1==H&&3==w&&5!==h.buttonId&&_index.propsManager.set({result:h,userRightsResps:v},a),!g&&k&&1==H&&3==w&&5!==h.buttonId&&I.imgUrl&&_index.propsManager.set({sourceData:I,needClickSource:!0},s),!g&&k&&(1==P||2==w&&1==L||0==H)&&_index.propsManager.set({data:h,type:"detail",onOpenShare:this.onClickShareSubscribe.bind(this),onHelpFriend:this.getCode2Help.bind(this),onRefreshPage:this.getFriendHelpDetailInfo.bind(this,!1)},n),!g&&k&&0==P&&(0==H||3==w||2==w&&0==L)&&x.length&&5!==h.buttonId&&_index.propsManager.set({goodList:x},r),!g&&k&&0==P&&(0==H||3==w||2==w&&0==L)&&h.nearbyStores&&h.nearbyStores.length&&_index.propsManager.set({nearbyStores:h.nearbyStores},p),!g&&k&&b&&0<b.length&&_index.propsManager.set({titleName:"更多优惠券等你来抢"},c),!g&&k&&b&&0<b.length&&_index.propsManager.set({list:b,onClickCard:this.onClickCard.bind(this),onShareSubscribEvent:this.onClickShareSubscribe.bind(this),refreshList:U,isExposure:!0},d),!g&&k&&1==H&&C&&_index.propsManager.set({result:h,helperUserFeature:w,closeOldUserDialog:this.closeOldUserDialog,activeOldUserHelpIsSuccess:T,silenceOldUserHelpIsSuccess:D,helperJoinMsg:W,userRightsResps:v},l),!g&&k&&_index.propsManager.set({isShow:f,onPopEvent:this.onPopEvent.bind(this)},e),Object.assign(this.__state,{anonymousState__temp:U,$compid__27:i,$compid__28:o,$compid__29:a,$compid__30:s,$compid__31:n,$compid__32:r,$compid__33:p,$compid__34:c,$compid__35:d,$compid__36:l,$compid__37:e,style:_indexModuleScssMap2.default,logoImg:u}),this.__state}},{key:"componentDidShow",value:function(){var e=this.$router.params,t=e.scene,i={},o=_index2.default.getApp();t?30<=t.length&&(i={activityId:t.substr(0,15),groupId:t.substr(15,15),channel:t.substr(30,t.length-30)||""},o.globalData.qrcode.business=23):i=e,e&&e.channel&&(o.globalData.qrcode.channel=e.channel),o.globalData.qrcode.business=e.business||23,(0,_indexWeapp6.pvReport)({create_time:new Date,page_par:{activityId:i.activityId||"",group_id:i.groupId||"",sceneId:i.sceneId||"",materialId:i.materialId||"",experimentName:i.experimentName||"",strategyName:i.strategyName||"",tempId:i.tempId||""}}),(0,_indexWeapp6.clickReport)({click_id:"clickwechatfriendhelp",create_time:new Date,click_par:{sceneId:e.sceneId||"",materialId:e.materialId||"",experimentName:e.experimentName||"",strategyName:e.strategyName||"",tempId:e.tempId||"",activityId:i.activityId||"",group_id:i.groupId||""}}),this.setState({pageParams:i}),this.handleLocation(i)}},{key:"toMyHelpList",value:function(){(0,_indexWeapp4.isLogin)().then(function(){(0,_indexWeapp.navigateTo)("/pages/friendHelp/myList/index")}).catch(function(e){(0,_indexWeapp4.goToLogin)({localTargetUrl:"/pages/friendHelp/list/index"})})}},{key:"handleLocation",value:function(t){var i=this;(0,_indexWeapp8.getLocation)().then(function(e){e.cityId=e.cityId||e.areaCode||e.cityCode||"",e.cityName=e.city||e.cityName||"",addressInfo={longitude:e.longitude,latitude:e.latitude,cityId:e.cityId,cityName:e.cityName,countyName:e.district,poi:e.poi,adcode:e.adcode},e.longitude?(i.getHeadSource(addressInfo),i.jumpLogin(t)):i.getLocationError()}).catch(function(e){i.getLocationError(e),i.getHeadSource()})}},{key:"componentWillMount",value:function(){startTime=Date.now(),isReportPerformance=!0,this.setState({showHelpCouponDia:!0})}},{key:"getLocationError",value:function(e){e?this.setState({showDefault:!0,locationError:e}):this.setState({showDefault:!0,locationError:"",defaultType:1,defaultTips:"定位才能参与活动哦，立即授权抢免费红包！",defaultBtnTxt:"授权位置"})}},{key:"onShareAppMessage",value:function(e){var t=this.state.result,i=t.activityId,i=void 0===i?"":i,o=t.groupId,o=void 0===o?"":o,a=t.sceneId,a=void 0===a?"":a,s=t.materialId,s=void 0===s?"":s,n=t.tempId,n=void 0===n?"":n,r=t.shareAb,r=void 0===r?{}:r,p=t.shareText,p=void 0===p?"":p,c=t.name,c=void 0===c?"":c,d=t.shareUrl,d=void 0===d?"":d,l=t.imageUrl,l=void 0===l?"":l,t=t.leader,t=void 0===t?"":t,u=(this.addShareNum(),"13"),h="ClickWechatOriginShare";return"button"==e.from&&(u="14",h="ClickShareFriend"),this.clickDataReport(h,{origin:t}),{title:p||c||"来帮好友助力吧~",imageUrl:d||l||"",path:"/pages/friendHelp/detail/index?activityId="+i+"&groupId="+o+"&channel="+u+"&sceneId="+a+"&materialId="+s+"&tempId="+n+"&strategyName="+r.strategyName+"&experimentName="+r.experimentName}}},{key:"getFriendHelpDetailInfo",value:function(a,e,s){var n=this,t=this.state,r=t.isGroupValid,p=t.userIsLogin,c=e||this.state.pageParams,d=((0,_indexWeapp.showLoading)(),Date.now());(0,_friendHelp.getFriendHelpDetail)({activityId:c.activityId||"",groupId:c.groupId||""}).then(function(e){(0,_indexWeapp.hideLoading)();var i,t,e=e.result||{},o=0;e&&e.activityId?(i=Date.now(),2!==e.helpStatus&&3!==e.helpStatus&&4!==e.status||1!=e.leader||!e.toast||0!=r||1!=p||(0,_indexWeapp.showToast)({title:e.toast}),3===e.status&&0==r&&(e.toastTitle=e.toastTitle||"活动已结束"),2===e.activityType?n.resolveFrom(!0):n.resolveFrom(!1),1!=e.helpStatus&&2!=e.status||1!=e.leader||n.selfJoinShowPop(e),n.data={storeIds:e.storeIds||[],orgCodes:e.orgCodes||[]},3==s&&e.userRightsResps&&0<e.userRightsResps.length&&n.setState({isShowOldUserDialog:!0}),n.setState({result:e,userRightsResps:e.userRightsResps||[],remainCouponUseTime:e.remainCouponUseTime||0,hotProducts:e.hotProducts||[],showDefault:!1},function(){var e,t;isReportPerformance&&((e=_index2.default.getApp()).reportPerformance(1013,t=i-d),t=Date.now()-startTime-t,e.reportPerformance(2014,t),isReportPerformance=!1)})):(o=1,n.setState({showDefault:!0,defaultType:2,defaultTips:"活动被挤爆啦，稍后再试哦～"})),a&&(t=[],(e.userRightsResps||[]).forEach(function(e){t.push({couponType:e.couponRightsType,couponId:e.couponResp.couponId})}),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"pvReport",click_par:{activityId:e.activityId||c.activityId||"",group_id:e.groupId||c.groupId||"",from:n.state.from||"",is_default:o,type:n.getPageType(e),origin:e.leader||"",source:e.activityType||"",sceneId:c.sceneId||"",materialId:c.materialId||"",experimentName:c.experimentName||"",strategyName:c.strategyName||"",tempId:c.tempId||"",sku:e.hotProducts&&0<e.hotProducts.length?1:0,store:e.nearbyStores&&0<e.nearbyStores.length?1:0,eventstatus:e.status||"",helpstatus:e.helpStatus||"",couponInfo:t}}))}).catch(function(e){(0,_indexWeapp.hideLoading)(),n.setState({showDefault:!0,defaultType:3,defaultTips:e.msg||e.code?e.msg+"（"+e.code+"）":"暂未获取到助力券信息，稍后重试～"})})}},{key:"getFriendHelpList",value:function(o){var a=this;(0,_friendHelp.getFriendHelpList)({currentPage:o,dataSize:10,latitude:addressInfo.latitude,longitude:addressInfo.longitude,cityId:addressInfo.cityId}).then(function(e){var t=1===o?[]:a.state.listArr,e=e.result,e=e&&e.friendHelpVOList||[],i=a.state.refreshList;a.setState({listArr:t.concat(e),currentPage:++o,refreshList:!i})}).catch(function(e){})}},{key:"sleep",value:function(e){for(var t=new Date,i=t.getTime()+e;;)if((t=new Date).getTime()>i)return}},{key:"onClickShareSubscribe",value:function(){var e=this.state.result.activityId,t=void 0===e?"":e,i=(this.sleep(1500),[]);try{i=(0,_indexWeapp2.getStorageSync)("cutShareInfo")}catch(e){}if(i){for(var o=!1,a=0;a<i.length;a++)if(i[a].activityId==t){o=!0;break}o||(i.push({activityId:t}),(0,_indexWeapp2.setStorageSync)("cutShareInfo",i),this.childSubscribe.initSubscribeMessage(["iwJcSNrbfOXKnfhoi4tEJvC1AnVWoNj1R8D8FSctMs0","3zzStxd9r5oOQ0N569D5l-cJ6OYj1E3QHb095rCRvSs","aUUy2JkJeivLJJCEPOMuM_fsywgjhNjdN4ryMeWYcsw"]))}else(i=[]).push({activityId:t}),(0,_indexWeapp2.setStorageSync)("cutShareInfo",i),this.childSubscribe.initSubscribeMessage(["iwJcSNrbfOXKnfhoi4tEJvC1AnVWoNj1R8D8FSctMs0","3zzStxd9r5oOQ0N569D5l-cJ6OYj1E3QHb095rCRvSs","aUUy2JkJeivLJJCEPOMuM_fsywgjhNjdN4ryMeWYcsw"])}},{key:"getCode2Help",value:function(t){var i=this;(0,_indexWeapp7.getWxCode)().then(function(e){i.helpFriendGetCoupon(t,e)}).catch(function(){})}},{key:"helpFriendGetCoupon",value:function(t,e){var i=this,o=this.state.pageParams,a=o.activityId||"",o=o.groupId||"",s=(0,_indexWeapp2.getStorageSync)(_indexWeapp5.LOGIN_INFO)||{},n=(0,_indexWeapp2.getStorageSync)("wxGroupId")||"",n=o+","+(s.openId||"")+","+n+","+(e||"");(0,_friendHelp.LaunchOrJoinFriendHelp)({activityId:a,groupId:o,nickName:s.nickname,nickHeadUrl:s.avatar,openId:s.openId,wcUnionId:s.unionid_pdj_jd_new||"",formId:"",encodeData:(0,_utilsWeapp.encrypt)(n)}).then(function(e){switch((0,_indexWeapp.hideLoading)(),e.code){case"0":if("helpSelf"==t)return(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"ClickSelf"}),void i.getFriendHelpDetailInfo(!1);break;case"70000":(0,_indexWeapp.showToast)({title:e.msg||"该助力活动已结束"});break;case"70001":(0,_indexWeapp.showToast)({title:e.msg||"参与活动次数已达上限"});break;case"70003":(0,_indexWeapp.showToast)({title:e.msg||"你已参与过该好友助力，去发起新的好友助力吧~"});break;case"70010":(0,_indexWeapp.showToast)({title:e.msg||"今日已抢光（明日抢）"});break;case"70006":(0,_indexWeapp.showToast)({title:e.msg||"活动已抢光（已抢光）"});break;case"70012":(0,_indexWeapp.showToast)({title:e.msg||"助力失败，券已被抢光"});break;case"202":(0,_indexWeapp4.goToLogin)();break;default:(0,_indexWeapp.showToast)({title:e.msg})}setTimeout(function(){i.getFriendHelpDetailInfo(!1)},500)}).catch(function(e){(0,_indexWeapp.hideLoading)(),(0,_indexWeapp.showToast)({title:e.msg||"网络异常"}),i.getFriendHelpDetailInfo(!1)})}},{key:"getPageType",value:function(e){var t,i;return e?(t=null,7==e.buttonId||8==e.buttonId?t="参与成功":2==e.helpStatus?t="助力成功":3==e.helpStatus?t="助力失败":3==e.status?t="活动已结束":4==e.status?t="券已抢光":1===e.failCause?t="参团失败1":2===e.failCause||3===e.failCause?t="参团失败2":(i=0,e.friendHelpUserVOList.map(function(e){e.nickName&&i++}),i==e.totalMemberNum&&(t="助力人数已满")),t):""}},{key:"clickDataReport",value:function(e,t){(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:e,click_par:t})}},{key:"onDefaultEvent",value:function(){3===this.state.defaultType&&(this.getFriendHelpDetailInfo(!1),this.clickDataReport("ClickLoadAgain",null))}},{key:"resolveFrom",value:function(e){var t="",i=_index2.default.getApp(),o=this.state.pageParams;switch(i.globalData.appScene){case 1007:case 1008:case 1036:i.globalData.qrcode.business=o.business||(e?"50":"23"),t="好友卡片";break;case 1014:t="模版消息";break;case 1047:case 1048:case 1049:i.globalData.qrcode.business=o.business||(e?"50":"23"),t="小程序码"}this.setState({from:t})}},{key:"onPopEvent",value:function(e){"close"===e.type&&this.setState({showRulePop:!1})}},{key:"onToggleRulePop",value:function(){this.setState({showRulePop:!0}),this.clickDataReport("click_rule",null)}},{key:"selfJoinShowPop",value:function(e){var e=e||this.state.result,t=!1,t=e.totalMemberNum>e.firstLadderCount&&(1<=e.shareCount&&(e.selfJoinCount<1||e.totalMemberNum>e.secondLadderCount&&(e.shareCount-1==e.shareGroupCount&&e.selfJoinCount<2||!!(e.totalMemberNum>e.thirdLadderCount&&e.inviteFriendEnough)&&e.selfJoinCount<3)));this.setState({showSelfHelpPop:t})}},{key:"onClickPopBackground",value:function(){this.setState({showSelfHelpPop:!1})}},{key:"addShareNum",value:function(){var e=this.state.result;(0,_friendHelp.countShareNum)({groupId:e.groupId,activityId:e.activityId}).then(function(){})}},{key:"getHeadSource",value:function(e){var t=this;(0,_friendHelp.getConfigInfo)({cityId:e&&e.cityId||1,pageId:"16"}).then(function(e){(e.result||[]).forEach(function(e){e.type&&1==e.type&&(t.setState({mpSourceData:e.data&&e.data[0]||{}}),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"showFriendHelpAD",click_par:{title:e.data[0].title,jump:e.data[0].jump,linkUrl:e.data[0].linkUrl||""}}))})})}},{key:"stopPropagation",value:function(e){e.stopPropagation()}},{key:"getCurrentScrollPos",value:function(){return currentScrollPos}},{key:"setSecTopPos",value:function(e){secTopPos=e+currentScrollPos}},{key:"secKillInfoCallback",value:function(e){this.setState({secKillProIsNull:e})}},{key:"setSecList3Pos",value:function(e){secList3Pos=0==e?e:e+currentScrollPos-screenHeight}},{key:"onReachBottom",value:function(){this.childSecGoodsKill&&this.childSecGoodsKill.seckillBottomRefresh(),0<this.state.listArr.length&&this.getFriendHelpList(this.state.currentPage)}},{key:"onPageScroll",value:function(e){currentScrollPos=e.scrollTop;e=e.scrollTop>=secTopPos;0!=secTopPos&&this.state.secIsTop!=e&&0!=secTopPos&&this.setState({secIsTop:e})}},{key:"onShowSeckill",value:function(e){this.setState({showSeckill:e}),this.clickDataReport("showSeckill",{seckill:e?1:0})}},{key:"onClickCard",value:function(e,t){(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"click_coupon",click_par:{userAction:JSON.stringify(e.userAction)||"",activityId:e.activityId||"",couponId:e.userAction.couponId||"",couponType:e.userAction.couponType||"",actType:"免费领"}});t="largeSale"==t?e.secKillStatus:["list","help"].includes(t)?e.status:"";[2,5].includes(t)?this.dealClickCard(e):[1,3,4].includes(t)&&(0,_indexWeapp.showToast)({title:{1:"活动暂未开始哦～",3:"活动已结束～",4:"优惠券已抢光～"}[t]})}},{key:"dealClickCard",value:function(i){var o=this;(0,_indexWeapp4.isLogin)().then(function(){(0,_indexWeapp.showLoading)(),i.groupId?o.goToDetail(i):(0,_friendHelp.LaunchOrJoinFriendHelp)({activityId:i.activityId}).then(function(e){switch((0,_indexWeapp.hideLoading)(),e.code){case"0":var t=e.result;t&&t.groupId?(t={activityId:i.activityId||"",groupId:t.groupId||""},o.goToDetail(t),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"ClickLaunchNew",click_par:{activity_id:i.activityId||""}})):(0,_indexWeapp.showToast)({title:e.msg||"发起次数达到上限"});break;case"70000":(0,_indexWeapp.showToast)({title:e.msg||"该助力活动已结束"});break;case"70001":(0,_indexWeapp.showToast)({title:e.msg||"参与活动次数已达上限~"});break;case"70003":(0,_indexWeapp.showToast)({title:e.msg||"你已参与过该好友助力，去发起新的好友助力吧~"});break;case"70010":(0,_indexWeapp.showToast)({title:e.msg||"今日已抢光（明日抢）"});break;case"70006":(0,_indexWeapp.showToast)({title:e.msg||"活动已抢光（已抢光）"});break;case"202":(0,_indexWeapp4.goToLogin)({localTargetUrl:"/pages/friendHelp/list/index"});break;default:(0,_indexWeapp.showToast)({title:e.msg||"网络错误"})}}).catch(function(e){(0,_indexWeapp.hideLoading)(),(0,_indexWeapp.showToast)({title:e.msg||"网络异常"})})}).catch(function(e){(0,_indexWeapp4.goToLogin)({localTargetUrl:"/pages/friendHelp/list/index"})})}},{key:"goToDetail",value:function(e){e="/pages/friendHelp/launch/index?from=list&activityId="+e.activityId+"&groupId="+e.groupId;(0,_indexWeapp.navigateTo)(e)}},{key:"onClickShareSubscribe",value:function(e){if(e){this.sleep(1500);var t=[];try{t=(0,_indexWeapp2.getStorageSync)("cutShareInfo")}catch(e){}if(t){for(var i=!1,o=0;o<t.length;o++)if(t[o].activityId==e){i=!0;break}i||(t.push({activityId:e}),(0,_indexWeapp2.setStorageSync)("cutShareInfo",t),this.childSubscribe.initSubscribeMessage(["iwJcSNrbfOXKnfhoi4tEJvC1AnVWoNj1R8D8FSctMs0","3zzStxd9r5oOQ0N569D5l-cJ6OYj1E3QHb095rCRvSs","aUUy2JkJeivLJJCEPOMuM_fsywgjhNjdN4ryMeWYcsw"]))}else(t=[]).push({activityId:e}),(0,_indexWeapp2.setStorageSync)("cutShareInfo",t),this.childSubscribe.initSubscribeMessage(["iwJcSNrbfOXKnfhoi4tEJvC1AnVWoNj1R8D8FSctMs0","3zzStxd9r5oOQ0N569D5l-cJ6OYj1E3QHb095rCRvSs","aUUy2JkJeivLJJCEPOMuM_fsywgjhNjdN4ryMeWYcsw"])}}},{key:"anonymousFunc0",value:function(e){}}]),a}(),_class.$$events=["onPageScroll","onToggleRulePop","anonymousFunc0","goToHome","onClickPopBackground","getCode2Help","toLogin"],_class.options={addGlobalClass:!0},_class.$$componentPath="pages/friendHelp/detail/index",_temp2);exports.default=Detail,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Detail,!0));