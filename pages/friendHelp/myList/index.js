"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}}(),_get=function e(t,i,a){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(t))?e(n,i,a):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_friendHelp=require("../api/friendHelp.js"),_indexWeapp=require("../../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp2=require("../../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_indexWeapp3=require("../../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap),_indexWeapp4=require("../../../npm/@jd/djmp/common-t/js/storage/index.weapp.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}_temp2=_class=function(){function s(){var e,t;_classCallCheck(this,s);for(var i=arguments.length,a=Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t=_possibleConstructorReturn(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(a)))).$usedState=["anonymousState__temp","$compid__38","$compid__39","style","tabIndex","address","list","currentPage","showDefault","defaultType","defaultTips","defaultBtnTxt","showRulePop","loadingMore","refreshList","sourceData"],t.config={navigationBarTitleText:"京东到家",navigationBarBackgroundColor:"#fff",navigationBarTextStyle:"black"},t.customComponents=["Default","MyListAll","SubscribeMessage"],_possibleConstructorReturn(t,e)}return _inherits(s,_index.Component),_createClass(s,[{key:"_constructor",value:function(e){var t=this;_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,e),this.userAction="",this.requestFlag=!0,this.state={tabIndex:"",address:{},list:[],currentPage:1,showDefault:!0,defaultType:0,defaultTips:"",defaultBtnTxt:"",showRulePop:!1,loadingMore:!0,refreshList:!0,sourceData:{}},this.$$refs=[{type:"component",id:"lCWZW",refName:"",fn:function(e){return t.childSubscribe=e}}]}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__38"),e=(0,_index.genCompid)(e+"$compid__39"),i=this.__state.list||[],a=!this.__state.refreshList;return this.__state.showDefault&&_index.propsManager.set({defaultType:this.__state.defaultType,defaultTips:this.__state.defaultTips,defaultBtnTxt:this.__state.defaultBtnTxt,onDefaultEvent:this.onDefaultEvent.bind(this)},t),this.__state.showDefault||_index.propsManager.set({list:i,onShareSubscribEvent:this.onClickShareSubscribe.bind(this),refreshList:a},e),Object.assign(this.__state,{anonymousState__temp:a,$compid__38:t,$compid__39:e,style:_indexModuleScssMap2.default}),this.__state}},{key:"componentDidShow",value:function(){(0,_indexWeapp3.pvReport)({create_time:new Date});var e=this.$router.params;e.userAction&&(this.userAction=decodeURIComponent(e.userAction)),this.getMyFriendHelpListFn()}},{key:"onClickTab",value:function(e){e!==this.state.tabIndex&&(this.getMyFriendHelpListFn(e),this.setState({tabIndex:e}))}},{key:"sleep",value:function(e){for(var t=new Date,i=t.getTime()+e;;)if((t=new Date).getTime()>i)return}},{key:"onClickShareSubscribe",value:function(e){this.sleep(1500);var t=[];try{t=(0,_indexWeapp4.getStorageSync)("cutShareInfo")}catch(e){}if(t){for(var i=!1,a=0;a<t.length;a++)if(t[a].activityId==e){i=!0;break}i||(t.push({activityId:e}),(0,_indexWeapp4.setStorageSync)("cutShareInfo",t),this.childSubscribe.initSubscribeMessage(["iwJcSNrbfOXKnfhoi4tEJvC1AnVWoNj1R8D8FSctMs0","3zzStxd9r5oOQ0N569D5l-cJ6OYj1E3QHb095rCRvSs","aUUy2JkJeivLJJCEPOMuM_fsywgjhNjdN4ryMeWYcsw"]))}else(t=[]).push({activityId:e}),(0,_indexWeapp4.setStorageSync)("cutShareInfo",t),this.childSubscribe.initSubscribeMessage(["iwJcSNrbfOXKnfhoi4tEJvC1AnVWoNj1R8D8FSctMs0","3zzStxd9r5oOQ0N569D5l-cJ6OYj1E3QHb095rCRvSs","aUUy2JkJeivLJJCEPOMuM_fsywgjhNjdN4ryMeWYcsw"])}},{key:"onShareAppMessage",value:function(e){var t,i,a,n,s,r,o,p,l,d;return"button"===e.from?(t=void 0===(t=(e=e.target.dataset.params).status)?"":t,i=void 0===(i=e.activityId)?"":i,a=void 0===(a=e.groupId)?"":a,n=void 0===(n=e.sceneId)?"":n,s=void 0===(s=e.materialId)?"":s,r=void 0===(r=e.tempId)?"":r,o=void 0===(o=e.shareText)?"":o,p=void 0===(p=e.name)?"":p,l=void 0===(l=e.shareUrl)?"":l,d=void 0===(d=e.imageUrl)?"":d,e=void 0===(e=e.shareAb)?{}:e,(0,_indexWeapp3.clickReport)({create_time:new Date,click_id:"Click_myfriendhelp",click_par:{is_start:t,contentid:2,activity_id:i}}),{title:o||p||"来帮好友助力吧~",imageUrl:l||d||"",path:"/pages/friendHelp/detail/index?activityId="+i+"&groupId="+a+"&sceneId="+n+"&materialId="+s+"&tempId="+r+"&strategyName="+e.strategyName+"&experimentName="+e.experimentName}):{title:"好友助力",imageUrl:"http://img30.360buyimg.com/mobilecms/jfs/t1/22028/16/11520/82586/5c908517E4763ecde/2b7c152c69de9a2f.png",path:"/pages/friendHelp/list/index"}}},{key:"getMyFriendHelpListFn",value:function(e){var i=this,a="还未发起过助力活动哦，赶紧去发起一个吧~";1==e?a="还没有助力中活动哦，赶紧去发起一个吧~":2==e?a="还没有助力成功的活动哦，赶紧去发起一个吧~":3==e&&(a="没有任何内容哦，去发起新的活动吧~"),Date.now();(0,_indexWeapp2.isLogin)().then(function(){new Date;(0,_indexWeapp.showLoading)(),(0,_friendHelp.getMyFriendHelpList)({activityHelpStatus:e||i.state.tabIndex}).then(function(e){var t;(0,_indexWeapp.hideLoading)(),0==e.code?0<(t=e.result.friendHelpVOList).length?i.setState({list:t,refreshList:!i.state.refreshList,showDefault:!1}):((0,_indexWeapp.showToast)({title:a}),i.setState({showDefault:!0,defaultTips:a,defaultType:2,defaultBtnTxt:"去发起活动"})):"201"==e.code||"202"==e.code?i.setState({showDefault:!0,defaultTips:e.msg||"请您登录~",defaultType:4}):i.setState({showDefault:!0,defaultTips:e.msg||"服务错误~",defaultType:3})}).catch(function(e){(0,_indexWeapp.hideLoading)(),i.setState({showDefault:!0,defaultTips:e.msg||"服务错误~",defaultType:3})})}).catch(function(){(0,_indexWeapp2.goToLogin)({localTargetUrl:"/pages/friendHelp/myList/index"})})}},{key:"onDefaultEvent",value:function(){var e=this.state.defaultType,t=this.state.tabIndex;3===e||1===e?this.getMyFriendHelpListFn(t):4===e?(0,_indexWeapp2.goToLogin)({localTargetUrl:"/pages/friendHelp/myList/index"}):1!==e&&2!==e&&3!==e||(0,_indexWeapp.navigateTo)("/pages/friendHelp/list/index")}}]),s}(),_class.$$events=["onClickTab"],_class.options={addGlobalClass:!0},_class.$$componentPath="pages/friendHelp/myList/index";var MyList=_temp2;exports.default=MyList,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(MyList,!0));