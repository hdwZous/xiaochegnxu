(wx.webpackJsonp=wx.webpackJsonp||[]).push([[14],{108:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return u})),n.d(t,"d",(function(){return i}));var c=n(46),o=function getCoupons(e){return Object(c.a)({functionId:"user/myCouponListV2",body:e})},a=function exchangeCouponByCode(e){return Object(c.a)({functionId:"share/exchangeCouponByCode",body:e})},u=function getCouponIntroduce(e){return Object(c.a)({functionId:"user/couponIntroduce",body:e})},i=function updatecouponread(e){return Object(c.a)({functionId:"user/updatecouponread",body:e})}},171:function(e,t,n){"use strict";n.r(t),n.d(t,"CouponList",(function(){return m})),n.d(t,"Exchange",(function(){return y})),n.d(t,"CouponDialog",(function(){return S})),n.d(t,"Tabs",(function(){return I})),n.d(t,"Custom",(function(){return w.a}));var c=n(5),o=n(19),a=n(11),u=n(2),i=n.n(u),r=n(3),s=n(69),l=n(28),b=n(31),d=n(154),f=n(84),j=n(108),p=n(177),O=n.n(p),g=n(49);var _=function useDebounce(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];Object(r.useEffect)((function(){var n;return n=setTimeout(e,t),function(){clearTimeout(n)}}),Object(g.a)(n))},h=n(71),C=n(0),m=function CouponList(e){var t=e.introduce,n=e.disabledCoupon,p=e._noneCoupon,g=e.dataSize,m=e.refPar,x=void 0===m?"":m,v=e.pageSource,y=void 0===v?"myCoupon":v,S=e.ctp,k=void 0===S?"couponsList":S,T=Object(r.useContext)(h.a)||{},I=Object(r.useState)([]),w=Object(o.a)(I,2),L=w[0],N=w[1],B=Object(r.useState)(e.state||1),E=Object(o.a)(B,2),A=E[0],D=E[1],P=Object(r.useState)(e.startIndex||1),J=Object(o.a)(P,2),H=J[0],R=J[1],z=Object(r.useState)(!1),M=Object(o.a)(z,2),U=M[0],Z=M[1],F=Object(r.useState)(!1),G=Object(o.a)(F,2),Q=G[0],V=G[1],X=Object(r.useState)(e.defaultPage),q=Object(o.a)(X,2),K=q[0],W=q[1],Y=Object(r.useState)(0),$=Object(o.a)(Y,2),ee=$[0],te=$[1],ne=Object(r.useState)(!0),ce=Object(o.a)(ne,2),oe=ce[0],ae=ce[1],ue=Object(r.useState)(!1),ie=Object(o.a)(ue,2),re=ie[0],se=ie[1],le=Object(r.useRef)(!1),be=Object(r.useCallback)((function(){i.a.eventCenter.on("_handleTag",(function(e){switch(N([]),e){case 0:D(3);break;case 1:D(2)}V(!1),R(1),le.current=!1,fe(!0),se(!1)}))}),[]),de=Object(r.useCallback)((function(){i.a.eventCenter.on("_handleConfirm",(function(e){var t=++ee;le.current=!1,N([]),D(1),V(!1),R(1),fe(!0),se(!1),te(t)}))}),[]);_((function(){Object(j.c)({startIndex:H,dataSize:g,refPar:x,pageSource:y,state:A,ctp:k,pageId:T.pageId}).then((function(e){return fe(!1),V(!1),new Promise((function(t){var n,o;if(null!==(n=e.result)&&void 0!==n&&null!==(o=n.couponList)&&void 0!==o&&o.length){var a=e.result.couponList.map((function(t){return Object(c.a)(Object(c.a)({},t),{},{showAll:!1,styles:Object(c.a)(Object(c.a)({},t.styles),{},{couponLabelStyle:t.styles.couponLabelStyle&&t.styles.couponLabelStyle.splice(0,2)}),traceId:e.traceId})}));a&&a.length?le.current=!0:(le.current=!1,1!=H&&se(!0)),N((function(e){var n=e.concat(a);return t(n),n}))}else 1!=H&&se(!0),t(L)}))})).then((function(e){0==e.length&&V(!0),i.a.eventCenter.trigger("isDefault",e.length||0)})).catch((function(e){fe(!1),"201"==e.code||"202"==e.code?(ae(!1),V(!0),W({tipTitle:"暂未登录",tipText:"立即登录",tipDesc:"快去登录，迫不及待与你相见啦~",type:"unlogin",callBack:function callBack(){Object(b.a)()}})):L.length||(V(!0),W({tipTitle:"网络请求失败",tipText:"重新加载",tipDesc:"网络离家出走啦？我要把TA找回来~",type:"nothing",callBack:function callBack(){fe(!0);var e=++ee;te(e)}}))}))}),50,[A,H,ee]);var fe=function showLoading(e){e?(i.a.eventCenter.trigger("_isShowLoading",!0),Z(!1)):(i.a.eventCenter.trigger("_isShowLoading",!1),Z(!0))};Object(r.useEffect)((function(){return i.a.eventCenter.trigger("_isShowLoading",!0),be(),function _useReachBottom(){i.a.eventCenter.on("_useReachBottom",(function(e){le.current&&R((function(){return H+1}))}))}(),de(),function(){je()}}),[]);var je=function offEventCenter(){i.a.eventCenter.off("_useReachBottom"),i.a.eventCenter.off("_handleTag")},pe=Object(r.useCallback)((function(e){var t=e.markState,n=e.couponId,o=e.activityCode,a=e.userAction,u=void 0===a?"":a,i=e.couponType,r=e.styles,b=void 0===r?{}:r,d=e.traceId,f=void 0===d?"":d;Object(l.a)(Object(c.a)({click_id:"click_coupon",click_par:{userAction:u||"",couponId:n,couponType:i,activityCode:o,actType:((b||{}).couponButStyle||{}).title}},T));var j={markState:t,code:o,refPageSource:T.pageSource||T.page_name};Object(s.a)({couponId:n,code:o,passThroughParam:j,extraParams:{ref_page:"applet",ref_par:JSON.stringify({traceId:f,userAction:u,pageId:T.pageId})}})}),[]),Oe=Object(r.useCallback)((function(){je(),Object(l.a)(Object(c.a)({click_id:"clickExplainIcon",click_par:{iconName:t.title||"优惠券说明"}},T)),t.url&&Object(u.navigateTo)({url:t.url})}),[]),ge=Object(r.useCallback)((function(){je(),n.url&&Object(u.navigateTo)({url:n.url})}),[]),_e=Object(r.useCallback)((function(e,t){L[t].showAll=!L[t].showAll;var n=JSON.parse(JSON.stringify(L));N(n)}),[L]);return U&&Object(C.jsxs)(a.i,{style:e.style,children:[Q&&Object(C.jsx)(f.a,Object(c.a)(Object(c.a)({type:"hasNoCoupon",isHideBtn:!0,tipTitle:"暂无可用优惠券"},K),{},{height:"60vh"})),!Q&&function showCoupon(){return Object(C.jsx)(a.i,{children:L&&L.map((function(t,n){return Object(C.jsx)(d.a,{couponData:t,HandleShowAllMsg:function HandleShowAllMsg(){return _e(t,n)},HandleToUse:pe,couponStatus:e.state},"coupon"+n)}))})}(),oe&&Object(C.jsxs)(a.i,{className:O.a.bottom_txt,children:[t?Object(C.jsx)(a.i,{onClick:Oe,children:t.title}):null,n?Object(C.jsxs)(a.i,{onClick:ge,children:[Object(C.jsx)(a.g,{className:O.a.bottom_h,children:"|"}),n.title]}):null,p&&re&&Object(C.jsx)(a.i,{className:O.a._noneCoupon,children:p.title})]})]})},x=n(193),v=n.n(x),y=function Exchange(e){var t=Object(r.useContext)(h.a);return Object(C.jsxs)(a.i,{onClick:function handleExchange(){Object(l.a)(Object(c.a)({click_id:"my_coupons_exchange_20160713"},t)),i.a.eventCenter.trigger("CouponDialog",!0)},className:v.a.btn_area,style:e.style,children:[Object(C.jsx)(a.c,{src:"https://static-o2o.360buyimg.com/activity/images/fe/user_store_act_focus.png",className:v.a.img_icon}),Object(C.jsx)(a.i,{children:"使用兑换码"})]})},S=function CouponDialog(e){var t=Object(r.useContext)(h.a),n=Object(r.useState)(e.show||!1),u=Object(o.a)(n,2),s=u[0],l=u[1];Object(r.useEffect)((function(){i.a.eventCenter.on("CouponDialog",(function(e){l(e)}))}),[]);return Object(C.jsx)(a.b,Object(c.a)(Object(c.a)({show:s},e),{},{onConfirm:function handleConfirm(e){if(!e)return i.a.showToast({icon:"none",title:"请输入兑换码"}),void l(!1);Object(j.a)({exchangeCode:e,pageId:t.pageId}).then((function(e){"0"==e.code&&i.a.eventCenter.trigger("_handleConfirm"),l(!1),i.a.showToast({icon:"none",title:e.msg})})).catch((function(e){l(!1),i.a.showToast({icon:"none",title:e.msg||"兑换失败"})}))},onCancel:function handleCancel(){l(!1)}}))},k=n(194),T=n.n(k),I=function Tabs(e){var t=e.dataSource,n=e.color,u=Object(r.useState)(0),s=Object(o.a)(u,2),b=s[0],d=s[1],f=Object(r.useContext)(h.a);return Object(r.useLayoutEffect)((function(){f.page_name&&Object(l.a)(Object(c.a)({click_id:"selectTab",click_par:{tabName:(t[0]||{}).text,state:0}},f))}),[f.page_name]),Object(C.jsx)(a.i,{className:T.a.tags,children:t.map((function(e,t){var o=b==t&&n;return Object(C.jsx)(a.i,{onClick:function onClick(){return function handleTag(e,t){e!==b&&(d(e),Object(l.a)(Object(c.a)({click_id:"selectTab",click_par:{tabName:t}},f)),i.a.eventCenter.trigger("_handleTag",e))}(t,e.text)},style:{color:o,borderColor:o},className:T.a.tag,children:e.text},t)}))})},w=n(186)},177:function(e,t,n){e.exports={bottom_txt:"index-module__bottom_txt___Bxc69",bottom_h:"index-module__bottom_h___1U9On",_noneCoupon:"index-module___noneCoupon___2ZFXZ"}},193:function(e,t,n){e.exports={btn_area:"index-module__btn_area___MfLQl",img_icon:"index-module__img_icon___1m8G9"}},194:function(e,t,n){e.exports={tags:"index-module__tags___3E5Eg",tag:"index-module__tag___2yCIz"}},71:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var c=n(3),o=n.n(c).a.createContext({pageId:""})}}]);