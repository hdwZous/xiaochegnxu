"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t,n=arguments[r];for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},_createClass=function(){function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}}(),_get=function e(r,t,n){null===r&&(r=Function.prototype);var a=Object.getOwnPropertyDescriptor(r,t);return void 0!==a?"value"in a?a.value:void 0!==(a=a.get)?a.call(n):void 0:null!==(a=Object.getPrototypeOf(r))?e(a,t,n):void 0},_index=require("../../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../../npm/prop-types/index.js"),_index4=_interopRequireDefault(_index3),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(e)return!r||"object"!=typeof r&&"function"!=typeof r?e:r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var lineNum=0,inerr=0,BarrageMoveView=(_temp2=_class=function(){function a(){var e,s;_classCallCheck(this,a);for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];return(e=s=_possibleConstructorReturn(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(t)))).$usedState=["loopArray10","styles","list","width","newMessages","animatedType","numberOfLines"],s.startMove=function(){s.props.animatedType;s.move()},s.getText=function(){var e=s.getRundomNumber1(s.barrageOriginal1.length-1),r=(s.barrageOriginal1&&0<s.barrageOriginal1.length||(s.barrageOriginal1=[].concat(_toConsumableArray(s.barrageOriginal2))),s.barrageOriginal1[e]);return s.barrageOriginal1.splice(e,1),r},s.getRundomNumber1=function(e){return Math.floor(Math.random()*(e+1))},s.addBarrageMessage=function(e,r){for(var t=_index2.default.getSystemInfoSync().screenWidth,n=0;n<e.length;n+=1){var a=e[n],i=s.getLineIndexOfNewBarrrage();i<0||(a=_extends({},a,{indexOfLine:i,isMiddleShow:r,position:{left:t}}),s.barrages[i]||(s.barrages[i]=[]),s.barrages[i].push(a),s.removeData(),s.setState(function(e){return delete e.list,e}),s.setState({list:s.barrages}))}},s.removeItemFromList=function(e){for(var r=0;r<s.barrages.length;r+=1)if(s.barrages[r])for(var t=0;t<s.barrages[r].length;t+=1)s.barrages[r][t].userPin===e.userPin&&(s.barrages[r].isFree=!0)},s.getLineIndexOfNewBarrrage=function(){s.props.numberOfLines;return 0===s.barrages.length||0===s.barrages[0].length?0:lineNum=0==lineNum?1:0},s.getLinNewBarrage=function(){var e=s.getRundomNumber(1);return e==s.lastLineNum&&(1==e?e=0:e++),s.lastLineNum=e},s.getLinNewBarrage1=function(){return-1==s.lastLineNum?s.lastLineNum=s.getRundomNumber(1):1==s.lastLineNum?s.lastLineNum=0:s.lastLineNum=s.lastLineNum+1,s.lastLineNum},s.getRundomNumber=function(e){return Math.floor(Math.random()*(e+1))},s.anonymousFunc0Map={},s.customComponents=["BarrageItem"],_possibleConstructorReturn(s,e)}return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.state={list:[],width:_index2.default.getSystemInfoSync().screenWidth},this.barrages=[],this.setRefs=this.setRefs.bind(this),this.lastLineNum=-1,this.barrageOriginal1=[],this.barrageOriginal2=[],this.$$refs=[]}},{key:"componentDidMount",value:function(){var e=this,r=this.props.newMessages;this.barrageOriginal1=[].concat(_toConsumableArray(r)),this.barrageOriginal2=[].concat(_toConsumableArray(r)),this.barrageOriginal1&&0<this.barrageOriginal1.length&&this.barrageOriginal1&&0<this.barrageOriginal1.length&&setTimeout(function(){e.addBarrageWithInterval()},550)}},{key:"refrshBarrageTime",value:function(){inerr&&clearInterval(inerr),this.setState({list:[]}),this.barrages=[],lineNum=0;var e=this.getText();this.addBarrageMessage([e],!0),this.addBarrageWithInterval()}},{key:"componentWillUnmount",value:function(){}},{key:"addBarrageWithInterval",value:function(){var r=this;inerr=setInterval(function(){var e=r.getText();r.addBarrageMessage([e],!1)},2220)}},{key:"componentDidShow",value:function(){this.barrageOriginal1&&0<this.barrageOriginal1.length&&this.addBarrageWithInterval()}},{key:"componentDidHide",value:function(){lineNum=0,this.inerr&&clearInterval(this.inerr)}},{key:"setRefs",value:function(e,r,t){e&&r&&t&&(this.barrages[r][t].ref=e)}},{key:"checkData",value:function(e){for(var r=!1,t=0;t<this.barrages.length;t+=1)if(this.barrages[t]){for(var n=0;n<this.barrages[t].length;n+=1)if(this.barrages[t][n].userPin===e.userPin){r=!0;break}}else r=!1;return r}},{key:"removeData",value:function(){for(var e=0;e<this.barrages.length;e+=1)this.barrages[e]&&50<this.barrages[e].length&&this.barrages[e].splice(0,this.barrages[e].length-1)}},{key:"_createData",value:function(){var a=this,i=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix),e=this.__state.list.map(function(e,n){return{$anonymousCallee__1:(e={$original:(0,_index.internal_get_original)(e)}).$original.map(function(e,r){e={$original:(0,_index.internal_get_original)(e)};var t="oXtmJ"+n+"-"+r,r=(a.anonymousFunc0Map[t]=function(e){return a.removeItemFromList(e)},(0,_index.genCompid)(i+"zjBTQpZzAn"+n+"-"+r));return _index.propsManager.set({line:e.$original.indexOfLine,data:e.$original,speed:2,type:2,isMiddleShow:e.$original.isMiddleShow,heightOfLine:50,onDestroyBarrageItem:a.anonymousFunc0.bind(a,t)},r),{_$indexKey:t,$compid__22:r,$original:e.$original}}),$original:e.$original}});return Object.assign(this.__state,{loopArray10:e,styles:_indexModuleScssMap2.default}),this.__state}},{key:"anonymousFunc0",value:function(e,r){return this.anonymousFunc0Map[e]&&this.anonymousFunc0Map[e](r)}}]),a}(),_class.$$events=[],_class.propTypes={newMessages:_index4.default.array,numberOfLines:_index4.default.number,speed:_index4.default.number,animatedType:_index4.default.number},_class.defaultProps={newMessages:[],numberOfLines:2,speed:1,animatedType:1},_class.$$componentPath="pages/orchard-t/components/SelectFruit/barrageView/index",_temp2);exports.default=BarrageMoveView,Component(require("../../../npm/@tarojs/taro-weapp/index.js").default.createComponent(BarrageMoveView));