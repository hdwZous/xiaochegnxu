"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,s=arguments[t];for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_createClass=function(){function s(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,a){return t&&s(e.prototype,t),a&&s(e,a),e}}(),_get=function e(t,a,s){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,a);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(s):void 0:null!==(i=Object.getPrototypeOf(t))?e(i,a,s):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap),_orchard=require("../../api/orchard.js"),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/jump/index.weapp.js"),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/jump2/index.weapp.js"),_utilsWeapp=require("../../npm/@jd/djmp/common-t/js/utils/utils.weapp.js"),_indexWeapp3=require("../../npm/@jd/djmp/common-t/js/env/index.weapp.js"),_indexWeapp4=require("../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp5=require("../../npm/@jd/djmp/common-t/constants/index.weapp.js"),_indexWeapp6=require("../../npm/@jd/djmp/common-t/js/share/index.weapp.js"),_indexWeapp7=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp8=require("../../npm/@jd/djmp/common-t/js/location/index.weapp.js"),_indexWeapp9=require("../../npm/@jd/djmp/common-t/js/utils/index.weapp.js"),_utils=require("../../js/utils.js"),_constant=require("../../js/constant.js"),_indexWeapp10=require("../../npm/@jd/djmp/common-t/js/storage/index.weapp.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var INVITER_NEW_TASK_TYPE=802,sharePathForOLd="pages/orchard-t/index?source=share&business="+_constant.BUSINESS_MAP.page,pin=void 0,isWeapp=!0,login_info=wx.getStorageSync("login_info"),queryForInitNewFriend="inviteUserPin="+(pin=login_info[_indexWeapp5.PDJ_H5_JDPIN_KEY]),sharePathForInviterNew="pages/orchard-t/index?source=share&business="+_constant.BUSINESS_MAP.task+"&"+queryForInitNewFriend,sharePath=sharePathForOLd,isClickTimeGetBtn=!1,HOT_FIX_REPORT={report:function(e,t){},hasOpenPushSettingHandle:function(e){this.report("orchard_hasOpenPushSettingHandle",e)}},TaskPop=(_temp2=_class=function(){function n(){var e,t;_classCallCheck(this,n);for(var a=arguments.length,s=Array(a),i=0;i<a;i++)s[i]=arguments[i];return(e=t=_possibleConstructorReturn(this,(t=n.__proto__||Object.getPrototypeOf(n)).call.apply(t,[this].concat(s)))).$usedState=["anonymousState__temp3","anonymousState__temp4","anonymousState__temp5","anonymousState__temp6","anonymousState__temp20","$compid__19","showPopAminate","showTaskGuideFlag","anonymousState__temp","isSceneTaskPop","sceneTaskInfo","style","anonymousState__temp2","showSysPushSwUp","disabled","switchChecked","welcomeFinnshTimes","hasShare","signTaskInfo","isOpenPushStatus","countDownStr","taskIndexAni","taskIndexForSupAni","handleGuideGetWater","router","title","taskList","shareInfo","isLargeScreen","timingQuestPushTest","handleSuperOrderPop","getTaskListInfo","handleToStore","showGetWaterToast","updataKettle","refreshShareStatus","address"],t.customComponents=["OpenSysPushPop"],_possibleConstructorReturn(t,e)}return _inherits(n,_index.Component),_createClass(n,[{key:"_constructor",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_constructor",this).call(this,e),this.shareFlag=!0,this.state={disabled:!1,switchChecked:!1,welcomeFinnshTimes:0,hasShare:!1,signTaskInfo:{},sceneTaskInfo:{},isSceneTaskPop:!1,showSysPushSwUp:!1,isOpenPushStatus:-1,countDownStr:"",taskIndexAni:-1,taskIndexForSupAni:-1},this.$$refs=[]}},{key:"componentWillReceiveProps",value:function(e){if(e&&e.taskList&&0<e.taskList.length)for(var t=0;t<e.taskList.length;t++)if(505==e.taskList[t].taskType&&1==e.taskList[t].status&&this.state.welcomeFinnshTimes<1&&(this.setState({welcomeFinnshTimes:this.state.welcomeFinnshTimes+1}),this.finnshTask(e.taskList[t],!0,!1)),503==e.taskList[t].taskType&&this.state.hasShare&&(this.setState({hasShare:!1}),this.finnshTask(e.taskList[t],!0,!1)),1101==e.taskList[t].taskType&&e.taskList[t].subList&&0<e.taskList[t].subList.length){for(var a=e.taskList[t],s=0;s<a.subList.length;s++)if(1==a.subList[s].taskStatus){a.subList[s].isflag=!0;break}this.setState({signTaskInfo:a})}}},{key:"showCountDown",value:function(e,a){var s=this;console.log("-----",this.state[a]),(0,_utils.clearTimeout)(),(0,_utils.countDown)(e,function(e){var t;e.end?((0,_utils.clearTimeout)(),s.setState(_defineProperty({},a,"")),setTimeout(function(){s.getTaskListInfo(!1)},1e3)):(t="",t=e.day?e.day+"天"+e.hour+":"+e.minute+":"+e.second:e.hour+":"+e.minute+":"+e.second,s.setState(_defineProperty({},a,t)))})}},{key:"refreshTime",value:function(e){var t,a=0,s=0,i=0;0<e&&(e/=1e3,t=Math.floor(e/86400),a=Math.floor(e/3600)-24*t,s=Math.floor(e/60)-24*t*60-60*a,i=Math.floor(e)-24*t*60*60-60*a*60-60*s,a<=9&&(a="0"+a),s<=9&&(s="0"+s),i<=9&&(i="0"+i),this.setState({countDownStr:t?t+"天"+a+":"+s+":"+i:a+":"+s+":"+i}))}},{key:"hasOpenPushSettingHandle",value:function(){try{(0,_indexWeapp9.hasOpenPushSetting2)(this.handleSetting.bind(this))}catch(e){HOT_FIX_REPORT.hasOpenPushSettingHandle(e)}}},{key:"handleSetting",value:function(e){this.setState({isOpenPushStatus:e}),isClickTimeGetBtn&&_indexWeapp3.isDaojiaApp&&(0==e?(0,_indexWeapp4.showToast)({title:"手机通知未开启"}):1==e&&(0,_indexWeapp4.showToast)({title:"已开启通知，水滴不浪费"}))}},{key:"setIsClickPagePushSwitch",value:function(){isClickTimeGetBtn=!0}},{key:"checkIsLocalDay",value:function(){var e=(0,_indexWeapp10.getStorageSync)("orchard_open_sys_date"),t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()!=e}},{key:"saveLocalDay",value:function(){var e=new Date,e=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();(0,_indexWeapp10.setStorageSync)("orchard_open_sys_date",e)}},{key:"handleSysPushPop",value:function(e){this.setState({showSysPushSwUp:e})}},{key:"closeSysPushPopLayer",value:function(){this.handleSysPushPop(!1),this.saveLocalDay()}},{key:"handleGuideGetWater",value:function(){this.props.handleGuideGetWater(),(0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"questFTE",click_par:{step:2}})}},{key:"componentDidMount",value:function(){var e=this.props.router&&this.props.router.params,t=e&&e.taskId,a=e&&e.taskType;console.log("任务列表",e),a&&this.finnshTask({taskId:t||"",taskType:a||""},!0,!1),_indexWeapp3.isDaojiaApp&&this.hasOpenPushSettingHandle()}},{key:"onTouchMove",value:function(e){return e.preventDefault(),e.stopPropagation(),!1}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.$prefix,t=(0,_index.genCompid)(e+"$compid__19"),a=this.__props.showPopAminate||!1,s=(this.__props.title,this.__props.showTaskGuideFlag),i=this.__state,n=(i.signTaskInfo,i.sceneTaskInfo),o=i.isSceneTaskPop,i=i.showSysPushSwUp,r=this.__props,r=(r.taskList,r.shareInfo,r.isLargeScreen),p=this._createTaskListData(e+"YasmTefpfD")(),e=o&&n?this._createItemData(e+"JAYfXkhECk")(n,!0):null,u=(0,_index.internal_inline_style)({top:r?"0":null}),c=(0,_index.internal_inline_style)({paddingBottom:r?"380px":null}),r=o&&n?(0,_index.internal_inline_style)({transform:r?"scale(0.75)":"",top:r?"0px":"10%"}):null,o=o&&n?this.handleSubTitle(n.taskSubTitle):null,n=this.handleNewerFunc()&&s;return i&&_index.propsManager.set({setIsClickPagePushSwitch:this.setIsClickPagePushSwitch.bind(this),closeSysPushPopLayer:this.closeSysPushPopLayer.bind(this)},t),Object.assign(this.__state,{anonymousState__temp3:u,anonymousState__temp4:c,anonymousState__temp5:r,anonymousState__temp6:o,anonymousState__temp20:n,$compid__19:t,showPopAminate:a,showTaskGuideFlag:s,anonymousState__temp:p,style:_indexModuleScssMap2.default,anonymousState__temp2:e}),this.__state}},{key:"_createItemNotClickData",value:function(e){var n=this;return function(e,t,a){var s=n.props.shareInfo,s=void 0===s?{title:"0元水果免费拿",shareUrl:"https://img10.360buyimg.com/mobilecms/jfs/t1/166629/31/9647/59797/60471fd3Ec09ebeb8/fb2bc2b91556bfb1.jpg",beansource:"share"}:s,i=n.state.taskIndexAni==a?_utils.clickAnimationName:"";return{anonymousState__temp7:0==e.status&&300==e.finishType&&602==e.extraFinishMQType?_extends({},s,{path:sharePathForInviterNew}):null,item:e,isScene:t,style:_indexModuleScssMap2.default,classNameForAni:i,index:a,shareInfo:s}}}},{key:"_createItemNotFinishData",value:function(e){var c=this;return function(e,t,a){var s=c.props.shareInfo,s=void 0===s?{title:"0元水果免费拿",shareUrl:"https://img10.360buyimg.com/mobilecms/jfs/t1/166629/31/9647/59797/60471fd3Ec09ebeb8/fb2bc2b91556bfb1.jpg",beansource:"share"}:s,i=e.status,n=e.taskType,i=1==i,o=i&&(503==n||300==e.finishType&&602==e.extraFinishMQType),r=i&&n==INVITER_NEW_TASK_TYPE,p=i&&301==n,i=i&&306==n,n=c.state.countDownStr,u=c.state.taskIndexAni==a?_utils.clickAnimationName:"";return{anonymousState__temp8:o?_extends({},s,{path:sharePathForInviterNew}):null,anonymousState__temp9:r?_extends({},s,{path:sharePathForInviterNew}):null,initFriendType:o,isScene:t,style:_indexModuleScssMap2.default,classNameForAni:u,item:e,index:a,initNewFriendType:r,h5ToApp:p,isWeapp:!0,addBusiWechat:i,countDownStr:n}}}},{key:"checkIsHaveFinishOrder",value:function(e){var t=e.subList;if(t&&0<t.length){for(var a=!1,s=0;s<t.length;s++)if(2==t[s].taskStatus){a=!0;break}return a}return!1}},{key:"getNeedGetRewardSub",value:function(e){var t=e.subList;if(t&&0<t.length){for(var a=null,s=0;s<t.length;s++)if(2==t[s].taskStatus){a=t[s];break}return a}}},{key:"getSubProcessText",value:function(e){var t=e.subList;if(t&&0<t.length&&(513==e.taskType||1104==e.taskType)){for(var a=0,s=0;s<t.length;s++)2<=t[s].taskStatus&&(a+=1);return"("+a+"/"+t.length+")"}return""}},{key:"_createItemData",value:function(p){var u=this;return function(e,t,a){var s=u.state.isOpenPushStatus,i=u.props.timingQuestPushTest,n=u.state.taskIndexAni==a?_utils.clickAnimationName:"",o=u._createItemNotClickData(p+"ZqwjiVuVLG")(e,t,a),r=513!=e.taskType?u._createItemNotFinishData(p+"EiWgCoRTpM")(e,t,a):null;return{anonymousState__temp21:0==s&&_indexWeapp3.isDaojiaApp&&u.checkIsLocalDay()&&i,anonymousState__temp22:1104==e.taskType&&1==e.status&&u.checkIsHaveFinishOrder(e),anonymousState__temp23:u.checkIsHaveFinishOrder(e),anonymousState__temp10:o,item:e,isScene:t,style:_indexModuleScssMap2.default,classNameForAni:n,index:a,anonymousState__temp11:r}}}},{key:"taskAgainEvent",value:function(e,t,a){this.props.showTaskGuideFlag&&this.props.handleGuideGetWater(),this.clickAnimation({index:t,obj:a}),this.doTaskAct(e,!1,!1);t="";null!=e.finishNum&&null!=e.totalNum&&(t=e.finishNum+"/"+e.totalNum),(0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"clickQuestBtn",click_par:{questId:e.taskId,questName:e.taskName,questReward:e.awardValue,questStatus:e.status,questStage:t}})}},{key:"_createTaskListData",value:function(a){var s=this;return function(){var e=s.props,t=e.taskList,e=e.showTaskGuideFlag;return{loopArray5:t&&0<t.length?t.map(function(e,t){return{$loopState__temp13:-1!=(e={$original:(0,_index.internal_get_original)(e)}).$original.isShow&&1==e.$original.showPosition?s._createItemData(a+"JSuAlleUnt"+t)(e.$original,!1,t):null,$loopState__temp15:-1!=e.$original.isShow&&1==e.$original.showPosition?t+"key":null,$loopState__temp17:-1!=e.$original.isShow&&1==e.$original.showPosition?s.getSubProcessText(e.$original):null,$loopState__temp19:-1!=e.$original.isShow&&1==e.$original.showPosition?s.handleSubTitle(e.$original.taskSubTitle):null,$original:e.$original}}):[],taskList:t,showTaskGuideFlag:e}}}},{key:"handleSubTitle",value:function(e){var t=e;return t=-1<e.indexOf("##")?this.SreplaceAll(e,'<img style="width:10px; height:13px;margin-left:1px;margin-right:1px;" src="https://storage.360buyimg.com/wximg/orchard/icon_drip.png"></img>'):t}},{key:"SreplaceAll",value:function(e,t){return e=null!=e?e.replace(/##/g,t):e}},{key:"setBodyScrollInH5",value:function(){}},{key:"closePop",value:function(e){this.setBodyScrollInH5(),e.stopPropagation(),this.props.onClosePopUp({})}},{key:"setSharePath",value:function(e){console.error("item-",e);var t=e.taskType;sharePath=t==INVITER_NEW_TASK_TYPE||300==e.finishType&&602==e.extraFinishMQType?sharePathForInviterNew:sharePathForOLd,console.error("sharePath",sharePath)}},{key:"clickAnimationForSup",value:function(e){var t=this,a=e.index;e.obj;a&&(console.error("clickAnimationForSup",a),this.setState({taskIndexForSupAni:a},function(){setTimeout(function(){t.setState({taskIndexForSupAni:-1})},_utils.clickAnimationGap)}))}},{key:"clickReward",value:function(e,t,a,s){this.clickAnimationForSup({index:a,obj:s}),e.isflag&&t.todayFinishNum<1&&(console.log("---------",this.props.showTaskGuideFlag),this.props.showTaskGuideFlag&&this.props.handleGuideGetWater(),this.finishSubTask(t,e,!1),a="",null!=t.finishNum&&null!=t.totalNum&&(a=t.finishNum+"/"+t.totalNum),(0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"clickQuestBtn",click_par:{questId:t.taskId,questName:t.taskName,questReward:t.awardValue,questStatus:t.status,questStage:a}}))}},{key:"clickAnimation",value:function(e){var t=this,a=e.index;e.obj;console.error("clickAnimation",a),this.setState({taskIndexAni:a},function(){setTimeout(function(){t.setState({taskIndexAni:-1})},_utils.clickAnimationGap)})}},{key:"clickTaskEvent",value:function(e,t,a,s){var i=this,s=(this.props.showTaskGuideFlag&&this.props.handleGuideGetWater(),{obj:s||a,index:s?a:t}),a=(this.clickAnimation(s),setTimeout(function(){i.setState({isSceneTaskPop:!1})},_utils.clickAnimationGap),this.setSharePath(e),0==e.status?this.getTask(e,e.taskId,e.taskType):1==e.status?this.doTaskAct(e,!0,t):2==e.status?513==e.taskType?(console.error(this),this.props.handleSuperOrderPop(),this.props.onClosePopUp({})):this._throttle(function(){i.getReward(e,i.getNeedGetRewardSub(e),t)}):e.status,"");null!=e.finishNum&&null!=e.totalNum&&(a=e.finishNum+"/"+e.totalNum),t?(0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"clickTriggerButton",click_par:{questId:e.taskId,questName:e.taskName,questReward:e.awardValue,questStatus:e.status,questStage:a}}):(0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"clickQuestBtn",click_par:{questId:e.taskId,questName:e.taskName,questReward:e.awardValue,questStatus:e.status,questStage:a}})}},{key:"getTaskListInfo",value:function(e){this.props.getTaskListInfo(e)}},{key:"getTask",value:function(t,e,a,s){var i=this;(0,_orchard.receivedTaskInfo)({modelId:"M10007",taskId:e,taskType:a,plateCode:this.getPlateCode()}).then(function(e){0==e.code&&(setTimeout(function(){t.status=1,0!=t.unreceiveTaskJumpFlag&&t.unreceiveTaskJumpFlag||i.doTaskAct(t,!0,s),i.getTaskListInfo(!0)},_utils.clickAnimationGap),s&&i.props.onClosePopUp(),i.setState({sceneTaskInfo:e.result,isSceneTaskPop:s}),309==t.taskType)&&(0,_indexWeapp4.showToast)({title:"微信关注「京东到家」，回复「666」即可完成"})}).catch(function(e){i.getTaskListInfo(!0)})}},{key:"doTaskAct",value:function(i,e,t){var a,s,n,o,r=this,p=(this.setState({isSceneTaskPop:!1}),function(){(0,_indexWeapp4.showToast)({title:"迷路了，请稍后再试"})}),u=function(){1104==i.taskType&&1==i.status&&r.checkIsHaveFinishOrder(i)?r.getReward(i,r.getNeedGetRewardSub(i),t):r.openShare()},c=function(){e&&r.finnshTask(i,!0,!1)},l=function(){(0,_indexWeapp4.showToast)({title:"微信关注「京东到家」，回复「666」即可完成"})},d=function(){(0,_indexWeapp4.navigateTo)("/pages/vpayMember-t/home/index")},h=function(){(0,_indexWeapp4.showToast)({title:"任务还没有完成，加油呀！"})},m=function(){r.props.handleSuperOrderPop(),r.props.onClosePopUp({})},k=function(){var e=r.props.timingQuestPushTest;1==i.status&&1==i.ifCanFinishTask?0==r.state.isOpenPushStatus&&r.checkIsLocalDay()&&e&&_indexWeapp3.isDaojiaApp?r.handleSysPushPop(!0):r.finishSubTask(i,null,t):(0,_indexWeapp4.showToast)({title:"现在还不能领喔~"})},f=function(){1==i.status&&r.finishSubTask(i,null,t)},_=function(){var e=wx.getStorageSync("login_info")[_indexWeapp5.PDJ_H5_JDPIN_KEY];(0,_indexWeapp.jump)({to:"merchantMember",type:"h5",params:{storeId:i.params.storeId,orgCode:i.params.orgCode,source:"orchard",taskId:i.taskId,pin:e,identificationCode:i.identificationCode}})},g=function(){e&&(0<i.browseTime?(0,_utils.saveTaskBrowseOrchard)(i):setTimeout(function(){r.finnshTask(i,!0,!1)},2e3)),T()},y=function(){T()},T=function(){var e=i.params.url;i.identificationCode&&(-1<e.indexOf("?")?e+="&identificationCode="+i.identificationCode:e+="?identificationCode="+i.identificationCode),r.jumpThoughtUrl(e)},S=function(){wx.getStorageSync("login_info")[_indexWeapp5.PDJ_H5_SID_KEY];var s=i.params&&i.params.url?i.params.url:"https://kuai.imdada.cn/app/commonActivity#/?activityCode=20200804006iEst0n&channel=JDDJ_xdzyH5";i.identificationCode&&(-1<s.indexOf("?")?s+="&identificationCode="+i.identificationCode:s+="?identificationCode="+i.identificationCode),(0,_indexWeapp8.getLocation)().then(function(e){var t=e.areaCode||e.cityId,a=(encodeURIComponent(s+"&cityId="+t+"&lng="+e.longitude+"&lat="+e.latitude+"&"),i.params&&i.params.url?i.params.url:"https://kuai.imdada.cn/app/commonActivity#/?activityCode=20200831006r5TgQJ&channe=JDDJ_xdzywechat"),a="/common/pages/activity/couponActivityNew/index?activityCode="+((0,_utilsWeapp.getQueryString)("activityCode",a)||"20200831006r5TgQJ")+"&channel="+((0,_utilsWeapp.getQueryString)("channel",a)||"JDDJ_xdzywechat")+"&identificationCode="+i.identificationCode+"&cityId="+t+"&lng="+e.longitude+"&lat="+e.latitude;console.debug("dada-t",a),wx.navigateToMiniProgram({appId:"wxcecfde2bc765c661",path:a}),r.props.onClosePopUp({})}).catch(function(e){console.error(e),(0,_indexWeapp4.showToast)("定位失败")})};"home"==i.to?(0,_indexWeapp.jump)({to:"home"}):"mina"==i.to?(503==i.taskType?taskType503:505==i.taskType?c:901==i.taskType?g:902==i.taskType?y:p)():"web"==i.to?(n=i.params,a=i.taskType,s=n.appId,n=n.path,console.debug("navigateToMiniProgram-appid",s),console.debug("navigateToMiniProgram-path",n),s?(i.identificationCode&&(-1<n.indexOf("?")?n+="&identificationCode="+i.identificationCode:n+="?identificationCode="+i.identificationCode),901==a&&e?0<i.browseTime?((0,_utils.saveTaskBrowseOrchard)(i),wx.navigateToMiniProgram({appId:s,path:n})):(o=this,wx.navigateToMiniProgram({appId:s,path:n,success:function(e){console.error("打开小程序了"),o.finnshTask(i,!0,!1)}})):wx.navigateToMiniProgram({appId:s,path:n})):300==i.finishType?601==i.extraFinishMQType?r.props.onClosePopUp({}):602==i.extraFinishMQType?u():309==i.taskType?l():505==i.taskType?c():310==i.taskType?_():510==i.taskType?d():901==i.taskType?g():902==i.taskType?y():511==i.taskType?h():1001==i.taskType?S():""!==i.params.url?r.jumpThoughtUrl(i.params.url):p():309==i.taskType?l():505==i.taskType?c():310==i.taskType?_():510==i.taskType?d():901==i.taskType?g():902==i.taskType?y():511==i.taskType?h():1001==i.taskType?S():""!==i.params.url?r.jumpThoughtUrl(i.params.url):p()):"storeShop"==i.to?i.params&&i.params.storeId?310==i.taskType?_():r.props.handleToStore(i):(0,_indexWeapp4.showToast)({title:"当前位置暂无门店哦～"}):300==i.finishType?601==i.extraFinishMQType?r.props.onClosePopUp({}):602==i.extraFinishMQType&&u():1103==i.taskType?f():1102==i.taskType?k():503==i.taskType?taskType503():309==i.taskType?l():505==i.taskType?c():510==i.taskType?d():511==i.taskType?h():513==i.taskType?m():1001==i.taskType?S():306!=i.taskType&&301!=i.taskType&&(i.taskType==INVITER_NEW_TASK_TYPE?r.openShare():p())}},{key:"finnshTask",value:function(e,t,a){var s=this;(0,_orchard.finishedTaskInfo)({modelId:"M10007",taskId:e.taskId,taskType:e.taskType,plateCode:this.getPlateCode()}).then(function(e){t&&s.getTaskListInfo(a)}).catch(function(e){t&&s.getTaskListInfo(a)})}},{key:"showGetWaterToast",value:function(e){this.props.showGetWaterToast?this.props.showGetWaterToast(e):(0,_indexWeapp4.showToast)({title:"成功收取"+e+"水滴"})}},{key:"finishSubTask",value:function(t,a,s){var i=this;(0,_orchard.finishedTaskInfo)({modelId:"M10007",taskId:t.taskId,taskType:t.taskType,plateCode:this.getPlateCode(),subNode:a&&a.node}).then(function(e){0==e.code&&(a?i.showGetWaterToast(a.prizeValue):t.subList&&0<t.subList.length?i.showGetWaterToast(t.subList[0].prizeValue):i.showGetWaterToast(e.result.awardValue),s?i.requestGetSceneId(7):i.requestGetSceneId(6)),i.getTaskListInfo(!0)}).catch(function(e){i.getTaskListInfo(!0)})}},{key:"getReward",value:function(e,t,a){var s=this;(0,_orchard.sendTaskPrizeInfo)({modelId:"M10007",taskId:e.taskId,taskType:e.taskType,plateCode:this.getPlateCode(),subNode:t&&t.node}).then(function(e){0==e.code?t&&t.prizeValue?s.showGetWaterToast(t.prizeValue):s.showGetWaterToast(e.result.awardValue):(0,_indexWeapp4.showToast)({title:"网络开小差了，请稍后重试"}),s.updataKettle(e.result.awardValue),s.getTaskListInfo(!1),a?s.requestGetSceneId(7):s.requestGetSceneId(6)}).catch(function(e){(0,_indexWeapp4.showToast)({title:"网络开小差了，请稍后重试"}),s.getTaskListInfo(!1)})}},{key:"updataKettle",value:function(e){this.props.updataKettle(e)}},{key:"openShare",value:function(){var e=this;this._throttle(function(){e.props&&e.props.refreshShareStatus&&e.props.refreshShareStatus(2),_indexWeapp3.isDaojiaApp&&0<=e.isCompatible(String(_indexWeapp3.djAppVersion),String(7))?e.onlyCallUpWechat(e.props.shareInfo):e.handleOpenShare()})}},{key:"getCircleSharePic",value:function(){}},{key:"handleOpenShare",value:function(){var e=this.props.shareInfo,t=e.shareUrl||"https://img10.360buyimg.com/mobilecms/jfs/t1/48798/36/8506/78945/5d5f5808E4c17f412/219404b469b14dd3.jpg",e={title:e.title||"0元水果免费拿",desc:"京东到家果园",imgUrl:"https://img30.360buyimg.com/mobilecms/jfs/t1/65465/34/7772/289742/5d5ba9a2Ededf3e31/d9c6737e7ed4df17.png",appId:"gh_5103b94a8a56",mpImgUrl:e.shareUrl||"https://img30.360buyimg.com/mobilecms/jfs/t1/65465/34/7772/289742/5d5ba9a2Ededf3e31/d9c6737e7ed4df17.png",path:sharePath,pyqImg:t||"",callback:"",clickcallback:"",timeline_title:"",channel:"Wxfriends",qrparam:{top_pic:e.title||"0元水果免费拿",mid_pic:"",slogan:"京东二维码分享",qr_title:e.title||"0元水果免费拿",qr_content:"京东到家果园",qr_direct:t}};e.pyqImg&&(0,_indexWeapp6.openShare)(e)}},{key:"taroShareCode",value:function(){var e="00",t="00",a={},t=_indexWeapp3.isJDApp?_indexWeapp3.isJDReactNativeWebView?(e="01","02"):(e="03","04"):_indexWeapp3.isDaojiaApp?_indexWeapp3.isIOS?(e="05","06"):(e="07","08"):_indexWeapp3.isWeixin?(e="09","10"):(e="11","12");return a.circleChannel=e,a.cardChannel=t,a}},{key:"onlyCallUpWechat",value:function(e){(0,_indexWeapp4.hideLoading)(),_indexWeapp3.isIOS?_indexWeapp3.supportDJSHWK?window.webkit.messageHandlers.MobileNavi.postMessage({method:"toShareNew",params:JSON.stringify({method:"3",chat:{shareType:"2",data:{title:e.shareText||"京东到家",appId:"gh_5103b94a8a56",imageUrl:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png",miniProgram:sharePath,shareUrl:"https://daojia.jd.com/taro2orchard/h5dist/#/pages/orchard-t/index"},degradeParams:{title:e.shareText||"京东到家",dec:"0元水果免费拿",icon:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png",degradeUrl:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png"}},square:{},imgUrl:{},userAction:{}}),callBackName:null,callBackId:null}):(console.log("8888888880000000"),toShareNew(JSON.stringify({method:"3",chat:{shareType:"2",data:{title:e.shareText||"京东到家",appId:"gh_5103b94a8a56",imageUrl:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png",miniProgram:sharePath,shareUrl:"https://daojia.jd.com/taro2orchard/h5dist/#/pages/orchard-t/index"},degradeParams:{title:e.shareText||"京东到家",dec:"京东到家果园",icon:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png",degradeUrl:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png"}},square:{},imgUrl:{},userAction:{}}))):(_indexWeapp3.isAndroid,window.djJava.toShareNew("3",JSON.stringify({shareType:"2",data:{title:e.shareText||"京东到家",appId:"gh_5103b94a8a56",imageUrl:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png",miniProgram:sharePath,shareUrl:"https://daojia.jd.com/taro2orchard/h5dist/#/pages/orchard-t/index"},degradeParams:{title:e.shareText||"京东到家",dec:"京东到家果园",icon:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png",degradeUrl:e.shareUrl||"https://storage.360buyimg.com/wximg/signIn_new/giftBox.png"}}),"","",""))}},{key:"isCompatible",value:function(e,t){try{e=e.split("."),t=t.split(".");for(var a=Math.max(e.length,t.length);e.length<a;)e.push("0");for(;t.length<a;)t.push("0");for(var s=0;s<a;s++){var i=parseInt(e[s]),n=parseInt(t[s]);if(n<i)return 1;if(i<n)return-1}return 0}catch(e){}}},{key:"getSubscribeNotifyInfo",value:function(){var t=this;(0,_orchard.subscribeNotifyInfo)({notifyStatus:0}).then(function(e){0==e.code&&2==e.result?t.setState({switchChecked:!0}):t.setState({switchChecked:!1})}).catch(function(e){})}},{key:"subscribeNotifyInfo",value:function(){var t=this,e=1,e=this.state.switchChecked?1:2,e=(this.setState({switchChecked:!this.state.switchChecked}),(0,_orchard.subscribeNotifyInfo)({notifyStatus:e}).then(function(e){0==e.code&&2==e.result?t.setState({switchChecked:!0}):t.setState({switchChecked:!1})}).catch(function(e){t.setState({switchChecked:!1})}),1==e?"open":"close");(0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"clickNoticeButton",click_par:{switchStatus:e||""}})}},{key:"getPlateCode",value:function(){return 5}},{key:"_throttle",value:function(e,t){var a=this;this.shareFlag&&(this.shareFlag=!1,e.apply(this,arguments),setTimeout(function(){a.shareFlag=!0},t||2e3))}},{key:"jumpThoughtUrl",value:function(e){-1<e.indexOf("friendHelp")||-1<e.indexOf("friendhelp")?(0,_indexWeapp.jump)({type:"",to:"friendHelpList"}):-1<e.indexOf("bargain/list")?(0,_indexWeapp.jump)({type:"",to:"bargainList"}):-1<e.indexOf("bargain/detail")?(0,_indexWeapp.jump)({type:"",to:"bargainDetail"}):-1<e.indexOf("punch-t")?(0,_indexWeapp.jump)({type:"",to:"punch"}):-1<e.indexOf("lottery")?(0,_indexWeapp.jump)({type:"",to:"lottery"}):-1<e.indexOf("GroupBuy")?(0,_indexWeapp.jump)({type:"",to:"groupBuyList"}):-1<e.indexOf("taskList")?(0,_indexWeapp.jump)({type:"",to:"taskList"}):-1<e.indexOf("bean-t")?(0,_indexWeapp.jump)({type:"",to:"beans"}):-1<e.indexOf("/phoneCharge-t")?(0,_indexWeapp.jump)({type:"",to:"phoneCharge"}):-1<e.indexOf("activityPage")?(0,_indexWeapp.autoJump)({url:e}):-1<e.indexOf("signIn-t")?(0,_indexWeapp.jump)({type:"",to:"newSignIn"}):-1<e.indexOf("orchard-t")?(0,_indexWeapp.jump)({type:"",to:"orchard"}):-1<e.indexOf("cash-t")?(0,_indexWeapp.jump)({type:"",to:"cash"}):(0,_indexWeapp.jumpIntercept)(e)}},{key:"h5JumpIntercept",value:function(e){var t=e.includes("throughLoginInDJAPP"),a=null,a=t?{to:e,openWay:{jdweb:!0}}:{to:e};console.debug("jumpParams",a),console.debug("hasKey",t),(0,_indexWeapp2.jump2)(a)}},{key:"preventDefaultEvent",value:function(e){e.stopPropagation()}},{key:"isShareEvent",value:function(e,t){var a=e.taskId,s=e.taskName,i=e.awardValue,e=e.taskType;this.clickAnimation({index:t}),this.setState({hasShare:!0}),(0,_orchard.receivedTaskInfo)({modelId:"M10007",taskId:a,taskType:e,plateCode:this.getPlateCode()}).then(function(e){}).catch(function(e){}),(0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"clickButton",click_par:{questId:a,questName:s,waterReward:i,questStatus:1}})}},{key:"handleScenePop",value:function(t){for(var a=this,s=this.props.taskList,e=0;e<s.length;e++)!function(e){s[e].taskId==t&&a._throttle(function(){1102==s[e].taskType&&1==s[e].ifCanFinishTask||1103==s[e].taskType&&1==s[e].status?a.finishSubTask(s[e],null,!0):2==s[e].status?a.getReward(s[e],null,!0):((0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"showTriggerPopop",click_par:{questId:s[e].taskId,questName:s[e].taskName}}),a.setState({sceneTaskInfo:s[e],isSceneTaskPop:!0}))},500)}(e)}},{key:"handleNewerFunc",value:function(){var e=this.props.taskList;if(e)for(var t=0;t<e.length;t++)if(1103==e[t].taskType)return!0;return!1}},{key:"closeScenePop",value:function(){this.setState({isSceneTaskPop:!1})}},{key:"requestGetSceneId",value:function(e){var t=this,a=this.props.address;(0,_orchard.getTaskBySceneId)({sceneId:e,latitude:a.latitude,longitude:a.longitude,plateCode:this.getPlateCode()}).then(function(e){0==e.code&&e.result&&((0,_indexWeapp7.clickReport)({create_time:new Date,click_id:"showTriggerPopop",click_par:{questId:e.result.taskId,questName:e.result.taskName}}),t.getTask(e.result,e.result.taskId,e.result.taskType,!0))}).catch(function(e){})}}]),n}(),_class.$$events=["closePop","preventDefaultEvent","onTouchMove","closeScenePop","isShareEvent","clickTaskEvent","isShareEvent","clickTaskEvent","taskAgainEvent","clickTaskEvent","handleGuideGetWater"],_class.multipleSlots=!0,_class.$$componentPath="pages/orchard-t/components/TaskPop/index",_temp2);exports.default=TaskPop,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(TaskPop));