"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),_get=function e(t,n,a){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);return void 0!==o?"value"in o?o.value:void 0!==(o=o.get)?o.call(a):void 0:null!==(o=Object.getPrototypeOf(t))?e(o,n,a):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_orchard=require("../../api/orchard.js"),_utils=require("../../js/utils.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var PLATE_CODE=(0,_utils.getPlateCode)(),MODEL_ID="M10007",isWeapp=!0,REPORT={showAllreceive:function(e){var t=e.taskId,n=e.taskName,a=e.status;console.error("showAllreceive",e),(0,_indexWeapp.clickReport)({click_id:"showAllreceive",click_par:{taskId:t,taskName:n,status:a}})},clickAllreceive:function(e,t,n){var a=e.taskId,o=e.taskName,e=e.status;(0,_indexWeapp.clickReport)({click_id:"clickAllreceive",click_par:{taskId:a,taskName:o,status:e,prizeValue:t,node:n}})}},turnFlag=!0,ConSignInTask=(_temp2=_class=function(){function s(){var e,t;_classCallCheck(this,s);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t=_possibleConstructorReturn(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(a)))).$usedState=["anonymousState__temp","anonymousState__temp2","loopArray9","$anonymousCallee__0","style","subList","scrollLeft","isCanHandleReward","lastSubTask","listsLen","showFlag","taskData","transition","showGetWaterToast","isLargeScreen","closeConTaskLayer","handleShowPriorityPopFlag","handlePriorityPop","conSignInTask"],t.customComponents=[],_possibleConstructorReturn(t,e)}return _inherits(s,_index.Component),_createClass(s,[{key:"_constructor",value:function(e){_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,e),this.state={taskData:{},showFlag:!1,transition:{opacity:"1"},scrollLeft:0},this.$$refs=[]}},{key:"showPop",value:function(){this.setState({showFlag:!0},function(){});var e=this.state.taskData;REPORT.showAllreceive(e)}},{key:"handleReward",value:function(){function n(){(0,_indexWeapp2.showToast)({title:"领取失败，请稍后再试"})}var a=this,e=this.state.taskData,t=e.subList,t=void 0===t?[]:t,o=e.taskId,s=e.taskType,r=e.keepNode,r=t.find(function(e){return 1==e.taskStatus})||{node:r,prizeValue:t[t.length-1].prizeValue},t=r.node,t=void 0===t?"":t,i=r.prizeValue;(0,_orchard.finishedTaskInfo)({modelId:MODEL_ID,taskId:o,taskType:s,plateCode:PLATE_CODE,subNode:t}).then(function(e){var t=e.code,e=e.result;0==t?a.setState({taskData:e},function(){a.props&&a.props.showGetWaterToast(i,!0),a.handleClose()}):n()}).catch(function(e){n()}),REPORT.clickAllreceive(e,i,t)}},{key:"refrushForClose",value:function(){var e=this,t=this.props.isLargeScreen;this.setState({transition:{opacity:"1",transform:"translateX("+(0<arguments.length&&void 0!==arguments[0]?arguments[0]:-146)+"px) translateY("+(1<arguments.length&&void 0!==arguments[1]?arguments[1]:-150)+"px) scale(0)",top:t?"-16%":"4%"}},function(){setTimeout(function(){e.setState({showFlag:!1,transition:{opacity:"1",transform:"translateX(0px) translateY(0px) scale(0.75)",top:t?"-16%":"4%"}})},600)})}},{key:"handleCloseTrigger",value:function(){this.props&&this.props.closeConTaskLayer()}},{key:"handleClose",value:function(o){var s=this;_index2.default.createSelectorQuery();_index2.default.createSelectorQuery().in(this.$scope).select("#con_sign_layer").boundingClientRect(function(e){var t,n,a;o&&e?(t=o.top+o.height/2,n=e.top+e.height/2,a=o.left+o.width/2,e=e.left+e.width/2,s.refrushForClose(a-e,t-n)):s.refrushForClose()}).exec(),setTimeout(function(){s.setState({showFlag:!1}),s.props&&s.props.handleShowPriorityPopFlag()},600)}},{key:"componentWillReceiveProps",value:function(e){var t=e.conSignInTask,n=e.isLargeScreen;n&&this.setState({isLargeScreen:n,transition:{opacity:"1",transform:"translateX(0px) translateY(0px) scale(0.75)",top:"-16%"}}),e&&t&&t.subList&&turnFlag&&(turnFlag=!1,this.setState({taskData:t}))}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.props&&e.props.handlePriorityPop()},1e3)}},{key:"componentWillUnmount",value:function(){turnFlag=!0}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};this.$prefix;var e=this.__state,t=e.taskData,n=(e.showFlag,e.transition),e=(e.scrollLeft,t.subList),i=void 0===e?[]:e,e=t.todayFinishNum,e=void 0===e?0:e,t=t.keepNode,a=i.length||0,o=i[a-1]||{},s=this.__props.isLargeScreen,r=i.length?i.slice(0,a-1):[],e=0==e&&3!=o.taskStatus||0==e&&3==o.taskStatus&&0!=t&&null!=t,t=(0,_index.internal_inline_style)({alignItems:s?"center":null}),s=(0,_index.internal_inline_style)(n),n=i.length?i.slice(0,a-1).map(function(e,t){var n=(e={$original:(0,_index.internal_get_original)(e)}).$original,a=n.node,o=n.prizeValue,n=n.taskStatus,s=i.length,r="";return 2*(s-1)/3<t?r="last_part_item":(s-1)/3<t&&(r="mid_part_item"),{node:a,prizeValue:o,taskStatus:n,len:s,classNameItem:r,$original:e.$original}}):[];return Object.assign(this.__state,{anonymousState__temp:t,anonymousState__temp2:s,loopArray9:n,$anonymousCallee__0:r,style:_indexModuleScssMap2.default,subList:i,isCanHandleReward:e,lastSubTask:o,listsLen:a}),this.__state}}]),s}(),_class.$$events=["handleCloseTrigger","handleReward"],_class.$$componentPath="pages/orchard-t/components/ConSignInTask/index",_temp2);exports.default=ConSignInTask,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(ConSignInTask));