"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}(),_get=function e(t,i,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);return void 0!==r?"value"in r?r.value:void 0!==(r=r.get)?r.call(o):void 0:null!==(r=Object.getPrototypeOf(t))?e(r,i,o):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_orchard=require("../../api/orchard.js"),_common=require("../../api/common.js"),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var REPORT={clickConfirmExchange:function(e){(0,_indexWeapp2.clickReport)({click_id:"clickConfirmExchange",click_par:{fruitName:e}})},clickCancelExchange:function(e){(0,_indexWeapp2.clickReport)({click_id:"clickCancelExchange",click_par:{fruitName:e}})},clickBtnNoFruit:function(e){(0,_indexWeapp2.clickReport)({click_id:"clickBtnNoFruit",click_par:{ogfruitName:e}})},showAddress:function(e){(0,_indexWeapp2.clickReport)({click_id:"showAddress",click_par:{addressCount:e,type:"chooseAddress"}})},clickAddressList:function(e){var t=e.index,e=e.count;(0,_indexWeapp2.clickReport)({click_id:"clickAddressList",click_par:{pos:t,addressCount:e}})},clickAddAddress:function(){(0,_indexWeapp2.clickReport)({click_id:"clickAddAddress",click_par:{}})},showAddressForConfirmAddress:function(){(0,_indexWeapp2.clickReport)({click_id:"showAddress",click_par:{type:"confirmAddress"}})},clickConfirmAddress:function(){(0,_indexWeapp2.clickReport)({click_id:"clickConfirmAddress",click_par:{}})},showAddressForWriteAddress:function(){(0,_indexWeapp2.clickReport)({click_id:"showAddress",click_par:{type:"writeAddress"}})},clickConfirmAddAddress:function(){(0,_indexWeapp2.clickReport)({click_id:"clickConfirmAddAddress",click_par:{}})}},returnFlag="choose",InputLocation=(_temp2=_class=function(){function n(){var e,i;_classCallCheck(this,n);for(var t=arguments.length,o=Array(t),r=0;r<t;r++)o[r]=arguments[r];return(e=i=_possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(o)))).$usedState=["loopArray8","$compid__21","style","fruitName","chooseAddrList","name","chooseAddr","phone","province","city","area","address","pic","showInputLocationFlag","showMainFlag","chooseAddrFlag","confirmAddrFalg","noGoodsFlag","showSelectFruit","selectFruitData","hideInputLocation","data","refreshNewPersonFunc","handleFruitData"],i.handleChane=function(e,t){i.setState(_defineProperty({},e,t.target.value))},i.customComponents=["SelectFruit"],_possibleConstructorReturn(i,e)}return _inherits(n,_index.Component),_createClass(n,[{key:"_constructor",value:function(e){_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_constructor",this).call(this,e),this.state={name:"",phone:"",city:"",area:"",address:"",province:"",noGoodsFlag:!1,showSelectFruit:!1,showMainFlag:!1,selectFruitData:[],pic:"",fruitName:"",chooseAddrFlag:!0,chooseAddrList:[],chooseAddr:{},confirmAddrFalg:!1},this.$$refs=[]}},{key:"handleClickAllNo",value:function(){this.hideInputLocationView();var e=this.state.fruitName;REPORT.clickBtnNoFruit(e)}},{key:"hideInputLocation",value:function(){this.hideInputLocationView();var e=this.state.fruitName;REPORT.clickCancelExchange(e)}},{key:"hideInputLocationView",value:function(){var e=this;this.props.hideInputLocation(),setTimeout(function(){e.initFlagData()},100)}},{key:"initFlagData",value:function(){this.setState({noGoodsFlag:!1,showSelectFruit:!1,chooseAddrFlag:!0,showMainFlag:!1,chooseAddr:{},confirmAddrFalg:!1})}},{key:"handleSureConfirmAddr",value:function(){var e,t,i,o,r,n,s=this.props.data,s=(void 0===s?{}:s).activityId,a={};"add"===returnFlag&&(r=(e=this.state).name,n=e.phone,t=e.city,i=e.area,o=e.address,a={name:r,phone:n,province:e.province,city:t,area:i,address:o,activityId:s}),"choose"===returnFlag&&(a={name:(n=void 0===(r=this.state.chooseAddr)?{}:r).name,phone:n.mobile,city:n.cityName,area:n.countyName,address:""+n.poi+n.addressDetail,activityId:s,addressId:n.id}),this.createOrderByReq(a),REPORT.clickConfirmAddress()}},{key:"handleSure",value:function(){var e=this.state,t=e.name,i=e.phone,o=e.city,r=e.area,n=e.address,e=e.province;REPORT.clickConfirmAddAddress(),t?i?11!=i.length?(0,_indexWeapp.showToast)({title:"请填写正确的收货人手机号"}):e?o?r?n?(this.setState({chooseAddr:{}}),this.finishAddAddr()):(0,_indexWeapp.showToast)({title:"请填写收货人所在详细地址"}):(0,_indexWeapp.showToast)({title:"请填写收货人所在区县"}):(0,_indexWeapp.showToast)({title:"请填写收货人所在市"}):(0,_indexWeapp.showToast)({title:"请填写收货人所在省/直辖市/自治区"}):(0,_indexWeapp.showToast)({title:"请填写收货人手机号"}):(0,_indexWeapp.showToast)({title:"请填写收货人姓名"})}},{key:"createOrderByReq",value:function(e){var o=this,e=((0,_orchard.createOrder)(e).then(function(e){var t=e.code,i=e.msg;e.result;0==t?((0,_indexWeapp.showToast)({title:"水果已经在路上啦，再种一棵果树吧~"}),o.hideInputLocationView(),o.refreshNewPersonFunc()):-2==t||-3==t?(0,_orchard.getFruitListForExchange)({}).then(function(e){var t=e.code,i=e.msg,e=e.result;0==t?o.setState({showSelectFruit:!0,showMainFlag:!1,confirmAddrFalg:!1,selectFruitData:e}):(0,_indexWeapp.showToast)({title:i})}).catch(function(e){console.error(e),(0,_indexWeapp.showToast)({title:e})}):(0,_indexWeapp.showToast)({title:i})}).catch(function(e){console.error(e),(0,_indexWeapp.showToast)({title:e})}),this.state.fruitName);REPORT.clickConfirmExchange(e)}},{key:"finishReselet",value:function(){this.initFlagData(),this.getAddressListByPlat()}},{key:"refreshNewPersonFunc",value:function(){this.props.refreshNewPersonFunc&&this.props.refreshNewPersonFunc()}},{key:"getFruitPic",value:function(o){var r=this;(0,_orchard.getFruitListInfo)({}).then(function(e){var t=e.code,i=e.msg,e=e.result;0==t?o&&(t=e.find(function(e){return e.fruitId==o}))&&(e=t.pic,r.props.handleFruitData&&r.props.handleFruitData(t),r.setState({pic:e})):console.error(i)}).catch(function(e){console.error(e)})}},{key:"receiveByFinishChoose",value:function(e){var t=e.fruitId,e=e.fruitName;this.getFruitPic(t),this.setState({fruitName:e})}},{key:"getAddressListByPlat",value:function(){var i=this;(0,_common.getAddressList)({}).then(function(e){var t=e.code,e=e.result;0==t&&(e&&e.length?(console.error(1111),i.setState({chooseAddrList:e,showMainFlag:!1}),i.props.showInputLocationFlag&&REPORT.showAddress(e.length)):(console.error(2222),i.setState({showMainFlag:!0,chooseAddrFlag:!1}),i.props.showInputLocationFlag&&REPORT.showAddressForWriteAddress()))}).catch(function(e){console.error(3333),console.error(e),i.setState({showMainFlag:!0,chooseAddrFlag:!1}),i.props.showInputLocationFlag&&REPORT.showAddressForWriteAddress()})}},{key:"handleChooseAddr",value:function(e,t,i){returnFlag="choose",this.setState({chooseAddr:e,confirmAddrFalg:!0,chooseAddrFlag:!1}),REPORT.clickAddressList({index:t,count:i.length}),REPORT.showAddressForConfirmAddress()}},{key:"handleReturn",value:function(){this.setState({confirmAddrFalg:!1}),"choose"===returnFlag&&this.setState({chooseAddrFlag:!0}),"add"===returnFlag&&(this.setState({showMainFlag:!0}),REPORT.showAddressForWriteAddress())}},{key:"finishAddAddr",value:function(){returnFlag="add",this.setState({confirmAddrFalg:!0,showMainFlag:!1}),REPORT.showAddressForConfirmAddress()}},{key:"addNewAddr",value:function(){returnFlag="choose",this.setState({showMainFlag:!0,chooseAddrFlag:!1}),REPORT.clickAddAddress(),REPORT.showAddressForWriteAddress()}},{key:"getFruitList",value:function(){var e=this.props.data,e=(void 0===e?{}:e).fruitId,t=this.state.pic;console.log("fruitid",e+"="+t),e&&t&&this.getFruitPic(e)}},{key:"componentWillReceiveProps",value:function(e,t){console.error("componentWillReceiveProps"),e.showInputLocationFlag&&console.error("componentWillReceiveProps-showInputLocationFlag")}},{key:"componentDidMount",value:function(){var i=this;console.error("componentDidMount"),setTimeout(function(){var e=i.props.data,e=void 0===e?{}:e,t=e.fruitId,e=e.fruitName;i.getFruitPic(t),i.setState({fruitName:e})},1e3),this.getAddressListByPlat()}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var e=this.$prefix,e=(0,_index.genCompid)(e+"$compid__21"),t=this.__state,i=(t.name,t.phone,t.city,t.area,t.address,t.province,t.noGoodsFlag,t.showSelectFruit),o=(t.showMainFlag,t.selectFruitData),t=(t.pic,t.fruitName),r=this.__state,n=(r.chooseAddrFlag,r.chooseAddrList),n=void 0===n?[]:n,s=r.chooseAddr,a=void 0===s?{}:s,s=(r.confirmAddrFalg,this.__props),r=s.showInputLocationFlag,s=s.data,s=(void 0===s?{}:s).activityId,n=n.length?n.map(function(e,t,i){var o=(e={$original:(0,_index.internal_get_original)(e)}).$original,r=(o.name,o.mobile),n=o.fullAddress,o=o.id;return{list:i,mobile:r,fullAddress:n,id:o,checkStatus:a.id==o?_indexModuleScssMap2.default.checked:_indexModuleScssMap2.default.unchecked,$original:e.$original}}):[];return r&&_index.propsManager.set({showSelectFruitFlag:i,isReselectFlag:!0,fruitNameBefore:t,activityId:s,SelectFruitData:o,finishReselet:this.finishReselet.bind(this),refreshNewPersonFunc:this.refreshNewPersonFunc.bind(this),commitByFinishChoose:this.receiveByFinishChoose.bind(this)},e),Object.assign(this.__state,{loopArray8:n,$compid__21:e,style:_indexModuleScssMap2.default,showInputLocationFlag:r}),this.__state}}]),n}(),_class.$$events=["handleClickAllNo","hideInputLocationView","handleChooseAddr","addNewAddr","handleReturn","handleSureConfirmAddr","hideInputLocation","handleChane","handleSure"],_class.$$componentPath="pages/orchard-t/components/InputLocation/index",_temp2);exports.default=InputLocation,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(InputLocation));