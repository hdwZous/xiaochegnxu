"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function r(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e}}(),_get=function e(t,a,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,a);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(r):void 0:null!==(n=Object.getPrototypeOf(t))?e(n,a,r):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_orchard=require("../../api/orchard.js"),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_utils=require("../../js/utils.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _this2=void 0,_arguments=arguments,REPORT={clickWaterWheel:function(e,t){(0,_indexWeapp2.clickReport)({click_id:"clickWaterWheel",click_par:{claimWater:e,fullWater:t}})},waterWheelFTE:function(e){(0,_indexWeapp2.clickReport)({click_id:"waterWheelFTE",click_par:{step:e}})}},mockRes={firstPlayFlag:1,capacityLimit:80,normalSpeed:1.123,weakSpeed:.212,collectChangeSpeed:10,totalCollectWater:1,waterStorageFloat:79},tmpRes=null,timer=null,nums2Array=function(e){if(isNaN(e))return[0,0,0,0,0];var t=String(e).split("."),a=[];1==t[0].length?(a.push(0),a.push(t[0])):(a.push(t[0][0]),a.push(t[0][1]));for(var r=0;r<3;r++)t[1]&&t[1][r]?a.push(t[1][r]):a.push(0);return a},throttleFlag=!0,_throttle=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2e3;throttleFlag&&(throttleFlag=!1,e.apply(_this2,_arguments),setTimeout(function(){throttleFlag=!0},t))},isWeapp=!0,Waterwheel=(_temp2=_class=function(){function o(){var e,t;_classCallCheck(this,o);for(var a=arguments.length,r=Array(a),n=0;n<a;n++)r[n]=arguments[n];return(e=t=_possibleConstructorReturn(this,(t=o.__proto__||Object.getPrototypeOf(o)).call.apply(t,[this].concat(r)))).$usedState=["style","waterwheel_ani","animateRotate","finish","animateDrop","isNewer","nums","step","refreshNewPersonFunc","freezeClickKettle","showGetWaterToast","handleWaterScene","isFirst"],t.customComponents=[],_possibleConstructorReturn(t,e)}return _inherits(o,_index.Component),_createClass(o,[{key:"_constructor",value:function(e){_get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_constructor",this).call(this,e),this.state={animateRotate:"rotate",animateDrop:"drop",nums:[],finish:!1,step:1,isNewer:!1,waterwheel_ani:""},this.$$refs=[]}},{key:"animate",value:function(){var l=this;tmpRes.firstPlayFlag;clearInterval(timer),timer=setInterval(function(){var e=tmpRes,t=e.totalCollectWater,a=e.waterStorageFloat,r=e.normalSpeed,n=e.weakSpeed,o=e.collectChangeSpeed,i=e.capacityLimit,e=(e.firstPlayFlag,e.date),s=r;i<=a?(tmpRes.waterStorageFloat=i,i=nums2Array(tmpRes.waterStorageFloat),l.setState({nums:i,finish:!0}),clearInterval(timer)):(s=(new Date).getDate()!=e||t<o?r:n,tmpRes.waterStorageFloat=a+s/10,i=nums2Array(tmpRes.waterStorageFloat),l.setState({nums:i,finish:!1}))},100)}},{key:"dataToRednder",value:function(e){(tmpRes=e).date=(new Date).getDate();e=tmpRes.waterStorageFloat,e=nums2Array(e);this.setState({nums:e}),this.animate()}},{key:"getWheelData",value:function(){var r=this;(0,_orchard.getWaterWheelInfo)({}).then(function(e){var t=e.code,a=e.msg,e=e.result;0==t?r.dataToRednder(e):(0,_indexWeapp.showToast)({title:a})}).catch(function(e){console.error(e),(0,_indexWeapp.showToast)({title:e})})}},{key:"refreshNewPersonFunc",value:function(){this.props.refreshNewPersonFunc&&this.props.refreshNewPersonFunc(),this.props.freezeClickKettle&&this.props.freezeClickKettle()}},{key:"clickReport",value:function(){var e=this.state,t=e.finish,t=void 0!==t&&t,e=e.nums,e=void 0===e?[]:e;e.length?(e=e.join(""),e/=1e3):e="-",REPORT.clickWaterWheel(e,t)}},{key:"clickAnimation",value:function(e){var t=this;this.setState({waterwheel_ani:_utils.clickAnimationName},function(){setTimeout(function(){t.setState({waterwheel_ani:""})},_utils.clickAnimationGap)})}},{key:"throttleHandleClick",value:function(){_throttle(this.handleClick.bind(this),700)}},{key:"showGetWaterToast",value:function(e){this.props.showGetWaterToast?this.props.showGetWaterToast(e):(0,_indexWeapp.showToast)({title:"成功收取"+e+"水滴"})}},{key:"handleClick",value:function(){var e,r=this;this.clickAnimation(),this.clickReport(),this.state.isNewer?REPORT.waterWheelFTE(2):this.props.handleWaterScene&&this.props.handleWaterScene(),r.setState({step:-1,isNewer:!1});console.error(111111,r.state),e=r.state.nums,Number(e.join(""))/1e3<1?(0,_indexWeapp.showToast)({title:"水滴满1g才能收哟~"}):(clearInterval(timer),(0,_orchard.fruitCollectWater)({}).then(function(e){var t=e.code,a=e.msg,e=e.result;0==t?(t=r.state.nums,t=Math.floor(Number(t.join(""))/1e3),r.showGetWaterToast(t),e.waterStorageFloat=0,r.dataToRednder(e),r.refreshNewPersonFunc()):(0,_indexWeapp.showToast)({title:a})}).catch(function(e){console.error(e),(0,_indexWeapp.showToast)({title:e})}))}},{key:"newerClick",value:function(){this.setState({step:2}),REPORT.waterWheelFTE(1)}},{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidMount",value:function(){this.getWheelData();var e=this.props.isFirst;this.setState({isNewer:e})}},{key:"componentWillUnmount",value:function(){clearInterval(timer)}},{key:"componentDidShow",value:function(){this.getWheelData()}},{key:"componentDidHide",value:function(){}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};this.$prefix;var e=this.__state;e.animateRotate,e.animateDrop,e.nums,e.finish,e.step,e.isNewer,e.waterwheel_ani;return Object.assign(this.__state,{style:_indexModuleScssMap2.default}),this.__state}}]),o}(),_class.$$events=["newerClick","throttleHandleClick"],_class.$$componentPath="pages/orchard-t/components/Waterwheel/index",_temp2);exports.default=Waterwheel,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Waterwheel));