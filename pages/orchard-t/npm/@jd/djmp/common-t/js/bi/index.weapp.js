"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.exposureReport=exports.clickReport=exports.pvReport=void 0;var _indexWeapp=require("../utils/index.weapp.js"),_indexWeapp2=require("../getApp/index.weapp.js"),_indexWeapp3=_interopRequireDefault(_indexWeapp2),_aesUtils=require("../utils/aes.utils.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var pathUrlMap={"pages/home/home":"home","pages/store/index":"storeinfo","pages/tabBar/orderlist/index":"myorderlist","pages/order/orderdetail/index":"myorderdetail","pages/settlement/settlement":"settlement","pages/coupon/person-coupon":"couponslist","pages/searchAbout/search/search":"search","pages/searchAbout/search-result/search-result":"search_results","pages/searchAbout/storeSearchResult/storeSearchResult":"store_search","pages/channelNew/index":"channel","pages/shareGift/shareGift":"sharegift","pages/shareGift/coupon":"invitefriends","pages/tabBar/easyGo/easyGo":"EasyGoHome","pages/easyGo/shoppingCart/index":"easygoshopcar","pages/easyGo/paySuccess/paySuccess":"EasyGoVerificationCode","pages/easyGo/orderFinish/index":"EasyGoOrderSuccess","pages/tabBar/person/person":"myinfo","pages/coupon/voucherlist":"voucherlist","pages/coupon/push-coupon":"push_coupon","pages/redPacketFission/redPacketFission":"reward","pages/order/orderstatus/index":"order_status","pages/newLogin/login/login":"login","pages/activity/homeFocus/index":"activitypage","pages/worldcup/index":"worldcup_home","pages/worldcup/select-game":"worldcup_select_game","pages/worldcup/guess-history":"worldcup_guess_history","pages/worldcup/cup-coin":"worldcup_cup_coin","pages/worldcup/coupon":"worldcup_coupon","pages/worldcup/add-records":"worldcup_add_records","pages/worldcup/rank":"worldcup_rank","pages/worldcup/shared-game":"worldcup_shared","pages/order/paySuccess/index":"ordersuccess","pages/activity/store/index":"storeactivity","pages/groupBuy/groupList/index":"CollageSale","pages/groupBuy/groupBuyDetail/index":"CollageGoodsInfo","pages/groupBuy/paySuccess/index":"CollageResult&&CollagePaySuccess","pages/groupBuy/join/index":"CollageJoin","pages/groupBuy/orderInfo/index":"collageorderdetail","pages/groupBuy/confirmOrder/index":"CollageOrderConfirm","pages/groupBuy/chooseStore/index":"ChangeStoreAddress","pages/groupBuy/collection/myCollectionDetail/index":"CollageOrderInfo","pages/address/home/index":"location","pages/address/search/index":"poi_search_lst","pages/address/map/index":"current_address_list","pages/address/createOrEdit/index":"new_address","pages/settlement/remarkPage/remarkPage":"OrderNote","pages/order/ordergoods/index":"OrderGoodsList","pages/bargain/fuel/index":"cutdownhelp","pages/bargain/cutGoodList/index":"cutdowngoods","pages/bargain/launch/index":"cutdowndetail","pages/personSecond/pay-result/pay-result":"ordersuccess_offline","pages/inviteFriends/index":"sharegift_invite","pages/personSecond/feedback/feedback":"AdviceNote","pages/medicineMan/choose/index":"drugUserList","pages/order/addOrRenewMember/index":"ShopMemberPay","pages/coupon/voucher/index":"getcoupon_offline","pages/coupon/storeList/index":"SelectAddressOffline","pages/lottery/list/index":"luckyby0list","pages/lottery/detail/index":"luckyby0detail","pages/lottery/userList/index":"luckyby0userlist","pages/h5/index":"webView","pages/groupBuy/oldInviteNew/detail/index":"OldNewCollageGoodsInfo","pages/groupBuy/oldInviteNew/result/index":"OldNewCollageInfoLaunch","pages/groupBuy/oldInviteNew/fuel/index":"OldNewCollageInfoJoin","pages/friendHelp/detail/index":"helpfriendinfo","pages/friendHelp/list/index":"friendshelplist","pages/friendHelp/myList/index":"myFriendsHelpList","pages/friendHelp/launch/index":"MyLaunchHelpInvite","pages/signInLand/index":"APPSignInShare","pages/groupBuy/groupOrder/index":"mygroupbuy","pages/product/index":"goodsinfo","pages/punch-t/home/index":"PunchCardsEarly","pages/punch-t/account/index":"MyBounty","pages/bean-t/index":"FreshBeanManor","pages/farm-t/home/index":"activityEgg","pages/farm-t/record/index":"PageMyExchange","pages/farm-t/storelist/index":"PageChooseShop","pages/tabBar/signIn-t/index":"PageSignIn","pages/signIn-t/record/index":"SignRecord","pages/signIn-t/taskList/index":"SignTask","pages/signIn-t/newCustomerBenefit/index":"SignNewCustomer","pages/signIn-t/secondKillList/index":"SignSecondKillList","pages/beansExchange-t/exchangeDetail/index":"ExchangeDetailPage","pages/beansExchange-t/myExchange/index":"MyExchangePage","pages/phoneCharge-t/index":"phoneCharge","pages/phoneCharge-t/rechargeList/index":"rechargeList","pages/phoneCharge-t/rechargeDetail/index":"rechargeDetail","pages/phoneCharge-t/payResult/index":"payResult","pages/vpayMember-t/home/index":"newvippage","pages/vpayMember-t/instructions/index":"PaidMemberHelp","pages/vpayMember-t/taskPage/index":"PaidMemberTask","pages/vpayMember-t/discountList/index":"Redenvelopepage","pages/vpayMember-t/couponTab/index":"VIPrednewpage","pages/vpayMember-t/renew/index":"renewpage","pages/vpayMember-t/introductionPage/index":"vip_jintiejieshao","pages/vpayMember-t/bountyList/index":"vip_jintiemingxi","pages/vpayMember-t/packageSelection/index":"packageSelection","pages/vpayMember-t/memberDay/index":"memberDay","pages/vpayMember-t/manageRenew/index":"manageRenew","pages/hackOrder-t/detail/index":"hackOrderDetail","pages/hackOrder-t/launch/index":"hackOrderLaunch","pages/differentIndustry-t/index":"vipCooperatepage","pages/differentIndustry-t/yili/index":"yiliVipCooperatepage","pages/differentIndustry-t/exchangePage/index":"vip_code_cooperatepage","pages/differentIndustry-t/home/index":"vipcooperatepage_home","pages/vpayMember-t/exchangePage/index":"vip_codepage","pages/offLineActive-t/index":"offlineGwdLanding","pages/getCoupon-t/index":"wxcouponpage","pages/cash-t/index":"CashCreatorPage","pages/cash-t/detail/index":"CashHelpPage","pages/cash-t/account/index":"CashPage","pages/orchard-t/index":"orchard","pages/orchard-t/strategy/index":"orchardStrategy","pages/orchard-t/myHarvest/index":"orchardMyHarvest","pages/newUser-t/index":"newComerActivity","pages/newPerson-t/index":"newPersonActivity","pages/takeCoupon-t/index":"couponBranch","pages/firstOrderFission-t/launch/index":"firstOrderFissionlaunch","pages/firstOrderFission-t/detail/index":"firstOrderFissiondetail","pages/firstOrderFission-t/account/index":"firstOrderFissionaccount","pages/bargain-t/launch/index":"bargainlaunch","pages/bargain-t/list/index":"bargainlist","pages/bargain-t/detail/index":"bargaindetail","pages/bargain-t/jrOpenmini/index":"bargainjrOpenmini","pages/redPacket-t/index":"newRain","pages/shopCartList/index":"shopcar"};function getCurPage(){var e,a=getCurrentPages(),t=a.length||0;return 0==t?{name:"",path:""}:1==t?(e=a[0]&&a[0].route||"",{name:pathUrlMap[e]||"",path:e||""}):2<=t?(e=a[t-1]&&a[t-1].route||"",{name:pathUrlMap[e]||"",path:e||""}):void 0}function getPrePage(){var e,a=getCurrentPages(),t=a.length||0;return 0==t?{name:"",path:""}:1==t?(e=a[0]&&a[0].route||"",{name:pathUrlMap[e]||"",path:e||""}):2<=t?(e=a[t-2]&&a[t-2].route||"",{name:pathUrlMap[e]||"",path:e||""}):void 0}var report=function(e){var a=(0,_indexWeapp3.default)(),t=wx.getStorageSync("address_info")||{},n=wx.getStorageSync("login_info")||{},r=n.openId||"",i=n.o2o_m_h5_sid||"",n=n.PDJ_H5_PIN||"",o="",s="",p={};try{var d=(p=wx.getSystemInfoSync()||{}).system.split(" "),o=d[0],s=d[1]}catch(e){}var d=new Date,g=e.create_time&&e.create_time.getTime()||d.getTime(),c=a._independent_.testtag||[],l=(0<c.length&&c.forEach(function(e,a){Date.now()-e.startTime>e.duration&&c.splice(a,1)}),getPrePage()),u=getCurPage(),x=[{platcode:"wx_xcx",cur_path:u.path||"",ref_path:l.path||"",cur_page:e.page_name||u.name||"",is_test:a._independent_.config.is_test,log_data_type:e.log_data_type,session_id:i,ep:e.ep||"",page_name:e.page_name||u.name||"",ref_page_name:l.name||"",device_id:(0,_indexWeapp.getDeviceId)(),network:a._independent_.networkType||a.globalData&&a.globalData.networkType||"",poi_select:t.poi,lat_select:t.latitude,lng_select:t.longitude,city_name_select:t.cityName,lng_pos:t.longitude||"",lat_pos:t.latitude||"",channel_name:a._independent_.qrcode.business||a.globalData&&a.globalData.qrcode.business||"",app_name:"wx_xcx",app_version:e.app_version||"8.16.0",wechat_version:p.version,create_time:g,clienttime:d.getTime(),visit_time:d.getTime(),os:o,os_ver:s,openId:r,brand:p.brand,model:p.model,click_par:e.click_par||"",ext_par:{roomid:a._independent_.qrcode.roomid||a.globalData&&a.globalData.qrcode.roomid||"",fontSizeSetting:p.fontSizeSetting,SDKVersion:p.SDKVersion,language:p.language,adcode:t.adcode||"",sourcefrom:"index",scene:a._independent_.qrcode||a.globalData&&a.globalData.qrcode||"",wxScene:a._independent_.appScene||a.globalData&&a.globalData.appScene||"",wxGroupId:a._independent_.wxGroupId||a.globalData&&a.globalData.wxGroupId||"",dj_par_key:a._independent_.qrcode.dj_par_key||a.globalData&&a.globalData.qrcode.dj_par_key||"",wetchat_type:"taro"},page_par:e.page_par||"",user_id:n,store_id:e.store_id||"",sku_id:e.sku_id||"",order_id:e.order_id||"",click_id:e.click_id||"",testtag:JSON.stringify(c),traceId:e.traceId||""}],_=(console.log("body----------",x),"show"===e.log_data_type?e.log_data_type:"daojia_wechat");wx.request({url:"https://log-o2o.jd.com/v1/logging",data:{"kafka topic":"topic_daojia_wechat_app",logType:_,json:encodeURIComponent((0,_aesUtils.encrypt)(JSON.stringify(x))),jef:1},method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",Cookie:"cart_uuid="+(0,_indexWeapp.getDeviceId)(),sid:i},success:function(e){e.data&&110==e.data.code&&(console.error("埋点降级传输2"),wx.request({url:"https://log-o2o.jd.com/v1/logging",data:{"kafka topic":"topic_daojia_wechat_app",logType:_,json:JSON.stringify(x)},method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",Cookie:"cart_uuid="+(0,_indexWeapp.getDeviceId)(),sid:i}}))}})},pvReport=exports.pvReport=function(e){var a=getCurPage(),t=setTimeout(function(){e.log_data_type="wechat_app_pv",report(e),clearTimeout(t);try{(0,_indexWeapp3.default)().globalData&&(0,_indexWeapp3.default)().globalData.globalCurrentPageNameObj&&((0,_indexWeapp3.default)().globalData.globalCurrentPageNameObj={currentPageName:e.page_name||a.name||""})}catch(e){console.log("globalCurrentPageNameObj-------",e)}},50)},clickReport=exports.clickReport=function(e){e.log_data_type="wechat_app_click",report(e)},exposureReport=exports.exposureReport=function(e,a){e.log_data_type="show",report(e,a)};