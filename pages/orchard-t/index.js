"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,a=arguments[t];for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},_createClass=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}}(),_get=function e(t,i,a){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(t))?e(n,i,a):void 0},_index=require("./npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("./npm/@jd/djmp/common-t/js/login/index.weapp.js"),_common=require("./api/common.js"),_indexWeapp2=require("./npm/@jd/djmp/common-t/js/location/index.weapp.js"),_indexWeapp3=require("./npm/@jd/djmp/common-t/js/env/index.weapp.js"),_indexWeapp4=require("./npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp5=require("./npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp6=require("./npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_utilsWeapp=require("./npm/@jd/djmp/common-t/js/utils/utils.weapp.js"),_orchard=require("./api/orchard.js"),_utils=require("./js/utils.js"),_constant=require("./js/constant.js"),_indexWeapp7=require("./js/lottieUtil/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var weapp=!0,anim=null,animUp=null,animleaf=null,isfirst=!1,lastTime=0,isDoubleHits=!1,isFirstDoubleHits=!0,timer=null,isReportAddress=!0,isFirstFruiterReport=!0,isFirstTaskReport=!0,isLoginLocation=!1,isShowPriorityPop=!1,isFirstCallSceneApi=!0,MODLE_ID="M10007",priorityMap=new Map,fruitData=null,REPORT={clickMyReward:function(){(0,_indexWeapp6.clickReport)({click_id:"clickMyReward"})},showSelectFruit:function(){(0,_indexWeapp6.clickReport)({click_id:"showSelectFruit"})},showProgressPacket:function(){(0,_indexWeapp6.clickReport)({click_id:"showProgressPacket"})},clickProgressPacket:function(e,t){(0,_indexWeapp6.clickReport)({click_id:"clickProgressPacket",click_par:{status:e,packetNum:t}})}},isNeedNewerPro=!1,getPositionController=function(){return new Promise(function(t,i){_indexWeapp3.isJDFinanceApp?fliterGetPositionInJR()?(0,_indexWeapp2.getPositionByJRJSBridge)().then(function(e){t(e)}).catch(function(e){(0,_indexWeapp2.getLocation)().then(function(e){t(e)}).catch(function(e){i(e)})}):i():(0,_indexWeapp2.getLocation)().then(function(e){t(e)}).catch(function(e){i(e)})})},Index=(_temp2=_class=function(){function s(){var e,t;_classCallCheck(this,s);for(var i=arguments.length,a=Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t=_possibleConstructorReturn(this,(t=s.__proto__||Object.getPrototypeOf(s)).call.apply(t,[this].concat(a)))).$usedState=["anonymousState__temp4","anonymousState__temp6","anonymousState__temp7","anonymousState__temp8","anonymousState__temp9","anonymousState__temp10","anonymousState__temp11","anonymousState__temp12","loopArray0","$compid__2","$compid__3","$compid__4","$compid__5","$compid__6","$compid__7","$compid__8","$compid__9","$compid__10","$compid__11","$compid__12","$compid__13","$compid__14","$compid__15","$compid__16","$compid__17","$compid__18","style","kettleBreatheAnimateForTips","waterTipsNums","data","showGetWaterAndGrowFlag","waterStep","isShowGuideMask","PlayIntroduceFlagClickNum","isNewPersonGetWaterFlag","anonymousState__temp","showWaterHand","WaterWheelNums","kettleAnimate","waterTipsShow","newerGiftData","conSignInTask","subList","showLoadIngFlag","backgroundPic","isShowMoreFunc","sceneTaskList","isUpgrade","isLeafAni","treeAmimate","isAndroid","redPackInfo","redPackageAnimation","showProcessLight","showUpgradeNodelay","showTaskGuideFlag","taskIsCanGet","showWaterWheel","showAssistance","taskShow","anonymousState__temp2","storeCouponLayer","anonymousState__temp3","showSignFlag","showGetLocationFlag","showDefaultPage","showErrorPage","seriesWaterData","undefined","showErrorPageMsg","result","treeClickdisabled","showBackFlag","showSelectFruit","showPlayIntroduceFlag","newUserGrowUpRewardWater","coldAmimate","showHandAmimate","kettleBreatheAnimate","taskList","showPopAminate","shareInfo","SelectFruitData","showUpgrade","isClickGetWaterUpBtn","processValue","isShowKettleAni","showPopForSuperOrder","superOrderTaskInfo","taskToast","toStoreInfo","address","ruleResponse","showInputLocation","isFirstInWheel","isSceneTaskPop","isFirstInAssis","showDetainPop","statusBarH","timingQuestPush","clickTaskBallAnimation","kettleClickAni","getWaterAni","levelUpRewardNum","layerPriority","isFirstIn","router"],t.config={navigationBarTitleText:"到家果园",navigationStyle:"custom",disableScroll:!0},t.customComponents=["SceneTaskPop","SuperOrderTaskPop","Waterwheel","Assistance","TaskPop","BrowseStoreCouponPop","SelectFruit","FruitBackground","NewGetWater","InputLocation","DetainPop","GetWaterDrop","TomorrowReward","RedPacket","NewerGift","SeriesWatering","RipePop","CustomNavBg","ConSignInTask","UpgradePopNew"],_possibleConstructorReturn(t,e)}return _inherits(s,_index.Component),_createClass(s,[{key:"_constructor",value:function(e){var t=this;_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"_constructor",this).call(this,e),this.shareFlag=!0,this.state={showLoadIngFlag:!0,data:{},result:{},treeClickdisabled:!1,treeAmimate:"",showBackFlag:!1,showGetWaterAndGrowFlag:!1,showSignFlag:!1,showGetLocationFlag:!1,showDefaultPage:!1,showSelectFruit:!1,isNewPersonGetWaterFlag:!1,showPlayIntroduceFlag:!1,showTaskGuideFlag:!1,newUserGrowUpRewardWater:0,waterStep:0,PlayIntroduceFlagClickNum:0,isShowGuideMask:!0,WaterWheelNums:-1,coldAmimate:!0,showHandAmimate:!1,kettleBreatheAnimate:"",taskList:[],kettleAnimate:!0,showPopAminate:!1,shareInfo:{},SelectFruitData:[],taskIsCanGet:!1,taskShow:!1,isUpgrade:!1,showUpgrade:!1,showUpgradeNodelay:!1,isClickGetWaterUpBtn:!1,processValue:0,isShowKettleAni:!1,showPopForSuperOrder:!1,superOrderTaskInfo:{},taskToast:"",storeCouponLayer:!1,toStoreInfo:{},address:{},isShowMoreFunc:!1,ruleResponse:{},backgroundPic:"",showInputLocation:!1,isLeafAni:!1,showErrorPage:!1,showErrorPageMsg:"",showWaterWheel:!1,isFirstInWheel:!1,isSceneTaskPop:!1,sceneTaskList:[],showAssistance:!1,isFirstInAssis:!1,showDetainPop:!1,statusBarH:20,waterTipsNums:0,waterTipsShow:!1,kettleBreatheAnimateForTips:"",timingQuestPush:!1,clickTaskBallAnimation:-1,kettleClickAni:"",getWaterAni:"",showProcessLight:!1,showWaterHand:!1,levelUpRewardNum:"",layerPriority:{},redPackageAnimation:"shakeMove",redPackInfo:{},newerGiftData:{},seriesWaterData:{},isFirstIn:!0},this.$$refs=[{type:"component",id:"DIYwX",refName:"",fn:function(e){return t.childSceneTaskPop=e}},{type:"component",id:"kJqKe",refName:"",fn:function(e){return t.childTaskSuPop=e}},{type:"dom",id:"kettle",refName:"kettleBtn",fn:null},{type:"component",id:"dNWkg",refName:"",fn:function(e){return t.waterWheelRef=e}},{type:"component",id:"POiIT",refName:"",fn:function(e){return t.childPop=e}},{type:"component",id:"uuMGg",refName:"",fn:function(e){return t.childSelectFruit=e}},{type:"component",id:"XxFOv",refName:"",fn:function(e){return t.childInputLocation=e}},{type:"component",id:"UeTYA",refName:"",fn:function(e){return t.getWaterToast=e}},{type:"component",id:"GuftU",refName:"",fn:function(e){return t.childTomo=e}},{type:"component",id:"QURzZ",refName:"",fn:function(e){return t.childRedPacket=e}},{type:"component",id:"eBlKV",refName:"",fn:function(e){return t.childNewerGift=e}},{type:"component",id:"LGiPg",refName:"",fn:function(e){return t.childSeriesWatering=e}},{type:"component",id:"sucIZ",refName:"",fn:function(e){return t.childRipePop=e}},{type:"component",id:"oZQaz",refName:"",fn:function(e){return t.childCustomNavBg=e}},{type:"component",id:"bxFCR",refName:"",fn:function(e){return t.childConSignIn=e}}]}},{key:"getPlateCode",value:function(){return 5}},{key:"getInitData",value:function(){_index2.default.request({method:"GET",url:"https://storage.360buyimg.com/wximg/orchard/data/init/orchardInitV2.json",header:{"content-type":"application/x-www-form-urlencoded;"}}).then(function(e){(0,_indexWeapp4.setStorageSync)("orchard_init",e.data.result)}).catch(function(e){})}},{key:"finishAssisTask",value:function(){var n=this;setTimeout(function(){var e,t,i,a;e=getCurrentPages().length-1||0,e=getCurrentPages()[e].options,t=e.isAssis,i=e.uniqueId,a=e.assistTargetPin,e=e.taskId,1==t&&(0,_orchard.finishedTaskInfo)({modelId:"M10007",taskType:1201,taskId:e,plateCode:n.getPlateCode(),assistTargetPin:a,uniqueId:i}).then(function(e){console.debug(e);var t=e.code,e=e.msg;0==t?((0,_indexWeapp5.showToast)({title:"助力成功！"}),n.getCurrentData()):(0,_indexWeapp5.showToast)({title:e})}).catch(function(e){console.debug(e.msg)})},2e3)}},{key:"pvReport",value:function(){console.debug(_constant.BUSINESS_MAP);var e=this.$router.params.business;getApp().globalData.qrcode.business=e,(0,_indexWeapp6.pvReport)({create_time:new Date})}},{key:"initH5Ani",value:function(){setTimeout(function(){anim=(0,_indexWeapp7.initWaterAni)(),animleaf=(0,_indexWeapp7.initleafAni)(),animUp=(0,_indexWeapp7.initUpgrade)()},100)}},{key:"refreshbCall",value:function(){var e=this;window.djAppDidBecomeActive=function(){console.debug("window.djAppDidBecomeActive this.getWheelData();"),e.waterWheelRef&&e.waterWheelRef.getWheelData(),_indexWeapp3.isAndroid&&e.checkTaskBrowse(!0),e.childSelectFruit&&e.childSelectFruit.refreshBarrage()},_indexWeapp3.isIOS&&(window.djWebviewRefresh=function(){console.debug("djWebviewRefresh this.checkTaskBrowse();"),e.checkTaskBrowse(!0)})}},{key:"refreshNewPersonFunc",value:function(){var e=this;this.state.waterStep<4?(this.getCurrentData(),isNeedNewerPro=!0):setTimeout(function(){e.getCurrentData()},3e3)}},{key:"freezeClickKettle",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:400;this.setState({coldAmimate:!1},function(){setTimeout(function(){e.setState({coldAmimate:!0})},t)})}},{key:"showProcessEffect",value:function(){var e=this;this.setState({showProcessLight:!0},function(){setTimeout(function(){e.setState({showProcessLight:!1})},1800)})}},{key:"getCurrentData",value:function(){var i=this;Date.now();(0,_indexWeapp.isLogin)().then(function(e){i.setState({showSignFlag:!1});var t=(0,_indexWeapp4.getStorageSync)("address_info");t.latitude&&t.longitude&&t.cityId||i.setState({showGetLocationFlag:!1}),Date.now();getPositionController().then(function(e){Date.now();i.setState({showGetLocationFlag:!1}),i.initInfo(e),i.setState({address:e}),isReportAddress&&(isReportAddress=!1,_indexWeapp6.clickReport)({create_time:new Date,click_id:"spclAddrSuccess"})}).catch(function(e){isLoginLocation=!1,i.setState({showGetLocationFlag:!0}),i.initInfo({})})}).catch(function(e){isLoginLocation=!1,setTimeout(function(){i.setState({showSignFlag:!0})},1e3)})}},{key:"getRedPackInfo",value:function(){var t=this;(0,_orchard.getWaterRedPackInfo)().then(function(e){"0"==e.code||0==e.code?(e.result&&REPORT.showProgressPacket(),t.setState({redPackInfo:e.result})):(0,_indexWeapp5.showToast)({title:res.msg})}).catch(function(e){})}},{key:"getSeriesWaterInfo",value:function(){var t=this;(0,_orchard.getLayerTaskInfoFn)().then(function(e){"0"==e.code||0==e.code?t.setState({seriesWaterData:e.result},function(){t.handlePriorityPop(2100,!1)}):(0,_indexWeapp5.showToast)({title:res.msg})}).catch(function(e){})}},{key:"showByFTEStep",value:function(e){var t=this.state.waterStep,e=e||t;2<e&&this.setState({showWaterWheel:!0,isFirstInWheel:!1}),3<e&&this.setState({showAssistance:!0,isFirstInAssis:!1})}},{key:"initInfo",value:function(e){var c=this,l=(this.getTaskListInfo(!1),this.getRedPackInfo(),this.refreshShareStatus(3),this.getSeriesWaterInfo(),_extends({cityId:e.cityId||e.areaCode||"",longitude:e.longitude||"",latitude:e.latitude||""},(0,_utils.setParamsInGetInitData)()));this.setState({showSelectFruit:!1}),(0,_orchard.getCurrentPageData)(l).then(function(t){var e,i,a,n,s,o=t.code,r=t.result;"0"==o||0==o?r&&(isLoginLocation=!0,e="",(n=0)==r.activityInfoResponse.curStageProcessType?(n=((r.activityInfoResponse.curStageTotalProcess-r.activityInfoResponse.curStageLeftProcess)/r.activityInfoResponse.curStageTotalProcess*100).toFixed(2),e=r.activityInfoResponse.curStageTotalProcess-r.activityInfoResponse.curStageLeftProcess+"/"+r.activityInfoResponse.curStageTotalProcess):1==r.activityInfoResponse.curStageProcessType&&(n=(parseFloat(r.activityInfoResponse.curStageTotalProcess)-parseFloat(r.activityInfoResponse.curStageLeftProcess)).toFixed(2),e=(parseFloat(r.activityInfoResponse.curStageTotalProcess)-parseFloat(r.activityInfoResponse.curStageLeftProcess)).toFixed(2)+"%"),i=r.userResponse.fteFlag,!isNeedNewerPro&&r.userResponse.fteFlag<4&&(c.finishNewFunc(),i=4),a=1==i||0==i&&0==r.userResponse.newUserFlag&&r.userResponse.waterBalance<=10,c.setState({WaterWheelNums:r.userResponse.waterBalance,data:r.activityInfoResponse,processValue:n,ruleResponse:r.ruleResponse,backgroundPic:r.backgroundPic,newerGiftData:c.handleNewerData(r.indexLayer),waterStep:i,showTaskGuideFlag:a,showWaterHand:i<4},function(){isFirstFruiterReport&&((isFirstFruiterReport=!1,_indexWeapp6.clickReport)({create_time:new Date,click_id:"orchardFruiterExposure"}),c.handlePriorityPop()),r.indexLayer&&priorityMap.set("newerGift",r.indexLayer)}),c.showByFTEStep(i),console.log("-----showTaskGuideFlag---同时缺水时，开启任务引导-----",a),n=c.$router.params.channel||"",(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"basicInfo",click_par:{treeLevel:r.activityInfoResponse.growingStage,levelProgress:e,fruitName:r.activityInfoResponse.fruitName,remainWater:r.userResponse.waterBalance,enterWay:(0,_utils.getInitSource)()?"share":"self",channel:n}})):"201"==o||201==o||"202"==o||202==o?(isLoginLocation=!1,setTimeout(function(){c.setState({showErrorPage:!0,showErrorPageMsg:t.msg||"当前存在异常，请联系客服～"})},2e3)):-1==o||-8==o?(isLoginLocation=!1,s=t.result.backgroundPic,(0,_orchard.getFruitListInfo)(l).then(function(e){"0"==e.code||0==e.code?(c.setState({SelectFruitData:e.result,showSelectFruit:!0,backgroundPic:s}),c.childSelectFruit&&c.childSelectFruit.getRecords(),REPORT.showSelectFruit()):((0,_indexWeapp5.showToast)({title:t.msg}),c.setState({showErrorPage:!0,showErrorPageMsg:t.msg||"当前存在异常，请联系客服～"}))}).catch(function(e){c.setState({showErrorPage:!0,showErrorPageMsg:e.msg||"当前存在异常，请联系客服～"}),(0,_indexWeapp5.showToast)({title:e.msg||"网络开小差，请稍后重试"})})):-2!=o&&(-3==o?(isLoginLocation=!1,c.setState({showDefaultPage:!0})):(isLoginLocation=!1,c.setState({showErrorPage:!0,showErrorPageMsg:t.msg||"当前存在异常，请联系客服～"})))}).catch(function(e){(0,_indexWeapp5.showToast)({title:e.msg||"网络开小差，请稍后重试"}),isLoginLocation=!1,c.setState({showErrorPage:!0,showErrorPageMsg:e.msg||"当前存在异常，请联系客服～"})})}},{key:"handlePriorityPop",value:function(e,t){var i,a,n,s,o,r=this;isShowPriorityPop||(i=priorityMap.get("newerGift"),a=(o=this.state).waterStep,n=o.seriesWaterData,s=o.data,o=o.isFirstIn,s&&1==s.ifMaxProcess&&5==s.growingStage&&o?(isShowPriorityPop=!0,this.setState({isFirstIn:!1}),setTimeout(function(){r.childInputLocation&&r.childInputLocation.getFruitList(),r.childRipePop&&r.childRipePop.setStateForAni()},2e3)):4<=a&&n&&null!=n.welfareName&&this.childSeriesWatering&&this.checkDateForPop("orchard_serieswater_local_date")?(setTimeout(function(){r.childSeriesWatering&&r.childSeriesWatering.setStateForAni(t)},e||2100),isShowPriorityPop=!0):i&&4<=a&&this.childNewerGift&&this.checkDateForPop("orchard_newgift_local_date")?(this.childNewerGift&&this.childNewerGift.showNewerGiftPop(),isShowPriorityPop=!0):4<=a&&!isNeedNewerPro&&this.childConSignIn&&this.checkDateForPop("CON_SIGNIN_TASK_DATE")?(this.childConSignIn&&this.childConSignIn.showPop(),isShowPriorityPop=!0):4<=a&&isFirstCallSceneApi&&(isFirstCallSceneApi=!1,setTimeout(function(){r.handleSceneRequest(1)},2e3)))}},{key:"handleShowPriorityPopFlag",value:function(){isShowPriorityPop=!1}},{key:"handleNewerData",value:function(e){return e&&e.items&&0<e.items.length&&e.items.sort(function(e,t){return e.id-t.id}),e}},{key:"refreshShareStatus",value:function(e){var i=this;(0,_orchard.getSharePictureInfo)({scene:e}).then(function(e){var t;"0"!=e.code&&0!=e.code||(t=(e=e.result).mpShareTitle,e=e.mpShareImg,i.setState({shareInfo:{title:t,shareUrl:e,shareText:t}}))}).catch(function(e){})}},{key:"checkFTEStep",value:function(e){var t=this,i=this.state.waterStep,e=e||i;3==e&&(i=_extends({fteFlag:4},(0,_utils.setParamsInGetInitData)()),(0,_orchard.updateNewPersonInfo)(i).then(function(e){var t=e.code,i=e.msg;e.result;0==t?console.debug("---updateNewPersonInfo----",e):(0,_indexWeapp5.showToast)({title:i})}).catch(function(e){console.debug(e)}),setTimeout(function(){t.setState({waterStep:4,showAssistance:!0,isFirstInAssis:!1},function(){t.handlePriorityPop(100,!0)})},3e3)),2==e&&(i=_extends({fteFlag:3},(0,_utils.setParamsInGetInitData)()),(0,_orchard.updateNewPersonInfo)(i).then(function(e){var t=e.code,i=e.msg;e.result;0==t?console.debug("---updateNewPersonInfo----",e):(0,_indexWeapp5.showToast)({title:i})}).catch(function(e){console.debug(e)}),setTimeout(function(){t.setState({showWaterWheel:!0,isFirstInWheel:!0,waterStep:3,showWaterHand:!0})},3e3)),1==e&&(i=_extends({fteFlag:2},(0,_utils.setParamsInGetInitData)()),(0,_orchard.updateNewPersonInfo)(i).then(function(e){"0"==e.code||0==e.code?console.log("---updateNewPersonInfo----",e):(0,_indexWeapp5.showToast)({title:res.msg})}).catch(function(e){(0,_indexWeapp5.showToast)({title:e.msg||"网络开小差，请稍后重试"})}))}},{key:"finishNewFunc",value:function(){var e=_extends({fteFlag:4},(0,_utils.setParamsInGetInitData)());(0,_orchard.updateNewPersonInfo)(e).then(function(e){}).catch(function(e){})}},{key:"_throttleOnClickTree",value:function(e){var t=this;this._throttle(function(){t.onClickTree(e),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickTree",click_par:{}})},1e3)}},{key:"hideMoreFunc",value:function(){this.setState({isShowMoreFunc:!1})}},{key:"_throttleOnClickMore",value:function(){var e=this;this._throttle(function(){e.setState({isShowMoreFunc:!e.state.isShowMoreFunc}),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickMenu",click_par:{}})},300)}},{key:"handleRedPacketPop",value:function(){var i=this;this._throttle(function(){var e=i.state.redPackInfo,t=(2==e.status?(0,_orchard.receiveWaterRedPack)().then(function(e){"0"==e.code||0==e.code?(i.childRedPacket&&i.childRedPacket.showRedPacketAni(e.result),i.getCurrentData()):(0,_indexWeapp5.showToast)({title:res.msg})}).catch(function(e){(0,_indexWeapp5.showToast)({title:e.msg||"网络开小差，请稍后重试"})}):i.childRedPacket&&i.childRedPacket.showRedPacketPop(e),1==e.status?"进行中":"已完成待开启");REPORT.clickProgressPacket(t,e.rewardStart+"-"+e.rewardEnd)},800)}},{key:"closeConTaskLayer",value:function(){var t=this;_index2.default.createSelectorQuery();_index2.default.createSelectorQuery().in(this.$scope).select("#con_sign_task_box").boundingClientRect(function(e){e?t.childConSignIn&&t.childConSignIn.handleClose(e):t.childConSignIn&&t.childConSignIn.handleClose()}).exec()}},{key:"showGetWaterToast",value:function(e,t){var i=this;this.getWaterToast&&this.getWaterToast.handleGetWaterToast(e),t&&setTimeout(function(){i.getCurrentData()},3e3)}},{key:"handleKettleClickAni",value:function(){var e=this;this.handleGetWaterAnimation(!0),setTimeout(function(){e.handleGetWaterAnimation(!1)},500)}},{key:"_throttle",value:function(e,t){var i=this;this.shareFlag&&(this.shareFlag=!1,e.apply(this,arguments),setTimeout(function(){i.shareFlag=!0},t||2e3))}},{key:"treeShakeAnimation",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;this.setState({treeAmimate:"treeAmimate"},function(){setTimeout(function(){e.setState({treeAmimate:""})},t)})}},{key:"onClickTree",value:function(e){var t=this;this.handleSceneRequest(3),this.setState({treeAmimate:"treeAmimate",isLeafAni:!0}),2<e&&animleaf&&animleaf.play&&animleaf.play(),setTimeout(function(){t.setState({treeAmimate:"",isLeafAni:!1}),animleaf&&animleaf.stop&&animleaf.stop()},1e3)}},{key:"hideSelectFruit",value:function(){this.setState({showSelectFruit:!1})}},{key:"hideInputLocation",value:function(){this.setState({showInputLocation:!1})}},{key:"handleGetWater",value:function(){this.getCurrentData(),this.setState({showGetWaterAndGrowFlag:!1,showPlayIntroduceFlag:!1,isNewPersonGetWaterFlag:!0})}},{key:"handleUpgradePop",value:function(){this.getCurrentData(),this.setState({showUpgrade:!1,isClickGetWaterUpBtn:!0})}},{key:"showTipsAndChangeWater",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.state,i=t.waterTipsNums,t=t.WaterWheelNums;console.debug("WaterWheelNums,,,,,,,,"+t),console.debug("-----waterTipsNums,,,,,,,,,"+i),10<=t&&(e?this.setState({waterTipsShow:!0,waterTipsNums:i+10,showUpgradeNodelay:!0,WaterWheelNums:t-10,kettleBreatheAnimateForTips:"kettleBreatheAnimateForTips"}):this.setState({waterTipsNums:i+10,showUpgradeNodelay:!0,WaterWheelNums:t-10}))}},{key:"_throttleOnWatering",value:function(e){var t=this,i=this.state,a=i.data,a=void 0===a?{}:a,i=i.waterStep,n=(console.debug(this.state),a.ifMaxProcess),a=a.growingStage;1==n&&5==a?(0,_indexWeapp5.showToast)({title:"快去兑换奖励吧"}):i<4?(this.setState({showWaterHand:!1}),this._throttle(function(){t.onWatering()})):this.doubleHit()}},{key:"kettleClickAnimation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0]?_utils.clickAnimationName:"";this.setState({kettleClickAni:e})}},{key:"handleGetWaterAnimation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0]?_utils.getWaterAnimationName:"";this.setState({getWaterAni:e})}},{key:"doubleHit",value:function(){var a=this,e=this.state,t=e.coldAmimate,t=void 0===t||t,i=e.WaterWheelNums,n=(e.waterTipsShow,400);(t?i<10&&(a.onWatering(),console.debug("水滴不足，开始浇水"),1):(console.debug("coldAmimate",t),1))||(this.kettleClickAnimation(!0),e=function(){var e=a.state,t=e.WaterWheelNums,e=e.waterTipsNums,i=n;console.debug(t+"====="+e),timer&&clearTimeout(timer),timer=setTimeout(function(){a.setState({waterTipsShow:!1,waterTipsNums:0,kettleBreatheAnimateForTips:""}),console.debug("不在点击，开始浇水"),isFirstDoubleHits=!(isDoubleHits=!1),a.onWatering()},i)},isFirstDoubleHits?(console.debug("isFirstDoubleHits---------",isFirstDoubleHits),isFirstDoubleHits=!1,lastTime=Date.now(),this.showTipsAndChangeWater(!1)):10<=i&&(t=Date.now()-lastTime<n,wx.vibrateShort({success:function(){},fail:function(){}}),t?(console.debug("在连击"),isDoubleHits=!0,lastTime=Date.now(),a.showTipsAndChangeWater()):(console.debug("不在连击"),isDoubleHits=!1,lastTime=Date.now(),a.setState({waterTipsShow:!1,kettleBreatheAnimateForTips:"kettleBreatheAnimateForTips"}))),e())}},{key:"onWatering",value:function(){var t,i,a,n,s=this,e=this.state,o=e.coldAmimate,o=void 0===o||o,r=e.WaterWheelNums,c=e.data,l=e.waterStep,e=e.waterTipsNums;this.setState({showPlayIntroduceFlag:!1,isShowGuideMask:!1,isNewPersonGetWaterFlag:!1}),o&&(s.setState({coldAmimate:!1,showHandAmimate:!1,kettleBreatheAnimate:""}),setTimeout(function(){var e=s.state.PlayIntroduceFlagClickNum+1;console.log("-----更新浇水次数------",e+"==="+l+"------"+s.state.isShowGuideMask),0==l?(s.setState({showHandAmimate:!0,PlayIntroduceFlagClickNum:e,showPlayIntroduceFlag:2!=e,showGetWaterAndGrowFlag:2==e,isShowGuideMask:!0,showWaterHand:!0}),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"howToPlayFTE",click_par:{step:e}})):s.setState({showHandAmimate:!0,PlayIntroduceFlagClickNum:e,isShowGuideMask:!0})},2800),t=function(){(0,_orchard.taskListInfo)({modelId:"M10007",plateCode:s.getPlateCode()}).then(function(e){var t;0==e.code?e.result&&(t=e.result.taskInfoList,s.setState({taskList:t}),1==e.result.status)?((0,_indexWeapp5.showToast)({title:"水滴不足，做任务获取水滴吧"}),console.debug("isDoubleHits1111111111,popUp",isDoubleHits),isDoubleHits||s.popUp()):(0,_indexWeapp5.showToast)({title:"水滴不足，等等就能领了喔"}):(0,_indexWeapp5.showToast)({title:"网络开小差，请稍后重试吧"})}).catch(function(e){(0,_indexWeapp5.showToast)({title:"网络繁忙,请稍后重试"})})},i=function(){setTimeout(function(){console.debug("异步恢复可浇水状态"),s.setState({coldAmimate:!0})},2e3)},a=function(){console.debug("同步恢复可浇水状态"),s.setState({coldAmimate:!0})},n=function(){setTimeout(function(){s.setState({animateDripsActive:"animateDripsActive"}),isfirst=isfirst||!0,setTimeout(function(){s.setState({animateDripsActive:"",isShowKettleAni:!0}),anim&&anim.play&&anim.play()},930),setTimeout(function(){anim&&anim.stop&&anim.stop(),s.setState({isShowKettleAni:!1})},2e3)},50)},r<10&&e<10?(console.debug("浇水不足100,,,,,,,,,,,,"+r+"---"+e),a(),4<=this.state.waterStep?(o=this.state.address,(0,_orchard.getTaskBySceneId)({sceneId:2,latitude:o.latitude,longitude:o.longitude,plateCode:this.getPlateCode()}).then(function(e){0==e.code&&e.result?s.childPop&&s.childPop.getTask(e.result,e.result.taskId,e.result.taskType,!0):t()}).catch(function(e){t()})):t(),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickKettle",click_par:{success:!1,remainWater:r}})):c&&(1==c.ifMaxProcess&&5==c.growingStage?((0,_indexWeapp5.showToast)({title:"快去兑换奖励吧"}),a()):(o=_extends({},(0,_utils.setParamsInGetInitData)()),e&&(o.waterTime=Number(e)/10),(0,_orchard.watering)(o).then(function(e){var t;"0"==e.code?(setTimeout(function(){s.getTaskListInfo(!1),s.getSeriesWaterInfo()},800),s.moveKettle(),setTimeout(function(){s.treeShakeAnimation(),s.showProcessEffect(),s.getRedPackInfo()},2e3),n(),t=e.result,s.updataStateData(t),0==l&&1==e.result.ifLevelUp&&s.setState({newUserGrowUpRewardWater:e.result.levelUpRewardNum,showTaskGuideFlag:!0}),0==l&&0==s.state.PlayIntroduceFlagClickNum&&s.checkFTEStep(0),s.checkFTEStep(),i(),t=e.result,s.handleBottleInfo(void 0===t?{}:t)):(s.getCurrentData(),(0,_indexWeapp5.showToast)({title:e.msg||"浇水失败！"}),a())}).catch(function(e){(0,_indexWeapp5.showToast)({title:e.msg||"服务异常"}),i()}))),this.kettleClickAnimation(!1))}},{key:"handleBottleInfo",value:function(e){e.ifLevelUp?this.setState({layerPriority:{tomo:e}}):this.showBottleInfo(e)}},{key:"showBottleInfo",value:function(e){var t=this,e=e.waterBottleInfoResponse,i=void 0===e?{}:e;4<=this.state.waterStep?console.debug("翻倍弹层触发"):(console.debug("不翻倍弹层触发，只更新数据"),delete i.ifDouble),setTimeout(function(){t.childTomo&&t.childTomo.setData&&t.childTomo.setData(i)},2e3)}},{key:"updataStateData",value:function(t){var i=this,e=t.curWaterBalance,a=t.levelUpRewardNum,n=0;0==t.activityInfoResponse.curStageProcessType?n=((t.activityInfoResponse.curStageTotalProcess-t.activityInfoResponse.curStageLeftProcess)/t.activityInfoResponse.curStageTotalProcess*100).toFixed(2):1==t.activityInfoResponse.curStageProcessType&&(n=(parseFloat(t.activityInfoResponse.curStageTotalProcess)-parseFloat(t.activityInfoResponse.curStageLeftProcess)).toFixed(2)),t.ifLevelUp?this.setState({WaterWheelNums:e-a}):this.setState({WaterWheelNums:t.curWaterBalance}),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickKettle",click_par:{success:!0,remainWater:this.state.WaterWheelNums}}),setTimeout(function(){var e=!1;t.ifLevelUp?(i.setState({isUpgrade:!0}),setTimeout(function(){animUp&&animUp.play&&animUp.play()},100),e=!0,setTimeout(function(){0==i.state.waterStep?i.setState({isUpgrade:!1,showUpgrade:!1}):i.setState({isUpgrade:!1,showUpgrade:!0,upgradeNum:t.levelUpRewardNum}),animUp&&animUp.stop&&animUp.stop()},1600)):e=1!=i.state.waterStep,t.activityInfoResponse&&1==t.activityInfoResponse.ifMaxProcess&&5==t.activityInfoResponse.growingStage&&(i.childInputLocation&&i.childInputLocation.getFruitList(),i.childRipePop&&i.childRipePop.setStateForAni(),i.setState({isFirstIn:!1})),i.setState({data:t.activityInfoResponse,processValue:n,addStageProcessNum:t.addStageProcessNum,ifLevelUp:t.ifLevelUp,levelUpRewardNum:t.levelUpRewardNum,showUpgradeNodelay:e})},2200)}},{key:"moveKettle",value:function(){var e=this;this.setState({kettleMoveAnimate:"kettleMoveAnimate"},function(){setTimeout(function(){e.setState({kettleMoveAnimate:""})},1920)})}},{key:"clickAnimationForTaskBtn",value:function(){console.debug("clickAnimationForTaskBtn")}},{key:"clickTaskBall",value:function(){this.clickAnimationForTaskBtn();var e=this.state.taskIsCanGet;(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickQuestBall",click_par:{ReadyToClaim:e}}),this.popUp()}},{key:"setBodyScrollInH5",value:function(){}},{key:"popUp",value:function(e){var t=this.state,i=t.taskList,a=t.taskToast;t.taskIsCanGet;0==i.length?(0,_indexWeapp5.showToast)({title:"没有赚水任务哦"}):(a&&(_index2.default.showToast({title:a,icon:"none",duration:3e3}),this.setState({taskToast:""})),this.checkTaskBrowse(),this.getTaskListInfo(!1),this.setState({showPopAminate:!0}),1==this.state.waterStep&&(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"questFTE",click_par:{step:1}}),this.clickTaskReport(),this.setBodyScrollInH5(!1))}},{key:"clickTaskReport",value:function(){var e=this.state.taskList,t=[];if(e&&0<e.length)for(var i=0;i<e.length;i++){var a="";null!=e[i].finishNum&&null!=e[i].totalNum&&(a=e[i].finishNum+"/"+e[i].totalNum),a={questId:e[i].taskId,questName:e[i].taskName,questReward:e[i].awardValue,questStatus:e[i].status,questStage:a},t.push(a)}(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"showQuestPopup",click_par:{params:t}})}},{key:"checkTaskBrowse",value:function(i){var a,n=this;this.childPop&&(a=setInterval(function(){var e,t=(0,_utils.getTaskBrowseOrchard)();t?(console.log("1111111"),(0,_utils.checkTaskBrowseOrchard)()?(console.log("2222222"),e=void 0,e="string"==typeof t?JSON.parse(t):JSON.parse(JSON.stringify(t)),n.finishTaskForStore(e.info)):(console.log("3333333"),(0,_indexWeapp5.showToast)({title:"时间太短啦~"})),(0,_utils.resetTaskBrowseOrchard)()):i&&n.getTaskListInfo(!1),clearInterval(a)},300))}},{key:"finishTaskForStore",value:function(e){this.childPop&&this.childPop.finnshTask(e,!0,!1)}},{key:"onClosePopUp",value:function(){this.setState({showPopAminate:!1})}},{key:"handleGuideGetWater",value:function(){this.state.waterStep<4&&this.setState({showTaskGuideFlag:!1,waterStep:2,showWaterHand:!0})}},{key:"taskFormShouyeqiu",value:function(e){var a,t,n,i,s=this;(0,_utilsWeapp.isQueryCheck)("channel","shouyeqiu")&&(a=1105,e=e.find(function(e){return e.taskType==a})||{},console.error("task",e),t=e.status,n=e.taskId)&&(i=function(){(0,_orchard.finishedTaskInfo)({modelId:MODLE_ID,taskId:n,taskType:a,plateCode:s.getPlateCode()}).then(function(e){e.code}).catch(function(e){})},0==t?new Promise(function(t,i){(0,_orchard.receivedTaskInfo)({modelId:MODLE_ID,taskId:n,taskType:a,plateCode:s.getPlateCode()}).then(function(e){0==e.code&&t(e)}).catch(function(e){i(e)})}).then(function(e){i()}).catch(function(e){}):1==t&&i())}},{key:"getTaskListInfo",value:function(o){var r=this;(0,_orchard.taskListInfo)({modelId:"M10007",plateCode:this.getPlateCode()}).then(function(e){if(0==e.code||"0"==e.code){for(var t,i=e.result.taskInfoList,a=(r.taskFormShouyeqiu(i),{}),n=[],s=0;s<i.length;s++)513==i[s].taskType&&(a=i[s]),2!=i[s].showPosition||-1==i[s].isShow||1!=i[s].status&&2!=i[s].status||n.push(i[s]),1102==i[s].taskType&&1!=i[s].ifCanFinishTask&&i[s].canNotFinishUntil&&0<i[s].canNotFinishUntil&&r.childPop&&(t=1e3*i[s].canNotFinishUntil,r.childPop.refreshTime(t),r.childPop.showCountDown(t-1e3,"countDownStr"));e.result.toast?r.setState({taskList:i,superOrderTaskInfo:a,taskToast:e.result.toast,sceneTaskList:n},function(){isFirstTaskReport&&(isFirstTaskReport=!1,_indexWeapp6.clickReport)({create_time:new Date,click_id:"orchardTaskExposure"})}):r.setState({taskList:i,superOrderTaskInfo:a,sceneTaskList:n},function(){isFirstTaskReport&&(isFirstTaskReport=!1,_indexWeapp6.clickReport)({create_time:new Date,click_id:"orchardTaskExposure"})}),r.refreshTaskCanGetFlag(i)}o&&r.getCurrentData()}).catch(function(e){console.log(e),o&&r.getCurrentData()})}},{key:"loginEvent",value:function(){(0,_indexWeapp.goToLogin)({localTargetUrl:"/pages/orchard-t/index"})}},{key:"getLocationEvent",value:function(){getApp().globalData.refreshHomeFlag=!1,this.openWXSetting()}},{key:"openWXSetting",value:function(){_index2.default.openSetting().then(function(e){}).catch(function(e){})}},{key:"updataKettle",value:function(e){var t=this.state.WaterWheelNums;this.setState({WaterWheelNums:t+Number(e)})}},{key:"getSideTaskStatus",value:function(e){if(1102==e.taskType&&1==e.ifCanFinishTask)return!0;if(1103==e.taskType&&1==e.status)return!0;if(2==e.status)return!0;if(e.subList&&0<e.subList.length){for(var t=!1,i=0;i<e.subList.length;i++)if(2==e.subList[i].taskStatus){t=!0;break}return t}return!1}},{key:"taskListRef",value:function(){this.getTaskListInfo(!1)}},{key:"errorEvent",value:function(){this.getCurrentData()}},{key:"onClosePopUpForSpuerOrder",value:function(){this.setState({showPopForSuperOrder:!1}),this.popUp()}},{key:"handleSuperOrderPop",value:function(){this.setState({showPopForSuperOrder:!0})}},{key:"closeCouponLayer",value:function(){this.setState({storeCouponLayer:!1})}},{key:"handleToStore",value:function(e){this.setState({storeCouponLayer:!0,toStoreInfo:e})}},{key:"finishTaskForStore",value:function(e){this.childPop&&this.childPop.finnshTask(e,!0,!1)}},{key:"handleRipeBtn",value:function(){this.setState({showInputLocation:!0});var e=this.state.data;(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickExchangeFruit",click_par:{fruitName:e.fruitName}})}},{key:"refreshTaskCanGetFlag",value:function(e){var t=!1;if(e&&0<e.length){for(var i=0;i<e.length;i++)if(-1!=e[i].isShow&&1==e[i].showPosition||1101==e[i].taskType){if(1102==e[i].taskType&&1==e[i].ifCanFinishTask){t=!0;break}if(1103==e[i].taskType&&1==e[i].status){t=!0;break}if(513==e[i].taskType&&this.checkIsHaveFinishOrder(e[i])){t=!0;break}if(2==e[i].status){t=!0;break}}this.setState({taskIsCanGet:t})}}},{key:"checkIsHaveFinishOrder",value:function(e){var t=e.subList;if(t&&0<t.length){for(var i=!1,a=0;a<t.length;a++)if(2==t[a].taskStatus){i=!0;break}return i}return!1}},{key:"onClickStrategy",value:function(){var e=this.state.ruleResponse;(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickRule",click_par:{}}),e&&((0,_indexWeapp5.navigateTo)("/pages/orchard-t/strategy/index?strategyPic="+e.strategyPic),this.setState({isShowMoreFunc:!1}))}},{key:"onClickMyHarvst",value:function(){REPORT.clickMyReward(),(0,_indexWeapp5.navigateTo)("/pages/orchard-t/myHarvest/index"),this.setState({isShowMoreFunc:!1})}},{key:"onClickShare",value:function(){this.childPop&&(this.childPop.openShare(),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickMenuShare"}))}},{key:"isShareEvent",value:function(){(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickMenuShare"})}},{key:"abTimingQuestPushTest",value:function(){var t=this;(0,_common.abTest)({experimentName:"timingQuestPush",routingValue:""}).then(function(e){e=e.result,e=(void 0===e?{}:e).strategyName;"on"==e?t.setState({timingQuestPush:!0}):t.setState({timingQuestPush:!1})}).catch(function(e){})}},{key:"_createScenePopData",value:function(a){var n=this;return function(){var e=(0,_index.genCompid)(a+"$compid__0"),t=n.state,i=t.sceneTaskInfo,t=t.isSceneTaskPop;return t&&_index.propsManager.set({updataKettle:n.updataKettle.bind(n),onClosePopUp:n.onCloseScenePop.bind(n),sceneTaskInfo:i,taskListRef:n.taskListRef.bind(n)},e),{$compid__0:e,isSceneTaskPop:t}}}},{key:"onCloseScenePop",value:function(){this.setState({isSceneTaskPop:!1})}},{key:"clickAnimationForSideBall",value:function(e,t){var i=this;console.debug("clickAnimationForSideBall"),this.setState({clickTaskBallAnimation:e},function(){setTimeout(function(){i.setState({clickTaskBallAnimation:-1})},_utils.clickAnimationGap)})}},{key:"clickSideTaskBall",value:function(e,t,i){var a=this;this.clickAnimationForSideBall(t,i),e.taskId&&((0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"clickTriggerBall",click_par:{questId:e.taskId}}),setTimeout(function(){a.childPop&&a.childPop.handleScenePop(e.taskId)},10))}},{key:"handleSceneRequest",value:function(e){this.childPop&&this.childPop.requestGetSceneId(e)}},{key:"handleWaterScene",value:function(){this.handleSceneRequest(5)}},{key:"checkDateForPop",value:function(e){var t=(0,_indexWeapp4.getStorageSync)(e),i=new Date,i=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();return i!=t&&((0,_indexWeapp4.setStorageSync)(e,i),!0)}},{key:"webCloseHandle",value:function(){this.closeWebCall(this.handle1.bind(this))}},{key:"handle1",value:function(){this.setState({showDetainPop:!0}),(0,_indexWeapp6.clickReport)({create_time:new Date,click_id:"showStayPopup"})}},{key:"closeWebCall",value:function(e){var t=this;window.djWebviewBack=function(){return!(!isLoginLocation||!t.checkDateForPop("orchard_detain_local_date")&&!t.state.showDetainPop||(e(),0))}}},{key:"onCloseHandler",value:function(){this.setState({showDetainPop:!1})}},{key:"onWebCloseHandler",value:function(){this.callNativeClose()}},{key:"callNativeClose",value:function(){_indexWeapp3.isDaojiaApp&&"8.6.0"<=_indexWeapp3.djAppVersion?_indexWeapp3.isIOS?_indexWeapp3.supportDJSHWK&&window.webkit.messageHandlers.MobileNavi.postMessage({method:"closeWebview",callBackName:null,callBackId:null}):_indexWeapp3.isAndroid&&window.djJava.closeWebview&&window.djJava.closeWebview():this.childCustomNavBg&&this.childCustomNavBg.goback()}},{key:"callEnableIntercept",value:function(){_indexWeapp3.isDaojiaApp&&"8.6.0"<=_indexWeapp3.djAppVersion?_indexWeapp3.isIOS?_indexWeapp3.supportDJSHWK&&window.webkit.messageHandlers.MobileNavi.postMessage({method:"enableIntercept",params:1,callBackName:null,callBackId:null}):_indexWeapp3.isAndroid&&window.djJava.enableIntercept&&window.djJava.enableIntercept(1):console.debug("not dao jia APP: 仅支持到家APP")}},{key:"handleWeappClose",value:function(){isLoginLocation&&(this.checkDateForPop("orchard_detain_local_date")||this.state.showDetainPop)?this.handle1():this.childCustomNavBg&&this.childCustomNavBg.goback()}},{key:"closeUpdatePop",value:function(e){var t=this;this.setState({showUpgrade:!1}),setTimeout(function(){t.showGetWaterToast(e)},300),setTimeout(function(){t.getCurrentData()},3e3);var i=this.state.layerPriority.tomo;i&&(this.showBottleInfo(i),this.setState({layerPriority:[]}))}},{key:"closeNewGiftLayer",value:function(){var t=this;_index2.default.createSelectorQuery();_index2.default.createSelectorQuery().in(this.$scope).selectAll("#funcBallLayout").boundingClientRect(function(e){console.log("pppppp",e),e[0]?t.childNewerGift&&t.childNewerGift.setStateForClose(e[0]):t.childNewerGift&&t.childNewerGift.setStateForClose()}).exec()}},{key:"clickNewerFuncBall",value:function(){this.childNewerGift&&this.childNewerGift.showNewerGiftPop()}},{key:"clickConSignInBall",value:function(){this.childConSignIn&&this.childConSignIn.showPop()}},{key:"handleFruitData",value:function(e){fruitData=e,console.log(fruitData)}},{key:"onShareAppMessage",value:function(e){var t=e.from,i=void 0,a=void 0,n=void 0,s=this.state.shareInfo;return"button"===t?(n=(t=e.target.dataset.params).shareText,a=t.shareUrl,i=t.path,console.debug("onShareAppMessage-button",t)):(n=s.title,a=s.shareUrl,i="/pages/orchard-t/index?business="+_constant.BUSINESS_MAP.page),{title:n||"快来！整箱水果免费领啦！",imageUrl:a||"https://img10.360buyimg.com/mobilecms/jfs/t1/166629/31/9647/59797/60471fd3Ec09ebeb8/fb2bc2b91556bfb1.jpg",path:i||"/pages/orchard-t/index"}}},{key:"componentWillMount",value:function(){this.abTimingQuestPushTest();var t=this;_index2.default.getSystemInfo({success:function(e){"ios"!=e.platform&&"android"==e.platform?t.setState({statusBarH:e.statusBarHeight+48}):t.setState({statusBarH:e.statusBarHeight+44})}})}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.getInitData()},100),setTimeout(function(){e.setState({showLoadIngFlag:!1,taskShow:!0}),setTimeout(function(){e.checkTaskBrowse()},200)},2e3),(0,_indexWeapp7.initleafAni)().then(function(e){animleaf=e}).catch(function(e){}),(0,_indexWeapp7.initWaterAni)().then(function(e){console.log("---------",e),anim=e}).catch(function(e){}),(0,_indexWeapp7.initUpgrade)().then(function(e){animUp=e}).catch(function(e){}),_indexWeapp3.isDaojiaApp&&this.refreshbCall(),_indexWeapp3.isDaojiaApp&&"8.6.0"<=_indexWeapp3.djAppVersion&&(this.callEnableIntercept(),this.webCloseHandle()),this.finishAssisTask()}},{key:"componentDidShow",value:function(){this.getCurrentData(),this.checkTaskBrowse(),this.abTimingQuestPushTest(),this.pvReport(),console.log("--------show")}},{key:"componentDidHide",value:function(){console.log("--------hide")}},{key:"componentWillUnMount",value:function(){console.debug("componentWillUnMount"),this.setBodyScrollInH5()}},{key:"_createKettleAndDripsData",value:function(e){var s=this;return function(){var e=s.state,t=e.kettleMoveAnimate,i=e.kettleBreatheAnimate,a=(e.animateDripsActive,e.isShowKettleAni),n=e.kettleClickAni,e=e.getWaterAni;return{kettleMoveAnimate:t,style:_indexModuleScssMap2.default,kettleBreatheAnimate:i,kettleClickAni:n,getWaterAni:e,isShowKettleAni:a}}}},{key:"_createCouponData",value:function(a){var n=this;return function(e){var t=(0,_index.genCompid)(a+"$compid__1"),i=n.state.showPopForSuperOrder;return e&&_index.propsManager.set({showPopAminate:i,updataKettle:n.updataKettle.bind(n),onClosePopUp:n.onClosePopUpForSpuerOrder.bind(n),taskInfo:e,taskListRef:n.taskListRef.bind(n)},t),{$compid__1:t,taskInfo:e}}}},{key:"_createData",value:function(){var i=this,e=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix),t=(0,_index.genCompid)(e+"$compid__2"),a=(0,_index.genCompid)(e+"$compid__3"),n=(0,_index.genCompid)(e+"$compid__4"),s=(0,_index.genCompid)(e+"$compid__5"),o=(0,_index.genCompid)(e+"$compid__6"),r=(0,_index.genCompid)(e+"$compid__7"),c=(0,_index.genCompid)(e+"$compid__8"),l=(0,_index.genCompid)(e+"$compid__9"),u=(0,_index.genCompid)(e+"$compid__10"),p=(0,_index.genCompid)(e+"$compid__11"),d=(0,_index.genCompid)(e+"$compid__12"),h=(0,_index.genCompid)(e+"$compid__13"),f=(0,_index.genCompid)(e+"$compid__14"),m=(0,_index.genCompid)(e+"$compid__15"),g=(0,_index.genCompid)(e+"$compid__16"),k=(0,_index.genCompid)(e+"$compid__17"),_=(0,_index.genCompid)(e+"$compid__18"),w=this.__state,S=w.data,y=(w.result,w.treeAmimate,w.showSelectFruit),P=(w.WaterWheelNums,w.kettleAnimate,w.showPopAminate),v=w.taskList,T=w.shareInfo,W=(w.isNewPersonGetWaterFlag,w.waterStep),L=(w.showLoadIngFlag,w.showBackFlag),G=w.showTaskGuideFlag,B=(w.isShowGuideMask,w.SelectFruitData),M=w.newUserGrowUpRewardWater,I=(w.taskIsCanGet,w.taskShow),U=(w.shoGetWaterFlag,w.showSignFlag,w.showGetLocationFlag,w.showDefaultPage,w.isUpgrade),F=w.processValue,j=w.showGetWaterAndGrowFlag,x=(w.showPlayIntroduceFlag,w.PlayIntroduceFlagClickNum,w.superOrderTaskInfo),$=w.storeCouponLayer,O=w.showUpgrade,b=(w.showUpgradeNodelay,w.isClickGetWaterUpBtn,w.isShowMoreFunc),H=w.showInputLocation,E=(w.backgroundPic,w.isLeafAni,w.toStoreInfo),q=(w.showErrorPage,w.showErrorPageMsg,w.showWaterWheel),K=w.isFirstInWheel,C=w.sceneTaskList,Q=w.showAssistance,J=w.isFirstInAssis,V=w.address,z=w.showDetainPop,A=w.statusBarH,X=(w.waterTipsShow,w.waterTipsNums,w.kettleBreatheAnimate,w.kettleBreatheAnimateForTips,w.timingQuestPush),Z=w.clickTaskBallAnimation,Y=(w.showProcessLight,w.showWaterHand,w.levelUpRewardNum),N=(w.redPackageAnimation,w.redPackInfo),ee=w.newerGiftData,w=w.seriesWaterData,D=v.find(function(e){return 1101==e.taskType})||{},te=this._createKettleAndDripsData(e+"IDDcUxXuLZ")(),R=D.subList,R=void 0===R?[]:R,ie=(0,_index.internal_inline_style)({top:A+10+"px"}),x=I?this._createCouponData(e+"okULomJRsx")(x):null,e=S?this._createScenePopData(e+"WIyXlXKzAm")():null,ae=S?(0,_index.internal_inline_style)({top:A+5+"px"}):null,ne=b?(0,_index.internal_inline_style)({top:A+3+"px","background-size":"100% 100%;"}):null,b=b?_extends({},T,{path:"/pages/orchard-t/index"}):null,se=C&&0<C.length&&S?(0,_index.internal_inline_style)({top:A+50+"px"}):null,N=N&&0<N.status&&S&&S.growingStage&&0==S.ifMaxProcess?(0,_index.internal_inline_style)(S.maxLevel?"left:calc(100% - 31px);":"left:calc("+F+"% - 31px);"):null,oe=S.maxLevel?(0,_index.internal_inline_style)({width:"100%"}):null,F=(0,_index.internal_inline_style)(0==F?{display:"none"}:{width:F+"%"}),C=C&&0<C.length?C.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{className:Z==t?_utils.clickAnimationName:"",$loopState__temp16:i.getSideTaskStatus(e.$original),$original:e.$original}}):[];return S&&_index.propsManager.set({handleWeappClose:this.handleWeappClose.bind(this)},t),S&&_index.propsManager.set({conSignInTask:D,showGetWaterToast:this.showGetWaterToast.bind(this),handlePriorityPop:this.handlePriorityPop.bind(this),closeConTaskLayer:this.closeConTaskLayer.bind(this),handleShowPriorityPopFlag:this.handleShowPriorityPopFlag.bind(this)},a),S&&_index.propsManager.set({dataResult:S,showUpdatePopNew:O,closePop:this.closeUpdatePop.bind(this),levelUpRewardNum:Y},n),S&&q&&_index.propsManager.set({isFirst:K,refreshNewPersonFunc:this.refreshNewPersonFunc.bind(this),freezeClickKettle:this.freezeClickKettle.bind(this),handleWaterScene:this.handleWaterScene.bind(this),showGetWaterToast:this.showGetWaterToast.bind(this)},s),S&&Q&&_index.propsManager.set({isFirst:J,refreshNewPersonFunc:this.refreshNewPersonFunc.bind(this)},o),S&&I&&_index.propsManager.set({showPopAminate:P,showTaskGuideFlag:G,onClosePopUp:this.onClosePopUp.bind(this),getTaskListInfo:this.getTaskListInfo.bind(this),updataKettle:this.updataKettle.bind(this),handleGuideGetWater:this.handleGuideGetWater.bind(this),taskList:v,title:"领水滴",address:V,shareInfo:T,refreshShareStatus:this.refreshShareStatus.bind(this),handleSuperOrderPop:this.handleSuperOrderPop.bind(this),handleToStore:this.handleToStore.bind(this),router:this.__props.router,timingQuestPushTest:X,showGetWaterToast:this.showGetWaterToast.bind(this)},r),S&&$&&_index.propsManager.set({taskInfo:E,closeCouponLayer:this.closeCouponLayer.bind(this),finishTaskForStore:this.finishTaskForStore.bind(this)},c),S&&_index.propsManager.set({showSelectFruitFlag:y,SelectFruitData:B,hideSelectFruit:this.hideSelectFruit.bind(this),refreshNewPersonFunc:this.refreshNewPersonFunc.bind(this)},l),S&&_index.propsManager.set({showBackFlag:L},u),S&&0==W&&_index.propsManager.set({treeIcon:S.icon,newUserGrowUpRewardWater:M,showUpdatePopNew:0==W&&!U&&j,handleGetWater:this.handleGetWater.bind(this)},p),S&&_index.propsManager.set({showInputLocationFlag:H,data:S,handleFruitData:this.handleFruitData.bind(this),hideInputLocation:this.hideInputLocation.bind(this),refreshNewPersonFunc:this.getCurrentData.bind(this)},d),S&&_index.propsManager.set({showDetainPop:z,onCloseHandler:this.onCloseHandler.bind(this),onWebCloseHandler:this.onWebCloseHandler.bind(this)},h),S&&_index.propsManager.set({handleKettleClickAni:this.handleKettleClickAni.bind(this)},f),S&&_index.propsManager.set({showGetWaterToast:this.showGetWaterToast.bind(this),refreshNewPersonFunc:this.getCurrentData.bind(this)},m),S&&_index.propsManager.set({closeNewGiftLayer:this.closeNewGiftLayer.bind(this),showGetWaterToast:this.showGetWaterToast.bind(this),handlePriorityPop:this.handlePriorityPop.bind(this),handleShowPriorityPopFlag:this.handleShowPriorityPopFlag.bind(this),indexLayerData:ee},g),S&&w&&null!=w.welfareName&&4<=W&&_index.propsManager.set({seriesWaterData:w,statusBarH:A,handlePriorityPop:this.handlePriorityPop.bind(this),handleShowPriorityPopFlag:this.handleShowPriorityPopFlag.bind(this)},k),S&&_index.propsManager.set({handleRipeBtn:this.handleRipeBtn.bind(this),fruitData:fruitData},_),Object.assign(this.__state,{anonymousState__temp4:ie,anonymousState__temp6:ae,anonymousState__temp7:ne,anonymousState__temp8:b,anonymousState__temp9:se,anonymousState__temp10:N,anonymousState__temp11:oe,anonymousState__temp12:F,loopArray0:C,$compid__2:t,$compid__3:a,$compid__4:n,$compid__5:s,$compid__6:o,$compid__7:r,$compid__8:c,$compid__9:l,$compid__10:u,$compid__11:p,$compid__12:d,$compid__13:h,$compid__14:f,$compid__15:m,$compid__16:g,$compid__17:k,$compid__18:_,style:_indexModuleScssMap2.default,anonymousState__temp:te,conSignInTask:D,subList:R,isAndroid:_indexWeapp3.isAndroid,anonymousState__temp2:x,anonymousState__temp3:e,undefined:void 0}),this.__state}}]),s}(),_class.$$events=["_throttleOnWatering","clickNewerFuncBall","clickConSignInBall","hideMoreFunc","_throttleOnClickMore","onClickStrategy","isShareEvent","onClickMyHarvst","clickSideTaskBall","_throttleOnClickTree","handleRedPacketPop","handleRipeBtn","clickTaskBall","loginEvent","getLocationEvent","errorEvent"],_class.multipleSlots=!0,_class.$$componentPath="pages/orchard-t/index",_temp2);exports.default=Index,Component(require("./npm/@tarojs/taro-weapp/index.js").default.createComponent(Index,!0));