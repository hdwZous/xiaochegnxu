"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_temp2,_createClass=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(o):void 0:null!==(i=Object.getPrototypeOf(t))?e(i,n,o):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_indexWeapp=require("../../npm/@jd/djmp/common-t/js/login/index.weapp.js"),_bean=require("../../common-mp/api/bean.js"),_indexWeapp2=require("../../npm/@jd/djmp/common-t/js/taroapi/index.weapp.js"),_indexWeapp3=require("../../npm/@jd/djmp/common-t/js/storage/index.weapp.js"),_indexWeapp4=require("../../npm/@jd/djmp/common-t/js/utils/index.weapp.js"),_indexWeapp5=require("../../npm/@jd/djmp/common-t/js/bi/index.weapp.js"),_indexModuleScssMap=require("./index.module.scss.map.js"),_indexModuleScssMap2=_interopRequireDefault(_indexModuleScssMap),_indexWeapp6=require("../../npm/@jd/djmp/common-t/js/location/index.weapp.js"),_indexWeapp7=require("../../npm/@jd/djmp/common-t/js/env/index.weapp.js"),_utils=require("./js/utils.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var MONITOR_REPORT={startTime:"",signInfoRequestPreTime:"",signInfoRequestEndTime:"",monitorReportFlag:!0},MONITOR_ID={signIn:{index:{request:1008,render:2009}},beans:{index:{request:1010,render:2011}}},Bean=(_temp2=_class=function(){function a(){var e,t;_classCallCheck(this,a);for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t=_possibleConstructorReturn(this,(t=a.__proto__||Object.getPrototypeOf(a)).call.apply(t,[this].concat(o)))).$usedState=["anonymousState__temp","anonymousState__temp2","$compid__99","$compid__100","$compid__101","$compid__102","$compid__103","$compid__104","$compid__105","$compid__106","style","loading","isShowLogin","LatestDivide","showLocationPop","curData","userLogin","showDefault","isNewer","showPop","rule","showRisePop","levelPic","levelData","rewardPopData","currentPage","preData","nextData","result","defaultType","defaultTips","defaultBtnTxt","level","countDownStr","timer","timer1","levelUpPoints","dailyWaterNum","shareInfo","preFinnshTips","iphoneXFit","waterFromGuide","groupId","data"],t.config={navigationBarTitleText:"鲜豆庄园"},t.customComponents=["BarrageMoveView","Default","Guide","Previous","Current","Next","SubscribeMessage"],_possibleConstructorReturn(t,e)}return _inherits(a,_index.Component),_createClass(a,[{key:"_constructor",value:function(e){var t=this;_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"_constructor",this).call(this,e),this.userAction="",this.state={result:{},preData:{},curData:{},nextData:{},rewardPopData:{},showDefault:!1,defaultType:0,defaultTips:"",defaultBtnTxt:"",currentPage:1,showPop:!1,rule:"",showRisePop:!1,isNewer:!1,level:0,countDownStr:"",timer:null,timer1:null,loading:!0,showLocationPop:!0,levelUpPoints:0,dailyWaterNum:0,shareInfo:{},isShowLogin:!0,preFinnshTips:!1,iphoneXFit:{height:"100%"},waterFromGuide:!1,levelData:{},groupId:"",levelPic:"",data:[],LatestDivide:[]},this.id=0,this.$$refs=[{type:"component",id:"OoCjL",refName:"",fn:function(e){return t.childCur=e}},{type:"component",id:"kueSe",refName:"",fn:function(e){return t.childSubscribe=e}}]}},{key:"_createData",value:function(){var o=this,e=(this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{},this.$prefix),t=(0,_index.genCompid)(e+"$compid__99"),n=(0,_index.genCompid)(e+"$compid__100"),i=(0,_index.genCompid)(e+"$compid__101"),a=(0,_index.genCompid)(e+"$compid__102"),r=(0,_index.genCompid)(e+"$compid__103"),s=(0,_index.genCompid)(e+"$compid__104"),u=(0,_index.genCompid)(e+"$compid__105"),e=(0,_index.genCompid)(e+"$compid__106"),c=this.__state,p=c.result,l=c.preData,d=c.curData,h=c.nextData,m=c.rewardPopData,_=(c.currentPage,c.defaultTips),f=c.defaultBtnTxt,g=c.defaultType,y=c.showDefault,v=(c.showPop,c.showRisePop,c.isNewer),w=(c.rule,c.level,c.countDownStr),k=c.loading,P=c.showLocationPop,R=(c.dailyWaterNum,c.shareInfo),x=c.isShowLogin,T=c.preFinnshTips,F=c.iphoneXFit,D=c.waterFromGuide,c=(c.levelData,c.groupId,c.levelPic,c.LatestDivide),C=this.__props.userLogin,F=(0,_index.internal_inline_style)(F),S=(this.anonymousFunc0=function(){return o.onDefaultEvent()},this.anonymousFunc1=function(){return o.onHideGuide()},this.anonymousFunc2=function(){return o.onWaterFromGuide()},v?function(){return o.showTeamInfoFromShareNewer()}:null);return this.anonymousFunc3=function(){return o.onClickClosePop()},this.anonymousFunc4=function(){return o.onClickRisePop()},this.anonymousFunc5=function(){return o.onClickRewardBg()},this.anonymousFunc6=function(e){return o.onClickRewardContent(e)},this.anonymousFunc7=function(){return o.onClickRewardBtn(m.buttonId,l.activityId)},this.anonymousFunc8=function(e){return o.onSwipeChange(e)},this.anonymousFunc9=function(e){return o._throttleOnClickTogglePage(e)},this.anonymousFunc10=function(){return o.onClickRules()},this.anonymousFunc11=function(e){return o.onGetRewardBeans(e,"btn")},this.anonymousFunc12=function(e){return o._throttleOnClickTogglePage(e)},this.anonymousFunc13=function(){return o.onClickRules()},this.anonymousFunc14=function(e,t,n){return o.onShowRisePop(e,t,n)},this.anonymousFunc15=function(){return o.onRefreshPage()},this.anonymousFunc16=function(e,t){return o.onNoticePopUp(e,t)},this.anonymousFunc17=function(e){return o._throttleOnClickTogglePage(e)},this.anonymousFunc18=function(){return o.onClickRules()},!x&&c&&0<c.length&&_index.propsManager.set({newMessages:c,numberOfLines:4,speed:5},t),!P&&!k&&c&&0<c.length&&_index.propsManager.set({newMessages:c,numberOfLines:4,speed:4},n),(C||y)&&_index.propsManager.set({defaultType:g,defaultTips:_,defaultBtnTxt:f,defaultTop:"120px",onDefaultEvent:this.anonymousFunc0},i),C||y||!v||_index.propsManager.set({onHideGuide:this.anonymousFunc1,onWaterFromGuide:this.anonymousFunc2,showTeamInfoFromShareNewer:S},a),C||y||!l||_index.propsManager.set({data:l,result:p,onChangePage:this.anonymousFunc9,onShowRules:this.anonymousFunc10,onGetRewardBeans:this.anonymousFunc11},r),C||y||!d||_index.propsManager.set({countDownStr:w,onChangePage:this.anonymousFunc12,onShowRules:this.anonymousFunc13,onShowRisePop:this.anonymousFunc14,onRefreshPage:this.anonymousFunc15,onNoticePopUp:this.anonymousFunc16,shareInfo:R,preFinnshTips:T,waterFromGuide:D,isNewer:v,setLevelPicByChild:this.setLevelPicByChild.bind(this),goToLoginProps:this.goToLoginProps.bind(this),setWaterFormGuideFalse:this.setWaterFormGuideFalse.bind(this),setShowRisePopByChild:this.setShowRisePopByChild.bind(this),router:this.$router},s),C||y||!h||_index.propsManager.set({data:h,result:p,onChangePage:this.anonymousFunc17,onShowRules:this.anonymousFunc18},u),_index.propsManager.set({subscribeMessageImageUrl:"https://storage.360buyimg.com/wximg/common/noticeImage1.png"},e),Object.assign(this.__state,{anonymousState__temp:F,anonymousState__temp2:S,$compid__99:t,$compid__100:n,$compid__101:i,$compid__102:a,$compid__103:r,$compid__104:s,$compid__105:u,$compid__106:e,style:_indexModuleScssMap2.default,userLogin:C}),this.__state}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.onLatestDivideResult()},600)}},{key:"componentWillUnmount",value:function(){}},{key:"componentWillReceiveProps",value:function(e){}},{key:"componentDidShow",value:function(){var e=this,t=this.$router.params,n=t.channel||"",o=t.beansource||"",t=(t.userAction&&(this.userAction=decodeURIComponent(t.userAction)),getApp().globalData.appScene);1007!=t&&1008!=t&&1036!=t&&1047!=t&&1048!=t||(getApp().globalData.qrcode.business=157),(0,_indexWeapp5.pvReport)({create_time:new Date,page_par:{channel:n,beansource:o,userAction:this.userAction,platFormCode:"miniPro"}}),_indexWeapp7.isJDReactNativeWebView||_indexWeapp7.isJDApp?setTimeout(function(){e.initLocation()},600):this.initLocation(),this.childCur&&(this.childCur.getCurrentData(),_indexWeapp7.isJDReactNativeWebView||_indexWeapp7.isJDApp?setTimeout(function(){e.childCur.getTaskListInfo(!1)},600):this.childCur.getTaskListInfo(!1),this.childCur.checkTaskBrowse())}},{key:"onRefreshPage",value:function(){this.getCurrentPage()}},{key:"setLevelPicByChild",value:function(e){this.setState({levelPic:e})}},{key:"onShareAppMessage",value:function(e){var t=e.from,n=e.beansource,o=void 0,i=void 0,a=void 0;return"button"===t&&(o=(t=e.target.dataset.params).shareText,i=t.shareUrl,a=t.path),n&&"task"==n&&(0<a.indexOf("?")?a+="&beansource=task":a+="?beansource=task"),{title:o||"鲜豆能当钱花，来鲜豆庄园和我一起瓜分鲜豆吧！",imageUrl:i||"https://storage.360buyimg.com/wximg/bean/share.jpg",path:a||"/pages/bean-t/index"}}},{key:"initLocation",value:function(){var e=this;(0,_indexWeapp6.getLocation)().then(function(){e.setState({showLocationPop:!0}),e.getCurrentPage()}).catch(function(){e.getCurrentPage(),e.setState({showLocationPop:!1});(0,_indexWeapp5.pvReport)({create_time:new Date,page_par:{activityId:"",status:"current",allowLocation:!1,login:""}})})}},{key:"getCurrentLocation",value:function(){_index2.default.openSetting().then(function(e){}).catch(function(e){})}},{key:"getCurrentPage",value:function(){var s=this;MONITOR_REPORT.signInfoRequestPreTime=Date.now(),(0,_indexWeapp.isLogin)().then(function(e){var t=(0,_utils.setParamsInGetInitData)();(0,_bean.getCurrentPageData)(t).then(function(e){var t,n,o,i,a=e.code,r=e.result;"0"==a||0==a?(MONITOR_REPORT.signInfoRequestEndTime=Date.now(),r?((t=r.cur||"")&&t.remainTime&&0<t.remainTime&&(clearInterval(s.state.timer),s.showCountDown(t.remainTime,"countDownStr","timer")),n=1===r.isNewUser,r.cur&&(o=r.cur.level),n&&o<2&&(s.setState({isNewer:!0}),t&&t.activityId&&(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"showFTE",click_par:{activityId:t.activityId}})),n=0,r.cur&&(n=r.pre?1:"0"),null!=(0,_indexWeapp3.getStorageSync)("handShowTime")&&"undefined"!=(0,_indexWeapp3.getStorageSync)("handShowTime")||(0,_indexWeapp3.setStorageSync)("handShowTime",0),o=!1,r.pre&&1==r.pre.buttonId&&(o=!0),(i={}).shareText=r.shareText,i.shareUrl=r.shareUrl,s.setState({currentPage:n,result:r,preData:r.pre||"",curData:t,nextData:r.next||"",rewardPopData:r.cur&&r.cur.tipsResponse||{},rule:r.rule||"",shareInfo:i,showDefault:!1,isShowLogin:!0,preFinnshTips:o},function(){s.monitorReport()}),setTimeout(function(){s.setState({loading:!1})},2e3),t&&t.resourceInfo&&t.resourceInfo.resourcesList&&0<t.resourceInfo.resourcesList.length&&(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"showAd",click_par:{title:t.resourceInfo.resourcesList[0].title||""}}),t&&t.activityId&&(0,_indexWeapp5.pvReport)({create_time:new Date,page_par:{activityId:t.activityId||"",status:"current",allowLocation:!0,login:!0}})):(s.setState({showDefault:!0,defaultTips:"暂无活动~",defaultType:2}),setTimeout(function(){s.setState({loading:!1})},2e3))):("201"==a||"202"==a?s.setState({isShowLogin:!1,defaultTips:e.msg||"未登录~",defaultType:4}):s.setState({showDefault:!0,defaultTips:e.msg||"服务异常~",defaultType:3}),setTimeout(function(){s.setState({loading:!1})},2e3))}).catch(function(e){s.setState({showDefault:!0,defaultTips:e.msg||"服务异常~",defaultType:3}),setTimeout(function(){s.setState({loading:!1})},2e3)})}).catch(function(e){s.setState({isShowLogin:!1,defaultTips:"未登录~",defaultType:4}),setTimeout(function(){s.setState({loading:!1})},2e3);(0,_indexWeapp5.pvReport)({create_time:new Date,page_par:{activityId:"",status:"current",allowLocation:"",login:!1}})})}},{key:"_throttleOnClickTogglePage",value:function(e){this.onClickTogglePage(e)}},{key:"onClickTogglePage",value:function(e){this.setState({currentPage:e+""}),(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"ClickToNext",click_par:{page_num:e,is_layer:0}})}},{key:"onSwipeChange",value:function(e){var t="current";0==e.detail.current?t="pre":1==e.detail.current?t="current":2==e.detail.current&&(t="next"),(0,_indexWeapp5.pvReport)({create_time:new Date,page_par:{status:t}})}},{key:"onClickRules",value:function(){this.setState({showPop:!0}),(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"click_rule"})}},{key:"onClickClosePop",value:function(){this.setState({showPop:!1})}},{key:"onShowRisePop",value:function(e,t){this.setState({levelData:e,showRisePop:!0});var n=e.level,e=e.levelUpPoints;(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"showLevelUp",click_par:{preLevel:n-1||0,waterReward:e,activityId:t||""}})}},{key:"onClickRisePop",value:function(){this.setState({showRisePop:!1})}},{key:"onDefaultEvent",value:function(){var e=this.state.defaultType;3===e?this.getCurrentPage():4===e&&(0,_indexWeapp.goToLogin)({localTargetUrl:"/pages/bean-t/index"})}},{key:"onWaterFromGuide",value:function(){this.setState({waterFromGuide:!0})}},{key:"showTeamInfoFromShareNewer",value:function(){this.childCur&&this.childCur.showTeamInfoFromShareNewer&&this.childCur.showTeamInfoFromShareNewer()}},{key:"onLatestDivideResult",value:function(){var t=this;(0,_bean.latestDivideResult)({number:100}).then(function(e){t.setState({LatestDivide:e.result||[]})}).catch(function(e){})}},{key:"onGetRewardBeans",value:function(t,n){var o=this;(0,_bean.getReward)({activityId:t||""}).then(function(e){"0"==e.code?(e.result&&o.setState({rewardPopData:e.result}),"btn"===n&&(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"clickCollectBeanReward",click_par:{rewardNumber:e.result.points||0,activityId:t||""}}),(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"showClaimBean",click_par:{beanReward:e.result.points||0,activityId:t||""}}),o.childSubscribe.initSubscribeMessage(["foXXDvHMDaA45_8QPRwAd_p9unR3syrGG8kxIVQXUQ0"])):(0,_indexWeapp2.showToast)({title:e.msg||"领取失败！"})}).catch(function(e){(0,_indexWeapp2.showToast)({title:e.msg||"服务异常！"})}),"btn"===n?(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"ClickGetPoint",click_par:{is_layer:0}}):(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"ClickGetPoint",click_par:{is_layer:1}})}},{key:"onClickRewardBtn",value:function(e,t){1===e?this.onGetRewardBeans(t):(this.onRefreshPage(),this.setState({currentPage:1,rewardPopData:{}}),(0,_indexWeapp5.clickReport)({create_time:new Date,click_id:"ClickToNext",click_par:{is_layer:1}}))}},{key:"showCountDown",value:function(e,o,i){var a=this;(0,_indexWeapp4.countDown)(e,function(e){var t,n;e.end?(a.onRefreshPage(),clearInterval(a.state[o]),a.setState(_defineProperty({},o,""))):(n="",n=e.day?e.day+"天"+e.hour+":"+e.minute+":"+e.second:e.hour+":"+e.minute+":"+e.second,a.setState((_defineProperty(t={},o,n),_defineProperty(t,i,e.timer),t)))})}},{key:"onClickRewardBg",value:function(){this.onRefreshPage(),this.setState({rewardPopData:{}})}},{key:"onClickRewardContent",value:function(e){e.stopPropagation()}},{key:"_throttle",value:function(e){var t=this;this.shareFlag&&(this.shareFlag=!1,e.apply(this,arguments),setTimeout(function(){t.shareFlag=!0},2e3))}},{key:"loginEvent",value:function(){(0,_indexWeapp.goToLogin)({localTargetUrl:"/pages/bean-t/index"})}},{key:"componentDidHide",value:function(){}},{key:"isPhoneX",value:function(){if(!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/))return 812==screen.height&&375==screen.width}},{key:"goToLoginProps",value:function(){this.setState({isShowLogin:!1})}},{key:"setWaterFormGuideFalse",value:function(){this.setState({waterFromGuide:!1})}},{key:"setShowRisePopByChild",value:function(e){this.setState({showRisePop:!0,levelData:e})}},{key:"monitorReport",value:function(){if(MONITOR_REPORT.monitorReportFlag){var e=MONITOR_ID.beans.index.request,t=MONITOR_ID.beans.index.render;try{var n=getApp(),o=MONITOR_REPORT.signInfoRequestEndTime-MONITOR_REPORT.signInfoRequestPreTime,i=(n.reportPerformance(e,o),Date.now()-MONITOR_REPORT.startTime-o);n.reportPerformance(t,i),MONITOR_REPORT.monitorReportFlag=!1}catch(e){}}}},{key:"anonymousFunc0",value:function(e){}},{key:"anonymousFunc1",value:function(e){}},{key:"anonymousFunc2",value:function(e){}},{key:"anonymousFunc3",value:function(e){}},{key:"anonymousFunc4",value:function(e){}},{key:"anonymousFunc5",value:function(e){}},{key:"anonymousFunc6",value:function(e){}},{key:"anonymousFunc7",value:function(e){}},{key:"anonymousFunc8",value:function(e){}},{key:"anonymousFunc9",value:function(e){}},{key:"anonymousFunc10",value:function(e){}},{key:"anonymousFunc11",value:function(e){}},{key:"anonymousFunc12",value:function(e){}},{key:"anonymousFunc13",value:function(e){}},{key:"anonymousFunc14",value:function(e){}},{key:"anonymousFunc15",value:function(e){}},{key:"anonymousFunc16",value:function(e){}},{key:"anonymousFunc17",value:function(e){}},{key:"anonymousFunc18",value:function(e){}}]),a}(),_class.$$events=["loginEvent","getCurrentLocation","anonymousFunc3","anonymousFunc4","anonymousFunc5","anonymousFunc6","anonymousFunc7","anonymousFunc8"],_class.options={addGlobalClass:!0},_class.multipleSlots=!0,_class.$$componentPath="pages/bean-t/index",_temp2);exports.default=Bean,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(Bean,!0));