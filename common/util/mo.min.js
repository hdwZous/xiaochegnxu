!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.jm=e.jm||{},e.jm.mpagent={}))}(this,function(e){"use strict";var t,n={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode(e){var t,n,r,a,o,i,s,c="",u=0;for(e=this._utf16to8(e);u<e.length;)a=(t=e.charCodeAt(u++))>>2,o=(3&t)<<4|(n=e.charCodeAt(u++))>>4,i=(15&n)<<2|(r=e.charCodeAt(u++))>>6,s=63&r,isNaN(n)?i=s=64:isNaN(r)&&(s=64),c=c+this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(i)+this._keyStr.charAt(s);return c},decode(e){var t,n,r,a,o,i,s="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)t=this._keyStr.indexOf(e.charAt(c++))<<2|(a=this._keyStr.indexOf(e.charAt(c++)))>>4,n=(15&a)<<4|(o=this._keyStr.indexOf(e.charAt(c++)))>>2,r=(3&o)<<6|(i=this._keyStr.indexOf(e.charAt(c++))),s+=String.fromCharCode(t),64!=o&&(s+=String.fromCharCode(n)),64!=i&&(s+=String.fromCharCode(r));return this._utf8to16(s)},_utf16to8:function(e){var t,n,r,a;for(t="",r=e.length,n=0;n<r;n++)(a=e.charCodeAt(n))>=1&&a<=127?t+=e.charAt(n):a>2047?(t+=String.fromCharCode(224|a>>12&15),t+=String.fromCharCode(128|a>>6&63),t+=String.fromCharCode(128|a>>0&63)):(t+=String.fromCharCode(192|a>>6&31),t+=String.fromCharCode(128|a>>0&63));return t},_utf8to16(e){var t,n,r,a,o,i;for(t="",r=e.length,n=0;n<r;)switch((a=e.charCodeAt(n++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:t+=e.charAt(n-1);break;case 12:case 13:o=e.charCodeAt(n++),t+=String.fromCharCode((31&a)<<6|63&o);break;case 14:o=e.charCodeAt(n++),i=e.charCodeAt(n++),t+=String.fromCharCode((15&a)<<12|(63&o)<<6|(63&i)<<0)}return t}},a=!1,o=!1,i=!1,s=!1,c="develop";"undefined"!=typeof tt&&tt?(t=tt,o=!0):"undefined"!=typeof swan&&swan?(t=swan,i=!0):"undefined"!=typeof wx&&wx?(t=wx,a=!0):"undefined"!=typeof jd&&jd&&(t=jd,s=!0);var u=256,d=256,f=6e5,p=1500,h=!0,l=!0,m=5,g=[500,1500],v="2.6.4",y="MP_UUID",S="CONFIG_MONITOR",D="SAMPLING",E="SETDATA_THRESHOLD",T="SETDATA_TRACE",O="SETDATA_TRACEHINT",x="SETDATA_TIME_INTERVAL",b="REQUEST_HEADER_DATA",q="REQUEST_RESPONSE_DATA",I="recordCustomTime",A="RECORD_METHOD",k="request",R="api",C=["success","fail"];var w=Object.assign({latitude:"",longitude:"",accuracy:"",net:""},function(){var e={appid:"",envVersion:"",appVersion:""};if(a){var n=t.getAccountInfoSync().miniProgram;e.appid=n.appId,e.envVersion=n.envVersion,e.appVersion=n.version}else if(o)e.envVersion=t.env.VERSION;else if(i){let t=swan.getEnvInfoSync();t instanceof Error||(e.envVersion=t.env)}return e}(),function(){var e={};if(s)t.getSystemInfo({success(t){for(var n in(e=t).machineType=e.model,delete e.model,e.os=e.system,delete e.system,e.screen=e.screenWidth+"*"+e.screenHeight,delete e.screenWidth,delete e.screenHeight,e.sdkVersion=e.SDKVersion,delete e.SDKVersion,console.log(e),e)e[n]=e[n]+"";w=Object.assign({},e)}});else{e=t.getSystemInfoSync(),console.log(e),delete e.safeArea,e.machineType=e.model,delete e.model;var n=e.system.split(" ");for(var r in e.os=n[0],e.osVersion=n[1],delete e.system,e.screen=e.screenWidth+"*"+e.screenHeight,delete e.screenWidth,delete e.screenHeight,e.sdkVersion=e.SDKVersion,delete e.SDKVersion,e)e[r]=e[r]+""}return e}()),P={mpVersion:"0.0.9",hookApp:function(e){return 0<=Xe(w,v)||!Te()?e:Pe.apply(this,arguments)},hookPage:function(e){return 0<=Xe(w,v)||!Te()?e:_e.apply(this,arguments)},hookComponent:function(e){return 0<=Xe(w,v)||!Te()?e:Me.apply(this,arguments)},request:ze},L={machineCode:function(){var e=t.getStorageSync(y);e||(e=function(){function e(e){return e<0?NaN:e<=30?0|Math.random()*(1<<e):e<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):NaN}function t(e,t){for(var n=e.toString(16),r=t-n.length,a="0";0<r;r>>>=1,a+=a)1&r&&(n=a+n);return n}return t(e(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12)}(),t.setStorageSync(y,e));return e}(),mpVersion:"0.0.9"},j=Se(),N={context:null},_={},H=[],M=[],F=t.request,V={},K={},J=[],U=0,z={},B={stuck:!1,firstLoad:0,jsError:!1,netError:!1},G={canSend:!1,sent:!1,apiRemain:0,isResetPerformanceData:!1},W=[],Q=!1,Z=!1;u=256,d=256,f=6e5;function X(e){return function(t){return"Array"===e&&Array.isArray?Array.isArray(t):Object.prototype.toString.call(t)==="[object "+e+"]"}}function Y(e){return X("String")(e)}function $(e){return X("Array")(e)}function ee(e){return X("Function")(e)}function te(e){return X("Object")(e)}function ne(e){return X("Number")(e)}var re=le(D),ae=le(A)||!1,oe=le(b)||_.reqHeaderData||!1,ie=le(q)||_.reqResponseData||!0;function se(e,t){return function(){if(ee(t))try{t.apply(this,arguments)}catch(e){}if(ee(e))return e.apply(this,arguments)}}function ce(e,t,n){return function(){var r;if(ee(t))try{t.apply(this,arguments)}catch(e){}if(ee(e)&&(r=e.apply(this,arguments)),ee(n))try{n.apply(this,arguments)}catch(e){}return r}}function ue(){for(var e=0;e<arguments.length;e++)if(null!=arguments[e])return arguments[e]}function de(e,t){var n="",r=!1;try{n=e.errMsg?e.errMsg:e,n=JSON.stringify(n)}catch(e){n="",r=!0}return t?{error:r,value:n}:n}function fe(e,t){var n;return n=te(e)?de(e):Y(e)?e:"",t&&(n=n.substring(0,t)),n}function pe(e){return null!=e&&ne(e)}function he(e){return null!=e&&function(e){return X("Boolean")(e)}(e)}function le(e){var n=t.getStorageSync(S);if(n&&te(n))return n[e]}function me(){return+new Date}function ge(){U=me()}function ve(){H=[]}function ye(){return H.slice()}function Se(){return{pageId:0,requestId:0,apiId:0,setData:{threshold:ue(le(E),p),setDataTrace:ue(le(T),h),setDataTraceHint:ue(le(O),l),setDataTimeInterval:ue(le(x),g),stuck:!1,max:0,currentSegmentTime:0,data:{},requestBridge:[]},request:{headerData:ue(le(b),oe),responseData:ue(le(q),ie)},reqStat:{currentSegmentTime:0,data:{}},apis:[],lastSetDataInOnReady:0,stuck:!1,jsError:!1,netError:!1,recordFirstLoad:!1}}function De(){B={stuck:!1,firstLoad:0,jsError:!1,netError:!1}}function Ee(e,n){var r=this,a={};e.forEach(function(e){var t=e.key,o=e.storeKey,i=e.validFunc;i&&i.call(r,n[t])&&(_[t]=n[t],a[o]=n[t])}),function(e){var n=t.getStorageSync(S);if(n&&te(n)||(n={}),e)for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);t.setStorageSync(S,n)}(a)}function Te(){return Q}function Oe(e,t,n,r,a){var o;this.id=++j.pageId,this.parent=e||null,this.name=t||"<root>",this.type=n||"event",this.subType="event"===this.type?r||"tap":r,this.requests=[],this.apis=[],this.remain=(o={},["request","api"].forEach(function(e){o[e]={current:0,children:0}}),o),this.start=me(),this.endTime=null,this.data=a;var i=this,s=_&&_.eventTimeout||f;this.interval=setTimeout(function(){i.timeout()},s),this.closed=!1,this.path=z.current,this.prevPath=z.prev}function xe(e,t){if(te(e)&&ee(e.handler)){var n=e.name,r=e.handler,a=e.afterHandler;t[n]=ce(t[n],r,a)}}function be(e){return _.ignoredPages&&$(_.ignoredPages)?_.ignoredPages.indexOf(e)<0:!_.pages||!$(_.pages)||-1<_.pages.indexOf(e)}function qe(e){var r=Object.assign({},L,w||{},{appOnLaunch:V.onLaunch+""||"",appOnShow:V.onShow+""||"",appOnHide:V.onHide+""||""},{appid:_.appKey},{wxAppid:w.appid},{dimension:"app",app:"vapp",curTime:me()+""});_.appKey&&_.url&&t.request({url:"".concat(_.url,"/v2/report?functionId=vappGetRule&appid="+_.serverName),data:{body:n.encode(JSON.stringify(r)),sdkVersion:"E1.1"},header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",_no_record:!0,success:function(e){var n,r,a,o=e.data||{},i=e.statusCode,s=o.data;200===i&&s&&pe(s.sampling)&&(re=s.sampling)&&function(e){var n=t.getStorageSync(S);if(n&&te(n)||(n={}),e)for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);t.setStorageSync(S,n)}((a=re,(r=D)in(n={})?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,n)),200===i&&Ee([{key:"setdataThreshold",storeKey:E,validFunc:pe},{key:"setdataTrace",storeKey:T,validFunc:he},{key:"setdataTraceHint",storeKey:O,validFunc:he},{key:"requestHeaderData",storeKey:b,validFunc:he},{key:"requestResponseData",storeKey:q,validFunc:he},{key:"recordMethod",storeKey:A,validFunc:he}],s)},complete:function(){e&&e(re)}})}function Ie(e,t,n){for(var r in t)if(t.hasOwnProperty(r)&&t[r]&&0<t[r].count&&("request"==n&&t[r].url||"setData"==n)){var a=t[r];a.traces=void 0!=t[r].traces?JSON.stringify(t[r].traces):"[]",e.push(Object.assign(a||{},{occurTime:+r},{type:n,typeId:1,chId:"setData"==n?21:23}))}}function Ae(e){var t=[];return e.length>0&&e.forEach(function(e){var n,r,a,o,i={};i.occurTime=e.occurTime,i.stack=e.stack,i.type="error",i.errorType=(n=e.stack,/ReferenceError/.test(n)?"ReferenceError":/TypeError/.test(n)?"TypeError":/URIError/.test(n)?"URIError":/RangeError/.test(n)?"RangeError":/SyntaxError/.test(n)?"SyntaxError":"Error"),i.methods=(r=e.methods,a=getCurrentPages(),o={},a.length&&(o=a[a.length-1]),r.forEach(function(e){e.currentRoute||(e.currentRoute=z.current?z.current:"",e.prevRoute=z.prev?z.prev:"",e.options=o.options?o.options:"")}),JSON.stringify(r)),i.typeId=1,i.chId=20,t.push(i)}),t}function ke(e){return e.forEach(function(e){for(var t in e)e[t]=e[t]+"";return e}),e}function Re(e){if(Z&&(G.canSend=!0,!G.sent&&G.canSend)){var r=getCurrentPages(),a={};r.length&&(a=r[r.length-1]);var o=ke(Ae(J.slice())),i=function(){var e=[],t=[],n=[];Ie(e,j.setData.data,"setData"),Ie(n,j.reqStat.data,"request");var r={jsError:(J&&0<J.length)+"",netError:j.netError+"",stuck:j.stuck+"",threshold:ue(j.setData.threshold,p)+"",setDataTrace:ue(j.setData.setDataTrace,h)+"",setDataTraceHint:ue(j.setData.setDataTraceHint,l)+"",max:j.setData.max+""};if(B={jsError:J&&0<J.length,netError:j.netError,stuck:j.stuck},0<e.length&&(t=j.setData.requestBridge).forEach(function(e){e.type="requestBridge",e.typeId=1,e.chId=22}),K.onLoad){var a=j.lastSetDataInOnReady;if(a=a||K.onReady){var o=a-K.onLoad;o=0<o?o:0,r.firstLoad=o+""}}return{allData:r,setData:e,requestBridge:t,requestData:n}}();!function(e){H.push({occurTime:me(),route:e,type:"route",typeId:1,chId:19})}(z.current);var u=ke(ye()),d=ke(i.setData),f=ke(i.requestBridge),m=ke(i.requestData),g=function(e){var t=0,n=[];return e.length>0&&(e.forEach(function(e){n.push(parseInt(e.duration))}),n.sort(),t=n[n.length-1]+""),t}(m),v=function(e){var t,n=0,r=[];return e.length>0&&(r=e.sort((t="endTime",function(e,n){return e[t]-n[t]})),n=K.onLoad?r[0].end-K.onLoad:r[0].end-r[0].start),n+""}(m);u[0]&&(u[0].firstResponse=v);var y=ke(j.apis),S=Object.assign({},{dimension:"page",app:"vapp",curTime:me()+"",maxRequest:g+"",path:z.current,pageOnLoad:K.onLoad+""||"",pageOnshow:K.onShow+""||"",pageOnReady:K.onReady+""||"",pageOnHide:K.onHide+""||"",appOnLaunch:V.onLaunch+""||"",appOnShow:V.onShow+""||"",appOnHide:V.onHide+""||"",data:[],options:a.options?JSON.stringify(a.options):"",fromPath:z.prev||""},Object.assign({},L,w||{},{wxAppid:w.appid}),{appid:_.appKey},0<U?{customTime:U}:{},i.allData);y.length>0&&(S.data=S.data.concat(y)),u.length>0&&(S.data=S.data.concat(u)),o.length>0&&(S.data=S.data.concat(o)),d.length>0&&(S.data=S.data.concat(d)),f.length>0&&(S.data=S.data.concat(f)),m.length>0&&(S.data=S.data.concat(m)),s&&(S.envVersion=c),t.request({url:"".concat(_.url,"/v2/report?functionId=vappReport&appid="+_.serverName),data:{body:n.encode(JSON.stringify(S)),sdkVersion:"E1.1"},header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",_no_record:!0,success:function(){}}),ve(),M=[],K={},J=[],U=0,G.apiRemain=0,j=Se(),G.needClearDeferredData=!0,G.sent=!0,G.canSend=!1}}function Ce(e){if(Z){var r=Object.assign({},L,w||{},{appOnLaunch:V.onLaunch+""||"",appOnShow:V.onShow+""||"",appOnHide:V.onHide+""||""},{appid:_.appKey},{wxAppid:w.appid},{dimension:"app",app:"vapp",curTime:me()+""});e&&(r.data=e.routeTrack,r.closePath=e.closePath,r.jsError=e.metric.jsError+"",r.netError=e.metric.netError+"",r.stuck=e.metric.stuck+""),s&&(r.envVersion=c),t.request({url:"".concat(_.url,"/v2/report?functionId=vappReport&appid="+_.serverName),data:{body:n.encode(JSON.stringify(r)),sdkVersion:"E1.1"},header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",_no_record:!0,success:function(){}})}}setInterval(qe,f),Oe.prototype.end=function(e,t){if(!this.closed){if(e&&(e.type===k||e.type===R)){var n=e.requests||[],r=e.apis||[];this.requests.map(function(t){"".concat(t.url,"-").concat(t.requestId)===e.name&&(t.requests=n,t.apis=r)}),this.apis.map(function(t){"".concat(t.name,"-").concat(t.apiId)===e.name&&(t.requests=n,t.apis=r)})}(this.isNoRemain()||t)&&(this.endTime=me(),this.closed=!0,this.interval&&clearTimeout(this.interval),this.parent&&this.parent.end(this))}},Oe.prototype.isNoRemain=function(e){var t=!0;for(var n in this.remain)if(this.remain.hasOwnProperty(n)&&!(this.remain[n].current<=0&&(e||this.remain[n].children<=0))){t=!1;break}return t},Oe.prototype.timeout=function(){this.end(null,!0)},Oe.prototype.setData=function(e){this.data=e},Oe.prototype.hasPrevAssignedData=function(){return this.requests&&0<this.requests.length||this.apis&&0<this.apis.length},Oe.prototype.canEnd=function(e,t){return this.isNoRemain(!0)},Oe.prototype.updateRemain=function(e,t){t=t||k;var n=e||0;this.remain[t].current=this.remain[t].current+n;for(var r=this.parent;r;)r.remain[t].children=r.remain[t].children+n,r=r.parent},Object.defineProperty(Oe.prototype,"current",{get:function(){return N.context},enumerable:!0,configurable:!0}),Object.defineProperty(Oe,"createEvent",{value:function(e,t,n,r,a){return new Oe(e,t,n||"event",r||null,a)},enumerable:!0,configurable:!0,writable:!0});var we=[{name:"onLaunch",handler:function(e){V.onLaunch=me(),function(){re=re||+_.sampleRate||1;var e=Math.random();Z=e<=re}();var n=e.path,r=JSON.stringify(e.query),a=e.scene+"";w.openPath=n,_.disableFetchQuery||(w.query=r),w.scene=a,t.getSetting({success(e){e.authSetting["scope.userLocation"]&&t.getLocation({type:"wgs84",success:e=>{w.latitude=e.latitude+"",w.longitude=e.longitude+"",w.accuracy=e.accuracy+""}})}}),t.getNetworkType({success:function(e){w.net=e.networkType},complete:function(){Ce()}})}},{name:"onError",handler:function(e){var t="",n="";if(Y(e)?t=e:e&&(t=e.stack,n=e.message),t){var r={occurTime:me(),stack:t,methods:[]};M&&M.length>0&&(r.methods=M),M=[],n&&(r.msg=n),J.push(r)}}},{name:"onShow",handler:function(){V.onShow=me()}},{name:"onHide",handler:function(){V.onHide=me();var e=ye();ve();var t=z.current;z.prev="",z.current="",Ce({routeTrack:e,closePath:t,metric:B})}}];function Pe(e){return we.forEach(function(t){xe(t,e)}),e}function Le(){var e=App;App=function(t){if(t=Pe(t),e)return e.call(this,t)}}var je=[{name:"onLoad",handler:function(){be(this.route)&&(G.isResetPerformanceData&&(De(),G.isResetPerformanceData=!1),j.recordFirstLoad=!0,K.onLoad=me(),function(){var e=this.setData,t=j.setData.threshold,n=j.setData.setDataTrace,r=j.setData.setDataTraceHint;j.setData.setDataTimeInterval;try{Object.defineProperty(this,"setData",{enumerable:!0,configurable:!0,writable:!0,value:function(){var a=arguments[0],o=arguments[1],i=me(),s={start:i},c=N.context,u=c&&c.type===k&&c.data&&c.data.recordFirstLoad;(j.recordFirstLoad||u)&&(s.calcFirstLoad=!0);try{j.setData.currentSegmentTime,j.setData.currentSegmentTime=i,j.setData.data[i]={count:0,traces:[]},s.segmentTime=i}catch(e){}return e.call(this,arguments[0],function(){try{s.end=me(),s.calcFirstLoad&&s.end>j.lastSetDataInOnReady&&(j.lastSetDataInOnReady=s.end),s.duration=s.end-s.start;var e=j.setData.data[s.segmentTime];if(e.count++,s.duration>j.setData.max&&(j.setData.max=s.duration),s.duration>t&&(j.stuck||(j.stuck=!0)),e.traces.length<m&&n)try{var i=de(a,!0),d={timestamp:s.start,duration:s.duration,size:i.value.length};r&&(d.hint=i.value.substring(0,200)),i.error&&(d.error=i.error),e.traces.push(d),e.duration=s.duration}catch(e){}u&&j.setData.requestBridge.push({start:s.start,end:s.end,occurTime:s.start,requestId:c.data.requestId,url:c.data.url})}catch(e){}return o&&o.apply(this,arguments)})}})}catch(e){console.log("rewriteSetData",e)}}.call(this))}},{name:"onShow",handler:function(){be(this.route)&&(G.isResetPerformanceData&&(De(),G.isResetPerformanceData=!1),K.onShow=me(),z.prev=z.current,z.current=this.route,G.sent=!1)}},{name:"onReady",handler:function(){be(this.route)&&(K.onReady=me())},afterHandler:function(){be(this.route)&&(j.recordFirstLoad=!1)}},{name:"onHide",handler:function(){be(this.route)&&(K.onHide=me(),Re())}},{name:"onUnload",handler:function(){be(this.route)&&(K.onUnload=me(),Re())}}];function Ne(e,t){var n=getCurrentPages();n.length&&n[n.length-1],e[t]=se(e[t],function(){var e,n={occurTime:me(),method:t};e=n,M.push(e),M.length>20&&M.shift()})}function _e(e){return je.forEach(function(t){xe(t,e)}),ae&&Object.keys(e).forEach(t=>{!(["onLoad","onShow","onReady","onHide","onUnload","onPageScroll"].indexOf(t)>=0)&&"function"==typeof e[t]&&Ne(e,t)}),e[I]=ge,e}function He(){var e=Page;Page=function(t){if(t=_e(t),e)return e.call(this,t)}}function Me(e){return e.methods||(e.methods={}),je.forEach(function(t){xe(t,e.methods)}),e}function Fe(){var e=Component;Component=function(t){t=Me(t),e&&e.call(this,t)}}function Ve(e){return function(e){var t=N.context;return function(){var n,r=N.context;N.context=t;try{n=e.apply(this,arguments)}finally{r&&!r.closed&&(N.context=r)}return n}}(e)}function Ke(e){return e?te(e)?de(e).length:Y(e)?e.length:e instanceof ArrayBuffer?e.byteLength:e.length?e.length:0:0}function Je(e,t,n){var r=j.request.headerData,a=j.request.responseData;return Object.assign({requestId:e.requestId,type:k,url:e.url,method:e.method,start:e.start,end:e.end,cbTime:e.cbTime,duration:0<e.end-e.start?e.end-e.start:0,send:Ke(t.data),rec:function(e){if(!e)return 0;var t=e.header,n=e.data,r=0;return(r=+(t&&t["Content-Length"]))&&ne(r)&&!Number.isNaN(r)||(r=Ke(n)||0),r}(n),statusCode:n.statusCode||0,failMessage:e.failMessage||"",recordFirstLoad:e.recordFirstLoad},r?{sendData:JSON.stringify(t.data)}:{},a?{recData:JSON.stringify(n)}:{})}function Ue(e,t){if(!e.context){var n="".concat(e.url,"-").concat(e.requestId);e.context=Oe.createEvent(t,n,k,null,{url:e.url,requestId:e.requestId,recordFirstLoad:e.recordFirstLoad})}N.context=e.context}var ze=function(e){var t=e||{};if(!t._no_record&&t.url&&Te()){var n=me(),r=j.reqStat.currentSegmentTime;r=n,j.reqStat.currentSegmentTime=n,j.reqStat.data[r]={count:0},j.reqStat.data[r].count++;var a=N.context,o={requestId:++j.requestId,url:t.url,method:t.method&&t.method.toUpperCase()||"GET",callbackContextCreated:!1,cbTime:0,recordFirstLoad:j.recordFirstLoad,statusCode:t.statusCode};o.id=me()%1e9,t.header=t.header||{};var i=t.success,s=t.fail,c=t.complete;t.success=Ve(function(){var e;if(o.end||(o.end=me()),Ue(o,a),i){var t=me();try{e=i.apply(this,arguments)}finally{var n=me()-t;0<n&&(o.cbTime+=n)}}return e}),t.fail=Ve(function(){var e;if(o.end||(o.end=me()),Ue(o,a),s){var t=me();try{e=s.apply(this,arguments)}finally{var n=me()-t;0<n&&(o.cbTime+=n)}}return e}),t.complete=Ve(function(e){var n,i;o.end||(o.end=me());var s=_.custom;if(s&&ee(s))try{var u=s.apply(this,arguments);te(u)&&(i={custom:u})}catch(e){}if(Ue(o,a),c){var d=me();try{n=c.apply(this,arguments)}finally{var f=me()-d;0<f&&(o.cbTime+=f)}}var p=void 0==e.statusCode||200!=e.statusCode;if(p&&!j.netError&&(j.netError=!0),p&&e){var h=e.data||e.errMsg||"request failed";o.failMessage=fe(h,_.requestFailMessageSize)}o.failMessage=o.failMessage?o.failMessage:"";var l=Je(o,t,e),m=Object.assign({},l||{},i||{});return j.reqStat.data[r]=Object.assign({},j.reqStat.data[r],m),function(e,t,n){N.context&&N.context.setData(n);var r=N.context&&N.context.hasPrevAssignedData(),a=N.context&&N.context.canEnd();a&&N.context.end(),t&&t.id===e.cid&&n&&(t.requests.push(n),t.updateRemain(-1,k),t.canEnd()&&a&&t.end(r?N.context:null))}(o,a,m),n}),o.start=n,a&&(o.cid=a.id,a.updateRemain(1))}return F.apply(this,arguments)};function Be(){Object.defineProperty(t,"request",{configurable:!0,enumerable:!0,writable:!0,value:ze})}function Ge(){_.hookApis&&_.hookApis.length>0&&_.hookApis.forEach(function(e){-1<W.indexOf(e)||"request"===e||W.push(e)})}function We(e,t){if(!e.context){var n="".concat(e.name,"-").concat(e.apiId);e.context=Oe.createEvent(t,n,R)}N.context=e.context}function Qe(e){var n=t[e];return function(){var t=N.context,a=arguments[0]||{},o={apiId:++j.apiId,name:e};return C.forEach(function(e){a[e]=Ve(se(a[e],function(){if(o.end||(o.end=me()),We(o,t),"fail"===e){o[e]=1;var n=arguments&&arguments[0];o.failMessage=fe(n,_.apiFailMessageSize)}}))}),a.complete=Ve(ce(a.complete,function(){o.end||(o.end=me()),We(o,r)},function(){var e,n={apiId:(e=o).apiId,type:"api",typeId:1,chId:18,name:e.name,start:e.start,occurTime:e.start,end:e.end,duration:0<e.end-e.start?e.end-e.start:0,count:1,failMessage:e.failMessage||""};!function(e,t,n){N.context&&N.context.setData(n);var r=N.context&&N.context.hasPrevAssignedData(),a=N.context&&N.context.canEnd();j.apis.push(n),a&&N.context.end(),t&&t.id===e.cid&&n&&(t.apis.push(n),t.updateRemain(-1,R),t.canEnd()&&a&&t.end(r?N.context:null))}(o,t,n)})),t&&(o.cid=t.id,t.updateRemain(1,"api")),o.start=me(),n.apply(this,arguments)}}function Ze(){Ge(),W.forEach(function(e){var n;(n=e)&&t[n]&&Object.defineProperty(t,n,{configurable:!0,enumerable:!0,writable:!0,value:Qe(n)})})}function Xe(e,t){var n="";return e&&(n=e.sdkVersion),n&&t?function(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var r=0;r<n;r++){var a=parseInt(e[r]),o=parseInt(t[r]);if(o<a)return 1;if(a<o)return-1}return 0}(n,t):-1}function Ye(e){a&&((!e||0<=Xe(w,v))&&(Le(),He(),Fe(),Be(),Ze()),e&&Object.assign(P,function(){Ge();var e={};return W.forEach(function(t){e[t]=Qe(t)}),e}()||{})),(o||i||s)&&(Le(),He(),Fe(),Be(),Ze())}function $e(e){if(e.jdEnv&&(c=e.jdEnv),!Te()){(function(e){null==(_=e||{}).requestFailMessageSize&&(_.requestFailMessageSize=u),null==_.apiFailMessageSize&&(_.apiFailMessageSize=d)})(e||{}),Q=!0,qe();var t=!0;null!=_.plugin&&(t=_.plugin),Ye(t)}}t.onNetworkStatusChange(function(e){w.net=e.networkType});var et=(P.config=$e,P);e.monitor=et,e.default=et,Object.defineProperty(e,"__esModule",{value:!0})});
